(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const y of document.querySelectorAll('link[rel="modulepreload"]'))d(y);new MutationObserver(y=>{for(const w of y)if(w.type==="childList")for(const T of w.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&d(T)}).observe(document,{childList:!0,subtree:!0});function o(y){const w={};return y.integrity&&(w.integrity=y.integrity),y.referrerPolicy&&(w.referrerPolicy=y.referrerPolicy),y.crossOrigin==="use-credentials"?w.credentials="include":y.crossOrigin==="anonymous"?w.credentials="omit":w.credentials="same-origin",w}function d(y){if(y.ep)return;y.ep=!0;const w=o(y);fetch(y.href,w)}})();var xS=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function w_(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Dx={exports:{}},dp={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bS=Symbol.for("react.transitional.element"),wS=Symbol.for("react.fragment");function Ix(i,a,o){var d=null;if(o!==void 0&&(d=""+o),a.key!==void 0&&(d=""+a.key),"key"in a){o={};for(var y in a)y!=="key"&&(o[y]=a[y])}else o=a;return a=o.ref,{$$typeof:bS,type:i,key:d,ref:a!==void 0?a:null,props:o}}dp.Fragment=wS;dp.jsx=Ix;dp.jsxs=Ix;Dx.exports=dp;var Eg=Dx.exports,kx={exports:{}},Te={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var S_=Symbol.for("react.transitional.element"),SS=Symbol.for("react.portal"),TS=Symbol.for("react.fragment"),AS=Symbol.for("react.strict_mode"),ES=Symbol.for("react.profiler"),MS=Symbol.for("react.consumer"),zS=Symbol.for("react.context"),CS=Symbol.for("react.forward_ref"),DS=Symbol.for("react.suspense"),IS=Symbol.for("react.memo"),Rx=Symbol.for("react.lazy"),rv=Symbol.iterator;function kS(i){return i===null||typeof i!="object"?null:(i=rv&&i[rv]||i["@@iterator"],typeof i=="function"?i:null)}var Px={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Lx=Object.assign,Bx={};function Nc(i,a,o){this.props=i,this.context=a,this.refs=Bx,this.updater=o||Px}Nc.prototype.isReactComponent={};Nc.prototype.setState=function(i,a){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,a,"setState")};Nc.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function Ox(){}Ox.prototype=Nc.prototype;function T_(i,a,o){this.props=i,this.context=a,this.refs=Bx,this.updater=o||Px}var A_=T_.prototype=new Ox;A_.constructor=T_;Lx(A_,Nc.prototype);A_.isPureReactComponent=!0;var sv=Array.isArray,mi={H:null,A:null,T:null,S:null,V:null},Fx=Object.prototype.hasOwnProperty;function E_(i,a,o,d,y,w){return o=w.ref,{$$typeof:S_,type:i,key:a,ref:o!==void 0?o:null,props:w}}function RS(i,a){return E_(i.type,a,void 0,void 0,void 0,i.props)}function M_(i){return typeof i=="object"&&i!==null&&i.$$typeof===S_}function PS(i){var a={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(o){return a[o]})}var ov=/\/+/g;function Gm(i,a){return typeof i=="object"&&i!==null&&i.key!=null?PS(""+i.key):a.toString(36)}function lv(){}function LS(i){switch(i.status){case"fulfilled":return i.value;case"rejected":throw i.reason;default:switch(typeof i.status=="string"?i.then(lv,lv):(i.status="pending",i.then(function(a){i.status==="pending"&&(i.status="fulfilled",i.value=a)},function(a){i.status==="pending"&&(i.status="rejected",i.reason=a)})),i.status){case"fulfilled":return i.value;case"rejected":throw i.reason}}throw i}function rc(i,a,o,d,y){var w=typeof i;(w==="undefined"||w==="boolean")&&(i=null);var T=!1;if(i===null)T=!0;else switch(w){case"bigint":case"string":case"number":T=!0;break;case"object":switch(i.$$typeof){case S_:case SS:T=!0;break;case Rx:return T=i._init,rc(T(i._payload),a,o,d,y)}}if(T)return y=y(i),T=d===""?"."+Gm(i,0):d,sv(y)?(o="",T!=null&&(o=T.replace(ov,"$&/")+"/"),rc(y,a,o,"",function(ct){return ct})):y!=null&&(M_(y)&&(y=RS(y,o+(y.key==null||i&&i.key===y.key?"":(""+y.key).replace(ov,"$&/")+"/")+T)),a.push(y)),1;T=0;var f=d===""?".":d+":";if(sv(i))for(var q=0;q<i.length;q++)d=i[q],w=f+Gm(d,q),T+=rc(d,a,o,w,y);else if(q=kS(i),typeof q=="function")for(i=q.call(i),q=0;!(d=i.next()).done;)d=d.value,w=f+Gm(d,q++),T+=rc(d,a,o,w,y);else if(w==="object"){if(typeof i.then=="function")return rc(LS(i),a,o,d,y);throw a=String(i),Error("Objects are not valid as a React child (found: "+(a==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":a)+"). If you meant to render a collection of children, use an array instead.")}return T}function of(i,a,o){if(i==null)return i;var d=[],y=0;return rc(i,d,"","",function(w){return a.call(o,w,y++)}),d}function BS(i){if(i._status===-1){var a=i._result;a=a(),a.then(function(o){(i._status===0||i._status===-1)&&(i._status=1,i._result=o)},function(o){(i._status===0||i._status===-1)&&(i._status=2,i._result=o)}),i._status===-1&&(i._status=0,i._result=a)}if(i._status===1)return i._result.default;throw i._result}var cv=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)};function OS(){}Te.Children={map:of,forEach:function(i,a,o){of(i,function(){a.apply(this,arguments)},o)},count:function(i){var a=0;return of(i,function(){a++}),a},toArray:function(i){return of(i,function(a){return a})||[]},only:function(i){if(!M_(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};Te.Component=Nc;Te.Fragment=TS;Te.Profiler=ES;Te.PureComponent=T_;Te.StrictMode=AS;Te.Suspense=DS;Te.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=mi;Te.__COMPILER_RUNTIME={__proto__:null,c:function(i){return mi.H.useMemoCache(i)}};Te.cache=function(i){return function(){return i.apply(null,arguments)}};Te.cloneElement=function(i,a,o){if(i==null)throw Error("The argument must be a React element, but you passed "+i+".");var d=Lx({},i.props),y=i.key,w=void 0;if(a!=null)for(T in a.ref!==void 0&&(w=void 0),a.key!==void 0&&(y=""+a.key),a)!Fx.call(a,T)||T==="key"||T==="__self"||T==="__source"||T==="ref"&&a.ref===void 0||(d[T]=a[T]);var T=arguments.length-2;if(T===1)d.children=o;else if(1<T){for(var f=Array(T),q=0;q<T;q++)f[q]=arguments[q+2];d.children=f}return E_(i.type,y,void 0,void 0,w,d)};Te.createContext=function(i){return i={$$typeof:zS,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null},i.Provider=i,i.Consumer={$$typeof:MS,_context:i},i};Te.createElement=function(i,a,o){var d,y={},w=null;if(a!=null)for(d in a.key!==void 0&&(w=""+a.key),a)Fx.call(a,d)&&d!=="key"&&d!=="__self"&&d!=="__source"&&(y[d]=a[d]);var T=arguments.length-2;if(T===1)y.children=o;else if(1<T){for(var f=Array(T),q=0;q<T;q++)f[q]=arguments[q+2];y.children=f}if(i&&i.defaultProps)for(d in T=i.defaultProps,T)y[d]===void 0&&(y[d]=T[d]);return E_(i,w,void 0,void 0,null,y)};Te.createRef=function(){return{current:null}};Te.forwardRef=function(i){return{$$typeof:CS,render:i}};Te.isValidElement=M_;Te.lazy=function(i){return{$$typeof:Rx,_payload:{_status:-1,_result:i},_init:BS}};Te.memo=function(i,a){return{$$typeof:IS,type:i,compare:a===void 0?null:a}};Te.startTransition=function(i){var a=mi.T,o={};mi.T=o;try{var d=i(),y=mi.S;y!==null&&y(o,d),typeof d=="object"&&d!==null&&typeof d.then=="function"&&d.then(OS,cv)}catch(w){cv(w)}finally{mi.T=a}};Te.unstable_useCacheRefresh=function(){return mi.H.useCacheRefresh()};Te.use=function(i){return mi.H.use(i)};Te.useActionState=function(i,a,o){return mi.H.useActionState(i,a,o)};Te.useCallback=function(i,a){return mi.H.useCallback(i,a)};Te.useContext=function(i){return mi.H.useContext(i)};Te.useDebugValue=function(){};Te.useDeferredValue=function(i,a){return mi.H.useDeferredValue(i,a)};Te.useEffect=function(i,a,o){var d=mi.H;if(typeof o=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return d.useEffect(i,a)};Te.useId=function(){return mi.H.useId()};Te.useImperativeHandle=function(i,a,o){return mi.H.useImperativeHandle(i,a,o)};Te.useInsertionEffect=function(i,a){return mi.H.useInsertionEffect(i,a)};Te.useLayoutEffect=function(i,a){return mi.H.useLayoutEffect(i,a)};Te.useMemo=function(i,a){return mi.H.useMemo(i,a)};Te.useOptimistic=function(i,a){return mi.H.useOptimistic(i,a)};Te.useReducer=function(i,a,o){return mi.H.useReducer(i,a,o)};Te.useRef=function(i){return mi.H.useRef(i)};Te.useState=function(i){return mi.H.useState(i)};Te.useSyncExternalStore=function(i,a,o){return mi.H.useSyncExternalStore(i,a,o)};Te.useTransition=function(){return mi.H.useTransition()};Te.version="19.1.0";kx.exports=Te;var Zs=kx.exports;const FS=w_(Zs);var Ux={exports:{}},fp={},Nx={exports:{}},Vx={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function a(qt,le){var fe=qt.length;qt.push(le);t:for(;0<fe;){var Ue=fe-1>>>1,Ge=qt[Ue];if(0<y(Ge,le))qt[Ue]=le,qt[fe]=Ge,fe=Ue;else break t}}function o(qt){return qt.length===0?null:qt[0]}function d(qt){if(qt.length===0)return null;var le=qt[0],fe=qt.pop();if(fe!==le){qt[0]=fe;t:for(var Ue=0,Ge=qt.length,Ei=Ge>>>1;Ue<Ei;){var qi=2*(Ue+1)-1,wa=qt[qi],Zi=qi+1,an=qt[Zi];if(0>y(wa,fe))Zi<Ge&&0>y(an,wa)?(qt[Ue]=an,qt[Zi]=fe,Ue=Zi):(qt[Ue]=wa,qt[qi]=fe,Ue=qi);else if(Zi<Ge&&0>y(an,fe))qt[Ue]=an,qt[Zi]=fe,Ue=Zi;else break t}}return le}function y(qt,le){var fe=qt.sortIndex-le.sortIndex;return fe!==0?fe:qt.id-le.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var w=performance;i.unstable_now=function(){return w.now()}}else{var T=Date,f=T.now();i.unstable_now=function(){return T.now()-f}}var q=[],ct=[],vt=1,tt=null,V=3,pt=!1,Jt=!1,Xt=!1,_e=!1,st=typeof setTimeout=="function"?setTimeout:null,nt=typeof clearTimeout=="function"?clearTimeout:null,ut=typeof setImmediate<"u"?setImmediate:null;function bt(qt){for(var le=o(ct);le!==null;){if(le.callback===null)d(ct);else if(le.startTime<=qt)d(ct),le.sortIndex=le.expirationTime,a(q,le);else break;le=o(ct)}}function Ot(qt){if(Xt=!1,bt(qt),!Jt)if(o(q)!==null)Jt=!0,ne||(ne=!0,An());else{var le=o(ct);le!==null&&En(Ot,le.startTime-qt)}}var ne=!1,Nt=-1,te=5,Pe=-1;function ye(){return _e?!0:!(i.unstable_now()-Pe<te)}function me(){if(_e=!1,ne){var qt=i.unstable_now();Pe=qt;var le=!0;try{t:{Jt=!1,Xt&&(Xt=!1,nt(Nt),Nt=-1),pt=!0;var fe=V;try{e:{for(bt(qt),tt=o(q);tt!==null&&!(tt.expirationTime>qt&&ye());){var Ue=tt.callback;if(typeof Ue=="function"){tt.callback=null,V=tt.priorityLevel;var Ge=Ue(tt.expirationTime<=qt);if(qt=i.unstable_now(),typeof Ge=="function"){tt.callback=Ge,bt(qt),le=!0;break e}tt===o(q)&&d(q),bt(qt)}else d(q);tt=o(q)}if(tt!==null)le=!0;else{var Ei=o(ct);Ei!==null&&En(Ot,Ei.startTime-qt),le=!1}}break t}finally{tt=null,V=fe,pt=!1}le=void 0}}finally{le?An():ne=!1}}}var An;if(typeof ut=="function")An=function(){ut(me)};else if(typeof MessageChannel<"u"){var Ai=new MessageChannel,Bi=Ai.port2;Ai.port1.onmessage=me,An=function(){Bi.postMessage(null)}}else An=function(){st(me,0)};function En(qt,le){Nt=st(function(){qt(i.unstable_now())},le)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(qt){qt.callback=null},i.unstable_forceFrameRate=function(qt){0>qt||125<qt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):te=0<qt?Math.floor(1e3/qt):5},i.unstable_getCurrentPriorityLevel=function(){return V},i.unstable_next=function(qt){switch(V){case 1:case 2:case 3:var le=3;break;default:le=V}var fe=V;V=le;try{return qt()}finally{V=fe}},i.unstable_requestPaint=function(){_e=!0},i.unstable_runWithPriority=function(qt,le){switch(qt){case 1:case 2:case 3:case 4:case 5:break;default:qt=3}var fe=V;V=qt;try{return le()}finally{V=fe}},i.unstable_scheduleCallback=function(qt,le,fe){var Ue=i.unstable_now();switch(typeof fe=="object"&&fe!==null?(fe=fe.delay,fe=typeof fe=="number"&&0<fe?Ue+fe:Ue):fe=Ue,qt){case 1:var Ge=-1;break;case 2:Ge=250;break;case 5:Ge=1073741823;break;case 4:Ge=1e4;break;default:Ge=5e3}return Ge=fe+Ge,qt={id:vt++,callback:le,priorityLevel:qt,startTime:fe,expirationTime:Ge,sortIndex:-1},fe>Ue?(qt.sortIndex=fe,a(ct,qt),o(q)===null&&qt===o(ct)&&(Xt?(nt(Nt),Nt=-1):Xt=!0,En(Ot,fe-Ue))):(qt.sortIndex=Ge,a(q,qt),Jt||pt||(Jt=!0,ne||(ne=!0,An()))),qt},i.unstable_shouldYield=ye,i.unstable_wrapCallback=function(qt){var le=V;return function(){var fe=V;V=le;try{return qt.apply(this,arguments)}finally{V=fe}}}})(Vx);Nx.exports=Vx;var US=Nx.exports,jx={exports:{}},Fn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var NS=Zs;function qx(i){var a="https://react.dev/errors/"+i;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var o=2;o<arguments.length;o++)a+="&args[]="+encodeURIComponent(arguments[o])}return"Minified React error #"+i+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Us(){}var On={d:{f:Us,r:function(){throw Error(qx(522))},D:Us,C:Us,L:Us,m:Us,X:Us,S:Us,M:Us},p:0,findDOMNode:null},VS=Symbol.for("react.portal");function jS(i,a,o){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:VS,key:d==null?null:""+d,children:i,containerInfo:a,implementation:o}}var fh=NS.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function pp(i,a){if(i==="font")return"";if(typeof a=="string")return a==="use-credentials"?a:""}Fn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=On;Fn.createPortal=function(i,a){var o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)throw Error(qx(299));return jS(i,a,null,o)};Fn.flushSync=function(i){var a=fh.T,o=On.p;try{if(fh.T=null,On.p=2,i)return i()}finally{fh.T=a,On.p=o,On.d.f()}};Fn.preconnect=function(i,a){typeof i=="string"&&(a?(a=a.crossOrigin,a=typeof a=="string"?a==="use-credentials"?a:"":void 0):a=null,On.d.C(i,a))};Fn.prefetchDNS=function(i){typeof i=="string"&&On.d.D(i)};Fn.preinit=function(i,a){if(typeof i=="string"&&a&&typeof a.as=="string"){var o=a.as,d=pp(o,a.crossOrigin),y=typeof a.integrity=="string"?a.integrity:void 0,w=typeof a.fetchPriority=="string"?a.fetchPriority:void 0;o==="style"?On.d.S(i,typeof a.precedence=="string"?a.precedence:void 0,{crossOrigin:d,integrity:y,fetchPriority:w}):o==="script"&&On.d.X(i,{crossOrigin:d,integrity:y,fetchPriority:w,nonce:typeof a.nonce=="string"?a.nonce:void 0})}};Fn.preinitModule=function(i,a){if(typeof i=="string")if(typeof a=="object"&&a!==null){if(a.as==null||a.as==="script"){var o=pp(a.as,a.crossOrigin);On.d.M(i,{crossOrigin:o,integrity:typeof a.integrity=="string"?a.integrity:void 0,nonce:typeof a.nonce=="string"?a.nonce:void 0})}}else a==null&&On.d.M(i)};Fn.preload=function(i,a){if(typeof i=="string"&&typeof a=="object"&&a!==null&&typeof a.as=="string"){var o=a.as,d=pp(o,a.crossOrigin);On.d.L(i,o,{crossOrigin:d,integrity:typeof a.integrity=="string"?a.integrity:void 0,nonce:typeof a.nonce=="string"?a.nonce:void 0,type:typeof a.type=="string"?a.type:void 0,fetchPriority:typeof a.fetchPriority=="string"?a.fetchPriority:void 0,referrerPolicy:typeof a.referrerPolicy=="string"?a.referrerPolicy:void 0,imageSrcSet:typeof a.imageSrcSet=="string"?a.imageSrcSet:void 0,imageSizes:typeof a.imageSizes=="string"?a.imageSizes:void 0,media:typeof a.media=="string"?a.media:void 0})}};Fn.preloadModule=function(i,a){if(typeof i=="string")if(a){var o=pp(a.as,a.crossOrigin);On.d.m(i,{as:typeof a.as=="string"&&a.as!=="script"?a.as:void 0,crossOrigin:o,integrity:typeof a.integrity=="string"?a.integrity:void 0})}else On.d.m(i)};Fn.requestFormReset=function(i){On.d.r(i)};Fn.unstable_batchedUpdates=function(i,a){return i(a)};Fn.useFormState=function(i,a,o){return fh.H.useFormState(i,a,o)};Fn.useFormStatus=function(){return fh.H.useHostTransitionStatus()};Fn.version="19.1.0";function Zx(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Zx)}catch(i){console.error(i)}}Zx(),jx.exports=Fn;var qS=jx.exports;/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ji=US,Gx=Zs,ZS=qS;function Tt(i){var a="https://react.dev/errors/"+i;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var o=2;o<arguments.length;o++)a+="&args[]="+encodeURIComponent(arguments[o])}return"Minified React error #"+i+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Hx(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function jh(i){var a=i,o=i;if(i.alternate)for(;a.return;)a=a.return;else{i=a;do a=i,a.flags&4098&&(o=a.return),i=a.return;while(i)}return a.tag===3?o:null}function Xx(i){if(i.tag===13){var a=i.memoizedState;if(a===null&&(i=i.alternate,i!==null&&(a=i.memoizedState)),a!==null)return a.dehydrated}return null}function uv(i){if(jh(i)!==i)throw Error(Tt(188))}function GS(i){var a=i.alternate;if(!a){if(a=jh(i),a===null)throw Error(Tt(188));return a!==i?null:i}for(var o=i,d=a;;){var y=o.return;if(y===null)break;var w=y.alternate;if(w===null){if(d=y.return,d!==null){o=d;continue}break}if(y.child===w.child){for(w=y.child;w;){if(w===o)return uv(y),i;if(w===d)return uv(y),a;w=w.sibling}throw Error(Tt(188))}if(o.return!==d.return)o=y,d=w;else{for(var T=!1,f=y.child;f;){if(f===o){T=!0,o=y,d=w;break}if(f===d){T=!0,d=y,o=w;break}f=f.sibling}if(!T){for(f=w.child;f;){if(f===o){T=!0,o=w,d=y;break}if(f===d){T=!0,d=w,o=y;break}f=f.sibling}if(!T)throw Error(Tt(189))}}if(o.alternate!==d)throw Error(Tt(190))}if(o.tag!==3)throw Error(Tt(188));return o.stateNode.current===o?i:a}function $x(i){var a=i.tag;if(a===5||a===26||a===27||a===6)return i;for(i=i.child;i!==null;){if(a=$x(i),a!==null)return a;i=i.sibling}return null}var ui=Object.assign,HS=Symbol.for("react.element"),lf=Symbol.for("react.transitional.element"),ch=Symbol.for("react.portal"),cc=Symbol.for("react.fragment"),Yx=Symbol.for("react.strict_mode"),Mg=Symbol.for("react.profiler"),XS=Symbol.for("react.provider"),Kx=Symbol.for("react.consumer"),Zr=Symbol.for("react.context"),z_=Symbol.for("react.forward_ref"),zg=Symbol.for("react.suspense"),Cg=Symbol.for("react.suspense_list"),C_=Symbol.for("react.memo"),js=Symbol.for("react.lazy"),Dg=Symbol.for("react.activity"),$S=Symbol.for("react.memo_cache_sentinel"),hv=Symbol.iterator;function eh(i){return i===null||typeof i!="object"?null:(i=hv&&i[hv]||i["@@iterator"],typeof i=="function"?i:null)}var YS=Symbol.for("react.client.reference");function Ig(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===YS?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case cc:return"Fragment";case Mg:return"Profiler";case Yx:return"StrictMode";case zg:return"Suspense";case Cg:return"SuspenseList";case Dg:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case ch:return"Portal";case Zr:return(i.displayName||"Context")+".Provider";case Kx:return(i._context.displayName||"Context")+".Consumer";case z_:var a=i.render;return i=i.displayName,i||(i=a.displayName||a.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case C_:return a=i.displayName||null,a!==null?a:Ig(i.type)||"Memo";case js:a=i._payload,i=i._init;try{return Ig(i(a))}catch{}}return null}var uh=Array.isArray,he=Gx.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Ze=ZS.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,$o={pending:!1,data:null,method:null,action:null},kg=[],uc=-1;function yr(i){return{current:i}}function nn(i){0>uc||(i.current=kg[uc],kg[uc]=null,uc--)}function gi(i,a){uc++,kg[uc]=i.current,i.current=a}var mr=yr(null),zh=yr(null),Ws=yr(null),Bf=yr(null);function Of(i,a){switch(gi(Ws,a),gi(zh,i),gi(mr,null),a.nodeType){case 9:case 11:i=(i=a.documentElement)&&(i=i.namespaceURI)?gx(i):0;break;default:if(i=a.tagName,a=a.namespaceURI)a=gx(a),i=fw(a,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}nn(mr),gi(mr,i)}function Cc(){nn(mr),nn(zh),nn(Ws)}function Rg(i){i.memoizedState!==null&&gi(Bf,i);var a=mr.current,o=fw(a,i.type);a!==o&&(gi(zh,i),gi(mr,o))}function Ff(i){zh.current===i&&(nn(mr),nn(zh)),Bf.current===i&&(nn(Bf),Fh._currentValue=$o)}var Pg=Object.prototype.hasOwnProperty,D_=ji.unstable_scheduleCallback,Hm=ji.unstable_cancelCallback,KS=ji.unstable_shouldYield,QS=ji.unstable_requestPaint,gr=ji.unstable_now,JS=ji.unstable_getCurrentPriorityLevel,Qx=ji.unstable_ImmediatePriority,Jx=ji.unstable_UserBlockingPriority,Uf=ji.unstable_NormalPriority,WS=ji.unstable_LowPriority,Wx=ji.unstable_IdlePriority,tT=ji.log,eT=ji.unstable_setDisableYieldValue,qh=null,_a=null;function Ys(i){if(typeof tT=="function"&&eT(i),_a&&typeof _a.setStrictMode=="function")try{_a.setStrictMode(qh,i)}catch{}}var ya=Math.clz32?Math.clz32:aT,iT=Math.log,nT=Math.LN2;function aT(i){return i>>>=0,i===0?32:31-(iT(i)/nT|0)|0}var cf=256,uf=4194304;function Go(i){var a=i&42;if(a!==0)return a;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function mp(i,a,o){var d=i.pendingLanes;if(d===0)return 0;var y=0,w=i.suspendedLanes,T=i.pingedLanes;i=i.warmLanes;var f=d&134217727;return f!==0?(d=f&~w,d!==0?y=Go(d):(T&=f,T!==0?y=Go(T):o||(o=f&~i,o!==0&&(y=Go(o))))):(f=d&~w,f!==0?y=Go(f):T!==0?y=Go(T):o||(o=d&~i,o!==0&&(y=Go(o)))),y===0?0:a!==0&&a!==y&&!(a&w)&&(w=y&-y,o=a&-a,w>=o||w===32&&(o&4194048)!==0)?a:y}function Zh(i,a){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&a)===0}function rT(i,a){switch(i){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function t1(){var i=cf;return cf<<=1,!(cf&4194048)&&(cf=256),i}function e1(){var i=uf;return uf<<=1,!(uf&62914560)&&(uf=4194304),i}function Xm(i){for(var a=[],o=0;31>o;o++)a.push(i);return a}function Gh(i,a){i.pendingLanes|=a,a!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function sT(i,a,o,d,y,w){var T=i.pendingLanes;i.pendingLanes=o,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=o,i.entangledLanes&=o,i.errorRecoveryDisabledLanes&=o,i.shellSuspendCounter=0;var f=i.entanglements,q=i.expirationTimes,ct=i.hiddenUpdates;for(o=T&~o;0<o;){var vt=31-ya(o),tt=1<<vt;f[vt]=0,q[vt]=-1;var V=ct[vt];if(V!==null)for(ct[vt]=null,vt=0;vt<V.length;vt++){var pt=V[vt];pt!==null&&(pt.lane&=-536870913)}o&=~tt}d!==0&&i1(i,d,0),w!==0&&y===0&&i.tag!==0&&(i.suspendedLanes|=w&~(T&~a))}function i1(i,a,o){i.pendingLanes|=a,i.suspendedLanes&=~a;var d=31-ya(a);i.entangledLanes|=a,i.entanglements[d]=i.entanglements[d]|1073741824|o&4194090}function n1(i,a){var o=i.entangledLanes|=a;for(i=i.entanglements;o;){var d=31-ya(o),y=1<<d;y&a|i[d]&a&&(i[d]|=a),o&=~y}}function I_(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function k_(i){return i&=-i,2<i?8<i?i&134217727?32:268435456:8:2}function a1(){var i=Ze.p;return i!==0?i:(i=window.event,i===void 0?32:Sw(i.type))}function oT(i,a){var o=Ze.p;try{return Ze.p=i,a()}finally{Ze.p=o}}var uo=Math.random().toString(36).slice(2),Sn="__reactFiber$"+uo,Qn="__reactProps$"+uo,Vc="__reactContainer$"+uo,Lg="__reactEvents$"+uo,lT="__reactListeners$"+uo,cT="__reactHandles$"+uo,dv="__reactResources$"+uo,Hh="__reactMarker$"+uo;function R_(i){delete i[Sn],delete i[Qn],delete i[Lg],delete i[lT],delete i[cT]}function hc(i){var a=i[Sn];if(a)return a;for(var o=i.parentNode;o;){if(a=o[Vc]||o[Sn]){if(o=a.alternate,a.child!==null||o!==null&&o.child!==null)for(i=vx(i);i!==null;){if(o=i[Sn])return o;i=vx(i)}return a}i=o,o=i.parentNode}return null}function jc(i){if(i=i[Sn]||i[Vc]){var a=i.tag;if(a===5||a===6||a===13||a===26||a===27||a===3)return i}return null}function hh(i){var a=i.tag;if(a===5||a===26||a===27||a===6)return i.stateNode;throw Error(Tt(33))}function bc(i){var a=i[dv];return a||(a=i[dv]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function tn(i){i[Hh]=!0}var r1=new Set,s1={};function rl(i,a){Dc(i,a),Dc(i+"Capture",a)}function Dc(i,a){for(s1[i]=a,i=0;i<a.length;i++)r1.add(a[i])}var uT=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),fv={},pv={};function hT(i){return Pg.call(pv,i)?!0:Pg.call(fv,i)?!1:uT.test(i)?pv[i]=!0:(fv[i]=!0,!1)}function wf(i,a,o){if(hT(a))if(o===null)i.removeAttribute(a);else{switch(typeof o){case"undefined":case"function":case"symbol":i.removeAttribute(a);return;case"boolean":var d=a.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){i.removeAttribute(a);return}}i.setAttribute(a,""+o)}}function hf(i,a,o){if(o===null)i.removeAttribute(a);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(a);return}i.setAttribute(a,""+o)}}function Nr(i,a,o,d){if(d===null)i.removeAttribute(o);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(o);return}i.setAttributeNS(a,o,""+d)}}var $m,mv;function sc(i){if($m===void 0)try{throw Error()}catch(o){var a=o.stack.trim().match(/\n( *(at )?)/);$m=a&&a[1]||"",mv=-1<o.stack.indexOf(`
    at`)?" (<anonymous>)":-1<o.stack.indexOf("@")?"@unknown:0:0":""}return`
`+$m+i+mv}var Ym=!1;function Km(i,a){if(!i||Ym)return"";Ym=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(a){var tt=function(){throw Error()};if(Object.defineProperty(tt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(tt,[])}catch(pt){var V=pt}Reflect.construct(i,[],tt)}else{try{tt.call()}catch(pt){V=pt}i.call(tt.prototype)}}else{try{throw Error()}catch(pt){V=pt}(tt=i())&&typeof tt.catch=="function"&&tt.catch(function(){})}}catch(pt){if(pt&&V&&typeof pt.stack=="string")return[pt.stack,V.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var y=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");y&&y.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var w=d.DetermineComponentFrameRoot(),T=w[0],f=w[1];if(T&&f){var q=T.split(`
`),ct=f.split(`
`);for(y=d=0;d<q.length&&!q[d].includes("DetermineComponentFrameRoot");)d++;for(;y<ct.length&&!ct[y].includes("DetermineComponentFrameRoot");)y++;if(d===q.length||y===ct.length)for(d=q.length-1,y=ct.length-1;1<=d&&0<=y&&q[d]!==ct[y];)y--;for(;1<=d&&0<=y;d--,y--)if(q[d]!==ct[y]){if(d!==1||y!==1)do if(d--,y--,0>y||q[d]!==ct[y]){var vt=`
`+q[d].replace(" at new "," at ");return i.displayName&&vt.includes("<anonymous>")&&(vt=vt.replace("<anonymous>",i.displayName)),vt}while(1<=d&&0<=y);break}}}finally{Ym=!1,Error.prepareStackTrace=o}return(o=i?i.displayName||i.name:"")?sc(o):""}function dT(i){switch(i.tag){case 26:case 27:case 5:return sc(i.type);case 16:return sc("Lazy");case 13:return sc("Suspense");case 19:return sc("SuspenseList");case 0:case 15:return Km(i.type,!1);case 11:return Km(i.type.render,!1);case 1:return Km(i.type,!0);case 31:return sc("Activity");default:return""}}function gv(i){try{var a="";do a+=dT(i),i=i.return;while(i);return a}catch(o){return`
Error generating stack: `+o.message+`
`+o.stack}}function Pa(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function o1(i){var a=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function fT(i){var a=o1(i)?"checked":"value",o=Object.getOwnPropertyDescriptor(i.constructor.prototype,a),d=""+i[a];if(!i.hasOwnProperty(a)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var y=o.get,w=o.set;return Object.defineProperty(i,a,{configurable:!0,get:function(){return y.call(this)},set:function(T){d=""+T,w.call(this,T)}}),Object.defineProperty(i,a,{enumerable:o.enumerable}),{getValue:function(){return d},setValue:function(T){d=""+T},stopTracking:function(){i._valueTracker=null,delete i[a]}}}}function Nf(i){i._valueTracker||(i._valueTracker=fT(i))}function l1(i){if(!i)return!1;var a=i._valueTracker;if(!a)return!0;var o=a.getValue(),d="";return i&&(d=o1(i)?i.checked?"true":"false":i.value),i=d,i!==o?(a.setValue(i),!0):!1}function Vf(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var pT=/[\n"\\]/g;function Oa(i){return i.replace(pT,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function Bg(i,a,o,d,y,w,T,f){i.name="",T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"?i.type=T:i.removeAttribute("type"),a!=null?T==="number"?(a===0&&i.value===""||i.value!=a)&&(i.value=""+Pa(a)):i.value!==""+Pa(a)&&(i.value=""+Pa(a)):T!=="submit"&&T!=="reset"||i.removeAttribute("value"),a!=null?Og(i,T,Pa(a)):o!=null?Og(i,T,Pa(o)):d!=null&&i.removeAttribute("value"),y==null&&w!=null&&(i.defaultChecked=!!w),y!=null&&(i.checked=y&&typeof y!="function"&&typeof y!="symbol"),f!=null&&typeof f!="function"&&typeof f!="symbol"&&typeof f!="boolean"?i.name=""+Pa(f):i.removeAttribute("name")}function c1(i,a,o,d,y,w,T,f){if(w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"&&(i.type=w),a!=null||o!=null){if(!(w!=="submit"&&w!=="reset"||a!=null))return;o=o!=null?""+Pa(o):"",a=a!=null?""+Pa(a):o,f||a===i.value||(i.value=a),i.defaultValue=a}d=d??y,d=typeof d!="function"&&typeof d!="symbol"&&!!d,i.checked=f?i.checked:!!d,i.defaultChecked=!!d,T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"&&(i.name=T)}function Og(i,a,o){a==="number"&&Vf(i.ownerDocument)===i||i.defaultValue===""+o||(i.defaultValue=""+o)}function wc(i,a,o,d){if(i=i.options,a){a={};for(var y=0;y<o.length;y++)a["$"+o[y]]=!0;for(o=0;o<i.length;o++)y=a.hasOwnProperty("$"+i[o].value),i[o].selected!==y&&(i[o].selected=y),y&&d&&(i[o].defaultSelected=!0)}else{for(o=""+Pa(o),a=null,y=0;y<i.length;y++){if(i[y].value===o){i[y].selected=!0,d&&(i[y].defaultSelected=!0);return}a!==null||i[y].disabled||(a=i[y])}a!==null&&(a.selected=!0)}}function u1(i,a,o){if(a!=null&&(a=""+Pa(a),a!==i.value&&(i.value=a),o==null)){i.defaultValue!==a&&(i.defaultValue=a);return}i.defaultValue=o!=null?""+Pa(o):""}function h1(i,a,o,d){if(a==null){if(d!=null){if(o!=null)throw Error(Tt(92));if(uh(d)){if(1<d.length)throw Error(Tt(93));d=d[0]}o=d}o==null&&(o=""),a=o}o=Pa(a),i.defaultValue=o,d=i.textContent,d===o&&d!==""&&d!==null&&(i.value=d)}function Ic(i,a){if(a){var o=i.firstChild;if(o&&o===i.lastChild&&o.nodeType===3){o.nodeValue=a;return}}i.textContent=a}var mT=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function _v(i,a,o){var d=a.indexOf("--")===0;o==null||typeof o=="boolean"||o===""?d?i.setProperty(a,""):a==="float"?i.cssFloat="":i[a]="":d?i.setProperty(a,o):typeof o!="number"||o===0||mT.has(a)?a==="float"?i.cssFloat=o:i[a]=(""+o).trim():i[a]=o+"px"}function d1(i,a,o){if(a!=null&&typeof a!="object")throw Error(Tt(62));if(i=i.style,o!=null){for(var d in o)!o.hasOwnProperty(d)||a!=null&&a.hasOwnProperty(d)||(d.indexOf("--")===0?i.setProperty(d,""):d==="float"?i.cssFloat="":i[d]="");for(var y in a)d=a[y],a.hasOwnProperty(y)&&o[y]!==d&&_v(i,y,d)}else for(var w in a)a.hasOwnProperty(w)&&_v(i,w,a[w])}function P_(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var gT=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),_T=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Sf(i){return _T.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}var Fg=null;function L_(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var dc=null,Sc=null;function yv(i){var a=jc(i);if(a&&(i=a.stateNode)){var o=i[Qn]||null;t:switch(i=a.stateNode,a.type){case"input":if(Bg(i,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name),a=o.name,o.type==="radio"&&a!=null){for(o=i;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll('input[name="'+Oa(""+a)+'"][type="radio"]'),a=0;a<o.length;a++){var d=o[a];if(d!==i&&d.form===i.form){var y=d[Qn]||null;if(!y)throw Error(Tt(90));Bg(d,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name)}}for(a=0;a<o.length;a++)d=o[a],d.form===i.form&&l1(d)}break t;case"textarea":u1(i,o.value,o.defaultValue);break t;case"select":a=o.value,a!=null&&wc(i,!!o.multiple,a,!1)}}}var Qm=!1;function f1(i,a,o){if(Qm)return i(a,o);Qm=!0;try{var d=i(a);return d}finally{if(Qm=!1,(dc!==null||Sc!==null)&&(Ap(),dc&&(a=dc,i=Sc,Sc=dc=null,yv(a),i)))for(a=0;a<i.length;a++)yv(i[a])}}function Ch(i,a){var o=i.stateNode;if(o===null)return null;var d=o[Qn]||null;if(d===null)return null;o=d[a];t:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(i=i.type,d=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!d;break t;default:i=!1}if(i)return null;if(o&&typeof o!="function")throw Error(Tt(231,a,typeof o));return o}var Qr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ug=!1;if(Qr)try{var ih={};Object.defineProperty(ih,"passive",{get:function(){Ug=!0}}),window.addEventListener("test",ih,ih),window.removeEventListener("test",ih,ih)}catch{Ug=!1}var Ks=null,B_=null,Tf=null;function p1(){if(Tf)return Tf;var i,a=B_,o=a.length,d,y="value"in Ks?Ks.value:Ks.textContent,w=y.length;for(i=0;i<o&&a[i]===y[i];i++);var T=o-i;for(d=1;d<=T&&a[o-d]===y[w-d];d++);return Tf=y.slice(i,1<d?1-d:void 0)}function Af(i){var a=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&a===13&&(i=13)):i=a,i===10&&(i=13),32<=i||i===13?i:0}function df(){return!0}function vv(){return!1}function Jn(i){function a(o,d,y,w,T){this._reactName=o,this._targetInst=y,this.type=d,this.nativeEvent=w,this.target=T,this.currentTarget=null;for(var f in i)i.hasOwnProperty(f)&&(o=i[f],this[f]=o?o(w):w[f]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?df:vv,this.isPropagationStopped=vv,this}return ui(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=df)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=df)},persist:function(){},isPersistent:df}),a}var sl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},gp=Jn(sl),Xh=ui({},sl,{view:0,detail:0}),yT=Jn(Xh),Jm,Wm,nh,_p=ui({},Xh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:O_,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==nh&&(nh&&i.type==="mousemove"?(Jm=i.screenX-nh.screenX,Wm=i.screenY-nh.screenY):Wm=Jm=0,nh=i),Jm)},movementY:function(i){return"movementY"in i?i.movementY:Wm}}),xv=Jn(_p),vT=ui({},_p,{dataTransfer:0}),xT=Jn(vT),bT=ui({},Xh,{relatedTarget:0}),tg=Jn(bT),wT=ui({},sl,{animationName:0,elapsedTime:0,pseudoElement:0}),ST=Jn(wT),TT=ui({},sl,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),AT=Jn(TT),ET=ui({},sl,{data:0}),bv=Jn(ET),MT={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},zT={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},CT={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function DT(i){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(i):(i=CT[i])?!!a[i]:!1}function O_(){return DT}var IT=ui({},Xh,{key:function(i){if(i.key){var a=MT[i.key]||i.key;if(a!=="Unidentified")return a}return i.type==="keypress"?(i=Af(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?zT[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:O_,charCode:function(i){return i.type==="keypress"?Af(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Af(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),kT=Jn(IT),RT=ui({},_p,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),wv=Jn(RT),PT=ui({},Xh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:O_}),LT=Jn(PT),BT=ui({},sl,{propertyName:0,elapsedTime:0,pseudoElement:0}),OT=Jn(BT),FT=ui({},_p,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),UT=Jn(FT),NT=ui({},sl,{newState:0,oldState:0}),VT=Jn(NT),jT=[9,13,27,32],F_=Qr&&"CompositionEvent"in window,ph=null;Qr&&"documentMode"in document&&(ph=document.documentMode);var qT=Qr&&"TextEvent"in window&&!ph,m1=Qr&&(!F_||ph&&8<ph&&11>=ph),Sv=" ",Tv=!1;function g1(i,a){switch(i){case"keyup":return jT.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function _1(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var fc=!1;function ZT(i,a){switch(i){case"compositionend":return _1(a);case"keypress":return a.which!==32?null:(Tv=!0,Sv);case"textInput":return i=a.data,i===Sv&&Tv?null:i;default:return null}}function GT(i,a){if(fc)return i==="compositionend"||!F_&&g1(i,a)?(i=p1(),Tf=B_=Ks=null,fc=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return m1&&a.locale!=="ko"?null:a.data;default:return null}}var HT={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Av(i){var a=i&&i.nodeName&&i.nodeName.toLowerCase();return a==="input"?!!HT[i.type]:a==="textarea"}function y1(i,a,o,d){dc?Sc?Sc.push(d):Sc=[d]:dc=d,a=rp(a,"onChange"),0<a.length&&(o=new gp("onChange","change",null,o,d),i.push({event:o,listeners:a}))}var mh=null,Dh=null;function XT(i){uw(i,0)}function yp(i){var a=hh(i);if(l1(a))return i}function Ev(i,a){if(i==="change")return a}var v1=!1;if(Qr){var eg;if(Qr){var ig="oninput"in document;if(!ig){var Mv=document.createElement("div");Mv.setAttribute("oninput","return;"),ig=typeof Mv.oninput=="function"}eg=ig}else eg=!1;v1=eg&&(!document.documentMode||9<document.documentMode)}function zv(){mh&&(mh.detachEvent("onpropertychange",x1),Dh=mh=null)}function x1(i){if(i.propertyName==="value"&&yp(Dh)){var a=[];y1(a,Dh,i,L_(i)),f1(XT,a)}}function $T(i,a,o){i==="focusin"?(zv(),mh=a,Dh=o,mh.attachEvent("onpropertychange",x1)):i==="focusout"&&zv()}function YT(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return yp(Dh)}function KT(i,a){if(i==="click")return yp(a)}function QT(i,a){if(i==="input"||i==="change")return yp(a)}function JT(i,a){return i===a&&(i!==0||1/i===1/a)||i!==i&&a!==a}var ba=typeof Object.is=="function"?Object.is:JT;function Ih(i,a){if(ba(i,a))return!0;if(typeof i!="object"||i===null||typeof a!="object"||a===null)return!1;var o=Object.keys(i),d=Object.keys(a);if(o.length!==d.length)return!1;for(d=0;d<o.length;d++){var y=o[d];if(!Pg.call(a,y)||!ba(i[y],a[y]))return!1}return!0}function Cv(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function Dv(i,a){var o=Cv(i);i=0;for(var d;o;){if(o.nodeType===3){if(d=i+o.textContent.length,i<=a&&d>=a)return{node:o,offset:a-i};i=d}t:{for(;o;){if(o.nextSibling){o=o.nextSibling;break t}o=o.parentNode}o=void 0}o=Cv(o)}}function b1(i,a){return i&&a?i===a?!0:i&&i.nodeType===3?!1:a&&a.nodeType===3?b1(i,a.parentNode):"contains"in i?i.contains(a):i.compareDocumentPosition?!!(i.compareDocumentPosition(a)&16):!1:!1}function w1(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var a=Vf(i.document);a instanceof i.HTMLIFrameElement;){try{var o=typeof a.contentWindow.location.href=="string"}catch{o=!1}if(o)i=a.contentWindow;else break;a=Vf(i.document)}return a}function U_(i){var a=i&&i.nodeName&&i.nodeName.toLowerCase();return a&&(a==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||a==="textarea"||i.contentEditable==="true")}var WT=Qr&&"documentMode"in document&&11>=document.documentMode,pc=null,Ng=null,gh=null,Vg=!1;function Iv(i,a,o){var d=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;Vg||pc==null||pc!==Vf(d)||(d=pc,"selectionStart"in d&&U_(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),gh&&Ih(gh,d)||(gh=d,d=rp(Ng,"onSelect"),0<d.length&&(a=new gp("onSelect","select",null,a,o),i.push({event:a,listeners:d}),a.target=pc)))}function Zo(i,a){var o={};return o[i.toLowerCase()]=a.toLowerCase(),o["Webkit"+i]="webkit"+a,o["Moz"+i]="moz"+a,o}var mc={animationend:Zo("Animation","AnimationEnd"),animationiteration:Zo("Animation","AnimationIteration"),animationstart:Zo("Animation","AnimationStart"),transitionrun:Zo("Transition","TransitionRun"),transitionstart:Zo("Transition","TransitionStart"),transitioncancel:Zo("Transition","TransitionCancel"),transitionend:Zo("Transition","TransitionEnd")},ng={},S1={};Qr&&(S1=document.createElement("div").style,"AnimationEvent"in window||(delete mc.animationend.animation,delete mc.animationiteration.animation,delete mc.animationstart.animation),"TransitionEvent"in window||delete mc.transitionend.transition);function ol(i){if(ng[i])return ng[i];if(!mc[i])return i;var a=mc[i],o;for(o in a)if(a.hasOwnProperty(o)&&o in S1)return ng[i]=a[o];return i}var T1=ol("animationend"),A1=ol("animationiteration"),E1=ol("animationstart"),tA=ol("transitionrun"),eA=ol("transitionstart"),iA=ol("transitioncancel"),M1=ol("transitionend"),z1=new Map,jg="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");jg.push("scrollEnd");function Ja(i,a){z1.set(i,a),rl(a,[i])}var kv=new WeakMap;function Fa(i,a){if(typeof i=="object"&&i!==null){var o=kv.get(i);return o!==void 0?o:(a={value:i,source:a,stack:gv(a)},kv.set(i,a),a)}return{value:i,source:a,stack:gv(a)}}var Ra=[],gc=0,N_=0;function vp(){for(var i=gc,a=N_=gc=0;a<i;){var o=Ra[a];Ra[a++]=null;var d=Ra[a];Ra[a++]=null;var y=Ra[a];Ra[a++]=null;var w=Ra[a];if(Ra[a++]=null,d!==null&&y!==null){var T=d.pending;T===null?y.next=y:(y.next=T.next,T.next=y),d.pending=y}w!==0&&C1(o,y,w)}}function xp(i,a,o,d){Ra[gc++]=i,Ra[gc++]=a,Ra[gc++]=o,Ra[gc++]=d,N_|=d,i.lanes|=d,i=i.alternate,i!==null&&(i.lanes|=d)}function V_(i,a,o,d){return xp(i,a,o,d),jf(i)}function qc(i,a){return xp(i,null,null,a),jf(i)}function C1(i,a,o){i.lanes|=o;var d=i.alternate;d!==null&&(d.lanes|=o);for(var y=!1,w=i.return;w!==null;)w.childLanes|=o,d=w.alternate,d!==null&&(d.childLanes|=o),w.tag===22&&(i=w.stateNode,i===null||i._visibility&1||(y=!0)),i=w,w=w.return;return i.tag===3?(w=i.stateNode,y&&a!==null&&(y=31-ya(o),i=w.hiddenUpdates,d=i[y],d===null?i[y]=[a]:d.push(a),a.lane=o|536870912),w):null}function jf(i){if(50<Eh)throw Eh=0,c_=null,Error(Tt(185));for(var a=i.return;a!==null;)i=a,a=i.return;return i.tag===3?i.stateNode:null}var _c={};function nA(i,a,o,d){this.tag=i,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ga(i,a,o,d){return new nA(i,a,o,d)}function j_(i){return i=i.prototype,!(!i||!i.isReactComponent)}function Yr(i,a){var o=i.alternate;return o===null?(o=ga(i.tag,a,i.key,i.mode),o.elementType=i.elementType,o.type=i.type,o.stateNode=i.stateNode,o.alternate=i,i.alternate=o):(o.pendingProps=a,o.type=i.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=i.flags&65011712,o.childLanes=i.childLanes,o.lanes=i.lanes,o.child=i.child,o.memoizedProps=i.memoizedProps,o.memoizedState=i.memoizedState,o.updateQueue=i.updateQueue,a=i.dependencies,o.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},o.sibling=i.sibling,o.index=i.index,o.ref=i.ref,o.refCleanup=i.refCleanup,o}function D1(i,a){i.flags&=65011714;var o=i.alternate;return o===null?(i.childLanes=0,i.lanes=a,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,a=o.dependencies,i.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),i}function Ef(i,a,o,d,y,w){var T=0;if(d=i,typeof i=="function")j_(i)&&(T=1);else if(typeof i=="string")T=rE(i,o,mr.current)?26:i==="html"||i==="head"||i==="body"?27:5;else t:switch(i){case Dg:return i=ga(31,o,a,y),i.elementType=Dg,i.lanes=w,i;case cc:return Yo(o.children,y,w,a);case Yx:T=8,y|=24;break;case Mg:return i=ga(12,o,a,y|2),i.elementType=Mg,i.lanes=w,i;case zg:return i=ga(13,o,a,y),i.elementType=zg,i.lanes=w,i;case Cg:return i=ga(19,o,a,y),i.elementType=Cg,i.lanes=w,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case XS:case Zr:T=10;break t;case Kx:T=9;break t;case z_:T=11;break t;case C_:T=14;break t;case js:T=16,d=null;break t}T=29,o=Error(Tt(130,i===null?"null":typeof i,"")),d=null}return a=ga(T,o,a,y),a.elementType=i,a.type=d,a.lanes=w,a}function Yo(i,a,o,d){return i=ga(7,i,d,a),i.lanes=o,i}function ag(i,a,o){return i=ga(6,i,null,a),i.lanes=o,i}function rg(i,a,o){return a=ga(4,i.children!==null?i.children:[],i.key,a),a.lanes=o,a.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},a}var yc=[],vc=0,qf=null,Zf=0,La=[],Ba=0,Ko=null,Gr=1,Hr="";function Ho(i,a){yc[vc++]=Zf,yc[vc++]=qf,qf=i,Zf=a}function I1(i,a,o){La[Ba++]=Gr,La[Ba++]=Hr,La[Ba++]=Ko,Ko=i;var d=Gr;i=Hr;var y=32-ya(d)-1;d&=~(1<<y),o+=1;var w=32-ya(a)+y;if(30<w){var T=y-y%5;w=(d&(1<<T)-1).toString(32),d>>=T,y-=T,Gr=1<<32-ya(a)+y|o<<y|d,Hr=w+i}else Gr=1<<w|o<<y|d,Hr=i}function q_(i){i.return!==null&&(Ho(i,1),I1(i,1,0))}function Z_(i){for(;i===qf;)qf=yc[--vc],yc[vc]=null,Zf=yc[--vc],yc[vc]=null;for(;i===Ko;)Ko=La[--Ba],La[Ba]=null,Hr=La[--Ba],La[Ba]=null,Gr=La[--Ba],La[Ba]=null}var Bn=null,Si=null,qe=!1,Qo=null,fr=!1,qg=Error(Tt(519));function el(i){var a=Error(Tt(418,""));throw kh(Fa(a,i)),qg}function Rv(i){var a=i.stateNode,o=i.type,d=i.memoizedProps;switch(a[Sn]=i,a[Qn]=d,o){case"dialog":ze("cancel",a),ze("close",a);break;case"iframe":case"object":case"embed":ze("load",a);break;case"video":case"audio":for(o=0;o<Lh.length;o++)ze(Lh[o],a);break;case"source":ze("error",a);break;case"img":case"image":case"link":ze("error",a),ze("load",a);break;case"details":ze("toggle",a);break;case"input":ze("invalid",a),c1(a,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0),Nf(a);break;case"select":ze("invalid",a);break;case"textarea":ze("invalid",a),h1(a,d.value,d.defaultValue,d.children),Nf(a)}o=d.children,typeof o!="string"&&typeof o!="number"&&typeof o!="bigint"||a.textContent===""+o||d.suppressHydrationWarning===!0||dw(a.textContent,o)?(d.popover!=null&&(ze("beforetoggle",a),ze("toggle",a)),d.onScroll!=null&&ze("scroll",a),d.onScrollEnd!=null&&ze("scrollend",a),d.onClick!=null&&(a.onclick=zp),a=!0):a=!1,a||el(i)}function Pv(i){for(Bn=i.return;Bn;)switch(Bn.tag){case 5:case 13:fr=!1;return;case 27:case 3:fr=!0;return;default:Bn=Bn.return}}function ah(i){if(i!==Bn)return!1;if(!qe)return Pv(i),qe=!0,!1;var a=i.tag,o;if((o=a!==3&&a!==27)&&((o=a===5)&&(o=i.type,o=!(o!=="form"&&o!=="button")||m_(i.type,i.memoizedProps)),o=!o),o&&Si&&el(i),Pv(i),a===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Tt(317));t:{for(i=i.nextSibling,a=0;i;){if(i.nodeType===8)if(o=i.data,o==="/$"){if(a===0){Si=Qa(i.nextSibling);break t}a--}else o!=="$"&&o!=="$!"&&o!=="$?"||a++;i=i.nextSibling}Si=null}}else a===27?(a=Si,ho(i.type)?(i=y_,y_=null,Si=i):Si=a):Si=Bn?Qa(i.stateNode.nextSibling):null;return!0}function $h(){Si=Bn=null,qe=!1}function Lv(){var i=Qo;return i!==null&&(Kn===null?Kn=i:Kn.push.apply(Kn,i),Qo=null),i}function kh(i){Qo===null?Qo=[i]:Qo.push(i)}var Zg=yr(null),ll=null,Xr=null;function Gs(i,a,o){gi(Zg,a._currentValue),a._currentValue=o}function Kr(i){i._currentValue=Zg.current,nn(Zg)}function Gg(i,a,o){for(;i!==null;){var d=i.alternate;if((i.childLanes&a)!==a?(i.childLanes|=a,d!==null&&(d.childLanes|=a)):d!==null&&(d.childLanes&a)!==a&&(d.childLanes|=a),i===o)break;i=i.return}}function Hg(i,a,o,d){var y=i.child;for(y!==null&&(y.return=i);y!==null;){var w=y.dependencies;if(w!==null){var T=y.child;w=w.firstContext;t:for(;w!==null;){var f=w;w=y;for(var q=0;q<a.length;q++)if(f.context===a[q]){w.lanes|=o,f=w.alternate,f!==null&&(f.lanes|=o),Gg(w.return,o,i),d||(T=null);break t}w=f.next}}else if(y.tag===18){if(T=y.return,T===null)throw Error(Tt(341));T.lanes|=o,w=T.alternate,w!==null&&(w.lanes|=o),Gg(T,o,i),T=null}else T=y.child;if(T!==null)T.return=y;else for(T=y;T!==null;){if(T===i){T=null;break}if(y=T.sibling,y!==null){y.return=T.return,T=y;break}T=T.return}y=T}}function Yh(i,a,o,d){i=null;for(var y=a,w=!1;y!==null;){if(!w){if(y.flags&524288)w=!0;else if(y.flags&262144)break}if(y.tag===10){var T=y.alternate;if(T===null)throw Error(Tt(387));if(T=T.memoizedProps,T!==null){var f=y.type;ba(y.pendingProps.value,T.value)||(i!==null?i.push(f):i=[f])}}else if(y===Bf.current){if(T=y.alternate,T===null)throw Error(Tt(387));T.memoizedState.memoizedState!==y.memoizedState.memoizedState&&(i!==null?i.push(Fh):i=[Fh])}y=y.return}i!==null&&Hg(a,i,o,d),a.flags|=262144}function Gf(i){for(i=i.firstContext;i!==null;){if(!ba(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function il(i){ll=i,Xr=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function Tn(i){return k1(ll,i)}function ff(i,a){return ll===null&&il(i),k1(i,a)}function k1(i,a){var o=a._currentValue;if(a={context:a,memoizedValue:o,next:null},Xr===null){if(i===null)throw Error(Tt(308));Xr=a,i.dependencies={lanes:0,firstContext:a},i.flags|=524288}else Xr=Xr.next=a;return o}var aA=typeof AbortController<"u"?AbortController:function(){var i=[],a=this.signal={aborted:!1,addEventListener:function(o,d){i.push(d)}};this.abort=function(){a.aborted=!0,i.forEach(function(o){return o()})}},rA=ji.unstable_scheduleCallback,sA=ji.unstable_NormalPriority,Ni={$$typeof:Zr,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function G_(){return{controller:new aA,data:new Map,refCount:0}}function Kh(i){i.refCount--,i.refCount===0&&rA(sA,function(){i.controller.abort()})}var _h=null,Xg=0,kc=0,Tc=null;function oA(i,a){if(_h===null){var o=_h=[];Xg=0,kc=py(),Tc={status:"pending",value:void 0,then:function(d){o.push(d)}}}return Xg++,a.then(Bv,Bv),a}function Bv(){if(--Xg===0&&_h!==null){Tc!==null&&(Tc.status="fulfilled");var i=_h;_h=null,kc=0,Tc=null;for(var a=0;a<i.length;a++)(0,i[a])()}}function lA(i,a){var o=[],d={status:"pending",value:null,reason:null,then:function(y){o.push(y)}};return i.then(function(){d.status="fulfilled",d.value=a;for(var y=0;y<o.length;y++)(0,o[y])(a)},function(y){for(d.status="rejected",d.reason=y,y=0;y<o.length;y++)(0,o[y])(void 0)}),d}var Ov=he.S;he.S=function(i,a){typeof a=="object"&&a!==null&&typeof a.then=="function"&&oA(i,a),Ov!==null&&Ov(i,a)};var Jo=yr(null);function H_(){var i=Jo.current;return i!==null?i:si.pooledCache}function Mf(i,a){a===null?gi(Jo,Jo.current):gi(Jo,a.pool)}function R1(){var i=H_();return i===null?null:{parent:Ni._currentValue,pool:i}}var Qh=Error(Tt(460)),P1=Error(Tt(474)),bp=Error(Tt(542)),$g={then:function(){}};function Fv(i){return i=i.status,i==="fulfilled"||i==="rejected"}function pf(){}function L1(i,a,o){switch(o=i[o],o===void 0?i.push(a):o!==a&&(a.then(pf,pf),a=o),a.status){case"fulfilled":return a.value;case"rejected":throw i=a.reason,Nv(i),i;default:if(typeof a.status=="string")a.then(pf,pf);else{if(i=si,i!==null&&100<i.shellSuspendCounter)throw Error(Tt(482));i=a,i.status="pending",i.then(function(d){if(a.status==="pending"){var y=a;y.status="fulfilled",y.value=d}},function(d){if(a.status==="pending"){var y=a;y.status="rejected",y.reason=d}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw i=a.reason,Nv(i),i}throw yh=a,Qh}}var yh=null;function Uv(){if(yh===null)throw Error(Tt(459));var i=yh;return yh=null,i}function Nv(i){if(i===Qh||i===bp)throw Error(Tt(483))}var qs=!1;function X_(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Yg(i,a){i=i.updateQueue,a.updateQueue===i&&(a.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function to(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function eo(i,a,o){var d=i.updateQueue;if(d===null)return null;if(d=d.shared,Ke&2){var y=d.pending;return y===null?a.next=a:(a.next=y.next,y.next=a),d.pending=a,a=jf(i),C1(i,null,o),a}return xp(i,d,a,o),jf(i)}function vh(i,a,o){if(a=a.updateQueue,a!==null&&(a=a.shared,(o&4194048)!==0)){var d=a.lanes;d&=i.pendingLanes,o|=d,a.lanes=o,n1(i,o)}}function sg(i,a){var o=i.updateQueue,d=i.alternate;if(d!==null&&(d=d.updateQueue,o===d)){var y=null,w=null;if(o=o.firstBaseUpdate,o!==null){do{var T={lane:o.lane,tag:o.tag,payload:o.payload,callback:null,next:null};w===null?y=w=T:w=w.next=T,o=o.next}while(o!==null);w===null?y=w=a:w=w.next=a}else y=w=a;o={baseState:d.baseState,firstBaseUpdate:y,lastBaseUpdate:w,shared:d.shared,callbacks:d.callbacks},i.updateQueue=o;return}i=o.lastBaseUpdate,i===null?o.firstBaseUpdate=a:i.next=a,o.lastBaseUpdate=a}var Kg=!1;function xh(){if(Kg){var i=Tc;if(i!==null)throw i}}function bh(i,a,o,d){Kg=!1;var y=i.updateQueue;qs=!1;var w=y.firstBaseUpdate,T=y.lastBaseUpdate,f=y.shared.pending;if(f!==null){y.shared.pending=null;var q=f,ct=q.next;q.next=null,T===null?w=ct:T.next=ct,T=q;var vt=i.alternate;vt!==null&&(vt=vt.updateQueue,f=vt.lastBaseUpdate,f!==T&&(f===null?vt.firstBaseUpdate=ct:f.next=ct,vt.lastBaseUpdate=q))}if(w!==null){var tt=y.baseState;T=0,vt=ct=q=null,f=w;do{var V=f.lane&-536870913,pt=V!==f.lane;if(pt?(Be&V)===V:(d&V)===V){V!==0&&V===kc&&(Kg=!0),vt!==null&&(vt=vt.next={lane:0,tag:f.tag,payload:f.payload,callback:null,next:null});t:{var Jt=i,Xt=f;V=a;var _e=o;switch(Xt.tag){case 1:if(Jt=Xt.payload,typeof Jt=="function"){tt=Jt.call(_e,tt,V);break t}tt=Jt;break t;case 3:Jt.flags=Jt.flags&-65537|128;case 0:if(Jt=Xt.payload,V=typeof Jt=="function"?Jt.call(_e,tt,V):Jt,V==null)break t;tt=ui({},tt,V);break t;case 2:qs=!0}}V=f.callback,V!==null&&(i.flags|=64,pt&&(i.flags|=8192),pt=y.callbacks,pt===null?y.callbacks=[V]:pt.push(V))}else pt={lane:V,tag:f.tag,payload:f.payload,callback:f.callback,next:null},vt===null?(ct=vt=pt,q=tt):vt=vt.next=pt,T|=V;if(f=f.next,f===null){if(f=y.shared.pending,f===null)break;pt=f,f=pt.next,pt.next=null,y.lastBaseUpdate=pt,y.shared.pending=null}}while(!0);vt===null&&(q=tt),y.baseState=q,y.firstBaseUpdate=ct,y.lastBaseUpdate=vt,w===null&&(y.shared.lanes=0),co|=T,i.lanes=T,i.memoizedState=tt}}function B1(i,a){if(typeof i!="function")throw Error(Tt(191,i));i.call(a)}function O1(i,a){var o=i.callbacks;if(o!==null)for(i.callbacks=null,i=0;i<o.length;i++)B1(o[i],a)}var Rc=yr(null),Hf=yr(0);function Vv(i,a){i=ts,gi(Hf,i),gi(Rc,a),ts=i|a.baseLanes}function Qg(){gi(Hf,ts),gi(Rc,Rc.current)}function $_(){ts=Hf.current,nn(Rc),nn(Hf)}var oo=0,Ae=null,ni=null,Pi=null,Xf=!1,Ac=!1,nl=!1,$f=0,Rh=0,Ec=null,cA=0;function zi(){throw Error(Tt(321))}function Y_(i,a){if(a===null)return!1;for(var o=0;o<a.length&&o<i.length;o++)if(!ba(i[o],a[o]))return!1;return!0}function K_(i,a,o,d,y,w){return oo=w,Ae=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,he.H=i===null||i.memoizedState===null?pb:mb,nl=!1,w=o(d,y),nl=!1,Ac&&(w=U1(a,o,d,y)),F1(i),w}function F1(i){he.H=Yf;var a=ni!==null&&ni.next!==null;if(oo=0,Pi=ni=Ae=null,Xf=!1,Rh=0,Ec=null,a)throw Error(Tt(300));i===null||en||(i=i.dependencies,i!==null&&Gf(i)&&(en=!0))}function U1(i,a,o,d){Ae=i;var y=0;do{if(Ac&&(Ec=null),Rh=0,Ac=!1,25<=y)throw Error(Tt(301));if(y+=1,Pi=ni=null,i.updateQueue!=null){var w=i.updateQueue;w.lastEffect=null,w.events=null,w.stores=null,w.memoCache!=null&&(w.memoCache.index=0)}he.H=gA,w=a(o,d)}while(Ac);return w}function uA(){var i=he.H,a=i.useState()[0];return a=typeof a.then=="function"?Jh(a):a,i=i.useState()[0],(ni!==null?ni.memoizedState:null)!==i&&(Ae.flags|=1024),a}function Q_(){var i=$f!==0;return $f=0,i}function J_(i,a,o){a.updateQueue=i.updateQueue,a.flags&=-2053,i.lanes&=~o}function W_(i){if(Xf){for(i=i.memoizedState;i!==null;){var a=i.queue;a!==null&&(a.pending=null),i=i.next}Xf=!1}oo=0,Pi=ni=Ae=null,Ac=!1,Rh=$f=0,Ec=null}function $n(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Pi===null?Ae.memoizedState=Pi=i:Pi=Pi.next=i,Pi}function Li(){if(ni===null){var i=Ae.alternate;i=i!==null?i.memoizedState:null}else i=ni.next;var a=Pi===null?Ae.memoizedState:Pi.next;if(a!==null)Pi=a,ni=i;else{if(i===null)throw Ae.alternate===null?Error(Tt(467)):Error(Tt(310));ni=i,i={memoizedState:ni.memoizedState,baseState:ni.baseState,baseQueue:ni.baseQueue,queue:ni.queue,next:null},Pi===null?Ae.memoizedState=Pi=i:Pi=Pi.next=i}return Pi}function ty(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Jh(i){var a=Rh;return Rh+=1,Ec===null&&(Ec=[]),i=L1(Ec,i,a),a=Ae,(Pi===null?a.memoizedState:Pi.next)===null&&(a=a.alternate,he.H=a===null||a.memoizedState===null?pb:mb),i}function wp(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return Jh(i);if(i.$$typeof===Zr)return Tn(i)}throw Error(Tt(438,String(i)))}function ey(i){var a=null,o=Ae.updateQueue;if(o!==null&&(a=o.memoCache),a==null){var d=Ae.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(a={data:d.data.map(function(y){return y.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),o===null&&(o=ty(),Ae.updateQueue=o),o.memoCache=a,o=a.data[a.index],o===void 0)for(o=a.data[a.index]=Array(i),d=0;d<i;d++)o[d]=$S;return a.index++,o}function Jr(i,a){return typeof a=="function"?a(i):a}function zf(i){var a=Li();return iy(a,ni,i)}function iy(i,a,o){var d=i.queue;if(d===null)throw Error(Tt(311));d.lastRenderedReducer=o;var y=i.baseQueue,w=d.pending;if(w!==null){if(y!==null){var T=y.next;y.next=w.next,w.next=T}a.baseQueue=y=w,d.pending=null}if(w=i.baseState,y===null)i.memoizedState=w;else{a=y.next;var f=T=null,q=null,ct=a,vt=!1;do{var tt=ct.lane&-536870913;if(tt!==ct.lane?(Be&tt)===tt:(oo&tt)===tt){var V=ct.revertLane;if(V===0)q!==null&&(q=q.next={lane:0,revertLane:0,action:ct.action,hasEagerState:ct.hasEagerState,eagerState:ct.eagerState,next:null}),tt===kc&&(vt=!0);else if((oo&V)===V){ct=ct.next,V===kc&&(vt=!0);continue}else tt={lane:0,revertLane:ct.revertLane,action:ct.action,hasEagerState:ct.hasEagerState,eagerState:ct.eagerState,next:null},q===null?(f=q=tt,T=w):q=q.next=tt,Ae.lanes|=V,co|=V;tt=ct.action,nl&&o(w,tt),w=ct.hasEagerState?ct.eagerState:o(w,tt)}else V={lane:tt,revertLane:ct.revertLane,action:ct.action,hasEagerState:ct.hasEagerState,eagerState:ct.eagerState,next:null},q===null?(f=q=V,T=w):q=q.next=V,Ae.lanes|=tt,co|=tt;ct=ct.next}while(ct!==null&&ct!==a);if(q===null?T=w:q.next=f,!ba(w,i.memoizedState)&&(en=!0,vt&&(o=Tc,o!==null)))throw o;i.memoizedState=w,i.baseState=T,i.baseQueue=q,d.lastRenderedState=w}return y===null&&(d.lanes=0),[i.memoizedState,d.dispatch]}function og(i){var a=Li(),o=a.queue;if(o===null)throw Error(Tt(311));o.lastRenderedReducer=i;var d=o.dispatch,y=o.pending,w=a.memoizedState;if(y!==null){o.pending=null;var T=y=y.next;do w=i(w,T.action),T=T.next;while(T!==y);ba(w,a.memoizedState)||(en=!0),a.memoizedState=w,a.baseQueue===null&&(a.baseState=w),o.lastRenderedState=w}return[w,d]}function N1(i,a,o){var d=Ae,y=Li(),w=qe;if(w){if(o===void 0)throw Error(Tt(407));o=o()}else o=a();var T=!ba((ni||y).memoizedState,o);T&&(y.memoizedState=o,en=!0),y=y.queue;var f=q1.bind(null,d,y,i);if(Wh(2048,8,f,[i]),y.getSnapshot!==a||T||Pi!==null&&Pi.memoizedState.tag&1){if(d.flags|=2048,Pc(9,Sp(),j1.bind(null,d,y,o,a),null),si===null)throw Error(Tt(349));w||oo&124||V1(d,a,o)}return o}function V1(i,a,o){i.flags|=16384,i={getSnapshot:a,value:o},a=Ae.updateQueue,a===null?(a=ty(),Ae.updateQueue=a,a.stores=[i]):(o=a.stores,o===null?a.stores=[i]:o.push(i))}function j1(i,a,o,d){a.value=o,a.getSnapshot=d,Z1(a)&&G1(i)}function q1(i,a,o){return o(function(){Z1(a)&&G1(i)})}function Z1(i){var a=i.getSnapshot;i=i.value;try{var o=a();return!ba(i,o)}catch{return!0}}function G1(i){var a=qc(i,2);a!==null&&xa(a,i,2)}function Jg(i){var a=$n();if(typeof i=="function"){var o=i;if(i=o(),nl){Ys(!0);try{o()}finally{Ys(!1)}}}return a.memoizedState=a.baseState=i,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Jr,lastRenderedState:i},a}function H1(i,a,o,d){return i.baseState=o,iy(i,ni,typeof d=="function"?d:Jr)}function hA(i,a,o,d,y){if(Tp(i))throw Error(Tt(485));if(i=a.action,i!==null){var w={payload:y,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(T){w.listeners.push(T)}};he.T!==null?o(!0):w.isTransition=!1,d(w),o=a.pending,o===null?(w.next=a.pending=w,X1(a,w)):(w.next=o.next,a.pending=o.next=w)}}function X1(i,a){var o=a.action,d=a.payload,y=i.state;if(a.isTransition){var w=he.T,T={};he.T=T;try{var f=o(y,d),q=he.S;q!==null&&q(T,f),jv(i,a,f)}catch(ct){Wg(i,a,ct)}finally{he.T=w}}else try{w=o(y,d),jv(i,a,w)}catch(ct){Wg(i,a,ct)}}function jv(i,a,o){o!==null&&typeof o=="object"&&typeof o.then=="function"?o.then(function(d){qv(i,a,d)},function(d){return Wg(i,a,d)}):qv(i,a,o)}function qv(i,a,o){a.status="fulfilled",a.value=o,$1(a),i.state=o,a=i.pending,a!==null&&(o=a.next,o===a?i.pending=null:(o=o.next,a.next=o,X1(i,o)))}function Wg(i,a,o){var d=i.pending;if(i.pending=null,d!==null){d=d.next;do a.status="rejected",a.reason=o,$1(a),a=a.next;while(a!==d)}i.action=null}function $1(i){i=i.listeners;for(var a=0;a<i.length;a++)(0,i[a])()}function Y1(i,a){return a}function Zv(i,a){if(qe){var o=si.formState;if(o!==null){t:{var d=Ae;if(qe){if(Si){e:{for(var y=Si,w=fr;y.nodeType!==8;){if(!w){y=null;break e}if(y=Qa(y.nextSibling),y===null){y=null;break e}}w=y.data,y=w==="F!"||w==="F"?y:null}if(y){Si=Qa(y.nextSibling),d=y.data==="F!";break t}}el(d)}d=!1}d&&(a=o[0])}}return o=$n(),o.memoizedState=o.baseState=a,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Y1,lastRenderedState:a},o.queue=d,o=hb.bind(null,Ae,d),d.dispatch=o,d=Jg(!1),w=sy.bind(null,Ae,!1,d.queue),d=$n(),y={state:a,dispatch:null,action:i,pending:null},d.queue=y,o=hA.bind(null,Ae,y,w,o),y.dispatch=o,d.memoizedState=i,[a,o,!1]}function Gv(i){var a=Li();return K1(a,ni,i)}function K1(i,a,o){if(a=iy(i,a,Y1)[0],i=zf(Jr)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var d=Jh(a)}catch(T){throw T===Qh?bp:T}else d=a;a=Li();var y=a.queue,w=y.dispatch;return o!==a.memoizedState&&(Ae.flags|=2048,Pc(9,Sp(),dA.bind(null,y,o),null)),[d,w,i]}function dA(i,a){i.action=a}function Hv(i){var a=Li(),o=ni;if(o!==null)return K1(a,o,i);Li(),a=a.memoizedState,o=Li();var d=o.queue.dispatch;return o.memoizedState=i,[a,d,!1]}function Pc(i,a,o,d){return i={tag:i,create:o,deps:d,inst:a,next:null},a=Ae.updateQueue,a===null&&(a=ty(),Ae.updateQueue=a),o=a.lastEffect,o===null?a.lastEffect=i.next=i:(d=o.next,o.next=i,i.next=d,a.lastEffect=i),i}function Sp(){return{destroy:void 0,resource:void 0}}function Q1(){return Li().memoizedState}function Cf(i,a,o,d){var y=$n();d=d===void 0?null:d,Ae.flags|=i,y.memoizedState=Pc(1|a,Sp(),o,d)}function Wh(i,a,o,d){var y=Li();d=d===void 0?null:d;var w=y.memoizedState.inst;ni!==null&&d!==null&&Y_(d,ni.memoizedState.deps)?y.memoizedState=Pc(a,w,o,d):(Ae.flags|=i,y.memoizedState=Pc(1|a,w,o,d))}function Xv(i,a){Cf(8390656,8,i,a)}function J1(i,a){Wh(2048,8,i,a)}function W1(i,a){return Wh(4,2,i,a)}function tb(i,a){return Wh(4,4,i,a)}function eb(i,a){if(typeof a=="function"){i=i();var o=a(i);return function(){typeof o=="function"?o():a(null)}}if(a!=null)return i=i(),a.current=i,function(){a.current=null}}function ib(i,a,o){o=o!=null?o.concat([i]):null,Wh(4,4,eb.bind(null,a,i),o)}function ny(){}function nb(i,a){var o=Li();a=a===void 0?null:a;var d=o.memoizedState;return a!==null&&Y_(a,d[1])?d[0]:(o.memoizedState=[i,a],i)}function ab(i,a){var o=Li();a=a===void 0?null:a;var d=o.memoizedState;if(a!==null&&Y_(a,d[1]))return d[0];if(d=i(),nl){Ys(!0);try{i()}finally{Ys(!1)}}return o.memoizedState=[d,a],d}function ay(i,a,o){return o===void 0||oo&1073741824?i.memoizedState=a:(i.memoizedState=o,i=$b(),Ae.lanes|=i,co|=i,o)}function rb(i,a,o,d){return ba(o,a)?o:Rc.current!==null?(i=ay(i,o,d),ba(i,a)||(en=!0),i):oo&42?(i=$b(),Ae.lanes|=i,co|=i,a):(en=!0,i.memoizedState=o)}function sb(i,a,o,d,y){var w=Ze.p;Ze.p=w!==0&&8>w?w:8;var T=he.T,f={};he.T=f,sy(i,!1,a,o);try{var q=y(),ct=he.S;if(ct!==null&&ct(f,q),q!==null&&typeof q=="object"&&typeof q.then=="function"){var vt=lA(q,d);wh(i,a,vt,va(i))}else wh(i,a,d,va(i))}catch(tt){wh(i,a,{then:function(){},status:"rejected",reason:tt},va())}finally{Ze.p=w,he.T=T}}function fA(){}function t_(i,a,o,d){if(i.tag!==5)throw Error(Tt(476));var y=ob(i).queue;sb(i,y,a,$o,o===null?fA:function(){return lb(i),o(d)})}function ob(i){var a=i.memoizedState;if(a!==null)return a;a={memoizedState:$o,baseState:$o,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Jr,lastRenderedState:$o},next:null};var o={};return a.next={memoizedState:o,baseState:o,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Jr,lastRenderedState:o},next:null},i.memoizedState=a,i=i.alternate,i!==null&&(i.memoizedState=a),a}function lb(i){var a=ob(i).next.queue;wh(i,a,{},va())}function ry(){return Tn(Fh)}function cb(){return Li().memoizedState}function ub(){return Li().memoizedState}function pA(i){for(var a=i.return;a!==null;){switch(a.tag){case 24:case 3:var o=va();i=to(o);var d=eo(a,i,o);d!==null&&(xa(d,a,o),vh(d,a,o)),a={cache:G_()},i.payload=a;return}a=a.return}}function mA(i,a,o){var d=va();o={lane:d,revertLane:0,action:o,hasEagerState:!1,eagerState:null,next:null},Tp(i)?db(a,o):(o=V_(i,a,o,d),o!==null&&(xa(o,i,d),fb(o,a,d)))}function hb(i,a,o){var d=va();wh(i,a,o,d)}function wh(i,a,o,d){var y={lane:d,revertLane:0,action:o,hasEagerState:!1,eagerState:null,next:null};if(Tp(i))db(a,y);else{var w=i.alternate;if(i.lanes===0&&(w===null||w.lanes===0)&&(w=a.lastRenderedReducer,w!==null))try{var T=a.lastRenderedState,f=w(T,o);if(y.hasEagerState=!0,y.eagerState=f,ba(f,T))return xp(i,a,y,0),si===null&&vp(),!1}catch{}finally{}if(o=V_(i,a,y,d),o!==null)return xa(o,i,d),fb(o,a,d),!0}return!1}function sy(i,a,o,d){if(d={lane:2,revertLane:py(),action:d,hasEagerState:!1,eagerState:null,next:null},Tp(i)){if(a)throw Error(Tt(479))}else a=V_(i,o,d,2),a!==null&&xa(a,i,2)}function Tp(i){var a=i.alternate;return i===Ae||a!==null&&a===Ae}function db(i,a){Ac=Xf=!0;var o=i.pending;o===null?a.next=a:(a.next=o.next,o.next=a),i.pending=a}function fb(i,a,o){if(o&4194048){var d=a.lanes;d&=i.pendingLanes,o|=d,a.lanes=o,n1(i,o)}}var Yf={readContext:Tn,use:wp,useCallback:zi,useContext:zi,useEffect:zi,useImperativeHandle:zi,useLayoutEffect:zi,useInsertionEffect:zi,useMemo:zi,useReducer:zi,useRef:zi,useState:zi,useDebugValue:zi,useDeferredValue:zi,useTransition:zi,useSyncExternalStore:zi,useId:zi,useHostTransitionStatus:zi,useFormState:zi,useActionState:zi,useOptimistic:zi,useMemoCache:zi,useCacheRefresh:zi},pb={readContext:Tn,use:wp,useCallback:function(i,a){return $n().memoizedState=[i,a===void 0?null:a],i},useContext:Tn,useEffect:Xv,useImperativeHandle:function(i,a,o){o=o!=null?o.concat([i]):null,Cf(4194308,4,eb.bind(null,a,i),o)},useLayoutEffect:function(i,a){return Cf(4194308,4,i,a)},useInsertionEffect:function(i,a){Cf(4,2,i,a)},useMemo:function(i,a){var o=$n();a=a===void 0?null:a;var d=i();if(nl){Ys(!0);try{i()}finally{Ys(!1)}}return o.memoizedState=[d,a],d},useReducer:function(i,a,o){var d=$n();if(o!==void 0){var y=o(a);if(nl){Ys(!0);try{o(a)}finally{Ys(!1)}}}else y=a;return d.memoizedState=d.baseState=y,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:y},d.queue=i,i=i.dispatch=mA.bind(null,Ae,i),[d.memoizedState,i]},useRef:function(i){var a=$n();return i={current:i},a.memoizedState=i},useState:function(i){i=Jg(i);var a=i.queue,o=hb.bind(null,Ae,a);return a.dispatch=o,[i.memoizedState,o]},useDebugValue:ny,useDeferredValue:function(i,a){var o=$n();return ay(o,i,a)},useTransition:function(){var i=Jg(!1);return i=sb.bind(null,Ae,i.queue,!0,!1),$n().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,a,o){var d=Ae,y=$n();if(qe){if(o===void 0)throw Error(Tt(407));o=o()}else{if(o=a(),si===null)throw Error(Tt(349));Be&124||V1(d,a,o)}y.memoizedState=o;var w={value:o,getSnapshot:a};return y.queue=w,Xv(q1.bind(null,d,w,i),[i]),d.flags|=2048,Pc(9,Sp(),j1.bind(null,d,w,o,a),null),o},useId:function(){var i=$n(),a=si.identifierPrefix;if(qe){var o=Hr,d=Gr;o=(d&~(1<<32-ya(d)-1)).toString(32)+o,a=""+a+"R"+o,o=$f++,0<o&&(a+="H"+o.toString(32)),a+=""}else o=cA++,a=""+a+"r"+o.toString(32)+"";return i.memoizedState=a},useHostTransitionStatus:ry,useFormState:Zv,useActionState:Zv,useOptimistic:function(i){var a=$n();a.memoizedState=a.baseState=i;var o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=o,a=sy.bind(null,Ae,!0,o),o.dispatch=a,[i,a]},useMemoCache:ey,useCacheRefresh:function(){return $n().memoizedState=pA.bind(null,Ae)}},mb={readContext:Tn,use:wp,useCallback:nb,useContext:Tn,useEffect:J1,useImperativeHandle:ib,useInsertionEffect:W1,useLayoutEffect:tb,useMemo:ab,useReducer:zf,useRef:Q1,useState:function(){return zf(Jr)},useDebugValue:ny,useDeferredValue:function(i,a){var o=Li();return rb(o,ni.memoizedState,i,a)},useTransition:function(){var i=zf(Jr)[0],a=Li().memoizedState;return[typeof i=="boolean"?i:Jh(i),a]},useSyncExternalStore:N1,useId:cb,useHostTransitionStatus:ry,useFormState:Gv,useActionState:Gv,useOptimistic:function(i,a){var o=Li();return H1(o,ni,i,a)},useMemoCache:ey,useCacheRefresh:ub},gA={readContext:Tn,use:wp,useCallback:nb,useContext:Tn,useEffect:J1,useImperativeHandle:ib,useInsertionEffect:W1,useLayoutEffect:tb,useMemo:ab,useReducer:og,useRef:Q1,useState:function(){return og(Jr)},useDebugValue:ny,useDeferredValue:function(i,a){var o=Li();return ni===null?ay(o,i,a):rb(o,ni.memoizedState,i,a)},useTransition:function(){var i=og(Jr)[0],a=Li().memoizedState;return[typeof i=="boolean"?i:Jh(i),a]},useSyncExternalStore:N1,useId:cb,useHostTransitionStatus:ry,useFormState:Hv,useActionState:Hv,useOptimistic:function(i,a){var o=Li();return ni!==null?H1(o,ni,i,a):(o.baseState=i,[i,o.queue.dispatch])},useMemoCache:ey,useCacheRefresh:ub},Mc=null,Ph=0;function mf(i){var a=Ph;return Ph+=1,Mc===null&&(Mc=[]),L1(Mc,i,a)}function rh(i,a){a=a.props.ref,i.ref=a!==void 0?a:null}function gf(i,a){throw a.$$typeof===HS?Error(Tt(525)):(i=Object.prototype.toString.call(a),Error(Tt(31,i==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":i)))}function $v(i){var a=i._init;return a(i._payload)}function gb(i){function a(st,nt){if(i){var ut=st.deletions;ut===null?(st.deletions=[nt],st.flags|=16):ut.push(nt)}}function o(st,nt){if(!i)return null;for(;nt!==null;)a(st,nt),nt=nt.sibling;return null}function d(st){for(var nt=new Map;st!==null;)st.key!==null?nt.set(st.key,st):nt.set(st.index,st),st=st.sibling;return nt}function y(st,nt){return st=Yr(st,nt),st.index=0,st.sibling=null,st}function w(st,nt,ut){return st.index=ut,i?(ut=st.alternate,ut!==null?(ut=ut.index,ut<nt?(st.flags|=67108866,nt):ut):(st.flags|=67108866,nt)):(st.flags|=1048576,nt)}function T(st){return i&&st.alternate===null&&(st.flags|=67108866),st}function f(st,nt,ut,bt){return nt===null||nt.tag!==6?(nt=ag(ut,st.mode,bt),nt.return=st,nt):(nt=y(nt,ut),nt.return=st,nt)}function q(st,nt,ut,bt){var Ot=ut.type;return Ot===cc?vt(st,nt,ut.props.children,bt,ut.key):nt!==null&&(nt.elementType===Ot||typeof Ot=="object"&&Ot!==null&&Ot.$$typeof===js&&$v(Ot)===nt.type)?(nt=y(nt,ut.props),rh(nt,ut),nt.return=st,nt):(nt=Ef(ut.type,ut.key,ut.props,null,st.mode,bt),rh(nt,ut),nt.return=st,nt)}function ct(st,nt,ut,bt){return nt===null||nt.tag!==4||nt.stateNode.containerInfo!==ut.containerInfo||nt.stateNode.implementation!==ut.implementation?(nt=rg(ut,st.mode,bt),nt.return=st,nt):(nt=y(nt,ut.children||[]),nt.return=st,nt)}function vt(st,nt,ut,bt,Ot){return nt===null||nt.tag!==7?(nt=Yo(ut,st.mode,bt,Ot),nt.return=st,nt):(nt=y(nt,ut),nt.return=st,nt)}function tt(st,nt,ut){if(typeof nt=="string"&&nt!==""||typeof nt=="number"||typeof nt=="bigint")return nt=ag(""+nt,st.mode,ut),nt.return=st,nt;if(typeof nt=="object"&&nt!==null){switch(nt.$$typeof){case lf:return ut=Ef(nt.type,nt.key,nt.props,null,st.mode,ut),rh(ut,nt),ut.return=st,ut;case ch:return nt=rg(nt,st.mode,ut),nt.return=st,nt;case js:var bt=nt._init;return nt=bt(nt._payload),tt(st,nt,ut)}if(uh(nt)||eh(nt))return nt=Yo(nt,st.mode,ut,null),nt.return=st,nt;if(typeof nt.then=="function")return tt(st,mf(nt),ut);if(nt.$$typeof===Zr)return tt(st,ff(st,nt),ut);gf(st,nt)}return null}function V(st,nt,ut,bt){var Ot=nt!==null?nt.key:null;if(typeof ut=="string"&&ut!==""||typeof ut=="number"||typeof ut=="bigint")return Ot!==null?null:f(st,nt,""+ut,bt);if(typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case lf:return ut.key===Ot?q(st,nt,ut,bt):null;case ch:return ut.key===Ot?ct(st,nt,ut,bt):null;case js:return Ot=ut._init,ut=Ot(ut._payload),V(st,nt,ut,bt)}if(uh(ut)||eh(ut))return Ot!==null?null:vt(st,nt,ut,bt,null);if(typeof ut.then=="function")return V(st,nt,mf(ut),bt);if(ut.$$typeof===Zr)return V(st,nt,ff(st,ut),bt);gf(st,ut)}return null}function pt(st,nt,ut,bt,Ot){if(typeof bt=="string"&&bt!==""||typeof bt=="number"||typeof bt=="bigint")return st=st.get(ut)||null,f(nt,st,""+bt,Ot);if(typeof bt=="object"&&bt!==null){switch(bt.$$typeof){case lf:return st=st.get(bt.key===null?ut:bt.key)||null,q(nt,st,bt,Ot);case ch:return st=st.get(bt.key===null?ut:bt.key)||null,ct(nt,st,bt,Ot);case js:var ne=bt._init;return bt=ne(bt._payload),pt(st,nt,ut,bt,Ot)}if(uh(bt)||eh(bt))return st=st.get(ut)||null,vt(nt,st,bt,Ot,null);if(typeof bt.then=="function")return pt(st,nt,ut,mf(bt),Ot);if(bt.$$typeof===Zr)return pt(st,nt,ut,ff(nt,bt),Ot);gf(nt,bt)}return null}function Jt(st,nt,ut,bt){for(var Ot=null,ne=null,Nt=nt,te=nt=0,Pe=null;Nt!==null&&te<ut.length;te++){Nt.index>te?(Pe=Nt,Nt=null):Pe=Nt.sibling;var ye=V(st,Nt,ut[te],bt);if(ye===null){Nt===null&&(Nt=Pe);break}i&&Nt&&ye.alternate===null&&a(st,Nt),nt=w(ye,nt,te),ne===null?Ot=ye:ne.sibling=ye,ne=ye,Nt=Pe}if(te===ut.length)return o(st,Nt),qe&&Ho(st,te),Ot;if(Nt===null){for(;te<ut.length;te++)Nt=tt(st,ut[te],bt),Nt!==null&&(nt=w(Nt,nt,te),ne===null?Ot=Nt:ne.sibling=Nt,ne=Nt);return qe&&Ho(st,te),Ot}for(Nt=d(Nt);te<ut.length;te++)Pe=pt(Nt,st,te,ut[te],bt),Pe!==null&&(i&&Pe.alternate!==null&&Nt.delete(Pe.key===null?te:Pe.key),nt=w(Pe,nt,te),ne===null?Ot=Pe:ne.sibling=Pe,ne=Pe);return i&&Nt.forEach(function(me){return a(st,me)}),qe&&Ho(st,te),Ot}function Xt(st,nt,ut,bt){if(ut==null)throw Error(Tt(151));for(var Ot=null,ne=null,Nt=nt,te=nt=0,Pe=null,ye=ut.next();Nt!==null&&!ye.done;te++,ye=ut.next()){Nt.index>te?(Pe=Nt,Nt=null):Pe=Nt.sibling;var me=V(st,Nt,ye.value,bt);if(me===null){Nt===null&&(Nt=Pe);break}i&&Nt&&me.alternate===null&&a(st,Nt),nt=w(me,nt,te),ne===null?Ot=me:ne.sibling=me,ne=me,Nt=Pe}if(ye.done)return o(st,Nt),qe&&Ho(st,te),Ot;if(Nt===null){for(;!ye.done;te++,ye=ut.next())ye=tt(st,ye.value,bt),ye!==null&&(nt=w(ye,nt,te),ne===null?Ot=ye:ne.sibling=ye,ne=ye);return qe&&Ho(st,te),Ot}for(Nt=d(Nt);!ye.done;te++,ye=ut.next())ye=pt(Nt,st,te,ye.value,bt),ye!==null&&(i&&ye.alternate!==null&&Nt.delete(ye.key===null?te:ye.key),nt=w(ye,nt,te),ne===null?Ot=ye:ne.sibling=ye,ne=ye);return i&&Nt.forEach(function(An){return a(st,An)}),qe&&Ho(st,te),Ot}function _e(st,nt,ut,bt){if(typeof ut=="object"&&ut!==null&&ut.type===cc&&ut.key===null&&(ut=ut.props.children),typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case lf:t:{for(var Ot=ut.key;nt!==null;){if(nt.key===Ot){if(Ot=ut.type,Ot===cc){if(nt.tag===7){o(st,nt.sibling),bt=y(nt,ut.props.children),bt.return=st,st=bt;break t}}else if(nt.elementType===Ot||typeof Ot=="object"&&Ot!==null&&Ot.$$typeof===js&&$v(Ot)===nt.type){o(st,nt.sibling),bt=y(nt,ut.props),rh(bt,ut),bt.return=st,st=bt;break t}o(st,nt);break}else a(st,nt);nt=nt.sibling}ut.type===cc?(bt=Yo(ut.props.children,st.mode,bt,ut.key),bt.return=st,st=bt):(bt=Ef(ut.type,ut.key,ut.props,null,st.mode,bt),rh(bt,ut),bt.return=st,st=bt)}return T(st);case ch:t:{for(Ot=ut.key;nt!==null;){if(nt.key===Ot)if(nt.tag===4&&nt.stateNode.containerInfo===ut.containerInfo&&nt.stateNode.implementation===ut.implementation){o(st,nt.sibling),bt=y(nt,ut.children||[]),bt.return=st,st=bt;break t}else{o(st,nt);break}else a(st,nt);nt=nt.sibling}bt=rg(ut,st.mode,bt),bt.return=st,st=bt}return T(st);case js:return Ot=ut._init,ut=Ot(ut._payload),_e(st,nt,ut,bt)}if(uh(ut))return Jt(st,nt,ut,bt);if(eh(ut)){if(Ot=eh(ut),typeof Ot!="function")throw Error(Tt(150));return ut=Ot.call(ut),Xt(st,nt,ut,bt)}if(typeof ut.then=="function")return _e(st,nt,mf(ut),bt);if(ut.$$typeof===Zr)return _e(st,nt,ff(st,ut),bt);gf(st,ut)}return typeof ut=="string"&&ut!==""||typeof ut=="number"||typeof ut=="bigint"?(ut=""+ut,nt!==null&&nt.tag===6?(o(st,nt.sibling),bt=y(nt,ut),bt.return=st,st=bt):(o(st,nt),bt=ag(ut,st.mode,bt),bt.return=st,st=bt),T(st)):o(st,nt)}return function(st,nt,ut,bt){try{Ph=0;var Ot=_e(st,nt,ut,bt);return Mc=null,Ot}catch(Nt){if(Nt===Qh||Nt===bp)throw Nt;var ne=ga(29,Nt,null,st.mode);return ne.lanes=bt,ne.return=st,ne}finally{}}}var Lc=gb(!0),_b=gb(!1),Na=yr(null),_r=null;function Hs(i){var a=i.alternate;gi(Vi,Vi.current&1),gi(Na,i),_r===null&&(a===null||Rc.current!==null||a.memoizedState!==null)&&(_r=i)}function yb(i){if(i.tag===22){if(gi(Vi,Vi.current),gi(Na,i),_r===null){var a=i.alternate;a!==null&&a.memoizedState!==null&&(_r=i)}}else Xs()}function Xs(){gi(Vi,Vi.current),gi(Na,Na.current)}function $r(i){nn(Na),_r===i&&(_r=null),nn(Vi)}var Vi=yr(0);function Kf(i){for(var a=i;a!==null;){if(a.tag===13){var o=a.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||o.data==="$?"||__(o)))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if(a.flags&128)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}function lg(i,a,o,d){a=i.memoizedState,o=o(d,a),o=o==null?a:ui({},a,o),i.memoizedState=o,i.lanes===0&&(i.updateQueue.baseState=o)}var e_={enqueueSetState:function(i,a,o){i=i._reactInternals;var d=va(),y=to(d);y.payload=a,o!=null&&(y.callback=o),a=eo(i,y,d),a!==null&&(xa(a,i,d),vh(a,i,d))},enqueueReplaceState:function(i,a,o){i=i._reactInternals;var d=va(),y=to(d);y.tag=1,y.payload=a,o!=null&&(y.callback=o),a=eo(i,y,d),a!==null&&(xa(a,i,d),vh(a,i,d))},enqueueForceUpdate:function(i,a){i=i._reactInternals;var o=va(),d=to(o);d.tag=2,a!=null&&(d.callback=a),a=eo(i,d,o),a!==null&&(xa(a,i,o),vh(a,i,o))}};function Yv(i,a,o,d,y,w,T){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(d,w,T):a.prototype&&a.prototype.isPureReactComponent?!Ih(o,d)||!Ih(y,w):!0}function Kv(i,a,o,d){i=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(o,d),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(o,d),a.state!==i&&e_.enqueueReplaceState(a,a.state,null)}function al(i,a){var o=a;if("ref"in a){o={};for(var d in a)d!=="ref"&&(o[d]=a[d])}if(i=i.defaultProps){o===a&&(o=ui({},o));for(var y in i)o[y]===void 0&&(o[y]=i[y])}return o}var Qf=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)};function vb(i){Qf(i)}function xb(i){console.error(i)}function bb(i){Qf(i)}function Jf(i,a){try{var o=i.onUncaughtError;o(a.value,{componentStack:a.stack})}catch(d){setTimeout(function(){throw d})}}function Qv(i,a,o){try{var d=i.onCaughtError;d(o.value,{componentStack:o.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(y){setTimeout(function(){throw y})}}function i_(i,a,o){return o=to(o),o.tag=3,o.payload={element:null},o.callback=function(){Jf(i,a)},o}function wb(i){return i=to(i),i.tag=3,i}function Sb(i,a,o,d){var y=o.type.getDerivedStateFromError;if(typeof y=="function"){var w=d.value;i.payload=function(){return y(w)},i.callback=function(){Qv(a,o,d)}}var T=o.stateNode;T!==null&&typeof T.componentDidCatch=="function"&&(i.callback=function(){Qv(a,o,d),typeof y!="function"&&(io===null?io=new Set([this]):io.add(this));var f=d.stack;this.componentDidCatch(d.value,{componentStack:f!==null?f:""})})}function _A(i,a,o,d,y){if(o.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(a=o.alternate,a!==null&&Yh(a,o,y,!0),o=Na.current,o!==null){switch(o.tag){case 13:return _r===null?u_():o.alternate===null&&Ti===0&&(Ti=3),o.flags&=-257,o.flags|=65536,o.lanes=y,d===$g?o.flags|=16384:(a=o.updateQueue,a===null?o.updateQueue=new Set([d]):a.add(d),vg(i,d,y)),!1;case 22:return o.flags|=65536,d===$g?o.flags|=16384:(a=o.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([d])},o.updateQueue=a):(o=a.retryQueue,o===null?a.retryQueue=new Set([d]):o.add(d)),vg(i,d,y)),!1}throw Error(Tt(435,o.tag))}return vg(i,d,y),u_(),!1}if(qe)return a=Na.current,a!==null?(!(a.flags&65536)&&(a.flags|=256),a.flags|=65536,a.lanes=y,d!==qg&&(i=Error(Tt(422),{cause:d}),kh(Fa(i,o)))):(d!==qg&&(a=Error(Tt(423),{cause:d}),kh(Fa(a,o))),i=i.current.alternate,i.flags|=65536,y&=-y,i.lanes|=y,d=Fa(d,o),y=i_(i.stateNode,d,y),sg(i,y),Ti!==4&&(Ti=2)),!1;var w=Error(Tt(520),{cause:d});if(w=Fa(w,o),Ah===null?Ah=[w]:Ah.push(w),Ti!==4&&(Ti=2),a===null)return!0;d=Fa(d,o),o=a;do{switch(o.tag){case 3:return o.flags|=65536,i=y&-y,o.lanes|=i,i=i_(o.stateNode,d,i),sg(o,i),!1;case 1:if(a=o.type,w=o.stateNode,(o.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(io===null||!io.has(w))))return o.flags|=65536,y&=-y,o.lanes|=y,y=wb(y),Sb(y,i,o,d),sg(o,y),!1}o=o.return}while(o!==null);return!1}var Tb=Error(Tt(461)),en=!1;function hn(i,a,o,d){a.child=i===null?_b(a,null,o,d):Lc(a,i.child,o,d)}function Jv(i,a,o,d,y){o=o.render;var w=a.ref;if("ref"in d){var T={};for(var f in d)f!=="ref"&&(T[f]=d[f])}else T=d;return il(a),d=K_(i,a,o,T,w,y),f=Q_(),i!==null&&!en?(J_(i,a,y),Wr(i,a,y)):(qe&&f&&q_(a),a.flags|=1,hn(i,a,d,y),a.child)}function Wv(i,a,o,d,y){if(i===null){var w=o.type;return typeof w=="function"&&!j_(w)&&w.defaultProps===void 0&&o.compare===null?(a.tag=15,a.type=w,Ab(i,a,w,d,y)):(i=Ef(o.type,null,d,a,a.mode,y),i.ref=a.ref,i.return=a,a.child=i)}if(w=i.child,!oy(i,y)){var T=w.memoizedProps;if(o=o.compare,o=o!==null?o:Ih,o(T,d)&&i.ref===a.ref)return Wr(i,a,y)}return a.flags|=1,i=Yr(w,d),i.ref=a.ref,i.return=a,a.child=i}function Ab(i,a,o,d,y){if(i!==null){var w=i.memoizedProps;if(Ih(w,d)&&i.ref===a.ref)if(en=!1,a.pendingProps=d=w,oy(i,y))i.flags&131072&&(en=!0);else return a.lanes=i.lanes,Wr(i,a,y)}return n_(i,a,o,d,y)}function Eb(i,a,o){var d=a.pendingProps,y=d.children,w=i!==null?i.memoizedState:null;if(d.mode==="hidden"){if(a.flags&128){if(d=w!==null?w.baseLanes|o:o,i!==null){for(y=a.child=i.child,w=0;y!==null;)w=w|y.lanes|y.childLanes,y=y.sibling;a.childLanes=w&~d}else a.childLanes=0,a.child=null;return tx(i,a,d,o)}if(o&536870912)a.memoizedState={baseLanes:0,cachePool:null},i!==null&&Mf(a,w!==null?w.cachePool:null),w!==null?Vv(a,w):Qg(),yb(a);else return a.lanes=a.childLanes=536870912,tx(i,a,w!==null?w.baseLanes|o:o,o)}else w!==null?(Mf(a,w.cachePool),Vv(a,w),Xs(),a.memoizedState=null):(i!==null&&Mf(a,null),Qg(),Xs());return hn(i,a,y,o),a.child}function tx(i,a,o,d){var y=H_();return y=y===null?null:{parent:Ni._currentValue,pool:y},a.memoizedState={baseLanes:o,cachePool:y},i!==null&&Mf(a,null),Qg(),yb(a),i!==null&&Yh(i,a,d,!0),null}function Df(i,a){var o=a.ref;if(o===null)i!==null&&i.ref!==null&&(a.flags|=4194816);else{if(typeof o!="function"&&typeof o!="object")throw Error(Tt(284));(i===null||i.ref!==o)&&(a.flags|=4194816)}}function n_(i,a,o,d,y){return il(a),o=K_(i,a,o,d,void 0,y),d=Q_(),i!==null&&!en?(J_(i,a,y),Wr(i,a,y)):(qe&&d&&q_(a),a.flags|=1,hn(i,a,o,y),a.child)}function ex(i,a,o,d,y,w){return il(a),a.updateQueue=null,o=U1(a,d,o,y),F1(i),d=Q_(),i!==null&&!en?(J_(i,a,w),Wr(i,a,w)):(qe&&d&&q_(a),a.flags|=1,hn(i,a,o,w),a.child)}function ix(i,a,o,d,y){if(il(a),a.stateNode===null){var w=_c,T=o.contextType;typeof T=="object"&&T!==null&&(w=Tn(T)),w=new o(d,w),a.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,w.updater=e_,a.stateNode=w,w._reactInternals=a,w=a.stateNode,w.props=d,w.state=a.memoizedState,w.refs={},X_(a),T=o.contextType,w.context=typeof T=="object"&&T!==null?Tn(T):_c,w.state=a.memoizedState,T=o.getDerivedStateFromProps,typeof T=="function"&&(lg(a,o,T,d),w.state=a.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof w.getSnapshotBeforeUpdate=="function"||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(T=w.state,typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount(),T!==w.state&&e_.enqueueReplaceState(w,w.state,null),bh(a,d,w,y),xh(),w.state=a.memoizedState),typeof w.componentDidMount=="function"&&(a.flags|=4194308),d=!0}else if(i===null){w=a.stateNode;var f=a.memoizedProps,q=al(o,f);w.props=q;var ct=w.context,vt=o.contextType;T=_c,typeof vt=="object"&&vt!==null&&(T=Tn(vt));var tt=o.getDerivedStateFromProps;vt=typeof tt=="function"||typeof w.getSnapshotBeforeUpdate=="function",f=a.pendingProps!==f,vt||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(f||ct!==T)&&Kv(a,w,d,T),qs=!1;var V=a.memoizedState;w.state=V,bh(a,d,w,y),xh(),ct=a.memoizedState,f||V!==ct||qs?(typeof tt=="function"&&(lg(a,o,tt,d),ct=a.memoizedState),(q=qs||Yv(a,o,q,d,V,ct,T))?(vt||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(a.flags|=4194308)):(typeof w.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=d,a.memoizedState=ct),w.props=d,w.state=ct,w.context=T,d=q):(typeof w.componentDidMount=="function"&&(a.flags|=4194308),d=!1)}else{w=a.stateNode,Yg(i,a),T=a.memoizedProps,vt=al(o,T),w.props=vt,tt=a.pendingProps,V=w.context,ct=o.contextType,q=_c,typeof ct=="object"&&ct!==null&&(q=Tn(ct)),f=o.getDerivedStateFromProps,(ct=typeof f=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(T!==tt||V!==q)&&Kv(a,w,d,q),qs=!1,V=a.memoizedState,w.state=V,bh(a,d,w,y),xh();var pt=a.memoizedState;T!==tt||V!==pt||qs||i!==null&&i.dependencies!==null&&Gf(i.dependencies)?(typeof f=="function"&&(lg(a,o,f,d),pt=a.memoizedState),(vt=qs||Yv(a,o,vt,d,V,pt,q)||i!==null&&i.dependencies!==null&&Gf(i.dependencies))?(ct||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(d,pt,q),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(d,pt,q)),typeof w.componentDidUpdate=="function"&&(a.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof w.componentDidUpdate!="function"||T===i.memoizedProps&&V===i.memoizedState||(a.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||T===i.memoizedProps&&V===i.memoizedState||(a.flags|=1024),a.memoizedProps=d,a.memoizedState=pt),w.props=d,w.state=pt,w.context=q,d=vt):(typeof w.componentDidUpdate!="function"||T===i.memoizedProps&&V===i.memoizedState||(a.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||T===i.memoizedProps&&V===i.memoizedState||(a.flags|=1024),d=!1)}return w=d,Df(i,a),d=(a.flags&128)!==0,w||d?(w=a.stateNode,o=d&&typeof o.getDerivedStateFromError!="function"?null:w.render(),a.flags|=1,i!==null&&d?(a.child=Lc(a,i.child,null,y),a.child=Lc(a,null,o,y)):hn(i,a,o,y),a.memoizedState=w.state,i=a.child):i=Wr(i,a,y),i}function nx(i,a,o,d){return $h(),a.flags|=256,hn(i,a,o,d),a.child}var cg={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function ug(i){return{baseLanes:i,cachePool:R1()}}function hg(i,a,o){return i=i!==null?i.childLanes&~o:0,a&&(i|=Ua),i}function Mb(i,a,o){var d=a.pendingProps,y=!1,w=(a.flags&128)!==0,T;if((T=w)||(T=i!==null&&i.memoizedState===null?!1:(Vi.current&2)!==0),T&&(y=!0,a.flags&=-129),T=(a.flags&32)!==0,a.flags&=-33,i===null){if(qe){if(y?Hs(a):Xs(),qe){var f=Si,q;if(q=f){t:{for(q=f,f=fr;q.nodeType!==8;){if(!f){f=null;break t}if(q=Qa(q.nextSibling),q===null){f=null;break t}}f=q}f!==null?(a.memoizedState={dehydrated:f,treeContext:Ko!==null?{id:Gr,overflow:Hr}:null,retryLane:536870912,hydrationErrors:null},q=ga(18,null,null,0),q.stateNode=f,q.return=a,a.child=q,Bn=a,Si=null,q=!0):q=!1}q||el(a)}if(f=a.memoizedState,f!==null&&(f=f.dehydrated,f!==null))return __(f)?a.lanes=32:a.lanes=536870912,null;$r(a)}return f=d.children,d=d.fallback,y?(Xs(),y=a.mode,f=Wf({mode:"hidden",children:f},y),d=Yo(d,y,o,null),f.return=a,d.return=a,f.sibling=d,a.child=f,y=a.child,y.memoizedState=ug(o),y.childLanes=hg(i,T,o),a.memoizedState=cg,d):(Hs(a),a_(a,f))}if(q=i.memoizedState,q!==null&&(f=q.dehydrated,f!==null)){if(w)a.flags&256?(Hs(a),a.flags&=-257,a=dg(i,a,o)):a.memoizedState!==null?(Xs(),a.child=i.child,a.flags|=128,a=null):(Xs(),y=d.fallback,f=a.mode,d=Wf({mode:"visible",children:d.children},f),y=Yo(y,f,o,null),y.flags|=2,d.return=a,y.return=a,d.sibling=y,a.child=d,Lc(a,i.child,null,o),d=a.child,d.memoizedState=ug(o),d.childLanes=hg(i,T,o),a.memoizedState=cg,a=y);else if(Hs(a),__(f)){if(T=f.nextSibling&&f.nextSibling.dataset,T)var ct=T.dgst;T=ct,d=Error(Tt(419)),d.stack="",d.digest=T,kh({value:d,source:null,stack:null}),a=dg(i,a,o)}else if(en||Yh(i,a,o,!1),T=(o&i.childLanes)!==0,en||T){if(T=si,T!==null&&(d=o&-o,d=d&42?1:I_(d),d=d&(T.suspendedLanes|o)?0:d,d!==0&&d!==q.retryLane))throw q.retryLane=d,qc(i,d),xa(T,i,d),Tb;f.data==="$?"||u_(),a=dg(i,a,o)}else f.data==="$?"?(a.flags|=192,a.child=i.child,a=null):(i=q.treeContext,Si=Qa(f.nextSibling),Bn=a,qe=!0,Qo=null,fr=!1,i!==null&&(La[Ba++]=Gr,La[Ba++]=Hr,La[Ba++]=Ko,Gr=i.id,Hr=i.overflow,Ko=a),a=a_(a,d.children),a.flags|=4096);return a}return y?(Xs(),y=d.fallback,f=a.mode,q=i.child,ct=q.sibling,d=Yr(q,{mode:"hidden",children:d.children}),d.subtreeFlags=q.subtreeFlags&65011712,ct!==null?y=Yr(ct,y):(y=Yo(y,f,o,null),y.flags|=2),y.return=a,d.return=a,d.sibling=y,a.child=d,d=y,y=a.child,f=i.child.memoizedState,f===null?f=ug(o):(q=f.cachePool,q!==null?(ct=Ni._currentValue,q=q.parent!==ct?{parent:ct,pool:ct}:q):q=R1(),f={baseLanes:f.baseLanes|o,cachePool:q}),y.memoizedState=f,y.childLanes=hg(i,T,o),a.memoizedState=cg,d):(Hs(a),o=i.child,i=o.sibling,o=Yr(o,{mode:"visible",children:d.children}),o.return=a,o.sibling=null,i!==null&&(T=a.deletions,T===null?(a.deletions=[i],a.flags|=16):T.push(i)),a.child=o,a.memoizedState=null,o)}function a_(i,a){return a=Wf({mode:"visible",children:a},i.mode),a.return=i,i.child=a}function Wf(i,a){return i=ga(22,i,null,a),i.lanes=0,i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},i}function dg(i,a,o){return Lc(a,i.child,null,o),i=a_(a,a.pendingProps.children),i.flags|=2,a.memoizedState=null,i}function ax(i,a,o){i.lanes|=a;var d=i.alternate;d!==null&&(d.lanes|=a),Gg(i.return,a,o)}function fg(i,a,o,d,y){var w=i.memoizedState;w===null?i.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:d,tail:o,tailMode:y}:(w.isBackwards=a,w.rendering=null,w.renderingStartTime=0,w.last=d,w.tail=o,w.tailMode=y)}function zb(i,a,o){var d=a.pendingProps,y=d.revealOrder,w=d.tail;if(hn(i,a,d.children,o),d=Vi.current,d&2)d=d&1|2,a.flags|=128;else{if(i!==null&&i.flags&128)t:for(i=a.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&ax(i,o,a);else if(i.tag===19)ax(i,o,a);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===a)break t;for(;i.sibling===null;){if(i.return===null||i.return===a)break t;i=i.return}i.sibling.return=i.return,i=i.sibling}d&=1}switch(gi(Vi,d),y){case"forwards":for(o=a.child,y=null;o!==null;)i=o.alternate,i!==null&&Kf(i)===null&&(y=o),o=o.sibling;o=y,o===null?(y=a.child,a.child=null):(y=o.sibling,o.sibling=null),fg(a,!1,y,o,w);break;case"backwards":for(o=null,y=a.child,a.child=null;y!==null;){if(i=y.alternate,i!==null&&Kf(i)===null){a.child=y;break}i=y.sibling,y.sibling=o,o=y,y=i}fg(a,!0,o,null,w);break;case"together":fg(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function Wr(i,a,o){if(i!==null&&(a.dependencies=i.dependencies),co|=a.lanes,!(o&a.childLanes))if(i!==null){if(Yh(i,a,o,!1),(o&a.childLanes)===0)return null}else return null;if(i!==null&&a.child!==i.child)throw Error(Tt(153));if(a.child!==null){for(i=a.child,o=Yr(i,i.pendingProps),a.child=o,o.return=a;i.sibling!==null;)i=i.sibling,o=o.sibling=Yr(i,i.pendingProps),o.return=a;o.sibling=null}return a.child}function oy(i,a){return i.lanes&a?!0:(i=i.dependencies,!!(i!==null&&Gf(i)))}function yA(i,a,o){switch(a.tag){case 3:Of(a,a.stateNode.containerInfo),Gs(a,Ni,i.memoizedState.cache),$h();break;case 27:case 5:Rg(a);break;case 4:Of(a,a.stateNode.containerInfo);break;case 10:Gs(a,a.type,a.memoizedProps.value);break;case 13:var d=a.memoizedState;if(d!==null)return d.dehydrated!==null?(Hs(a),a.flags|=128,null):o&a.child.childLanes?Mb(i,a,o):(Hs(a),i=Wr(i,a,o),i!==null?i.sibling:null);Hs(a);break;case 19:var y=(i.flags&128)!==0;if(d=(o&a.childLanes)!==0,d||(Yh(i,a,o,!1),d=(o&a.childLanes)!==0),y){if(d)return zb(i,a,o);a.flags|=128}if(y=a.memoizedState,y!==null&&(y.rendering=null,y.tail=null,y.lastEffect=null),gi(Vi,Vi.current),d)break;return null;case 22:case 23:return a.lanes=0,Eb(i,a,o);case 24:Gs(a,Ni,i.memoizedState.cache)}return Wr(i,a,o)}function Cb(i,a,o){if(i!==null)if(i.memoizedProps!==a.pendingProps)en=!0;else{if(!oy(i,o)&&!(a.flags&128))return en=!1,yA(i,a,o);en=!!(i.flags&131072)}else en=!1,qe&&a.flags&1048576&&I1(a,Zf,a.index);switch(a.lanes=0,a.tag){case 16:t:{i=a.pendingProps;var d=a.elementType,y=d._init;if(d=y(d._payload),a.type=d,typeof d=="function")j_(d)?(i=al(d,i),a.tag=1,a=ix(null,a,d,i,o)):(a.tag=0,a=n_(null,a,d,i,o));else{if(d!=null){if(y=d.$$typeof,y===z_){a.tag=11,a=Jv(null,a,d,i,o);break t}else if(y===C_){a.tag=14,a=Wv(null,a,d,i,o);break t}}throw a=Ig(d)||d,Error(Tt(306,a,""))}}return a;case 0:return n_(i,a,a.type,a.pendingProps,o);case 1:return d=a.type,y=al(d,a.pendingProps),ix(i,a,d,y,o);case 3:t:{if(Of(a,a.stateNode.containerInfo),i===null)throw Error(Tt(387));d=a.pendingProps;var w=a.memoizedState;y=w.element,Yg(i,a),bh(a,d,null,o);var T=a.memoizedState;if(d=T.cache,Gs(a,Ni,d),d!==w.cache&&Hg(a,[Ni],o,!0),xh(),d=T.element,w.isDehydrated)if(w={element:d,isDehydrated:!1,cache:T.cache},a.updateQueue.baseState=w,a.memoizedState=w,a.flags&256){a=nx(i,a,d,o);break t}else if(d!==y){y=Fa(Error(Tt(424)),a),kh(y),a=nx(i,a,d,o);break t}else{switch(i=a.stateNode.containerInfo,i.nodeType){case 9:i=i.body;break;default:i=i.nodeName==="HTML"?i.ownerDocument.body:i}for(Si=Qa(i.firstChild),Bn=a,qe=!0,Qo=null,fr=!0,o=_b(a,null,d,o),a.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling}else{if($h(),d===y){a=Wr(i,a,o);break t}hn(i,a,d,o)}a=a.child}return a;case 26:return Df(i,a),i===null?(o=bx(a.type,null,a.pendingProps,null))?a.memoizedState=o:qe||(o=a.type,i=a.pendingProps,d=sp(Ws.current).createElement(o),d[Sn]=a,d[Qn]=i,fn(d,o,i),tn(d),a.stateNode=d):a.memoizedState=bx(a.type,i.memoizedProps,a.pendingProps,i.memoizedState),null;case 27:return Rg(a),i===null&&qe&&(d=a.stateNode=mw(a.type,a.pendingProps,Ws.current),Bn=a,fr=!0,y=Si,ho(a.type)?(y_=y,Si=Qa(d.firstChild)):Si=y),hn(i,a,a.pendingProps.children,o),Df(i,a),i===null&&(a.flags|=4194304),a.child;case 5:return i===null&&qe&&((y=d=Si)&&(d=HA(d,a.type,a.pendingProps,fr),d!==null?(a.stateNode=d,Bn=a,Si=Qa(d.firstChild),fr=!1,y=!0):y=!1),y||el(a)),Rg(a),y=a.type,w=a.pendingProps,T=i!==null?i.memoizedProps:null,d=w.children,m_(y,w)?d=null:T!==null&&m_(y,T)&&(a.flags|=32),a.memoizedState!==null&&(y=K_(i,a,uA,null,null,o),Fh._currentValue=y),Df(i,a),hn(i,a,d,o),a.child;case 6:return i===null&&qe&&((i=o=Si)&&(o=XA(o,a.pendingProps,fr),o!==null?(a.stateNode=o,Bn=a,Si=null,i=!0):i=!1),i||el(a)),null;case 13:return Mb(i,a,o);case 4:return Of(a,a.stateNode.containerInfo),d=a.pendingProps,i===null?a.child=Lc(a,null,d,o):hn(i,a,d,o),a.child;case 11:return Jv(i,a,a.type,a.pendingProps,o);case 7:return hn(i,a,a.pendingProps,o),a.child;case 8:return hn(i,a,a.pendingProps.children,o),a.child;case 12:return hn(i,a,a.pendingProps.children,o),a.child;case 10:return d=a.pendingProps,Gs(a,a.type,d.value),hn(i,a,d.children,o),a.child;case 9:return y=a.type._context,d=a.pendingProps.children,il(a),y=Tn(y),d=d(y),a.flags|=1,hn(i,a,d,o),a.child;case 14:return Wv(i,a,a.type,a.pendingProps,o);case 15:return Ab(i,a,a.type,a.pendingProps,o);case 19:return zb(i,a,o);case 31:return d=a.pendingProps,o=a.mode,d={mode:d.mode,children:d.children},i===null?(o=Wf(d,o),o.ref=a.ref,a.child=o,o.return=a,a=o):(o=Yr(i.child,d),o.ref=a.ref,a.child=o,o.return=a,a=o),a;case 22:return Eb(i,a,o);case 24:return il(a),d=Tn(Ni),i===null?(y=H_(),y===null&&(y=si,w=G_(),y.pooledCache=w,w.refCount++,w!==null&&(y.pooledCacheLanes|=o),y=w),a.memoizedState={parent:d,cache:y},X_(a),Gs(a,Ni,y)):(i.lanes&o&&(Yg(i,a),bh(a,null,null,o),xh()),y=i.memoizedState,w=a.memoizedState,y.parent!==d?(y={parent:d,cache:d},a.memoizedState=y,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=y),Gs(a,Ni,d)):(d=w.cache,Gs(a,Ni,d),d!==y.cache&&Hg(a,[Ni],o,!0))),hn(i,a,a.pendingProps.children,o),a.child;case 29:throw a.pendingProps}throw Error(Tt(156,a.tag))}function Vr(i){i.flags|=4}function rx(i,a){if(a.type!=="stylesheet"||a.state.loading&4)i.flags&=-16777217;else if(i.flags|=16777216,!yw(a)){if(a=Na.current,a!==null&&((Be&4194048)===Be?_r!==null:(Be&62914560)!==Be&&!(Be&536870912)||a!==_r))throw yh=$g,P1;i.flags|=8192}}function _f(i,a){a!==null&&(i.flags|=4),i.flags&16384&&(a=i.tag!==22?e1():536870912,i.lanes|=a,Bc|=a)}function sh(i,a){if(!qe)switch(i.tailMode){case"hidden":a=i.tail;for(var o=null;a!==null;)a.alternate!==null&&(o=a),a=a.sibling;o===null?i.tail=null:o.sibling=null;break;case"collapsed":o=i.tail;for(var d=null;o!==null;)o.alternate!==null&&(d=o),o=o.sibling;d===null?a||i.tail===null?i.tail=null:i.tail.sibling=null:d.sibling=null}}function vi(i){var a=i.alternate!==null&&i.alternate.child===i.child,o=0,d=0;if(a)for(var y=i.child;y!==null;)o|=y.lanes|y.childLanes,d|=y.subtreeFlags&65011712,d|=y.flags&65011712,y.return=i,y=y.sibling;else for(y=i.child;y!==null;)o|=y.lanes|y.childLanes,d|=y.subtreeFlags,d|=y.flags,y.return=i,y=y.sibling;return i.subtreeFlags|=d,i.childLanes=o,a}function vA(i,a,o){var d=a.pendingProps;switch(Z_(a),a.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return vi(a),null;case 1:return vi(a),null;case 3:return o=a.stateNode,d=null,i!==null&&(d=i.memoizedState.cache),a.memoizedState.cache!==d&&(a.flags|=2048),Kr(Ni),Cc(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(i===null||i.child===null)&&(ah(a)?Vr(a):i===null||i.memoizedState.isDehydrated&&!(a.flags&256)||(a.flags|=1024,Lv())),vi(a),null;case 26:return o=a.memoizedState,i===null?(Vr(a),o!==null?(vi(a),rx(a,o)):(vi(a),a.flags&=-16777217)):o?o!==i.memoizedState?(Vr(a),vi(a),rx(a,o)):(vi(a),a.flags&=-16777217):(i.memoizedProps!==d&&Vr(a),vi(a),a.flags&=-16777217),null;case 27:Ff(a),o=Ws.current;var y=a.type;if(i!==null&&a.stateNode!=null)i.memoizedProps!==d&&Vr(a);else{if(!d){if(a.stateNode===null)throw Error(Tt(166));return vi(a),null}i=mr.current,ah(a)?Rv(a):(i=mw(y,d,o),a.stateNode=i,Vr(a))}return vi(a),null;case 5:if(Ff(a),o=a.type,i!==null&&a.stateNode!=null)i.memoizedProps!==d&&Vr(a);else{if(!d){if(a.stateNode===null)throw Error(Tt(166));return vi(a),null}if(i=mr.current,ah(a))Rv(a);else{switch(y=sp(Ws.current),i){case 1:i=y.createElementNS("http://www.w3.org/2000/svg",o);break;case 2:i=y.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;default:switch(o){case"svg":i=y.createElementNS("http://www.w3.org/2000/svg",o);break;case"math":i=y.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;case"script":i=y.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild);break;case"select":i=typeof d.is=="string"?y.createElement("select",{is:d.is}):y.createElement("select"),d.multiple?i.multiple=!0:d.size&&(i.size=d.size);break;default:i=typeof d.is=="string"?y.createElement(o,{is:d.is}):y.createElement(o)}}i[Sn]=a,i[Qn]=d;t:for(y=a.child;y!==null;){if(y.tag===5||y.tag===6)i.appendChild(y.stateNode);else if(y.tag!==4&&y.tag!==27&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===a)break t;for(;y.sibling===null;){if(y.return===null||y.return===a)break t;y=y.return}y.sibling.return=y.return,y=y.sibling}a.stateNode=i;t:switch(fn(i,o,d),o){case"button":case"input":case"select":case"textarea":i=!!d.autoFocus;break t;case"img":i=!0;break t;default:i=!1}i&&Vr(a)}}return vi(a),a.flags&=-16777217,null;case 6:if(i&&a.stateNode!=null)i.memoizedProps!==d&&Vr(a);else{if(typeof d!="string"&&a.stateNode===null)throw Error(Tt(166));if(i=Ws.current,ah(a)){if(i=a.stateNode,o=a.memoizedProps,d=null,y=Bn,y!==null)switch(y.tag){case 27:case 5:d=y.memoizedProps}i[Sn]=a,i=!!(i.nodeValue===o||d!==null&&d.suppressHydrationWarning===!0||dw(i.nodeValue,o)),i||el(a)}else i=sp(i).createTextNode(d),i[Sn]=a,a.stateNode=i}return vi(a),null;case 13:if(d=a.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(y=ah(a),d!==null&&d.dehydrated!==null){if(i===null){if(!y)throw Error(Tt(318));if(y=a.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(Tt(317));y[Sn]=a}else $h(),!(a.flags&128)&&(a.memoizedState=null),a.flags|=4;vi(a),y=!1}else y=Lv(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=y),y=!0;if(!y)return a.flags&256?($r(a),a):($r(a),null)}if($r(a),a.flags&128)return a.lanes=o,a;if(o=d!==null,i=i!==null&&i.memoizedState!==null,o){d=a.child,y=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(y=d.alternate.memoizedState.cachePool.pool);var w=null;d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(w=d.memoizedState.cachePool.pool),w!==y&&(d.flags|=2048)}return o!==i&&o&&(a.child.flags|=8192),_f(a,a.updateQueue),vi(a),null;case 4:return Cc(),i===null&&my(a.stateNode.containerInfo),vi(a),null;case 10:return Kr(a.type),vi(a),null;case 19:if(nn(Vi),y=a.memoizedState,y===null)return vi(a),null;if(d=(a.flags&128)!==0,w=y.rendering,w===null)if(d)sh(y,!1);else{if(Ti!==0||i!==null&&i.flags&128)for(i=a.child;i!==null;){if(w=Kf(i),w!==null){for(a.flags|=128,sh(y,!1),i=w.updateQueue,a.updateQueue=i,_f(a,i),a.subtreeFlags=0,i=o,o=a.child;o!==null;)D1(o,i),o=o.sibling;return gi(Vi,Vi.current&1|2),a.child}i=i.sibling}y.tail!==null&&gr()>ep&&(a.flags|=128,d=!0,sh(y,!1),a.lanes=4194304)}else{if(!d)if(i=Kf(w),i!==null){if(a.flags|=128,d=!0,i=i.updateQueue,a.updateQueue=i,_f(a,i),sh(y,!0),y.tail===null&&y.tailMode==="hidden"&&!w.alternate&&!qe)return vi(a),null}else 2*gr()-y.renderingStartTime>ep&&o!==536870912&&(a.flags|=128,d=!0,sh(y,!1),a.lanes=4194304);y.isBackwards?(w.sibling=a.child,a.child=w):(i=y.last,i!==null?i.sibling=w:a.child=w,y.last=w)}return y.tail!==null?(a=y.tail,y.rendering=a,y.tail=a.sibling,y.renderingStartTime=gr(),a.sibling=null,i=Vi.current,gi(Vi,d?i&1|2:i&1),a):(vi(a),null);case 22:case 23:return $r(a),$_(),d=a.memoizedState!==null,i!==null?i.memoizedState!==null!==d&&(a.flags|=8192):d&&(a.flags|=8192),d?o&536870912&&!(a.flags&128)&&(vi(a),a.subtreeFlags&6&&(a.flags|=8192)):vi(a),o=a.updateQueue,o!==null&&_f(a,o.retryQueue),o=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(o=i.memoizedState.cachePool.pool),d=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(d=a.memoizedState.cachePool.pool),d!==o&&(a.flags|=2048),i!==null&&nn(Jo),null;case 24:return o=null,i!==null&&(o=i.memoizedState.cache),a.memoizedState.cache!==o&&(a.flags|=2048),Kr(Ni),vi(a),null;case 25:return null;case 30:return null}throw Error(Tt(156,a.tag))}function xA(i,a){switch(Z_(a),a.tag){case 1:return i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 3:return Kr(Ni),Cc(),i=a.flags,i&65536&&!(i&128)?(a.flags=i&-65537|128,a):null;case 26:case 27:case 5:return Ff(a),null;case 13:if($r(a),i=a.memoizedState,i!==null&&i.dehydrated!==null){if(a.alternate===null)throw Error(Tt(340));$h()}return i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 19:return nn(Vi),null;case 4:return Cc(),null;case 10:return Kr(a.type),null;case 22:case 23:return $r(a),$_(),i!==null&&nn(Jo),i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 24:return Kr(Ni),null;case 25:return null;default:return null}}function Db(i,a){switch(Z_(a),a.tag){case 3:Kr(Ni),Cc();break;case 26:case 27:case 5:Ff(a);break;case 4:Cc();break;case 13:$r(a);break;case 19:nn(Vi);break;case 10:Kr(a.type);break;case 22:case 23:$r(a),$_(),i!==null&&nn(Jo);break;case 24:Kr(Ni)}}function td(i,a){try{var o=a.updateQueue,d=o!==null?o.lastEffect:null;if(d!==null){var y=d.next;o=y;do{if((o.tag&i)===i){d=void 0;var w=o.create,T=o.inst;d=w(),T.destroy=d}o=o.next}while(o!==y)}}catch(f){ri(a,a.return,f)}}function lo(i,a,o){try{var d=a.updateQueue,y=d!==null?d.lastEffect:null;if(y!==null){var w=y.next;d=w;do{if((d.tag&i)===i){var T=d.inst,f=T.destroy;if(f!==void 0){T.destroy=void 0,y=a;var q=o,ct=f;try{ct()}catch(vt){ri(y,q,vt)}}}d=d.next}while(d!==w)}}catch(vt){ri(a,a.return,vt)}}function Ib(i){var a=i.updateQueue;if(a!==null){var o=i.stateNode;try{O1(a,o)}catch(d){ri(i,i.return,d)}}}function kb(i,a,o){o.props=al(i.type,i.memoizedProps),o.state=i.memoizedState;try{o.componentWillUnmount()}catch(d){ri(i,a,d)}}function Sh(i,a){try{var o=i.ref;if(o!==null){switch(i.tag){case 26:case 27:case 5:var d=i.stateNode;break;case 30:d=i.stateNode;break;default:d=i.stateNode}typeof o=="function"?i.refCleanup=o(d):o.current=d}}catch(y){ri(i,a,y)}}function pr(i,a){var o=i.ref,d=i.refCleanup;if(o!==null)if(typeof d=="function")try{d()}catch(y){ri(i,a,y)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof o=="function")try{o(null)}catch(y){ri(i,a,y)}else o.current=null}function Rb(i){var a=i.type,o=i.memoizedProps,d=i.stateNode;try{t:switch(a){case"button":case"input":case"select":case"textarea":o.autoFocus&&d.focus();break t;case"img":o.src?d.src=o.src:o.srcSet&&(d.srcset=o.srcSet)}}catch(y){ri(i,i.return,y)}}function pg(i,a,o){try{var d=i.stateNode;VA(d,i.type,o,a),d[Qn]=a}catch(y){ri(i,i.return,y)}}function Pb(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&ho(i.type)||i.tag===4}function mg(i){t:for(;;){for(;i.sibling===null;){if(i.return===null||Pb(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&ho(i.type)||i.flags&2||i.child===null||i.tag===4)continue t;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function r_(i,a,o){var d=i.tag;if(d===5||d===6)i=i.stateNode,a?(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o).insertBefore(i,a):(a=o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,a.appendChild(i),o=o._reactRootContainer,o!=null||a.onclick!==null||(a.onclick=zp));else if(d!==4&&(d===27&&ho(i.type)&&(o=i.stateNode,a=null),i=i.child,i!==null))for(r_(i,a,o),i=i.sibling;i!==null;)r_(i,a,o),i=i.sibling}function tp(i,a,o){var d=i.tag;if(d===5||d===6)i=i.stateNode,a?o.insertBefore(i,a):o.appendChild(i);else if(d!==4&&(d===27&&ho(i.type)&&(o=i.stateNode),i=i.child,i!==null))for(tp(i,a,o),i=i.sibling;i!==null;)tp(i,a,o),i=i.sibling}function Lb(i){var a=i.stateNode,o=i.memoizedProps;try{for(var d=i.type,y=a.attributes;y.length;)a.removeAttributeNode(y[0]);fn(a,d,o),a[Sn]=i,a[Qn]=o}catch(w){ri(i,i.return,w)}}var qr=!1,Ci=!1,gg=!1,sx=typeof WeakSet=="function"?WeakSet:Set,Wi=null;function bA(i,a){if(i=i.containerInfo,f_=up,i=w1(i),U_(i)){if("selectionStart"in i)var o={start:i.selectionStart,end:i.selectionEnd};else t:{o=(o=i.ownerDocument)&&o.defaultView||window;var d=o.getSelection&&o.getSelection();if(d&&d.rangeCount!==0){o=d.anchorNode;var y=d.anchorOffset,w=d.focusNode;d=d.focusOffset;try{o.nodeType,w.nodeType}catch{o=null;break t}var T=0,f=-1,q=-1,ct=0,vt=0,tt=i,V=null;e:for(;;){for(var pt;tt!==o||y!==0&&tt.nodeType!==3||(f=T+y),tt!==w||d!==0&&tt.nodeType!==3||(q=T+d),tt.nodeType===3&&(T+=tt.nodeValue.length),(pt=tt.firstChild)!==null;)V=tt,tt=pt;for(;;){if(tt===i)break e;if(V===o&&++ct===y&&(f=T),V===w&&++vt===d&&(q=T),(pt=tt.nextSibling)!==null)break;tt=V,V=tt.parentNode}tt=pt}o=f===-1||q===-1?null:{start:f,end:q}}else o=null}o=o||{start:0,end:0}}else o=null;for(p_={focusedElem:i,selectionRange:o},up=!1,Wi=a;Wi!==null;)if(a=Wi,i=a.child,(a.subtreeFlags&1024)!==0&&i!==null)i.return=a,Wi=i;else for(;Wi!==null;){switch(a=Wi,w=a.alternate,i=a.flags,a.tag){case 0:break;case 11:case 15:break;case 1:if(i&1024&&w!==null){i=void 0,o=a,y=w.memoizedProps,w=w.memoizedState,d=o.stateNode;try{var Jt=al(o.type,y,o.elementType===o.type);i=d.getSnapshotBeforeUpdate(Jt,w),d.__reactInternalSnapshotBeforeUpdate=i}catch(Xt){ri(o,o.return,Xt)}}break;case 3:if(i&1024){if(i=a.stateNode.containerInfo,o=i.nodeType,o===9)g_(i);else if(o===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":g_(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if(i&1024)throw Error(Tt(163))}if(i=a.sibling,i!==null){i.return=a.return,Wi=i;break}Wi=a.return}}function Bb(i,a,o){var d=o.flags;switch(o.tag){case 0:case 11:case 15:Ns(i,o),d&4&&td(5,o);break;case 1:if(Ns(i,o),d&4)if(i=o.stateNode,a===null)try{i.componentDidMount()}catch(T){ri(o,o.return,T)}else{var y=al(o.type,a.memoizedProps);a=a.memoizedState;try{i.componentDidUpdate(y,a,i.__reactInternalSnapshotBeforeUpdate)}catch(T){ri(o,o.return,T)}}d&64&&Ib(o),d&512&&Sh(o,o.return);break;case 3:if(Ns(i,o),d&64&&(i=o.updateQueue,i!==null)){if(a=null,o.child!==null)switch(o.child.tag){case 27:case 5:a=o.child.stateNode;break;case 1:a=o.child.stateNode}try{O1(i,a)}catch(T){ri(o,o.return,T)}}break;case 27:a===null&&d&4&&Lb(o);case 26:case 5:Ns(i,o),a===null&&d&4&&Rb(o),d&512&&Sh(o,o.return);break;case 12:Ns(i,o);break;case 13:Ns(i,o),d&4&&Ub(i,o),d&64&&(i=o.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(o=DA.bind(null,o),$A(i,o))));break;case 22:if(d=o.memoizedState!==null||qr,!d){a=a!==null&&a.memoizedState!==null||Ci,y=qr;var w=Ci;qr=d,(Ci=a)&&!w?Vs(i,o,(o.subtreeFlags&8772)!==0):Ns(i,o),qr=y,Ci=w}break;case 30:break;default:Ns(i,o)}}function Ob(i){var a=i.alternate;a!==null&&(i.alternate=null,Ob(a)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(a=i.stateNode,a!==null&&R_(a)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var pi=null,Yn=!1;function jr(i,a,o){for(o=o.child;o!==null;)Fb(i,a,o),o=o.sibling}function Fb(i,a,o){if(_a&&typeof _a.onCommitFiberUnmount=="function")try{_a.onCommitFiberUnmount(qh,o)}catch{}switch(o.tag){case 26:Ci||pr(o,a),jr(i,a,o),o.memoizedState?o.memoizedState.count--:o.stateNode&&(o=o.stateNode,o.parentNode.removeChild(o));break;case 27:Ci||pr(o,a);var d=pi,y=Yn;ho(o.type)&&(pi=o.stateNode,Yn=!1),jr(i,a,o),Mh(o.stateNode),pi=d,Yn=y;break;case 5:Ci||pr(o,a);case 6:if(d=pi,y=Yn,pi=null,jr(i,a,o),pi=d,Yn=y,pi!==null)if(Yn)try{(pi.nodeType===9?pi.body:pi.nodeName==="HTML"?pi.ownerDocument.body:pi).removeChild(o.stateNode)}catch(w){ri(o,a,w)}else try{pi.removeChild(o.stateNode)}catch(w){ri(o,a,w)}break;case 18:pi!==null&&(Yn?(i=pi,yx(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,o.stateNode),Vh(i)):yx(pi,o.stateNode));break;case 4:d=pi,y=Yn,pi=o.stateNode.containerInfo,Yn=!0,jr(i,a,o),pi=d,Yn=y;break;case 0:case 11:case 14:case 15:Ci||lo(2,o,a),Ci||lo(4,o,a),jr(i,a,o);break;case 1:Ci||(pr(o,a),d=o.stateNode,typeof d.componentWillUnmount=="function"&&kb(o,a,d)),jr(i,a,o);break;case 21:jr(i,a,o);break;case 22:Ci=(d=Ci)||o.memoizedState!==null,jr(i,a,o),Ci=d;break;default:jr(i,a,o)}}function Ub(i,a){if(a.memoizedState===null&&(i=a.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{Vh(i)}catch(o){ri(a,a.return,o)}}function wA(i){switch(i.tag){case 13:case 19:var a=i.stateNode;return a===null&&(a=i.stateNode=new sx),a;case 22:return i=i.stateNode,a=i._retryCache,a===null&&(a=i._retryCache=new sx),a;default:throw Error(Tt(435,i.tag))}}function _g(i,a){var o=wA(i);a.forEach(function(d){var y=IA.bind(null,i,d);o.has(d)||(o.add(d),d.then(y,y))})}function fa(i,a){var o=a.deletions;if(o!==null)for(var d=0;d<o.length;d++){var y=o[d],w=i,T=a,f=T;t:for(;f!==null;){switch(f.tag){case 27:if(ho(f.type)){pi=f.stateNode,Yn=!1;break t}break;case 5:pi=f.stateNode,Yn=!1;break t;case 3:case 4:pi=f.stateNode.containerInfo,Yn=!0;break t}f=f.return}if(pi===null)throw Error(Tt(160));Fb(w,T,y),pi=null,Yn=!1,w=y.alternate,w!==null&&(w.return=null),y.return=null}if(a.subtreeFlags&13878)for(a=a.child;a!==null;)Nb(a,i),a=a.sibling}var Ka=null;function Nb(i,a){var o=i.alternate,d=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:fa(a,i),pa(i),d&4&&(lo(3,i,i.return),td(3,i),lo(5,i,i.return));break;case 1:fa(a,i),pa(i),d&512&&(Ci||o===null||pr(o,o.return)),d&64&&qr&&(i=i.updateQueue,i!==null&&(d=i.callbacks,d!==null&&(o=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=o===null?d:o.concat(d))));break;case 26:var y=Ka;if(fa(a,i),pa(i),d&512&&(Ci||o===null||pr(o,o.return)),d&4){var w=o!==null?o.memoizedState:null;if(d=i.memoizedState,o===null)if(d===null)if(i.stateNode===null){t:{d=i.type,o=i.memoizedProps,y=y.ownerDocument||y;e:switch(d){case"title":w=y.getElementsByTagName("title")[0],(!w||w[Hh]||w[Sn]||w.namespaceURI==="http://www.w3.org/2000/svg"||w.hasAttribute("itemprop"))&&(w=y.createElement(d),y.head.insertBefore(w,y.querySelector("head > title"))),fn(w,d,o),w[Sn]=i,tn(w),d=w;break t;case"link":var T=Sx("link","href",y).get(d+(o.href||""));if(T){for(var f=0;f<T.length;f++)if(w=T[f],w.getAttribute("href")===(o.href==null||o.href===""?null:o.href)&&w.getAttribute("rel")===(o.rel==null?null:o.rel)&&w.getAttribute("title")===(o.title==null?null:o.title)&&w.getAttribute("crossorigin")===(o.crossOrigin==null?null:o.crossOrigin)){T.splice(f,1);break e}}w=y.createElement(d),fn(w,d,o),y.head.appendChild(w);break;case"meta":if(T=Sx("meta","content",y).get(d+(o.content||""))){for(f=0;f<T.length;f++)if(w=T[f],w.getAttribute("content")===(o.content==null?null:""+o.content)&&w.getAttribute("name")===(o.name==null?null:o.name)&&w.getAttribute("property")===(o.property==null?null:o.property)&&w.getAttribute("http-equiv")===(o.httpEquiv==null?null:o.httpEquiv)&&w.getAttribute("charset")===(o.charSet==null?null:o.charSet)){T.splice(f,1);break e}}w=y.createElement(d),fn(w,d,o),y.head.appendChild(w);break;default:throw Error(Tt(468,d))}w[Sn]=i,tn(w),d=w}i.stateNode=d}else Tx(y,i.type,i.stateNode);else i.stateNode=wx(y,d,i.memoizedProps);else w!==d?(w===null?o.stateNode!==null&&(o=o.stateNode,o.parentNode.removeChild(o)):w.count--,d===null?Tx(y,i.type,i.stateNode):wx(y,d,i.memoizedProps)):d===null&&i.stateNode!==null&&pg(i,i.memoizedProps,o.memoizedProps)}break;case 27:fa(a,i),pa(i),d&512&&(Ci||o===null||pr(o,o.return)),o!==null&&d&4&&pg(i,i.memoizedProps,o.memoizedProps);break;case 5:if(fa(a,i),pa(i),d&512&&(Ci||o===null||pr(o,o.return)),i.flags&32){y=i.stateNode;try{Ic(y,"")}catch(pt){ri(i,i.return,pt)}}d&4&&i.stateNode!=null&&(y=i.memoizedProps,pg(i,y,o!==null?o.memoizedProps:y)),d&1024&&(gg=!0);break;case 6:if(fa(a,i),pa(i),d&4){if(i.stateNode===null)throw Error(Tt(162));d=i.memoizedProps,o=i.stateNode;try{o.nodeValue=d}catch(pt){ri(i,i.return,pt)}}break;case 3:if(Rf=null,y=Ka,Ka=op(a.containerInfo),fa(a,i),Ka=y,pa(i),d&4&&o!==null&&o.memoizedState.isDehydrated)try{Vh(a.containerInfo)}catch(pt){ri(i,i.return,pt)}gg&&(gg=!1,Vb(i));break;case 4:d=Ka,Ka=op(i.stateNode.containerInfo),fa(a,i),pa(i),Ka=d;break;case 12:fa(a,i),pa(i);break;case 13:fa(a,i),pa(i),i.child.flags&8192&&i.memoizedState!==null!=(o!==null&&o.memoizedState!==null)&&(dy=gr()),d&4&&(d=i.updateQueue,d!==null&&(i.updateQueue=null,_g(i,d)));break;case 22:y=i.memoizedState!==null;var q=o!==null&&o.memoizedState!==null,ct=qr,vt=Ci;if(qr=ct||y,Ci=vt||q,fa(a,i),Ci=vt,qr=ct,pa(i),d&8192)t:for(a=i.stateNode,a._visibility=y?a._visibility&-2:a._visibility|1,y&&(o===null||q||qr||Ci||Xo(i)),o=null,a=i;;){if(a.tag===5||a.tag===26){if(o===null){q=o=a;try{if(w=q.stateNode,y)T=w.style,typeof T.setProperty=="function"?T.setProperty("display","none","important"):T.display="none";else{f=q.stateNode;var tt=q.memoizedProps.style,V=tt!=null&&tt.hasOwnProperty("display")?tt.display:null;f.style.display=V==null||typeof V=="boolean"?"":(""+V).trim()}}catch(pt){ri(q,q.return,pt)}}}else if(a.tag===6){if(o===null){q=a;try{q.stateNode.nodeValue=y?"":q.memoizedProps}catch(pt){ri(q,q.return,pt)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===i)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break t;for(;a.sibling===null;){if(a.return===null||a.return===i)break t;o===a&&(o=null),a=a.return}o===a&&(o=null),a.sibling.return=a.return,a=a.sibling}d&4&&(d=i.updateQueue,d!==null&&(o=d.retryQueue,o!==null&&(d.retryQueue=null,_g(i,o))));break;case 19:fa(a,i),pa(i),d&4&&(d=i.updateQueue,d!==null&&(i.updateQueue=null,_g(i,d)));break;case 30:break;case 21:break;default:fa(a,i),pa(i)}}function pa(i){var a=i.flags;if(a&2){try{for(var o,d=i.return;d!==null;){if(Pb(d)){o=d;break}d=d.return}if(o==null)throw Error(Tt(160));switch(o.tag){case 27:var y=o.stateNode,w=mg(i);tp(i,w,y);break;case 5:var T=o.stateNode;o.flags&32&&(Ic(T,""),o.flags&=-33);var f=mg(i);tp(i,f,T);break;case 3:case 4:var q=o.stateNode.containerInfo,ct=mg(i);r_(i,ct,q);break;default:throw Error(Tt(161))}}catch(vt){ri(i,i.return,vt)}i.flags&=-3}a&4096&&(i.flags&=-4097)}function Vb(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var a=i;Vb(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),i=i.sibling}}function Ns(i,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)Bb(i,a.alternate,a),a=a.sibling}function Xo(i){for(i=i.child;i!==null;){var a=i;switch(a.tag){case 0:case 11:case 14:case 15:lo(4,a,a.return),Xo(a);break;case 1:pr(a,a.return);var o=a.stateNode;typeof o.componentWillUnmount=="function"&&kb(a,a.return,o),Xo(a);break;case 27:Mh(a.stateNode);case 26:case 5:pr(a,a.return),Xo(a);break;case 22:a.memoizedState===null&&Xo(a);break;case 30:Xo(a);break;default:Xo(a)}i=i.sibling}}function Vs(i,a,o){for(o=o&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var d=a.alternate,y=i,w=a,T=w.flags;switch(w.tag){case 0:case 11:case 15:Vs(y,w,o),td(4,w);break;case 1:if(Vs(y,w,o),d=w,y=d.stateNode,typeof y.componentDidMount=="function")try{y.componentDidMount()}catch(ct){ri(d,d.return,ct)}if(d=w,y=d.updateQueue,y!==null){var f=d.stateNode;try{var q=y.shared.hiddenCallbacks;if(q!==null)for(y.shared.hiddenCallbacks=null,y=0;y<q.length;y++)B1(q[y],f)}catch(ct){ri(d,d.return,ct)}}o&&T&64&&Ib(w),Sh(w,w.return);break;case 27:Lb(w);case 26:case 5:Vs(y,w,o),o&&d===null&&T&4&&Rb(w),Sh(w,w.return);break;case 12:Vs(y,w,o);break;case 13:Vs(y,w,o),o&&T&4&&Ub(y,w);break;case 22:w.memoizedState===null&&Vs(y,w,o),Sh(w,w.return);break;case 30:break;default:Vs(y,w,o)}a=a.sibling}}function ly(i,a){var o=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(o=i.memoizedState.cachePool.pool),i=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(i=a.memoizedState.cachePool.pool),i!==o&&(i!=null&&i.refCount++,o!=null&&Kh(o))}function cy(i,a){i=null,a.alternate!==null&&(i=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==i&&(a.refCount++,i!=null&&Kh(i))}function dr(i,a,o,d){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)jb(i,a,o,d),a=a.sibling}function jb(i,a,o,d){var y=a.flags;switch(a.tag){case 0:case 11:case 15:dr(i,a,o,d),y&2048&&td(9,a);break;case 1:dr(i,a,o,d);break;case 3:dr(i,a,o,d),y&2048&&(i=null,a.alternate!==null&&(i=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==i&&(a.refCount++,i!=null&&Kh(i)));break;case 12:if(y&2048){dr(i,a,o,d),i=a.stateNode;try{var w=a.memoizedProps,T=w.id,f=w.onPostCommit;typeof f=="function"&&f(T,a.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(q){ri(a,a.return,q)}}else dr(i,a,o,d);break;case 13:dr(i,a,o,d);break;case 23:break;case 22:w=a.stateNode,T=a.alternate,a.memoizedState!==null?w._visibility&2?dr(i,a,o,d):Th(i,a):w._visibility&2?dr(i,a,o,d):(w._visibility|=2,oc(i,a,o,d,(a.subtreeFlags&10256)!==0)),y&2048&&ly(T,a);break;case 24:dr(i,a,o,d),y&2048&&cy(a.alternate,a);break;default:dr(i,a,o,d)}}function oc(i,a,o,d,y){for(y=y&&(a.subtreeFlags&10256)!==0,a=a.child;a!==null;){var w=i,T=a,f=o,q=d,ct=T.flags;switch(T.tag){case 0:case 11:case 15:oc(w,T,f,q,y),td(8,T);break;case 23:break;case 22:var vt=T.stateNode;T.memoizedState!==null?vt._visibility&2?oc(w,T,f,q,y):Th(w,T):(vt._visibility|=2,oc(w,T,f,q,y)),y&&ct&2048&&ly(T.alternate,T);break;case 24:oc(w,T,f,q,y),y&&ct&2048&&cy(T.alternate,T);break;default:oc(w,T,f,q,y)}a=a.sibling}}function Th(i,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var o=i,d=a,y=d.flags;switch(d.tag){case 22:Th(o,d),y&2048&&ly(d.alternate,d);break;case 24:Th(o,d),y&2048&&cy(d.alternate,d);break;default:Th(o,d)}a=a.sibling}}var dh=8192;function nc(i){if(i.subtreeFlags&dh)for(i=i.child;i!==null;)qb(i),i=i.sibling}function qb(i){switch(i.tag){case 26:nc(i),i.flags&dh&&i.memoizedState!==null&&oE(Ka,i.memoizedState,i.memoizedProps);break;case 5:nc(i);break;case 3:case 4:var a=Ka;Ka=op(i.stateNode.containerInfo),nc(i),Ka=a;break;case 22:i.memoizedState===null&&(a=i.alternate,a!==null&&a.memoizedState!==null?(a=dh,dh=16777216,nc(i),dh=a):nc(i));break;default:nc(i)}}function Zb(i){var a=i.alternate;if(a!==null&&(i=a.child,i!==null)){a.child=null;do a=i.sibling,i.sibling=null,i=a;while(i!==null)}}function oh(i){var a=i.deletions;if(i.flags&16){if(a!==null)for(var o=0;o<a.length;o++){var d=a[o];Wi=d,Hb(d,i)}Zb(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)Gb(i),i=i.sibling}function Gb(i){switch(i.tag){case 0:case 11:case 15:oh(i),i.flags&2048&&lo(9,i,i.return);break;case 3:oh(i);break;case 12:oh(i);break;case 22:var a=i.stateNode;i.memoizedState!==null&&a._visibility&2&&(i.return===null||i.return.tag!==13)?(a._visibility&=-3,If(i)):oh(i);break;default:oh(i)}}function If(i){var a=i.deletions;if(i.flags&16){if(a!==null)for(var o=0;o<a.length;o++){var d=a[o];Wi=d,Hb(d,i)}Zb(i)}for(i=i.child;i!==null;){switch(a=i,a.tag){case 0:case 11:case 15:lo(8,a,a.return),If(a);break;case 22:o=a.stateNode,o._visibility&2&&(o._visibility&=-3,If(a));break;default:If(a)}i=i.sibling}}function Hb(i,a){for(;Wi!==null;){var o=Wi;switch(o.tag){case 0:case 11:case 15:lo(8,o,a);break;case 23:case 22:if(o.memoizedState!==null&&o.memoizedState.cachePool!==null){var d=o.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:Kh(o.memoizedState.cache)}if(d=o.child,d!==null)d.return=o,Wi=d;else t:for(o=i;Wi!==null;){d=Wi;var y=d.sibling,w=d.return;if(Ob(d),d===o){Wi=null;break t}if(y!==null){y.return=w,Wi=y;break t}Wi=w}}}var SA={getCacheForType:function(i){var a=Tn(Ni),o=a.data.get(i);return o===void 0&&(o=i(),a.data.set(i,o)),o}},TA=typeof WeakMap=="function"?WeakMap:Map,Ke=0,si=null,Ce=null,Be=0,Ye=0,ma=null,Qs=!1,Zc=!1,uy=!1,ts=0,Ti=0,co=0,Wo=0,hy=0,Ua=0,Bc=0,Ah=null,Kn=null,s_=!1,dy=0,ep=1/0,ip=null,io=null,dn=0,no=null,Oc=null,zc=0,o_=0,l_=null,Xb=null,Eh=0,c_=null;function va(){if(Ke&2&&Be!==0)return Be&-Be;if(he.T!==null){var i=kc;return i!==0?i:py()}return a1()}function $b(){Ua===0&&(Ua=!(Be&536870912)||qe?t1():536870912);var i=Na.current;return i!==null&&(i.flags|=32),Ua}function xa(i,a,o){(i===si&&(Ye===2||Ye===9)||i.cancelPendingCommit!==null)&&(Fc(i,0),Js(i,Be,Ua,!1)),Gh(i,o),(!(Ke&2)||i!==si)&&(i===si&&(!(Ke&2)&&(Wo|=o),Ti===4&&Js(i,Be,Ua,!1)),vr(i))}function Yb(i,a,o){if(Ke&6)throw Error(Tt(327));var d=!o&&(a&124)===0&&(a&i.expiredLanes)===0||Zh(i,a),y=d?MA(i,a):yg(i,a,!0),w=d;do{if(y===0){Zc&&!d&&Js(i,a,0,!1);break}else{if(o=i.current.alternate,w&&!AA(o)){y=yg(i,a,!1),w=!1;continue}if(y===2){if(w=a,i.errorRecoveryDisabledLanes&w)var T=0;else T=i.pendingLanes&-536870913,T=T!==0?T:T&536870912?536870912:0;if(T!==0){a=T;t:{var f=i;y=Ah;var q=f.current.memoizedState.isDehydrated;if(q&&(Fc(f,T).flags|=256),T=yg(f,T,!1),T!==2){if(uy&&!q){f.errorRecoveryDisabledLanes|=w,Wo|=w,y=4;break t}w=Kn,Kn=y,w!==null&&(Kn===null?Kn=w:Kn.push.apply(Kn,w))}y=T}if(w=!1,y!==2)continue}}if(y===1){Fc(i,0),Js(i,a,0,!0);break}t:{switch(d=i,w=y,w){case 0:case 1:throw Error(Tt(345));case 4:if((a&4194048)!==a)break;case 6:Js(d,a,Ua,!Qs);break t;case 2:Kn=null;break;case 3:case 5:break;default:throw Error(Tt(329))}if((a&62914560)===a&&(y=dy+300-gr(),10<y)){if(Js(d,a,Ua,!Qs),mp(d,0,!0)!==0)break t;d.timeoutHandle=pw(ox.bind(null,d,o,Kn,ip,s_,a,Ua,Wo,Bc,Qs,w,2,-0,0),y);break t}ox(d,o,Kn,ip,s_,a,Ua,Wo,Bc,Qs,w,0,-0,0)}}break}while(!0);vr(i)}function ox(i,a,o,d,y,w,T,f,q,ct,vt,tt,V,pt){if(i.timeoutHandle=-1,tt=a.subtreeFlags,(tt&8192||(tt&16785408)===16785408)&&(Oh={stylesheets:null,count:0,unsuspend:sE},qb(a),tt=lE(),tt!==null)){i.cancelPendingCommit=tt(cx.bind(null,i,a,w,o,d,y,T,f,q,vt,1,V,pt)),Js(i,w,T,!ct);return}cx(i,a,w,o,d,y,T,f,q)}function AA(i){for(var a=i;;){var o=a.tag;if((o===0||o===11||o===15)&&a.flags&16384&&(o=a.updateQueue,o!==null&&(o=o.stores,o!==null)))for(var d=0;d<o.length;d++){var y=o[d],w=y.getSnapshot;y=y.value;try{if(!ba(w(),y))return!1}catch{return!1}}if(o=a.child,a.subtreeFlags&16384&&o!==null)o.return=a,a=o;else{if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Js(i,a,o,d){a&=~hy,a&=~Wo,i.suspendedLanes|=a,i.pingedLanes&=~a,d&&(i.warmLanes|=a),d=i.expirationTimes;for(var y=a;0<y;){var w=31-ya(y),T=1<<w;d[w]=-1,y&=~T}o!==0&&i1(i,o,a)}function Ap(){return Ke&6?!0:(ed(0),!1)}function fy(){if(Ce!==null){if(Ye===0)var i=Ce.return;else i=Ce,Xr=ll=null,W_(i),Mc=null,Ph=0,i=Ce;for(;i!==null;)Db(i.alternate,i),i=i.return;Ce=null}}function Fc(i,a){var o=i.timeoutHandle;o!==-1&&(i.timeoutHandle=-1,qA(o)),o=i.cancelPendingCommit,o!==null&&(i.cancelPendingCommit=null,o()),fy(),si=i,Ce=o=Yr(i.current,null),Be=a,Ye=0,ma=null,Qs=!1,Zc=Zh(i,a),uy=!1,Bc=Ua=hy=Wo=co=Ti=0,Kn=Ah=null,s_=!1,a&8&&(a|=a&32);var d=i.entangledLanes;if(d!==0)for(i=i.entanglements,d&=a;0<d;){var y=31-ya(d),w=1<<y;a|=i[y],d&=~w}return ts=a,vp(),o}function Kb(i,a){Ae=null,he.H=Yf,a===Qh||a===bp?(a=Uv(),Ye=3):a===P1?(a=Uv(),Ye=4):Ye=a===Tb?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,ma=a,Ce===null&&(Ti=1,Jf(i,Fa(a,i.current)))}function Qb(){var i=he.H;return he.H=Yf,i===null?Yf:i}function Jb(){var i=he.A;return he.A=SA,i}function u_(){Ti=4,Qs||(Be&4194048)!==Be&&Na.current!==null||(Zc=!0),!(co&134217727)&&!(Wo&134217727)||si===null||Js(si,Be,Ua,!1)}function yg(i,a,o){var d=Ke;Ke|=2;var y=Qb(),w=Jb();(si!==i||Be!==a)&&(ip=null,Fc(i,a)),a=!1;var T=Ti;t:do try{if(Ye!==0&&Ce!==null){var f=Ce,q=ma;switch(Ye){case 8:fy(),T=6;break t;case 3:case 2:case 9:case 6:Na.current===null&&(a=!0);var ct=Ye;if(Ye=0,ma=null,xc(i,f,q,ct),o&&Zc){T=0;break t}break;default:ct=Ye,Ye=0,ma=null,xc(i,f,q,ct)}}EA(),T=Ti;break}catch(vt){Kb(i,vt)}while(!0);return a&&i.shellSuspendCounter++,Xr=ll=null,Ke=d,he.H=y,he.A=w,Ce===null&&(si=null,Be=0,vp()),T}function EA(){for(;Ce!==null;)Wb(Ce)}function MA(i,a){var o=Ke;Ke|=2;var d=Qb(),y=Jb();si!==i||Be!==a?(ip=null,ep=gr()+500,Fc(i,a)):Zc=Zh(i,a);t:do try{if(Ye!==0&&Ce!==null){a=Ce;var w=ma;e:switch(Ye){case 1:Ye=0,ma=null,xc(i,a,w,1);break;case 2:case 9:if(Fv(w)){Ye=0,ma=null,lx(a);break}a=function(){Ye!==2&&Ye!==9||si!==i||(Ye=7),vr(i)},w.then(a,a);break t;case 3:Ye=7;break t;case 4:Ye=5;break t;case 7:Fv(w)?(Ye=0,ma=null,lx(a)):(Ye=0,ma=null,xc(i,a,w,7));break;case 5:var T=null;switch(Ce.tag){case 26:T=Ce.memoizedState;case 5:case 27:var f=Ce;if(!T||yw(T)){Ye=0,ma=null;var q=f.sibling;if(q!==null)Ce=q;else{var ct=f.return;ct!==null?(Ce=ct,Ep(ct)):Ce=null}break e}}Ye=0,ma=null,xc(i,a,w,5);break;case 6:Ye=0,ma=null,xc(i,a,w,6);break;case 8:fy(),Ti=6;break t;default:throw Error(Tt(462))}}zA();break}catch(vt){Kb(i,vt)}while(!0);return Xr=ll=null,he.H=d,he.A=y,Ke=o,Ce!==null?0:(si=null,Be=0,vp(),Ti)}function zA(){for(;Ce!==null&&!KS();)Wb(Ce)}function Wb(i){var a=Cb(i.alternate,i,ts);i.memoizedProps=i.pendingProps,a===null?Ep(i):Ce=a}function lx(i){var a=i,o=a.alternate;switch(a.tag){case 15:case 0:a=ex(o,a,a.pendingProps,a.type,void 0,Be);break;case 11:a=ex(o,a,a.pendingProps,a.type.render,a.ref,Be);break;case 5:W_(a);default:Db(o,a),a=Ce=D1(a,ts),a=Cb(o,a,ts)}i.memoizedProps=i.pendingProps,a===null?Ep(i):Ce=a}function xc(i,a,o,d){Xr=ll=null,W_(a),Mc=null,Ph=0;var y=a.return;try{if(_A(i,y,a,o,Be)){Ti=1,Jf(i,Fa(o,i.current)),Ce=null;return}}catch(w){if(y!==null)throw Ce=y,w;Ti=1,Jf(i,Fa(o,i.current)),Ce=null;return}a.flags&32768?(qe||d===1?i=!0:Zc||Be&536870912?i=!1:(Qs=i=!0,(d===2||d===9||d===3||d===6)&&(d=Na.current,d!==null&&d.tag===13&&(d.flags|=16384))),tw(a,i)):Ep(a)}function Ep(i){var a=i;do{if(a.flags&32768){tw(a,Qs);return}i=a.return;var o=vA(a.alternate,a,ts);if(o!==null){Ce=o;return}if(a=a.sibling,a!==null){Ce=a;return}Ce=a=i}while(a!==null);Ti===0&&(Ti=5)}function tw(i,a){do{var o=xA(i.alternate,i);if(o!==null){o.flags&=32767,Ce=o;return}if(o=i.return,o!==null&&(o.flags|=32768,o.subtreeFlags=0,o.deletions=null),!a&&(i=i.sibling,i!==null)){Ce=i;return}Ce=i=o}while(i!==null);Ti=6,Ce=null}function cx(i,a,o,d,y,w,T,f,q){i.cancelPendingCommit=null;do Mp();while(dn!==0);if(Ke&6)throw Error(Tt(327));if(a!==null){if(a===i.current)throw Error(Tt(177));if(w=a.lanes|a.childLanes,w|=N_,sT(i,o,w,T,f,q),i===si&&(Ce=si=null,Be=0),Oc=a,no=i,zc=o,o_=w,l_=y,Xb=d,a.subtreeFlags&10256||a.flags&10256?(i.callbackNode=null,i.callbackPriority=0,kA(Uf,function(){return rw(),null})):(i.callbackNode=null,i.callbackPriority=0),d=(a.flags&13878)!==0,a.subtreeFlags&13878||d){d=he.T,he.T=null,y=Ze.p,Ze.p=2,T=Ke,Ke|=4;try{bA(i,a,o)}finally{Ke=T,Ze.p=y,he.T=d}}dn=1,ew(),iw(),nw()}}function ew(){if(dn===1){dn=0;var i=no,a=Oc,o=(a.flags&13878)!==0;if(a.subtreeFlags&13878||o){o=he.T,he.T=null;var d=Ze.p;Ze.p=2;var y=Ke;Ke|=4;try{Nb(a,i);var w=p_,T=w1(i.containerInfo),f=w.focusedElem,q=w.selectionRange;if(T!==f&&f&&f.ownerDocument&&b1(f.ownerDocument.documentElement,f)){if(q!==null&&U_(f)){var ct=q.start,vt=q.end;if(vt===void 0&&(vt=ct),"selectionStart"in f)f.selectionStart=ct,f.selectionEnd=Math.min(vt,f.value.length);else{var tt=f.ownerDocument||document,V=tt&&tt.defaultView||window;if(V.getSelection){var pt=V.getSelection(),Jt=f.textContent.length,Xt=Math.min(q.start,Jt),_e=q.end===void 0?Xt:Math.min(q.end,Jt);!pt.extend&&Xt>_e&&(T=_e,_e=Xt,Xt=T);var st=Dv(f,Xt),nt=Dv(f,_e);if(st&&nt&&(pt.rangeCount!==1||pt.anchorNode!==st.node||pt.anchorOffset!==st.offset||pt.focusNode!==nt.node||pt.focusOffset!==nt.offset)){var ut=tt.createRange();ut.setStart(st.node,st.offset),pt.removeAllRanges(),Xt>_e?(pt.addRange(ut),pt.extend(nt.node,nt.offset)):(ut.setEnd(nt.node,nt.offset),pt.addRange(ut))}}}}for(tt=[],pt=f;pt=pt.parentNode;)pt.nodeType===1&&tt.push({element:pt,left:pt.scrollLeft,top:pt.scrollTop});for(typeof f.focus=="function"&&f.focus(),f=0;f<tt.length;f++){var bt=tt[f];bt.element.scrollLeft=bt.left,bt.element.scrollTop=bt.top}}up=!!f_,p_=f_=null}finally{Ke=y,Ze.p=d,he.T=o}}i.current=a,dn=2}}function iw(){if(dn===2){dn=0;var i=no,a=Oc,o=(a.flags&8772)!==0;if(a.subtreeFlags&8772||o){o=he.T,he.T=null;var d=Ze.p;Ze.p=2;var y=Ke;Ke|=4;try{Bb(i,a.alternate,a)}finally{Ke=y,Ze.p=d,he.T=o}}dn=3}}function nw(){if(dn===4||dn===3){dn=0,QS();var i=no,a=Oc,o=zc,d=Xb;a.subtreeFlags&10256||a.flags&10256?dn=5:(dn=0,Oc=no=null,aw(i,i.pendingLanes));var y=i.pendingLanes;if(y===0&&(io=null),k_(o),a=a.stateNode,_a&&typeof _a.onCommitFiberRoot=="function")try{_a.onCommitFiberRoot(qh,a,void 0,(a.current.flags&128)===128)}catch{}if(d!==null){a=he.T,y=Ze.p,Ze.p=2,he.T=null;try{for(var w=i.onRecoverableError,T=0;T<d.length;T++){var f=d[T];w(f.value,{componentStack:f.stack})}}finally{he.T=a,Ze.p=y}}zc&3&&Mp(),vr(i),y=i.pendingLanes,o&4194090&&y&42?i===c_?Eh++:(Eh=0,c_=i):Eh=0,ed(0)}}function aw(i,a){(i.pooledCacheLanes&=a)===0&&(a=i.pooledCache,a!=null&&(i.pooledCache=null,Kh(a)))}function Mp(i){return ew(),iw(),nw(),rw()}function rw(){if(dn!==5)return!1;var i=no,a=o_;o_=0;var o=k_(zc),d=he.T,y=Ze.p;try{Ze.p=32>o?32:o,he.T=null,o=l_,l_=null;var w=no,T=zc;if(dn=0,Oc=no=null,zc=0,Ke&6)throw Error(Tt(331));var f=Ke;if(Ke|=4,Gb(w.current),jb(w,w.current,T,o),Ke=f,ed(0,!1),_a&&typeof _a.onPostCommitFiberRoot=="function")try{_a.onPostCommitFiberRoot(qh,w)}catch{}return!0}finally{Ze.p=y,he.T=d,aw(i,a)}}function ux(i,a,o){a=Fa(o,a),a=i_(i.stateNode,a,2),i=eo(i,a,2),i!==null&&(Gh(i,2),vr(i))}function ri(i,a,o){if(i.tag===3)ux(i,i,o);else for(;a!==null;){if(a.tag===3){ux(a,i,o);break}else if(a.tag===1){var d=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(io===null||!io.has(d))){i=Fa(o,i),o=wb(2),d=eo(a,o,2),d!==null&&(Sb(o,d,a,i),Gh(d,2),vr(d));break}}a=a.return}}function vg(i,a,o){var d=i.pingCache;if(d===null){d=i.pingCache=new TA;var y=new Set;d.set(a,y)}else y=d.get(a),y===void 0&&(y=new Set,d.set(a,y));y.has(o)||(uy=!0,y.add(o),i=CA.bind(null,i,a,o),a.then(i,i))}function CA(i,a,o){var d=i.pingCache;d!==null&&d.delete(a),i.pingedLanes|=i.suspendedLanes&o,i.warmLanes&=~o,si===i&&(Be&o)===o&&(Ti===4||Ti===3&&(Be&62914560)===Be&&300>gr()-dy?!(Ke&2)&&Fc(i,0):hy|=o,Bc===Be&&(Bc=0)),vr(i)}function sw(i,a){a===0&&(a=e1()),i=qc(i,a),i!==null&&(Gh(i,a),vr(i))}function DA(i){var a=i.memoizedState,o=0;a!==null&&(o=a.retryLane),sw(i,o)}function IA(i,a){var o=0;switch(i.tag){case 13:var d=i.stateNode,y=i.memoizedState;y!==null&&(o=y.retryLane);break;case 19:d=i.stateNode;break;case 22:d=i.stateNode._retryCache;break;default:throw Error(Tt(314))}d!==null&&d.delete(a),sw(i,o)}function kA(i,a){return D_(i,a)}var np=null,lc=null,h_=!1,ap=!1,xg=!1,tl=0;function vr(i){i!==lc&&i.next===null&&(lc===null?np=lc=i:lc=lc.next=i),ap=!0,h_||(h_=!0,PA())}function ed(i,a){if(!xg&&ap){xg=!0;do for(var o=!1,d=np;d!==null;){if(i!==0){var y=d.pendingLanes;if(y===0)var w=0;else{var T=d.suspendedLanes,f=d.pingedLanes;w=(1<<31-ya(42|i)+1)-1,w&=y&~(T&~f),w=w&201326741?w&201326741|1:w?w|2:0}w!==0&&(o=!0,hx(d,w))}else w=Be,w=mp(d,d===si?w:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),!(w&3)||Zh(d,w)||(o=!0,hx(d,w));d=d.next}while(o);xg=!1}}function RA(){ow()}function ow(){ap=h_=!1;var i=0;tl!==0&&(jA()&&(i=tl),tl=0);for(var a=gr(),o=null,d=np;d!==null;){var y=d.next,w=lw(d,a);w===0?(d.next=null,o===null?np=y:o.next=y,y===null&&(lc=o)):(o=d,(i!==0||w&3)&&(ap=!0)),d=y}ed(i)}function lw(i,a){for(var o=i.suspendedLanes,d=i.pingedLanes,y=i.expirationTimes,w=i.pendingLanes&-62914561;0<w;){var T=31-ya(w),f=1<<T,q=y[T];q===-1?(!(f&o)||f&d)&&(y[T]=rT(f,a)):q<=a&&(i.expiredLanes|=f),w&=~f}if(a=si,o=Be,o=mp(i,i===a?o:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),d=i.callbackNode,o===0||i===a&&(Ye===2||Ye===9)||i.cancelPendingCommit!==null)return d!==null&&d!==null&&Hm(d),i.callbackNode=null,i.callbackPriority=0;if(!(o&3)||Zh(i,o)){if(a=o&-o,a===i.callbackPriority)return a;switch(d!==null&&Hm(d),k_(o)){case 2:case 8:o=Jx;break;case 32:o=Uf;break;case 268435456:o=Wx;break;default:o=Uf}return d=cw.bind(null,i),o=D_(o,d),i.callbackPriority=a,i.callbackNode=o,a}return d!==null&&d!==null&&Hm(d),i.callbackPriority=2,i.callbackNode=null,2}function cw(i,a){if(dn!==0&&dn!==5)return i.callbackNode=null,i.callbackPriority=0,null;var o=i.callbackNode;if(Mp()&&i.callbackNode!==o)return null;var d=Be;return d=mp(i,i===si?d:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),d===0?null:(Yb(i,d,a),lw(i,gr()),i.callbackNode!=null&&i.callbackNode===o?cw.bind(null,i):null)}function hx(i,a){if(Mp())return null;Yb(i,a,!0)}function PA(){ZA(function(){Ke&6?D_(Qx,RA):ow()})}function py(){return tl===0&&(tl=t1()),tl}function dx(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:Sf(""+i)}function fx(i,a){var o=a.ownerDocument.createElement("input");return o.name=a.name,o.value=a.value,i.id&&o.setAttribute("form",i.id),a.parentNode.insertBefore(o,a),i=new FormData(i),o.parentNode.removeChild(o),i}function LA(i,a,o,d,y){if(a==="submit"&&o&&o.stateNode===y){var w=dx((y[Qn]||null).action),T=d.submitter;T&&(a=(a=T[Qn]||null)?dx(a.formAction):T.getAttribute("formAction"),a!==null&&(w=a,T=null));var f=new gp("action","action",null,d,y);i.push({event:f,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(tl!==0){var q=T?fx(y,T):new FormData(y);t_(o,{pending:!0,data:q,method:y.method,action:w},null,q)}}else typeof w=="function"&&(f.preventDefault(),q=T?fx(y,T):new FormData(y),t_(o,{pending:!0,data:q,method:y.method,action:w},w,q))},currentTarget:y}]})}}for(var bg=0;bg<jg.length;bg++){var wg=jg[bg],BA=wg.toLowerCase(),OA=wg[0].toUpperCase()+wg.slice(1);Ja(BA,"on"+OA)}Ja(T1,"onAnimationEnd");Ja(A1,"onAnimationIteration");Ja(E1,"onAnimationStart");Ja("dblclick","onDoubleClick");Ja("focusin","onFocus");Ja("focusout","onBlur");Ja(tA,"onTransitionRun");Ja(eA,"onTransitionStart");Ja(iA,"onTransitionCancel");Ja(M1,"onTransitionEnd");Dc("onMouseEnter",["mouseout","mouseover"]);Dc("onMouseLeave",["mouseout","mouseover"]);Dc("onPointerEnter",["pointerout","pointerover"]);Dc("onPointerLeave",["pointerout","pointerover"]);rl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));rl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));rl("onBeforeInput",["compositionend","keypress","textInput","paste"]);rl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));rl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));rl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Lh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),FA=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Lh));function uw(i,a){a=(a&4)!==0;for(var o=0;o<i.length;o++){var d=i[o],y=d.event;d=d.listeners;t:{var w=void 0;if(a)for(var T=d.length-1;0<=T;T--){var f=d[T],q=f.instance,ct=f.currentTarget;if(f=f.listener,q!==w&&y.isPropagationStopped())break t;w=f,y.currentTarget=ct;try{w(y)}catch(vt){Qf(vt)}y.currentTarget=null,w=q}else for(T=0;T<d.length;T++){if(f=d[T],q=f.instance,ct=f.currentTarget,f=f.listener,q!==w&&y.isPropagationStopped())break t;w=f,y.currentTarget=ct;try{w(y)}catch(vt){Qf(vt)}y.currentTarget=null,w=q}}}}function ze(i,a){var o=a[Lg];o===void 0&&(o=a[Lg]=new Set);var d=i+"__bubble";o.has(d)||(hw(a,i,2,!1),o.add(d))}function Sg(i,a,o){var d=0;a&&(d|=4),hw(o,i,d,a)}var yf="_reactListening"+Math.random().toString(36).slice(2);function my(i){if(!i[yf]){i[yf]=!0,r1.forEach(function(o){o!=="selectionchange"&&(FA.has(o)||Sg(o,!1,i),Sg(o,!0,i))});var a=i.nodeType===9?i:i.ownerDocument;a===null||a[yf]||(a[yf]=!0,Sg("selectionchange",!1,a))}}function hw(i,a,o,d){switch(Sw(a)){case 2:var y=hE;break;case 8:y=dE;break;default:y=vy}o=y.bind(null,a,o,i),y=void 0,!Ug||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(y=!0),d?y!==void 0?i.addEventListener(a,o,{capture:!0,passive:y}):i.addEventListener(a,o,!0):y!==void 0?i.addEventListener(a,o,{passive:y}):i.addEventListener(a,o,!1)}function Tg(i,a,o,d,y){var w=d;if(!(a&1)&&!(a&2)&&d!==null)t:for(;;){if(d===null)return;var T=d.tag;if(T===3||T===4){var f=d.stateNode.containerInfo;if(f===y)break;if(T===4)for(T=d.return;T!==null;){var q=T.tag;if((q===3||q===4)&&T.stateNode.containerInfo===y)return;T=T.return}for(;f!==null;){if(T=hc(f),T===null)return;if(q=T.tag,q===5||q===6||q===26||q===27){d=w=T;continue t}f=f.parentNode}}d=d.return}f1(function(){var ct=w,vt=L_(o),tt=[];t:{var V=z1.get(i);if(V!==void 0){var pt=gp,Jt=i;switch(i){case"keypress":if(Af(o)===0)break t;case"keydown":case"keyup":pt=kT;break;case"focusin":Jt="focus",pt=tg;break;case"focusout":Jt="blur",pt=tg;break;case"beforeblur":case"afterblur":pt=tg;break;case"click":if(o.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":pt=xv;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":pt=xT;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":pt=LT;break;case T1:case A1:case E1:pt=ST;break;case M1:pt=OT;break;case"scroll":case"scrollend":pt=yT;break;case"wheel":pt=UT;break;case"copy":case"cut":case"paste":pt=AT;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":pt=wv;break;case"toggle":case"beforetoggle":pt=VT}var Xt=(a&4)!==0,_e=!Xt&&(i==="scroll"||i==="scrollend"),st=Xt?V!==null?V+"Capture":null:V;Xt=[];for(var nt=ct,ut;nt!==null;){var bt=nt;if(ut=bt.stateNode,bt=bt.tag,bt!==5&&bt!==26&&bt!==27||ut===null||st===null||(bt=Ch(nt,st),bt!=null&&Xt.push(Bh(nt,bt,ut))),_e)break;nt=nt.return}0<Xt.length&&(V=new pt(V,Jt,null,o,vt),tt.push({event:V,listeners:Xt}))}}if(!(a&7)){t:{if(V=i==="mouseover"||i==="pointerover",pt=i==="mouseout"||i==="pointerout",V&&o!==Fg&&(Jt=o.relatedTarget||o.fromElement)&&(hc(Jt)||Jt[Vc]))break t;if((pt||V)&&(V=vt.window===vt?vt:(V=vt.ownerDocument)?V.defaultView||V.parentWindow:window,pt?(Jt=o.relatedTarget||o.toElement,pt=ct,Jt=Jt?hc(Jt):null,Jt!==null&&(_e=jh(Jt),Xt=Jt.tag,Jt!==_e||Xt!==5&&Xt!==27&&Xt!==6)&&(Jt=null)):(pt=null,Jt=ct),pt!==Jt)){if(Xt=xv,bt="onMouseLeave",st="onMouseEnter",nt="mouse",(i==="pointerout"||i==="pointerover")&&(Xt=wv,bt="onPointerLeave",st="onPointerEnter",nt="pointer"),_e=pt==null?V:hh(pt),ut=Jt==null?V:hh(Jt),V=new Xt(bt,nt+"leave",pt,o,vt),V.target=_e,V.relatedTarget=ut,bt=null,hc(vt)===ct&&(Xt=new Xt(st,nt+"enter",Jt,o,vt),Xt.target=ut,Xt.relatedTarget=_e,bt=Xt),_e=bt,pt&&Jt)e:{for(Xt=pt,st=Jt,nt=0,ut=Xt;ut;ut=ac(ut))nt++;for(ut=0,bt=st;bt;bt=ac(bt))ut++;for(;0<nt-ut;)Xt=ac(Xt),nt--;for(;0<ut-nt;)st=ac(st),ut--;for(;nt--;){if(Xt===st||st!==null&&Xt===st.alternate)break e;Xt=ac(Xt),st=ac(st)}Xt=null}else Xt=null;pt!==null&&px(tt,V,pt,Xt,!1),Jt!==null&&_e!==null&&px(tt,_e,Jt,Xt,!0)}}t:{if(V=ct?hh(ct):window,pt=V.nodeName&&V.nodeName.toLowerCase(),pt==="select"||pt==="input"&&V.type==="file")var Ot=Ev;else if(Av(V))if(v1)Ot=QT;else{Ot=YT;var ne=$T}else pt=V.nodeName,!pt||pt.toLowerCase()!=="input"||V.type!=="checkbox"&&V.type!=="radio"?ct&&P_(ct.elementType)&&(Ot=Ev):Ot=KT;if(Ot&&(Ot=Ot(i,ct))){y1(tt,Ot,o,vt);break t}ne&&ne(i,V,ct),i==="focusout"&&ct&&V.type==="number"&&ct.memoizedProps.value!=null&&Og(V,"number",V.value)}switch(ne=ct?hh(ct):window,i){case"focusin":(Av(ne)||ne.contentEditable==="true")&&(pc=ne,Ng=ct,gh=null);break;case"focusout":gh=Ng=pc=null;break;case"mousedown":Vg=!0;break;case"contextmenu":case"mouseup":case"dragend":Vg=!1,Iv(tt,o,vt);break;case"selectionchange":if(WT)break;case"keydown":case"keyup":Iv(tt,o,vt)}var Nt;if(F_)t:{switch(i){case"compositionstart":var te="onCompositionStart";break t;case"compositionend":te="onCompositionEnd";break t;case"compositionupdate":te="onCompositionUpdate";break t}te=void 0}else fc?g1(i,o)&&(te="onCompositionEnd"):i==="keydown"&&o.keyCode===229&&(te="onCompositionStart");te&&(m1&&o.locale!=="ko"&&(fc||te!=="onCompositionStart"?te==="onCompositionEnd"&&fc&&(Nt=p1()):(Ks=vt,B_="value"in Ks?Ks.value:Ks.textContent,fc=!0)),ne=rp(ct,te),0<ne.length&&(te=new bv(te,i,null,o,vt),tt.push({event:te,listeners:ne}),Nt?te.data=Nt:(Nt=_1(o),Nt!==null&&(te.data=Nt)))),(Nt=qT?ZT(i,o):GT(i,o))&&(te=rp(ct,"onBeforeInput"),0<te.length&&(ne=new bv("onBeforeInput","beforeinput",null,o,vt),tt.push({event:ne,listeners:te}),ne.data=Nt)),LA(tt,i,ct,o,vt)}uw(tt,a)})}function Bh(i,a,o){return{instance:i,listener:a,currentTarget:o}}function rp(i,a){for(var o=a+"Capture",d=[];i!==null;){var y=i,w=y.stateNode;if(y=y.tag,y!==5&&y!==26&&y!==27||w===null||(y=Ch(i,o),y!=null&&d.unshift(Bh(i,y,w)),y=Ch(i,a),y!=null&&d.push(Bh(i,y,w))),i.tag===3)return d;i=i.return}return[]}function ac(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function px(i,a,o,d,y){for(var w=a._reactName,T=[];o!==null&&o!==d;){var f=o,q=f.alternate,ct=f.stateNode;if(f=f.tag,q!==null&&q===d)break;f!==5&&f!==26&&f!==27||ct===null||(q=ct,y?(ct=Ch(o,w),ct!=null&&T.unshift(Bh(o,ct,q))):y||(ct=Ch(o,w),ct!=null&&T.push(Bh(o,ct,q)))),o=o.return}T.length!==0&&i.push({event:a,listeners:T})}var UA=/\r\n?/g,NA=/\u0000|\uFFFD/g;function mx(i){return(typeof i=="string"?i:""+i).replace(UA,`
`).replace(NA,"")}function dw(i,a){return a=mx(a),mx(i)===a}function zp(){}function ii(i,a,o,d,y,w){switch(o){case"children":typeof d=="string"?a==="body"||a==="textarea"&&d===""||Ic(i,d):(typeof d=="number"||typeof d=="bigint")&&a!=="body"&&Ic(i,""+d);break;case"className":hf(i,"class",d);break;case"tabIndex":hf(i,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":hf(i,o,d);break;case"style":d1(i,d,w);break;case"data":if(a!=="object"){hf(i,"data",d);break}case"src":case"href":if(d===""&&(a!=="a"||o!=="href")){i.removeAttribute(o);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){i.removeAttribute(o);break}d=Sf(""+d),i.setAttribute(o,d);break;case"action":case"formAction":if(typeof d=="function"){i.setAttribute(o,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof w=="function"&&(o==="formAction"?(a!=="input"&&ii(i,a,"name",y.name,y,null),ii(i,a,"formEncType",y.formEncType,y,null),ii(i,a,"formMethod",y.formMethod,y,null),ii(i,a,"formTarget",y.formTarget,y,null)):(ii(i,a,"encType",y.encType,y,null),ii(i,a,"method",y.method,y,null),ii(i,a,"target",y.target,y,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){i.removeAttribute(o);break}d=Sf(""+d),i.setAttribute(o,d);break;case"onClick":d!=null&&(i.onclick=zp);break;case"onScroll":d!=null&&ze("scroll",i);break;case"onScrollEnd":d!=null&&ze("scrollend",i);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(Tt(61));if(o=d.__html,o!=null){if(y.children!=null)throw Error(Tt(60));i.innerHTML=o}}break;case"multiple":i.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":i.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){i.removeAttribute("xlink:href");break}o=Sf(""+d),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?i.setAttribute(o,""+d):i.removeAttribute(o);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?i.setAttribute(o,""):i.removeAttribute(o);break;case"capture":case"download":d===!0?i.setAttribute(o,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?i.setAttribute(o,d):i.removeAttribute(o);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?i.setAttribute(o,d):i.removeAttribute(o);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?i.removeAttribute(o):i.setAttribute(o,d);break;case"popover":ze("beforetoggle",i),ze("toggle",i),wf(i,"popover",d);break;case"xlinkActuate":Nr(i,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":Nr(i,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":Nr(i,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":Nr(i,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":Nr(i,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":Nr(i,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":Nr(i,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":Nr(i,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":Nr(i,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":wf(i,"is",d);break;case"innerText":case"textContent":break;default:(!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(o=gT.get(o)||o,wf(i,o,d))}}function d_(i,a,o,d,y,w){switch(o){case"style":d1(i,d,w);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(Tt(61));if(o=d.__html,o!=null){if(y.children!=null)throw Error(Tt(60));i.innerHTML=o}}break;case"children":typeof d=="string"?Ic(i,d):(typeof d=="number"||typeof d=="bigint")&&Ic(i,""+d);break;case"onScroll":d!=null&&ze("scroll",i);break;case"onScrollEnd":d!=null&&ze("scrollend",i);break;case"onClick":d!=null&&(i.onclick=zp);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!s1.hasOwnProperty(o))t:{if(o[0]==="o"&&o[1]==="n"&&(y=o.endsWith("Capture"),a=o.slice(2,y?o.length-7:void 0),w=i[Qn]||null,w=w!=null?w[o]:null,typeof w=="function"&&i.removeEventListener(a,w,y),typeof d=="function")){typeof w!="function"&&w!==null&&(o in i?i[o]=null:i.hasAttribute(o)&&i.removeAttribute(o)),i.addEventListener(a,d,y);break t}o in i?i[o]=d:d===!0?i.setAttribute(o,""):wf(i,o,d)}}}function fn(i,a,o){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ze("error",i),ze("load",i);var d=!1,y=!1,w;for(w in o)if(o.hasOwnProperty(w)){var T=o[w];if(T!=null)switch(w){case"src":d=!0;break;case"srcSet":y=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(Tt(137,a));default:ii(i,a,w,T,o,null)}}y&&ii(i,a,"srcSet",o.srcSet,o,null),d&&ii(i,a,"src",o.src,o,null);return;case"input":ze("invalid",i);var f=w=T=y=null,q=null,ct=null;for(d in o)if(o.hasOwnProperty(d)){var vt=o[d];if(vt!=null)switch(d){case"name":y=vt;break;case"type":T=vt;break;case"checked":q=vt;break;case"defaultChecked":ct=vt;break;case"value":w=vt;break;case"defaultValue":f=vt;break;case"children":case"dangerouslySetInnerHTML":if(vt!=null)throw Error(Tt(137,a));break;default:ii(i,a,d,vt,o,null)}}c1(i,w,f,q,ct,T,y,!1),Nf(i);return;case"select":ze("invalid",i),d=T=w=null;for(y in o)if(o.hasOwnProperty(y)&&(f=o[y],f!=null))switch(y){case"value":w=f;break;case"defaultValue":T=f;break;case"multiple":d=f;default:ii(i,a,y,f,o,null)}a=w,o=T,i.multiple=!!d,a!=null?wc(i,!!d,a,!1):o!=null&&wc(i,!!d,o,!0);return;case"textarea":ze("invalid",i),w=y=d=null;for(T in o)if(o.hasOwnProperty(T)&&(f=o[T],f!=null))switch(T){case"value":d=f;break;case"defaultValue":y=f;break;case"children":w=f;break;case"dangerouslySetInnerHTML":if(f!=null)throw Error(Tt(91));break;default:ii(i,a,T,f,o,null)}h1(i,d,y,w),Nf(i);return;case"option":for(q in o)if(o.hasOwnProperty(q)&&(d=o[q],d!=null))switch(q){case"selected":i.selected=d&&typeof d!="function"&&typeof d!="symbol";break;default:ii(i,a,q,d,o,null)}return;case"dialog":ze("beforetoggle",i),ze("toggle",i),ze("cancel",i),ze("close",i);break;case"iframe":case"object":ze("load",i);break;case"video":case"audio":for(d=0;d<Lh.length;d++)ze(Lh[d],i);break;case"image":ze("error",i),ze("load",i);break;case"details":ze("toggle",i);break;case"embed":case"source":case"link":ze("error",i),ze("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ct in o)if(o.hasOwnProperty(ct)&&(d=o[ct],d!=null))switch(ct){case"children":case"dangerouslySetInnerHTML":throw Error(Tt(137,a));default:ii(i,a,ct,d,o,null)}return;default:if(P_(a)){for(vt in o)o.hasOwnProperty(vt)&&(d=o[vt],d!==void 0&&d_(i,a,vt,d,o,void 0));return}}for(f in o)o.hasOwnProperty(f)&&(d=o[f],d!=null&&ii(i,a,f,d,o,null))}function VA(i,a,o,d){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var y=null,w=null,T=null,f=null,q=null,ct=null,vt=null;for(pt in o){var tt=o[pt];if(o.hasOwnProperty(pt)&&tt!=null)switch(pt){case"checked":break;case"value":break;case"defaultValue":q=tt;default:d.hasOwnProperty(pt)||ii(i,a,pt,null,d,tt)}}for(var V in d){var pt=d[V];if(tt=o[V],d.hasOwnProperty(V)&&(pt!=null||tt!=null))switch(V){case"type":w=pt;break;case"name":y=pt;break;case"checked":ct=pt;break;case"defaultChecked":vt=pt;break;case"value":T=pt;break;case"defaultValue":f=pt;break;case"children":case"dangerouslySetInnerHTML":if(pt!=null)throw Error(Tt(137,a));break;default:pt!==tt&&ii(i,a,V,pt,d,tt)}}Bg(i,T,f,q,ct,vt,w,y);return;case"select":pt=T=f=V=null;for(w in o)if(q=o[w],o.hasOwnProperty(w)&&q!=null)switch(w){case"value":break;case"multiple":pt=q;default:d.hasOwnProperty(w)||ii(i,a,w,null,d,q)}for(y in d)if(w=d[y],q=o[y],d.hasOwnProperty(y)&&(w!=null||q!=null))switch(y){case"value":V=w;break;case"defaultValue":f=w;break;case"multiple":T=w;default:w!==q&&ii(i,a,y,w,d,q)}a=f,o=T,d=pt,V!=null?wc(i,!!o,V,!1):!!d!=!!o&&(a!=null?wc(i,!!o,a,!0):wc(i,!!o,o?[]:"",!1));return;case"textarea":pt=V=null;for(f in o)if(y=o[f],o.hasOwnProperty(f)&&y!=null&&!d.hasOwnProperty(f))switch(f){case"value":break;case"children":break;default:ii(i,a,f,null,d,y)}for(T in d)if(y=d[T],w=o[T],d.hasOwnProperty(T)&&(y!=null||w!=null))switch(T){case"value":V=y;break;case"defaultValue":pt=y;break;case"children":break;case"dangerouslySetInnerHTML":if(y!=null)throw Error(Tt(91));break;default:y!==w&&ii(i,a,T,y,d,w)}u1(i,V,pt);return;case"option":for(var Jt in o)if(V=o[Jt],o.hasOwnProperty(Jt)&&V!=null&&!d.hasOwnProperty(Jt))switch(Jt){case"selected":i.selected=!1;break;default:ii(i,a,Jt,null,d,V)}for(q in d)if(V=d[q],pt=o[q],d.hasOwnProperty(q)&&V!==pt&&(V!=null||pt!=null))switch(q){case"selected":i.selected=V&&typeof V!="function"&&typeof V!="symbol";break;default:ii(i,a,q,V,d,pt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Xt in o)V=o[Xt],o.hasOwnProperty(Xt)&&V!=null&&!d.hasOwnProperty(Xt)&&ii(i,a,Xt,null,d,V);for(ct in d)if(V=d[ct],pt=o[ct],d.hasOwnProperty(ct)&&V!==pt&&(V!=null||pt!=null))switch(ct){case"children":case"dangerouslySetInnerHTML":if(V!=null)throw Error(Tt(137,a));break;default:ii(i,a,ct,V,d,pt)}return;default:if(P_(a)){for(var _e in o)V=o[_e],o.hasOwnProperty(_e)&&V!==void 0&&!d.hasOwnProperty(_e)&&d_(i,a,_e,void 0,d,V);for(vt in d)V=d[vt],pt=o[vt],!d.hasOwnProperty(vt)||V===pt||V===void 0&&pt===void 0||d_(i,a,vt,V,d,pt);return}}for(var st in o)V=o[st],o.hasOwnProperty(st)&&V!=null&&!d.hasOwnProperty(st)&&ii(i,a,st,null,d,V);for(tt in d)V=d[tt],pt=o[tt],!d.hasOwnProperty(tt)||V===pt||V==null&&pt==null||ii(i,a,tt,V,d,pt)}var f_=null,p_=null;function sp(i){return i.nodeType===9?i:i.ownerDocument}function gx(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function fw(i,a){if(i===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&a==="foreignObject"?0:i}function m_(i,a){return i==="textarea"||i==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var Ag=null;function jA(){var i=window.event;return i&&i.type==="popstate"?i===Ag?!1:(Ag=i,!0):(Ag=null,!1)}var pw=typeof setTimeout=="function"?setTimeout:void 0,qA=typeof clearTimeout=="function"?clearTimeout:void 0,_x=typeof Promise=="function"?Promise:void 0,ZA=typeof queueMicrotask=="function"?queueMicrotask:typeof _x<"u"?function(i){return _x.resolve(null).then(i).catch(GA)}:pw;function GA(i){setTimeout(function(){throw i})}function ho(i){return i==="head"}function yx(i,a){var o=a,d=0,y=0;do{var w=o.nextSibling;if(i.removeChild(o),w&&w.nodeType===8)if(o=w.data,o==="/$"){if(0<d&&8>d){o=d;var T=i.ownerDocument;if(o&1&&Mh(T.documentElement),o&2&&Mh(T.body),o&4)for(o=T.head,Mh(o),T=o.firstChild;T;){var f=T.nextSibling,q=T.nodeName;T[Hh]||q==="SCRIPT"||q==="STYLE"||q==="LINK"&&T.rel.toLowerCase()==="stylesheet"||o.removeChild(T),T=f}}if(y===0){i.removeChild(w),Vh(a);return}y--}else o==="$"||o==="$?"||o==="$!"?y++:d=o.charCodeAt(0)-48;else d=0;o=w}while(o);Vh(a)}function g_(i){var a=i.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var o=a;switch(a=a.nextSibling,o.nodeName){case"HTML":case"HEAD":case"BODY":g_(o),R_(o);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(o.rel.toLowerCase()==="stylesheet")continue}i.removeChild(o)}}function HA(i,a,o,d){for(;i.nodeType===1;){var y=o;if(i.nodeName.toLowerCase()!==a.toLowerCase()){if(!d&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(d){if(!i[Hh])switch(a){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(w=i.getAttribute("rel"),w==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(w!==y.rel||i.getAttribute("href")!==(y.href==null||y.href===""?null:y.href)||i.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin)||i.getAttribute("title")!==(y.title==null?null:y.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(w=i.getAttribute("src"),(w!==(y.src==null?null:y.src)||i.getAttribute("type")!==(y.type==null?null:y.type)||i.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin))&&w&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(a==="input"&&i.type==="hidden"){var w=y.name==null?null:""+y.name;if(y.type==="hidden"&&i.getAttribute("name")===w)return i}else return i;if(i=Qa(i.nextSibling),i===null)break}return null}function XA(i,a,o){if(a==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!o||(i=Qa(i.nextSibling),i===null))return null;return i}function __(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState==="complete"}function $A(i,a){var o=i.ownerDocument;if(i.data!=="$?"||o.readyState==="complete")a();else{var d=function(){a(),o.removeEventListener("DOMContentLoaded",d)};o.addEventListener("DOMContentLoaded",d),i._reactRetry=d}}function Qa(i){for(;i!=null;i=i.nextSibling){var a=i.nodeType;if(a===1||a===3)break;if(a===8){if(a=i.data,a==="$"||a==="$!"||a==="$?"||a==="F!"||a==="F")break;if(a==="/$")return null}}return i}var y_=null;function vx(i){i=i.previousSibling;for(var a=0;i;){if(i.nodeType===8){var o=i.data;if(o==="$"||o==="$!"||o==="$?"){if(a===0)return i;a--}else o==="/$"&&a++}i=i.previousSibling}return null}function mw(i,a,o){switch(a=sp(o),i){case"html":if(i=a.documentElement,!i)throw Error(Tt(452));return i;case"head":if(i=a.head,!i)throw Error(Tt(453));return i;case"body":if(i=a.body,!i)throw Error(Tt(454));return i;default:throw Error(Tt(451))}}function Mh(i){for(var a=i.attributes;a.length;)i.removeAttributeNode(a[0]);R_(i)}var Va=new Map,xx=new Set;function op(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var es=Ze.d;Ze.d={f:YA,r:KA,D:QA,C:JA,L:WA,m:tE,X:iE,S:eE,M:nE};function YA(){var i=es.f(),a=Ap();return i||a}function KA(i){var a=jc(i);a!==null&&a.tag===5&&a.type==="form"?lb(a):es.r(i)}var Gc=typeof document>"u"?null:document;function gw(i,a,o){var d=Gc;if(d&&typeof a=="string"&&a){var y=Oa(a);y='link[rel="'+i+'"][href="'+y+'"]',typeof o=="string"&&(y+='[crossorigin="'+o+'"]'),xx.has(y)||(xx.add(y),i={rel:i,crossOrigin:o,href:a},d.querySelector(y)===null&&(a=d.createElement("link"),fn(a,"link",i),tn(a),d.head.appendChild(a)))}}function QA(i){es.D(i),gw("dns-prefetch",i,null)}function JA(i,a){es.C(i,a),gw("preconnect",i,a)}function WA(i,a,o){es.L(i,a,o);var d=Gc;if(d&&i&&a){var y='link[rel="preload"][as="'+Oa(a)+'"]';a==="image"&&o&&o.imageSrcSet?(y+='[imagesrcset="'+Oa(o.imageSrcSet)+'"]',typeof o.imageSizes=="string"&&(y+='[imagesizes="'+Oa(o.imageSizes)+'"]')):y+='[href="'+Oa(i)+'"]';var w=y;switch(a){case"style":w=Uc(i);break;case"script":w=Hc(i)}Va.has(w)||(i=ui({rel:"preload",href:a==="image"&&o&&o.imageSrcSet?void 0:i,as:a},o),Va.set(w,i),d.querySelector(y)!==null||a==="style"&&d.querySelector(id(w))||a==="script"&&d.querySelector(nd(w))||(a=d.createElement("link"),fn(a,"link",i),tn(a),d.head.appendChild(a)))}}function tE(i,a){es.m(i,a);var o=Gc;if(o&&i){var d=a&&typeof a.as=="string"?a.as:"script",y='link[rel="modulepreload"][as="'+Oa(d)+'"][href="'+Oa(i)+'"]',w=y;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":w=Hc(i)}if(!Va.has(w)&&(i=ui({rel:"modulepreload",href:i},a),Va.set(w,i),o.querySelector(y)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(o.querySelector(nd(w)))return}d=o.createElement("link"),fn(d,"link",i),tn(d),o.head.appendChild(d)}}}function eE(i,a,o){es.S(i,a,o);var d=Gc;if(d&&i){var y=bc(d).hoistableStyles,w=Uc(i);a=a||"default";var T=y.get(w);if(!T){var f={loading:0,preload:null};if(T=d.querySelector(id(w)))f.loading=5;else{i=ui({rel:"stylesheet",href:i,"data-precedence":a},o),(o=Va.get(w))&&gy(i,o);var q=T=d.createElement("link");tn(q),fn(q,"link",i),q._p=new Promise(function(ct,vt){q.onload=ct,q.onerror=vt}),q.addEventListener("load",function(){f.loading|=1}),q.addEventListener("error",function(){f.loading|=2}),f.loading|=4,kf(T,a,d)}T={type:"stylesheet",instance:T,count:1,state:f},y.set(w,T)}}}function iE(i,a){es.X(i,a);var o=Gc;if(o&&i){var d=bc(o).hoistableScripts,y=Hc(i),w=d.get(y);w||(w=o.querySelector(nd(y)),w||(i=ui({src:i,async:!0},a),(a=Va.get(y))&&_y(i,a),w=o.createElement("script"),tn(w),fn(w,"link",i),o.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},d.set(y,w))}}function nE(i,a){es.M(i,a);var o=Gc;if(o&&i){var d=bc(o).hoistableScripts,y=Hc(i),w=d.get(y);w||(w=o.querySelector(nd(y)),w||(i=ui({src:i,async:!0,type:"module"},a),(a=Va.get(y))&&_y(i,a),w=o.createElement("script"),tn(w),fn(w,"link",i),o.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},d.set(y,w))}}function bx(i,a,o,d){var y=(y=Ws.current)?op(y):null;if(!y)throw Error(Tt(446));switch(i){case"meta":case"title":return null;case"style":return typeof o.precedence=="string"&&typeof o.href=="string"?(a=Uc(o.href),o=bc(y).hoistableStyles,d=o.get(a),d||(d={type:"style",instance:null,count:0,state:null},o.set(a,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(o.rel==="stylesheet"&&typeof o.href=="string"&&typeof o.precedence=="string"){i=Uc(o.href);var w=bc(y).hoistableStyles,T=w.get(i);if(T||(y=y.ownerDocument||y,T={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},w.set(i,T),(w=y.querySelector(id(i)))&&!w._p&&(T.instance=w,T.state.loading=5),Va.has(i)||(o={rel:"preload",as:"style",href:o.href,crossOrigin:o.crossOrigin,integrity:o.integrity,media:o.media,hrefLang:o.hrefLang,referrerPolicy:o.referrerPolicy},Va.set(i,o),w||aE(y,i,o,T.state))),a&&d===null)throw Error(Tt(528,""));return T}if(a&&d!==null)throw Error(Tt(529,""));return null;case"script":return a=o.async,o=o.src,typeof o=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=Hc(o),o=bc(y).hoistableScripts,d=o.get(a),d||(d={type:"script",instance:null,count:0,state:null},o.set(a,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(Tt(444,i))}}function Uc(i){return'href="'+Oa(i)+'"'}function id(i){return'link[rel="stylesheet"]['+i+"]"}function _w(i){return ui({},i,{"data-precedence":i.precedence,precedence:null})}function aE(i,a,o,d){i.querySelector('link[rel="preload"][as="style"]['+a+"]")?d.loading=1:(a=i.createElement("link"),d.preload=a,a.addEventListener("load",function(){return d.loading|=1}),a.addEventListener("error",function(){return d.loading|=2}),fn(a,"link",o),tn(a),i.head.appendChild(a))}function Hc(i){return'[src="'+Oa(i)+'"]'}function nd(i){return"script[async]"+i}function wx(i,a,o){if(a.count++,a.instance===null)switch(a.type){case"style":var d=i.querySelector('style[data-href~="'+Oa(o.href)+'"]');if(d)return a.instance=d,tn(d),d;var y=ui({},o,{"data-href":o.href,"data-precedence":o.precedence,href:null,precedence:null});return d=(i.ownerDocument||i).createElement("style"),tn(d),fn(d,"style",y),kf(d,o.precedence,i),a.instance=d;case"stylesheet":y=Uc(o.href);var w=i.querySelector(id(y));if(w)return a.state.loading|=4,a.instance=w,tn(w),w;d=_w(o),(y=Va.get(y))&&gy(d,y),w=(i.ownerDocument||i).createElement("link"),tn(w);var T=w;return T._p=new Promise(function(f,q){T.onload=f,T.onerror=q}),fn(w,"link",d),a.state.loading|=4,kf(w,o.precedence,i),a.instance=w;case"script":return w=Hc(o.src),(y=i.querySelector(nd(w)))?(a.instance=y,tn(y),y):(d=o,(y=Va.get(w))&&(d=ui({},o),_y(d,y)),i=i.ownerDocument||i,y=i.createElement("script"),tn(y),fn(y,"link",d),i.head.appendChild(y),a.instance=y);case"void":return null;default:throw Error(Tt(443,a.type))}else a.type==="stylesheet"&&!(a.state.loading&4)&&(d=a.instance,a.state.loading|=4,kf(d,o.precedence,i));return a.instance}function kf(i,a,o){for(var d=o.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),y=d.length?d[d.length-1]:null,w=y,T=0;T<d.length;T++){var f=d[T];if(f.dataset.precedence===a)w=f;else if(w!==y)break}w?w.parentNode.insertBefore(i,w.nextSibling):(a=o.nodeType===9?o.head:o,a.insertBefore(i,a.firstChild))}function gy(i,a){i.crossOrigin==null&&(i.crossOrigin=a.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=a.referrerPolicy),i.title==null&&(i.title=a.title)}function _y(i,a){i.crossOrigin==null&&(i.crossOrigin=a.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=a.referrerPolicy),i.integrity==null&&(i.integrity=a.integrity)}var Rf=null;function Sx(i,a,o){if(Rf===null){var d=new Map,y=Rf=new Map;y.set(o,d)}else y=Rf,d=y.get(o),d||(d=new Map,y.set(o,d));if(d.has(i))return d;for(d.set(i,null),o=o.getElementsByTagName(i),y=0;y<o.length;y++){var w=o[y];if(!(w[Hh]||w[Sn]||i==="link"&&w.getAttribute("rel")==="stylesheet")&&w.namespaceURI!=="http://www.w3.org/2000/svg"){var T=w.getAttribute(a)||"";T=i+T;var f=d.get(T);f?f.push(w):d.set(T,[w])}}return d}function Tx(i,a,o){i=i.ownerDocument||i,i.head.insertBefore(o,a==="title"?i.querySelector("head > title"):null)}function rE(i,a,o){if(o===1||a.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return i=a.disabled,typeof a.precedence=="string"&&i==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function yw(i){return!(i.type==="stylesheet"&&!(i.state.loading&3))}var Oh=null;function sE(){}function oE(i,a,o){if(Oh===null)throw Error(Tt(475));var d=Oh;if(a.type==="stylesheet"&&(typeof o.media!="string"||matchMedia(o.media).matches!==!1)&&!(a.state.loading&4)){if(a.instance===null){var y=Uc(o.href),w=i.querySelector(id(y));if(w){i=w._p,i!==null&&typeof i=="object"&&typeof i.then=="function"&&(d.count++,d=lp.bind(d),i.then(d,d)),a.state.loading|=4,a.instance=w,tn(w);return}w=i.ownerDocument||i,o=_w(o),(y=Va.get(y))&&gy(o,y),w=w.createElement("link"),tn(w);var T=w;T._p=new Promise(function(f,q){T.onload=f,T.onerror=q}),fn(w,"link",o),a.instance=w}d.stylesheets===null&&(d.stylesheets=new Map),d.stylesheets.set(a,i),(i=a.state.preload)&&!(a.state.loading&3)&&(d.count++,a=lp.bind(d),i.addEventListener("load",a),i.addEventListener("error",a))}}function lE(){if(Oh===null)throw Error(Tt(475));var i=Oh;return i.stylesheets&&i.count===0&&v_(i,i.stylesheets),0<i.count?function(a){var o=setTimeout(function(){if(i.stylesheets&&v_(i,i.stylesheets),i.unsuspend){var d=i.unsuspend;i.unsuspend=null,d()}},6e4);return i.unsuspend=a,function(){i.unsuspend=null,clearTimeout(o)}}:null}function lp(){if(this.count--,this.count===0){if(this.stylesheets)v_(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var cp=null;function v_(i,a){i.stylesheets=null,i.unsuspend!==null&&(i.count++,cp=new Map,a.forEach(cE,i),cp=null,lp.call(i))}function cE(i,a){if(!(a.state.loading&4)){var o=cp.get(i);if(o)var d=o.get(null);else{o=new Map,cp.set(i,o);for(var y=i.querySelectorAll("link[data-precedence],style[data-precedence]"),w=0;w<y.length;w++){var T=y[w];(T.nodeName==="LINK"||T.getAttribute("media")!=="not all")&&(o.set(T.dataset.precedence,T),d=T)}d&&o.set(null,d)}y=a.instance,T=y.getAttribute("data-precedence"),w=o.get(T)||d,w===d&&o.set(null,y),o.set(T,y),this.count++,d=lp.bind(this),y.addEventListener("load",d),y.addEventListener("error",d),w?w.parentNode.insertBefore(y,w.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(y,i.firstChild)),a.state.loading|=4}}var Fh={$$typeof:Zr,Provider:null,Consumer:null,_currentValue:$o,_currentValue2:$o,_threadCount:0};function uE(i,a,o,d,y,w,T,f){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Xm(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Xm(0),this.hiddenUpdates=Xm(null),this.identifierPrefix=d,this.onUncaughtError=y,this.onCaughtError=w,this.onRecoverableError=T,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=f,this.incompleteTransitions=new Map}function vw(i,a,o,d,y,w,T,f,q,ct,vt,tt){return i=new uE(i,a,o,T,f,q,ct,tt),a=1,w===!0&&(a|=24),w=ga(3,null,null,a),i.current=w,w.stateNode=i,a=G_(),a.refCount++,i.pooledCache=a,a.refCount++,w.memoizedState={element:d,isDehydrated:o,cache:a},X_(w),i}function xw(i){return i?(i=_c,i):_c}function bw(i,a,o,d,y,w){y=xw(y),d.context===null?d.context=y:d.pendingContext=y,d=to(a),d.payload={element:o},w=w===void 0?null:w,w!==null&&(d.callback=w),o=eo(i,d,a),o!==null&&(xa(o,i,a),vh(o,i,a))}function Ax(i,a){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var o=i.retryLane;i.retryLane=o!==0&&o<a?o:a}}function yy(i,a){Ax(i,a),(i=i.alternate)&&Ax(i,a)}function ww(i){if(i.tag===13){var a=qc(i,67108864);a!==null&&xa(a,i,67108864),yy(i,67108864)}}var up=!0;function hE(i,a,o,d){var y=he.T;he.T=null;var w=Ze.p;try{Ze.p=2,vy(i,a,o,d)}finally{Ze.p=w,he.T=y}}function dE(i,a,o,d){var y=he.T;he.T=null;var w=Ze.p;try{Ze.p=8,vy(i,a,o,d)}finally{Ze.p=w,he.T=y}}function vy(i,a,o,d){if(up){var y=x_(d);if(y===null)Tg(i,a,d,hp,o),Ex(i,d);else if(pE(y,i,a,o,d))d.stopPropagation();else if(Ex(i,d),a&4&&-1<fE.indexOf(i)){for(;y!==null;){var w=jc(y);if(w!==null)switch(w.tag){case 3:if(w=w.stateNode,w.current.memoizedState.isDehydrated){var T=Go(w.pendingLanes);if(T!==0){var f=w;for(f.pendingLanes|=2,f.entangledLanes|=2;T;){var q=1<<31-ya(T);f.entanglements[1]|=q,T&=~q}vr(w),!(Ke&6)&&(ep=gr()+500,ed(0))}}break;case 13:f=qc(w,2),f!==null&&xa(f,w,2),Ap(),yy(w,2)}if(w=x_(d),w===null&&Tg(i,a,d,hp,o),w===y)break;y=w}y!==null&&d.stopPropagation()}else Tg(i,a,d,null,o)}}function x_(i){return i=L_(i),xy(i)}var hp=null;function xy(i){if(hp=null,i=hc(i),i!==null){var a=jh(i);if(a===null)i=null;else{var o=a.tag;if(o===13){if(i=Xx(a),i!==null)return i;i=null}else if(o===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;i=null}else a!==i&&(i=null)}}return hp=i,null}function Sw(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(JS()){case Qx:return 2;case Jx:return 8;case Uf:case WS:return 32;case Wx:return 268435456;default:return 32}default:return 32}}var b_=!1,ao=null,ro=null,so=null,Uh=new Map,Nh=new Map,$s=[],fE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Ex(i,a){switch(i){case"focusin":case"focusout":ao=null;break;case"dragenter":case"dragleave":ro=null;break;case"mouseover":case"mouseout":so=null;break;case"pointerover":case"pointerout":Uh.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":Nh.delete(a.pointerId)}}function lh(i,a,o,d,y,w){return i===null||i.nativeEvent!==w?(i={blockedOn:a,domEventName:o,eventSystemFlags:d,nativeEvent:w,targetContainers:[y]},a!==null&&(a=jc(a),a!==null&&ww(a)),i):(i.eventSystemFlags|=d,a=i.targetContainers,y!==null&&a.indexOf(y)===-1&&a.push(y),i)}function pE(i,a,o,d,y){switch(a){case"focusin":return ao=lh(ao,i,a,o,d,y),!0;case"dragenter":return ro=lh(ro,i,a,o,d,y),!0;case"mouseover":return so=lh(so,i,a,o,d,y),!0;case"pointerover":var w=y.pointerId;return Uh.set(w,lh(Uh.get(w)||null,i,a,o,d,y)),!0;case"gotpointercapture":return w=y.pointerId,Nh.set(w,lh(Nh.get(w)||null,i,a,o,d,y)),!0}return!1}function Tw(i){var a=hc(i.target);if(a!==null){var o=jh(a);if(o!==null){if(a=o.tag,a===13){if(a=Xx(o),a!==null){i.blockedOn=a,oT(i.priority,function(){if(o.tag===13){var d=va();d=I_(d);var y=qc(o,d);y!==null&&xa(y,o,d),yy(o,d)}});return}}else if(a===3&&o.stateNode.current.memoizedState.isDehydrated){i.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Pf(i){if(i.blockedOn!==null)return!1;for(var a=i.targetContainers;0<a.length;){var o=x_(i.nativeEvent);if(o===null){o=i.nativeEvent;var d=new o.constructor(o.type,o);Fg=d,o.target.dispatchEvent(d),Fg=null}else return a=jc(o),a!==null&&ww(a),i.blockedOn=o,!1;a.shift()}return!0}function Mx(i,a,o){Pf(i)&&o.delete(a)}function mE(){b_=!1,ao!==null&&Pf(ao)&&(ao=null),ro!==null&&Pf(ro)&&(ro=null),so!==null&&Pf(so)&&(so=null),Uh.forEach(Mx),Nh.forEach(Mx)}function vf(i,a){i.blockedOn===a&&(i.blockedOn=null,b_||(b_=!0,ji.unstable_scheduleCallback(ji.unstable_NormalPriority,mE)))}var xf=null;function zx(i){xf!==i&&(xf=i,ji.unstable_scheduleCallback(ji.unstable_NormalPriority,function(){xf===i&&(xf=null);for(var a=0;a<i.length;a+=3){var o=i[a],d=i[a+1],y=i[a+2];if(typeof d!="function"){if(xy(d||o)===null)continue;break}var w=jc(o);w!==null&&(i.splice(a,3),a-=3,t_(w,{pending:!0,data:y,method:o.method,action:d},d,y))}}))}function Vh(i){function a(q){return vf(q,i)}ao!==null&&vf(ao,i),ro!==null&&vf(ro,i),so!==null&&vf(so,i),Uh.forEach(a),Nh.forEach(a);for(var o=0;o<$s.length;o++){var d=$s[o];d.blockedOn===i&&(d.blockedOn=null)}for(;0<$s.length&&(o=$s[0],o.blockedOn===null);)Tw(o),o.blockedOn===null&&$s.shift();if(o=(i.ownerDocument||i).$$reactFormReplay,o!=null)for(d=0;d<o.length;d+=3){var y=o[d],w=o[d+1],T=y[Qn]||null;if(typeof w=="function")T||zx(o);else if(T){var f=null;if(w&&w.hasAttribute("formAction")){if(y=w,T=w[Qn]||null)f=T.formAction;else if(xy(y)!==null)continue}else f=T.action;typeof f=="function"?o[d+1]=f:(o.splice(d,3),d-=3),zx(o)}}}function by(i){this._internalRoot=i}Cp.prototype.render=by.prototype.render=function(i){var a=this._internalRoot;if(a===null)throw Error(Tt(409));var o=a.current,d=va();bw(o,d,i,a,null,null)};Cp.prototype.unmount=by.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var a=i.containerInfo;bw(i.current,2,null,i,null,null),Ap(),a[Vc]=null}};function Cp(i){this._internalRoot=i}Cp.prototype.unstable_scheduleHydration=function(i){if(i){var a=a1();i={blockedOn:null,target:i,priority:a};for(var o=0;o<$s.length&&a!==0&&a<$s[o].priority;o++);$s.splice(o,0,i),o===0&&Tw(i)}};var Cx=Gx.version;if(Cx!=="19.1.0")throw Error(Tt(527,Cx,"19.1.0"));Ze.findDOMNode=function(i){var a=i._reactInternals;if(a===void 0)throw typeof i.render=="function"?Error(Tt(188)):(i=Object.keys(i).join(","),Error(Tt(268,i)));return i=GS(a),i=i!==null?$x(i):null,i=i===null?null:i.stateNode,i};var gE={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:he,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var bf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!bf.isDisabled&&bf.supportsFiber)try{qh=bf.inject(gE),_a=bf}catch{}}fp.createRoot=function(i,a){if(!Hx(i))throw Error(Tt(299));var o=!1,d="",y=vb,w=xb,T=bb,f=null;return a!=null&&(a.unstable_strictMode===!0&&(o=!0),a.identifierPrefix!==void 0&&(d=a.identifierPrefix),a.onUncaughtError!==void 0&&(y=a.onUncaughtError),a.onCaughtError!==void 0&&(w=a.onCaughtError),a.onRecoverableError!==void 0&&(T=a.onRecoverableError),a.unstable_transitionCallbacks!==void 0&&(f=a.unstable_transitionCallbacks)),a=vw(i,1,!1,null,null,o,d,y,w,T,f,null),i[Vc]=a.current,my(i),new by(a)};fp.hydrateRoot=function(i,a,o){if(!Hx(i))throw Error(Tt(299));var d=!1,y="",w=vb,T=xb,f=bb,q=null,ct=null;return o!=null&&(o.unstable_strictMode===!0&&(d=!0),o.identifierPrefix!==void 0&&(y=o.identifierPrefix),o.onUncaughtError!==void 0&&(w=o.onUncaughtError),o.onCaughtError!==void 0&&(T=o.onCaughtError),o.onRecoverableError!==void 0&&(f=o.onRecoverableError),o.unstable_transitionCallbacks!==void 0&&(q=o.unstable_transitionCallbacks),o.formState!==void 0&&(ct=o.formState)),a=vw(i,1,!0,a,o??null,d,y,w,T,f,q,ct),a.context=xw(null),o=a.current,d=va(),d=I_(d),y=to(d),y.callback=null,eo(o,y,d),o=d,a.current.lanes=o,Gh(a,o),vr(a),i[Vc]=a.current,my(i),new Cp(a)};fp.version="19.1.0";function Aw(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Aw)}catch(i){console.error(i)}}Aw(),Ux.exports=fp;var _E=Ux.exports;const yE=w_(_E);var Ew={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(i,a){(function(o,d){i.exports=d()})(xS,function(){var o={},d={};function y(T,f,q){if(d[T]=q,T==="index"){var ct="var sharedModule = {}; ("+d.shared+")(sharedModule); ("+d.worker+")(sharedModule);",vt={};return d.shared(vt),d.index(o,vt),typeof window<"u"&&o.setWorkerUrl(window.URL.createObjectURL(new Blob([ct],{type:"text/javascript"}))),o}}y("shared",["exports"],function(T){function f(n,e,r,l){return new(r||(r=Promise))(function(h,g){function _(E){try{b(l.next(E))}catch(M){g(M)}}function v(E){try{b(l.throw(E))}catch(M){g(M)}}function b(E){var M;E.done?h(E.value):(M=E.value,M instanceof r?M:new r(function(C){C(M)})).then(_,v)}b((l=l.apply(n,e||[])).next())})}function q(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}typeof SuppressedError=="function"&&SuppressedError;var ct=vt;function vt(n,e){this.x=n,this.y=e}vt.prototype={clone:function(){return new vt(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,e){return this.clone()._rotateAround(n,e)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var e=n.x-this.x,r=n.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult:function(n){var e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var e=Math.cos(n),r=Math.sin(n),l=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=l,this},_rotateAround:function(n,e){var r=Math.cos(n),l=Math.sin(n),h=e.y+l*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-l*(this.y-e.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},vt.convert=function(n){return n instanceof vt?n:Array.isArray(n)?new vt(n[0],n[1]):n};var tt=q(ct),V=pt;function pt(n,e,r,l){this.cx=3*n,this.bx=3*(r-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(l-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=e,this.p2x=r,this.p2y=l}pt.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,e){if(e===void 0&&(e=1e-6),n<0)return 0;if(n>1)return 1;for(var r=n,l=0;l<8;l++){var h=this.sampleCurveX(r)-n;if(Math.abs(h)<e)return r;var g=this.sampleCurveDerivativeX(r);if(Math.abs(g)<1e-6)break;r-=h/g}var _=0,v=1;for(r=n,l=0;l<20&&(h=this.sampleCurveX(r),!(Math.abs(h-n)<e));l++)n>h?_=r:v=r,r=.5*(v-_)+_;return r},solve:function(n,e){return this.sampleCurveY(this.solveCurveX(n,e))}};var Jt=q(V);let Xt,_e;function st(){return Xt==null&&(Xt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Xt}function nt(){if(_e==null&&(_e=!1,st())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let l=0;l<5*5;l++){const h=4*l;e.fillStyle=`rgb(${h},${h+1},${h+2})`,e.fillRect(l%5,Math.floor(l/5),1,1)}const r=e.getImageData(0,0,5,5).data;for(let l=0;l<5*5*4;l++)if(l%4!=3&&r[l]!==l){_e=!0;break}}}return _e||!1}function ut(n,e,r,l){const h=new Jt(n,e,r,l);return g=>h.solve(g)}const bt=ut(.25,.1,.25,1);function Ot(n,e,r){return Math.min(r,Math.max(e,n))}function ne(n,e,r){const l=r-e,h=((n-e)%l+l)%l+e;return h===e?r:h}function Nt(n,...e){for(const r of e)for(const l in r)n[l]=r[l];return n}let te=1;function Pe(n,e,r){const l={};for(const h in n)l[h]=e.call(this,n[h],h,n);return l}function ye(n,e,r){const l={};for(const h in n)e.call(this,n[h],h,n)&&(l[h]=n[h]);return l}function me(n){return Array.isArray(n)?n.map(me):typeof n=="object"&&n?Pe(n,me):n}const An={};function Ai(n){An[n]||(typeof console<"u"&&console.warn(n),An[n]=!0)}function Bi(n,e,r){return(r.y-n.y)*(e.x-n.x)>(e.y-n.y)*(r.x-n.x)}function En(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let qt=null;function le(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const fe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ue(n,e,r,l,h){return f(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const g=new VideoFrame(n,{timestamp:0});try{const _=g==null?void 0:g.format;if(!_||!_.startsWith("BGR")&&!_.startsWith("RGB"))throw new Error(`Unrecognized format ${_}`);const v=_.startsWith("BGR"),b=new Uint8ClampedArray(l*h*4);if(yield g.copyTo(b,function(E,M,C,k,L){const O=4*Math.max(-M,0),F=(Math.max(0,C)-C)*k*4+O,G=4*k,Y=Math.max(0,M),dt=Math.max(0,C);return{rect:{x:Y,y:dt,width:Math.min(E.width,M+k)-Y,height:Math.min(E.height,C+L)-dt},layout:[{offset:F,stride:G}]}}(n,e,r,l,h)),v)for(let E=0;E<b.length;E+=4){const M=b[E];b[E]=b[E+2],b[E+2]=M}return b}finally{g.close()}})}let Ge,Ei;const qi="AbortError";function wa(){return new Error(qi)}const Zi={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function an(n){return Zi.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const is="global-dispatcher";class Mn extends Error{constructor(e,r,l,h){super(`AJAXError: ${r} (${e}): ${l}`),this.status=e,this.statusText=r,this.url=l,this.body=h}}const Wn=()=>En(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,xr=function(n,e){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const l=an(n.url);if(l)return l(n,e);if(En(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:is},e)}if(!(/^file:/.test(r=n.url)||/^file:/.test(Wn())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(l,h){return f(this,void 0,void 0,function*(){const g=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,cache:l.cache,referrer:Wn(),signal:h.signal});l.type!=="json"||g.headers.has("Accept")||g.headers.set("Accept","application/json");const _=yield fetch(g);if(!_.ok){const E=yield _.blob();throw new Mn(_.status,_.statusText,l.url,E)}let v;v=l.type==="arrayBuffer"||l.type==="image"?_.arrayBuffer():l.type==="json"?_.json():_.text();const b=yield v;if(h.signal.aborted)throw wa();return{data:b,cacheControl:_.headers.get("Cache-Control"),expires:_.headers.get("Expires")}})}(n,e);if(En(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:is},e)}var r;return function(l,h){return new Promise((g,_)=>{var v;const b=new XMLHttpRequest;b.open(l.method||"GET",l.url,!0),l.type!=="arrayBuffer"&&l.type!=="image"||(b.responseType="arraybuffer");for(const E in l.headers)b.setRequestHeader(E,l.headers[E]);l.type==="json"&&(b.responseType="text",!((v=l.headers)===null||v===void 0)&&v.Accept||b.setRequestHeader("Accept","application/json")),b.withCredentials=l.credentials==="include",b.onerror=()=>{_(new Error(b.statusText))},b.onload=()=>{if(!h.signal.aborted)if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){let E=b.response;if(l.type==="json")try{E=JSON.parse(b.response)}catch(M){return void _(M)}g({data:E,cacheControl:b.getResponseHeader("Cache-Control"),expires:b.getResponseHeader("Expires")})}else{const E=new Blob([b.response],{type:b.getResponseHeader("Content-Type")});_(new Mn(b.status,b.statusText,l.url,E))}},h.signal.addEventListener("abort",()=>{b.abort(),_(wa())}),b.send(l.body)})}(n,e)};function br(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const e=new URL(n),r=window.location;return e.protocol===r.protocol&&e.host===r.host}function fo(n,e,r){r[n]&&r[n].indexOf(e)!==-1||(r[n]=r[n]||[],r[n].push(e))}function ja(n,e,r){if(r&&r[n]){const l=r[n].indexOf(e);l!==-1&&r[n].splice(l,1)}}class Wa{constructor(e,r={}){Nt(this,r),this.type=e}}class tr extends Wa{constructor(e,r={}){super("error",Nt({error:e},r))}}class ns{on(e,r){return this._listeners=this._listeners||{},fo(e,r,this._listeners),this}off(e,r){return ja(e,r,this._listeners),ja(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},fo(e,r,this._oneTimeListeners),this):new Promise(l=>this.once(e,l))}fire(e,r){typeof e=="string"&&(e=new Wa(e,r||{}));const l=e.type;if(this.listens(l)){e.target=this;const h=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const v of h)v.call(this,e);const g=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const v of g)ja(l,v,this._oneTimeListeners),v.call(this,e);const _=this._eventedParent;_&&(Nt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(e))}else e instanceof tr&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var gt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const wr=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function po(n,e){const r={};for(const l in n)l!=="ref"&&(r[l]=n[l]);return wr.forEach(l=>{l in e&&(r[l]=e[l])}),r}function ke(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(!ke(n[r],e[r]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const r in n)if(!ke(n[r],e[r]))return!1;return!0}return n===e}function oi(n,e){n.push(e)}function mo(n,e,r){oi(r,{command:"addSource",args:[n,e[n]]})}function er(n,e,r){oi(e,{command:"removeSource",args:[n]}),r[n]=!0}function qa(n,e,r,l){er(n,r,l),mo(n,e,r)}function as(n,e,r){let l;for(l in n[r])if(Object.prototype.hasOwnProperty.call(n[r],l)&&l!=="data"&&!ke(n[r][l],e[r][l]))return!1;for(l in e[r])if(Object.prototype.hasOwnProperty.call(e[r],l)&&l!=="data"&&!ke(n[r][l],e[r][l]))return!1;return!0}function Un(n,e,r,l,h,g){n=n||{},e=e||{};for(const _ in n)Object.prototype.hasOwnProperty.call(n,_)&&(ke(n[_],e[_])||r.push({command:g,args:[l,_,e[_],h]}));for(const _ in e)Object.prototype.hasOwnProperty.call(e,_)&&!Object.prototype.hasOwnProperty.call(n,_)&&(ke(n[_],e[_])||r.push({command:g,args:[l,_,e[_],h]}))}function go(n){return n.id}function _o(n,e){return n[e.id]=e,n}class Mt{constructor(e,r,l,h){this.message=(e?`${e}: `:"")+l,h&&(this.identifier=h),r!=null&&r.__line__&&(this.line=r.__line__)}}function Sa(n,...e){for(const r of e)for(const l in r)n[l]=r[l];return n}class rn extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Ta{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[l,h]of r)this.bindings[l]=h}concat(e){return new Ta(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const ir={kind:"null"},It={kind:"number"},pe={kind:"string"},ae={kind:"boolean"},pn={kind:"color"},ta={kind:"object"},ce={kind:"value"},Aa={kind:"collator"},Za={kind:"formatted"},nr={kind:"padding"},Ea={kind:"resolvedImage"},$={kind:"variableAnchorOffsetCollection"};function P(n,e){return{kind:"array",itemType:n,N:e}}function R(n){if(n.kind==="array"){const e=R(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const N=[ir,It,pe,ae,pn,Za,ta,P(ce),nr,Ea,$];function H(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!H(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const r of N)if(!H(r,e))return null}}return`Expected ${R(n)} but found ${R(e)} instead.`}function it(n,e){return e.some(r=>r.kind===n.kind)}function rt(n,e){return e.some(r=>r==="null"?n===null:r==="array"?Array.isArray(n):r==="object"?n&&!Array.isArray(n)&&typeof n=="object":r===typeof n)}function ht(n,e){return n.kind==="array"&&e.kind==="array"?n.itemType.kind===e.itemType.kind&&typeof n.N=="number":n.kind===e.kind}const J=.96422,yt=.82521,St=4/29,mt=6/29,zt=3*mt*mt,Qt=mt*mt*mt,Wt=Math.PI/180,Ee=180/Math.PI;function ue(n){return(n%=360)<0&&(n+=360),n}function Me([n,e,r,l]){let h,g;const _=xi((.2225045*(n=xe(n))+.7168786*(e=xe(e))+.0606169*(r=xe(r)))/1);n===e&&e===r?h=g=_:(h=xi((.4360747*n+.3850649*e+.1430804*r)/J),g=xi((.0139322*n+.0971045*e+.7141733*r)/yt));const v=116*_-16;return[v<0?0:v,500*(h-_),200*(_-g),l]}function xe(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function xi(n){return n>Qt?Math.pow(n,1/3):n/zt+St}function li([n,e,r,l]){let h=(n+16)/116,g=isNaN(e)?h:h+e/500,_=isNaN(r)?h:h-r/200;return h=1*Oe(h),g=J*Oe(g),_=yt*Oe(_),[ge(3.1338561*g-1.6168667*h-.4906146*_),ge(-.9787684*g+1.9161415*h+.033454*_),ge(.0719453*g-.2289914*h+1.4052427*_),l]}function ge(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function Oe(n){return n>mt?n*n*n:zt*(n-St)}function ai(n){return parseInt(n.padEnd(2,n),16)/255}function Di(n,e){return Oi(e?n/100:n,0,1)}function Oi(n,e,r){return Math.min(Math.max(e,n),r)}function sn(n){return!n.some(Number.isNaN)}const rs={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Fe{constructor(e,r,l,h=1,g=!0){this.r=e,this.g=r,this.b=l,this.a=h,g||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[e,r,l,h]))}static parse(e){if(e instanceof Fe)return e;if(typeof e!="string")return;const r=function(l){if((l=l.toLowerCase().trim())==="transparent")return[0,0,0,0];const h=rs[l];if(h){const[_,v,b]=h;return[_/255,v/255,b/255,1]}if(l.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(l)){const _=l.length<6?1:2;let v=1;return[ai(l.slice(v,v+=_)),ai(l.slice(v,v+=_)),ai(l.slice(v,v+=_)),ai(l.slice(v,v+_)||"ff")]}if(l.startsWith("rgb")){const _=l.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[v,b,E,M,C,k,L,O,F,G,Y,dt]=_,et=[M||" ",L||" ",G].join("");if(et==="  "||et==="  /"||et===",,"||et===",,,"){const lt=[E,k,F].join(""),_t=lt==="%%%"?100:lt===""?255:0;if(_t){const At=[Oi(+b/_t,0,1),Oi(+C/_t,0,1),Oi(+O/_t,0,1),Y?Di(+Y,dt):1];if(sn(At))return At}}return}}const g=l.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[_,v,b,E,M,C,k,L,O]=g,F=[b||" ",M||" ",k].join("");if(F==="  "||F==="  /"||F===",,"||F===",,,"){const G=[+v,Oi(+E,0,100),Oi(+C,0,100),L?Di(+L,O):1];if(sn(G))return function([Y,dt,et,lt]){function _t(At){const Ft=(At+Y/30)%12,ee=dt*Math.min(et,1-et);return et-ee*Math.max(-1,Math.min(Ft-3,9-Ft,1))}return Y=ue(Y),dt/=100,et/=100,[_t(0),_t(8),_t(4),lt]}(G)}}}(e);return r?new Fe(...r,!1):void 0}get rgb(){const{r:e,g:r,b:l,a:h}=this,g=h||1/0;return this.overwriteGetter("rgb",[e/g,r/g,l/g,h])}get hcl(){return this.overwriteGetter("hcl",function(e){const[r,l,h,g]=Me(e),_=Math.sqrt(l*l+h*h);return[Math.round(1e4*_)?ue(Math.atan2(h,l)*Ee):NaN,_,r,g]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Me(this.rgb))}overwriteGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}toString(){const[e,r,l,h]=this.rgb;return`rgba(${[e,r,l].map(g=>Math.round(255*g)).join(",")},${h})`}}Fe.black=new Fe(0,0,0,1),Fe.white=new Fe(1,1,1,1),Fe.transparent=new Fe(0,0,0,0),Fe.red=new Fe(1,0,0,1);class Xc{constructor(e,r,l){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class $c{constructor(e,r,l,h,g){this.text=e,this.image=r,this.scale=l,this.fontStack=h,this.textColor=g}}class zn{constructor(e){this.sections=e}static fromString(e){return new zn([new $c(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof zn?e:zn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class Cn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Cn)return e;if(typeof e=="number")return new Cn([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Cn(e)}}toString(){return JSON.stringify(this.values)}}const Dp=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Nn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Nn)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let r=0;r<e.length;r+=2){const l=e[r],h=e[r+1];if(typeof l!="string"||!Dp.has(l)||!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")return}return new Nn(e)}}toString(){return JSON.stringify(this.values)}}class Dn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Dn({name:e,available:!1}):null}}function ss(n,e,r,l){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[n,e,r,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[n,e,r,l]:[n,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Sr(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Fe||n instanceof Xc||n instanceof zn||n instanceof Cn||n instanceof Nn||n instanceof Dn)return!0;if(Array.isArray(n)){for(const e of n)if(!Sr(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!Sr(n[e]))return!1;return!0}return!1}function bi(n){if(n===null)return ir;if(typeof n=="string")return pe;if(typeof n=="boolean")return ae;if(typeof n=="number")return It;if(n instanceof Fe)return pn;if(n instanceof Xc)return Aa;if(n instanceof zn)return Za;if(n instanceof Cn)return nr;if(n instanceof Nn)return $;if(n instanceof Dn)return Ea;if(Array.isArray(n)){const e=n.length;let r;for(const l of n){const h=bi(l);if(r){if(r===h)continue;r=ce;break}r=h}return P(r||ce,e)}return ta}function yo(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof Fe||n instanceof zn||n instanceof Cn||n instanceof Nn||n instanceof Dn?n.toString():JSON.stringify(n)}class ea{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Sr(e[1]))return r.error("invalid value");const l=e[1];let h=bi(l);const g=r.expectedType;return h.kind!=="array"||h.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(h=g),new ea(h,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class _i{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const cl={string:pe,number:It,boolean:ae,object:ta};class ia{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let l,h=1;const g=e[0];if(g==="array"){let v,b;if(e.length>2){const E=e[1];if(typeof E!="string"||!(E in cl)||E==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);v=cl[E],h++}else v=ce;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);b=e[2],h++}l=P(v,b)}else{if(!cl[g])throw new Error(`Types doesn't contain name = ${g}`);l=cl[g]}const _=[];for(;h<e.length;h++){const v=r.parse(e[h],h,ce);if(!v)return null;_.push(v)}return new ia(l,_)}evaluate(e){for(let r=0;r<this.args.length;r++){const l=this.args[r].evaluate(e);if(!H(this.type,bi(l)))return l;if(r===this.args.length-1)throw new _i(`Expected value to be of type ${R(this.type)}, but found ${R(bi(l))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Yc={"to-boolean":ae,"to-color":pn,"to-number":It,"to-string":pe};class na{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const l=e[0];if(!Yc[l])throw new Error(`Can't parse ${l} as it is not part of the known types`);if((l==="to-boolean"||l==="to-string")&&e.length!==2)return r.error("Expected one argument.");const h=Yc[l],g=[];for(let _=1;_<e.length;_++){const v=r.parse(e[_],_,ce);if(!v)return null;g.push(v)}return new na(h,g)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let r,l;for(const h of this.args){if(r=h.evaluate(e),l=null,r instanceof Fe)return r;if(typeof r=="string"){const g=e.parseColor(r);if(g)return g}else if(Array.isArray(r)&&(l=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:ss(r[0],r[1],r[2],r[3]),!l))return new Fe(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new _i(l||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const l of this.args){r=l.evaluate(e);const h=Cn.parse(r);if(h)return h}throw new _i(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const l of this.args){r=l.evaluate(e);const h=Nn.parse(r);if(h)return h}throw new _i(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const l of this.args){if(r=l.evaluate(e),r===null)return 0;const h=Number(r);if(!isNaN(h))return h}throw new _i(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return zn.fromString(yo(this.args[0].evaluate(e)));case"resolvedImage":return Dn.fromString(yo(this.args[0].evaluate(e)));default:return yo(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Ip=["Unknown","Point","LineString","Polygon"];class ul{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ip[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=Fe.parse(e)),r}}class Tr{constructor(e,r,l=[],h,g=new Ta,_=[]){this.registry=e,this.path=l,this.key=l.map(v=>`[${v}]`).join(""),this.scope=g,this.errors=_,this.expectedType=h,this._isConstant=r}parse(e,r,l,h,g={}){return r?this.concat(r,l,h)._parse(e,g):this._parse(e,g)}_parse(e,r){function l(h,g,_){return _==="assert"?new ia(g,[h]):_==="coerce"?new na(g,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=e[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[h];if(g){let _=g.parse(e,this);if(!_)return null;if(this.expectedType){const v=this.expectedType,b=_.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||b.kind!=="value")if(v.kind!=="color"&&v.kind!=="formatted"&&v.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string")if(v.kind!=="padding"||b.kind!=="value"&&b.kind!=="number"&&b.kind!=="array")if(v.kind!=="variableAnchorOffsetCollection"||b.kind!=="value"&&b.kind!=="array"){if(this.checkSubtype(v,b))return null}else _=l(_,v,r.typeAnnotation||"coerce");else _=l(_,v,r.typeAnnotation||"coerce");else _=l(_,v,r.typeAnnotation||"coerce");else _=l(_,v,r.typeAnnotation||"assert")}if(!(_ instanceof ea)&&_.type.kind!=="resolvedImage"&&this._isConstant(_)){const v=new ul;try{_=new ea(_.type,_.evaluate(v))}catch(b){return this.error(b.message),null}}return _}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,l){const h=typeof e=="number"?this.path.concat(e):this.path,g=l?this.scope.concat(l):this.scope;return new Tr(this.registry,this._isConstant,h,r||null,g,this.errors)}error(e,...r){const l=`${this.key}${r.map(h=>`[${h}]`).join("")}`;this.errors.push(new rn(l,e))}checkSubtype(e,r){const l=H(e,r);return l&&this.error(l),l}}class ar{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let g=1;g<e.length-1;g+=2){const _=e[g];if(typeof _!="string")return r.error(`Expected string, but found ${typeof _} instead.`,g);if(/[^a-zA-Z0-9_]/.test(_))return r.error("Variable names must contain only alphanumeric characters or '_'.",g);const v=r.parse(e[g+1],g+1);if(!v)return null;l.push([_,v])}const h=r.parse(e[e.length-1],e.length-1,r.expectedType,l);return h?new ar(l,h):null}outputDefined(){return this.result.outputDefined()}}class Re{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const l=e[1];return r.scope.has(l)?new Re(l,r.scope.get(l)):r.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Kc{constructor(e,r,l){this.type=e,this.index=r,this.input=l}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,It),h=r.parse(e[2],2,P(r.expectedType||ce));return l&&h?new Kc(h.type.itemType,l,h):null}evaluate(e){const r=this.index.evaluate(e),l=this.input.evaluate(e);if(r<0)throw new _i(`Array index out of bounds: ${r} < 0.`);if(r>=l.length)throw new _i(`Array index out of bounds: ${r} > ${l.length-1}.`);if(r!==Math.floor(r))throw new _i(`Array index must be an integer, but found ${r} instead.`);return l[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Qc{constructor(e,r){this.type=ae,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,ce),h=r.parse(e[2],2,ce);return l&&h?it(l.type,[ae,pe,It,ir,ce])?new Qc(l,h):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${R(l.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!l)return!1;if(!rt(r,["boolean","string","number","null"]))throw new _i(`Expected first argument to be of type boolean, string, number or null, but found ${R(bi(r))} instead.`);if(!rt(l,["string","array"]))throw new _i(`Expected second argument to be of type array or string, but found ${R(bi(l))} instead.`);return l.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class os{constructor(e,r,l){this.type=It,this.needle=e,this.haystack=r,this.fromIndex=l}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,ce),h=r.parse(e[2],2,ce);if(!l||!h)return null;if(!it(l.type,[ae,pe,It,ir,ce]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${R(l.type)} instead`);if(e.length===4){const g=r.parse(e[3],3,It);return g?new os(l,h,g):null}return new os(l,h)}evaluate(e){const r=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!rt(r,["boolean","string","number","null"]))throw new _i(`Expected first argument to be of type boolean, string, number or null, but found ${R(bi(r))} instead.`);let h;if(this.fromIndex&&(h=this.fromIndex.evaluate(e)),rt(l,["string"])){const g=l.indexOf(r,h);return g===-1?-1:[...l.slice(0,g)].length}if(rt(l,["array"]))return l.indexOf(r,h);throw new _i(`Expected second argument to be of type array or string, but found ${R(bi(l))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Jc{constructor(e,r,l,h,g,_){this.inputType=e,this.type=r,this.input=l,this.cases=h,this.outputs=g,this.otherwise=_}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let l,h;r.expectedType&&r.expectedType.kind!=="value"&&(h=r.expectedType);const g={},_=[];for(let E=2;E<e.length-1;E+=2){let M=e[E];const C=e[E+1];Array.isArray(M)||(M=[M]);const k=r.concat(E);if(M.length===0)return k.error("Expected at least one branch label.");for(const O of M){if(typeof O!="number"&&typeof O!="string")return k.error("Branch labels must be numbers or strings.");if(typeof O=="number"&&Math.abs(O)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof O=="number"&&Math.floor(O)!==O)return k.error("Numeric branch labels must be integer values.");if(l){if(k.checkSubtype(l,bi(O)))return null}else l=bi(O);if(g[String(O)]!==void 0)return k.error("Branch labels must be unique.");g[String(O)]=_.length}const L=r.parse(C,E,h);if(!L)return null;h=h||L.type,_.push(L)}const v=r.parse(e[1],1,ce);if(!v)return null;const b=r.parse(e[e.length-1],e.length-1,h);return b?v.type.kind!=="value"&&r.concat(1).checkSubtype(l,v.type)?null:new Jc(l,h,v,g,_,b):null}evaluate(e){const r=this.input.evaluate(e);return(bi(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class hl{constructor(e,r,l){this.type=e,this.branches=r,this.otherwise=l}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const h=[];for(let _=1;_<e.length-1;_+=2){const v=r.parse(e[_],_,ae);if(!v)return null;const b=r.parse(e[_+1],_+1,l);if(!b)return null;h.push([v,b]),l=l||b.type}const g=r.parse(e[e.length-1],e.length-1,l);if(!g)return null;if(!l)throw new Error("Can't infer output type");return new hl(l,h,g)}evaluate(e){for(const[r,l]of this.branches)if(r.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,l]of this.branches)e(r),e(l);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class vo{constructor(e,r,l,h){this.type=e,this.input=r,this.beginIndex=l,this.endIndex=h}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,ce),h=r.parse(e[2],2,It);if(!l||!h)return null;if(!it(l.type,[P(ce),pe,ce]))return r.error(`Expected first argument to be of type array or string, but found ${R(l.type)} instead`);if(e.length===4){const g=r.parse(e[3],3,It);return g?new vo(l.type,l,h,g):null}return new vo(l.type,l,h)}evaluate(e){const r=this.input.evaluate(e),l=this.beginIndex.evaluate(e);let h;if(this.endIndex&&(h=this.endIndex.evaluate(e)),rt(r,["string"]))return[...r].slice(l,h).join("");if(rt(r,["array"]))return r.slice(l,h);throw new _i(`Expected first argument to be of type array or string, but found ${R(bi(r))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function dl(n,e){const r=n.length-1;let l,h,g=0,_=r,v=0;for(;g<=_;)if(v=Math.floor((g+_)/2),l=n[v],h=n[v+1],l<=e){if(v===r||e<h)return v;g=v+1}else{if(!(l>e))throw new _i("Input is not a number.");_=v-1}return 0}class ls{constructor(e,r,l){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[h,g]of l)this.labels.push(h),this.outputs.push(g)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const l=r.parse(e[1],1,It);if(!l)return null;const h=[];let g=null;r.expectedType&&r.expectedType.kind!=="value"&&(g=r.expectedType);for(let _=1;_<e.length;_+=2){const v=_===1?-1/0:e[_],b=e[_+1],E=_,M=_+1;if(typeof v!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(h.length&&h[h.length-1][0]>=v)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const C=r.parse(b,M,g);if(!C)return null;g=g||C.type,h.push([v,C])}return new ls(g,l,h)}evaluate(e){const r=this.labels,l=this.outputs;if(r.length===1)return l[0].evaluate(e);const h=this.input.evaluate(e);if(h<=r[0])return l[0].evaluate(e);const g=r.length;return h>=r[g-1]?l[g-1].evaluate(e):l[dl(r,h)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function ad(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var kp=rd;function rd(n,e,r,l){this.cx=3*n,this.bx=3*(r-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(l-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=e,this.p2x=r,this.p2y=l}rd.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,e){if(e===void 0&&(e=1e-6),n<0)return 0;if(n>1)return 1;for(var r=n,l=0;l<8;l++){var h=this.sampleCurveX(r)-n;if(Math.abs(h)<e)return r;var g=this.sampleCurveDerivativeX(r);if(Math.abs(g)<1e-6)break;r-=h/g}var _=0,v=1;for(r=n,l=0;l<20&&(h=this.sampleCurveX(r),!(Math.abs(h-n)<e));l++)n>h?_=r:v=r,r=.5*(v-_)+_;return r},solve:function(n,e){return this.sampleCurveY(this.solveCurveX(n,e))}};var Rp=ad(kp);function Ar(n,e,r){return n+r*(e-n)}function xo(n,e,r){return n.map((l,h)=>Ar(l,e[h],r))}const mn={number:Ar,color:function(n,e,r,l="rgb"){switch(l){case"rgb":{const[h,g,_,v]=xo(n.rgb,e.rgb,r);return new Fe(h,g,_,v,!1)}case"hcl":{const[h,g,_,v]=n.hcl,[b,E,M,C]=e.hcl;let k,L;if(isNaN(h)||isNaN(b))isNaN(h)?isNaN(b)?k=NaN:(k=b,_!==1&&_!==0||(L=E)):(k=h,M!==1&&M!==0||(L=g));else{let dt=b-h;b>h&&dt>180?dt-=360:b<h&&h-b>180&&(dt+=360),k=h+r*dt}const[O,F,G,Y]=function([dt,et,lt,_t]){return dt=isNaN(dt)?0:dt*Wt,li([lt,Math.cos(dt)*et,Math.sin(dt)*et,_t])}([k,L??Ar(g,E,r),Ar(_,M,r),Ar(v,C,r)]);return new Fe(O,F,G,Y,!1)}case"lab":{const[h,g,_,v]=li(xo(n.lab,e.lab,r));return new Fe(h,g,_,v,!1)}}},array:xo,padding:function(n,e,r){return new Cn(xo(n.values,e.values,r))},variableAnchorOffsetCollection:function(n,e,r){const l=n.values,h=e.values;if(l.length!==h.length)throw new _i(`Cannot interpolate values of different length. from: ${n.toString()}, to: ${e.toString()}`);const g=[];for(let _=0;_<l.length;_+=2){if(l[_]!==h[_])throw new _i(`Cannot interpolate values containing mismatched anchors. from[${_}]: ${l[_]}, to[${_}]: ${h[_]}`);g.push(l[_]);const[v,b]=l[_+1],[E,M]=h[_+1];g.push([Ar(v,E,r),Ar(b,M,r)])}return new Nn(g)}};class gn{constructor(e,r,l,h,g){this.type=e,this.operator=r,this.interpolation=l,this.input=h,this.labels=[],this.outputs=[];for(const[_,v]of g)this.labels.push(_),this.outputs.push(v)}static interpolationFactor(e,r,l,h){let g=0;if(e.name==="exponential")g=fl(r,e.base,l,h);else if(e.name==="linear")g=fl(r,1,l,h);else if(e.name==="cubic-bezier"){const _=e.controlPoints;g=new Rp(_[0],_[1],_[2],_[3]).solve(fl(r,1,l,h))}return g}static parse(e,r){let[l,h,g,..._]=e;if(!Array.isArray(h)||h.length===0)return r.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const E=h[1];if(typeof E!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:E}}else{if(h[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const E=h.slice(1);if(E.length!==4||E.some(M=>typeof M!="number"||M<0||M>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:E}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(g=r.parse(g,2,It),!g)return null;const v=[];let b=null;l==="interpolate-hcl"||l==="interpolate-lab"?b=pn:r.expectedType&&r.expectedType.kind!=="value"&&(b=r.expectedType);for(let E=0;E<_.length;E+=2){const M=_[E],C=_[E+1],k=E+3,L=E+4;if(typeof M!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(v.length&&v[v.length-1][0]>=M)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const O=r.parse(C,L,b);if(!O)return null;b=b||O.type,v.push([M,O])}return ht(b,It)||ht(b,pn)||ht(b,nr)||ht(b,$)||ht(b,P(It))?new gn(b,l,h,g,v):r.error(`Type ${R(b)} is not interpolatable.`)}evaluate(e){const r=this.labels,l=this.outputs;if(r.length===1)return l[0].evaluate(e);const h=this.input.evaluate(e);if(h<=r[0])return l[0].evaluate(e);const g=r.length;if(h>=r[g-1])return l[g-1].evaluate(e);const _=dl(r,h),v=gn.interpolationFactor(this.interpolation,h,r[_],r[_+1]),b=l[_].evaluate(e),E=l[_+1].evaluate(e);switch(this.operator){case"interpolate":return mn[this.type.kind](b,E,v);case"interpolate-hcl":return mn.color(b,E,v,"hcl");case"interpolate-lab":return mn.color(b,E,v,"lab")}}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function fl(n,e,r,l){const h=l-r,g=n-r;return h===0?0:e===1?g/h:(Math.pow(e,g)-1)/(Math.pow(e,h)-1)}class pl{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let l=null;const h=r.expectedType;h&&h.kind!=="value"&&(l=h);const g=[];for(const v of e.slice(1)){const b=r.parse(v,1+g.length,l,void 0,{typeAnnotation:"omit"});if(!b)return null;l=l||b.type,g.push(b)}if(!l)throw new Error("No output type");const _=h&&g.some(v=>H(h,v.type));return new pl(_?ce:l,g)}evaluate(e){let r,l=null,h=0;for(const g of this.args)if(h++,l=g.evaluate(e),l&&l instanceof Dn&&!l.available&&(r||(r=l.name),l=null,h===this.args.length&&(l=r)),l!==null)break;return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function ml(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function sd(n,e,r,l){return l.compare(e,r)===0}function cs(n,e,r){const l=n!=="=="&&n!=="!=";return class Mw{constructor(g,_,v){this.type=ae,this.lhs=g,this.rhs=_,this.collator=v,this.hasUntypedArgument=g.type.kind==="value"||_.type.kind==="value"}static parse(g,_){if(g.length!==3&&g.length!==4)return _.error("Expected two or three arguments.");const v=g[0];let b=_.parse(g[1],1,ce);if(!b)return null;if(!ml(v,b.type))return _.concat(1).error(`"${v}" comparisons are not supported for type '${R(b.type)}'.`);let E=_.parse(g[2],2,ce);if(!E)return null;if(!ml(v,E.type))return _.concat(2).error(`"${v}" comparisons are not supported for type '${R(E.type)}'.`);if(b.type.kind!==E.type.kind&&b.type.kind!=="value"&&E.type.kind!=="value")return _.error(`Cannot compare types '${R(b.type)}' and '${R(E.type)}'.`);l&&(b.type.kind==="value"&&E.type.kind!=="value"?b=new ia(E.type,[b]):b.type.kind!=="value"&&E.type.kind==="value"&&(E=new ia(b.type,[E])));let M=null;if(g.length===4){if(b.type.kind!=="string"&&E.type.kind!=="string"&&b.type.kind!=="value"&&E.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(M=_.parse(g[3],3,Aa),!M)return null}return new Mw(b,E,M)}evaluate(g){const _=this.lhs.evaluate(g),v=this.rhs.evaluate(g);if(l&&this.hasUntypedArgument){const b=bi(_),E=bi(v);if(b.kind!==E.kind||b.kind!=="string"&&b.kind!=="number")throw new _i(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${b.kind}, ${E.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const b=bi(_),E=bi(v);if(b.kind!=="string"||E.kind!=="string")return e(g,_,v)}return this.collator?r(g,_,v,this.collator.evaluate(g)):e(g,_,v)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}const Pp=cs("==",function(n,e,r){return e===r},sd),od=cs("!=",function(n,e,r){return e!==r},function(n,e,r,l){return!sd(0,e,r,l)}),ld=cs("<",function(n,e,r){return e<r},function(n,e,r,l){return l.compare(e,r)<0}),Lp=cs(">",function(n,e,r){return e>r},function(n,e,r,l){return l.compare(e,r)>0}),Bp=cs("<=",function(n,e,r){return e<=r},function(n,e,r,l){return l.compare(e,r)<=0}),cd=cs(">=",function(n,e,r){return e>=r},function(n,e,r,l){return l.compare(e,r)>=0});class bo{constructor(e,r,l){this.type=Aa,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return r.error("Collator options argument must be an object.");const h=r.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,ae);if(!h)return null;const g=r.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,ae);if(!g)return null;let _=null;return l.locale&&(_=r.parse(l.locale,1,pe),!_)?null:new bo(h,g,_)}evaluate(e){return new Xc(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class Wc{constructor(e,r,l,h,g){this.type=pe,this.number=e,this.locale=r,this.currency=l,this.minFractionDigits=h,this.maxFractionDigits=g}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const l=r.parse(e[1],1,It);if(!l)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return r.error("NumberFormat options argument must be an object.");let g=null;if(h.locale&&(g=r.parse(h.locale,1,pe),!g))return null;let _=null;if(h.currency&&(_=r.parse(h.currency,1,pe),!_))return null;let v=null;if(h["min-fraction-digits"]&&(v=r.parse(h["min-fraction-digits"],1,It),!v))return null;let b=null;return h["max-fraction-digits"]&&(b=r.parse(h["max-fraction-digits"],1,It),!b)?null:new Wc(l,g,_,v,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class gl{constructor(e){this.type=Za,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return r.error("First argument must be an image or text section.");const h=[];let g=!1;for(let _=1;_<=e.length-1;++_){const v=e[_];if(g&&typeof v=="object"&&!Array.isArray(v)){g=!1;let b=null;if(v["font-scale"]&&(b=r.parse(v["font-scale"],1,It),!b))return null;let E=null;if(v["text-font"]&&(E=r.parse(v["text-font"],1,P(pe)),!E))return null;let M=null;if(v["text-color"]&&(M=r.parse(v["text-color"],1,pn),!M))return null;const C=h[h.length-1];C.scale=b,C.font=E,C.textColor=M}else{const b=r.parse(e[_],1,ce);if(!b)return null;const E=b.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,h.push({content:b,scale:null,font:null,textColor:null})}}return new gl(h)}evaluate(e){return new zn(this.sections.map(r=>{const l=r.content.evaluate(e);return bi(l)===Ea?new $c("",l,null,null,null):new $c(yo(l),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}}class tu{constructor(e){this.type=Ea,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const l=r.parse(e[1],1,pe);return l?new tu(l):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),l=Dn.fromString(r);return l&&e.availableImages&&(l.available=e.availableImages.indexOf(r)>-1),l}eachChild(e){e(this.input)}outputDefined(){return!1}}class eu{constructor(e){this.type=It,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=r.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${R(l.type)} instead.`):new eu(l):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new _i(`Expected value to be of type string or array, but found ${R(bi(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Ma=8192;function Op(n,e){const r=(180+n[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(r*h*Ma),Math.round(l*h*Ma)]}function iu(n,e){const r=Math.pow(2,e.z);return[(h=(n[0]/Ma+e.x)/r,360*h-180),(l=(n[1]/Ma+e.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90)];var l,h}function Er(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function rr(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function Le(n,e,r){const l=n[0]-e[0],h=n[1]-e[1],g=n[0]-r[0],_=n[1]-r[1];return l*_-g*h==0&&l*g<=0&&h*_<=0}function _l(n,e,r,l){return(h=[l[0]-r[0],l[1]-r[1]])[0]*(g=[e[0]-n[0],e[1]-n[1]])[1]-h[1]*g[0]!=0&&!(!hd(n,e,r,l)||!hd(r,l,n,e));var h,g}function Fp(n,e,r){for(const l of r)for(let h=0;h<l.length-1;++h)if(_l(n,e,l[h],l[h+1]))return!0;return!1}function us(n,e,r=!1){let l=!1;for(const v of e)for(let b=0;b<v.length-1;b++){if(Le(n,v[b],v[b+1]))return r;(g=v[b])[1]>(h=n)[1]!=(_=v[b+1])[1]>h[1]&&h[0]<(_[0]-g[0])*(h[1]-g[1])/(_[1]-g[1])+g[0]&&(l=!l)}var h,g,_;return l}function Up(n,e){for(const r of e)if(us(n,r))return!0;return!1}function ud(n,e){for(const r of n)if(!us(r,e))return!1;for(let r=0;r<n.length-1;++r)if(Fp(n[r],n[r+1],e))return!1;return!0}function Np(n,e){for(const r of e)if(ud(n,r))return!0;return!1}function hd(n,e,r,l){const h=l[0]-r[0],g=l[1]-r[1],_=(n[0]-r[0])*g-h*(n[1]-r[1]),v=(e[0]-r[0])*g-h*(e[1]-r[1]);return _>0&&v<0||_<0&&v>0}function nu(n,e,r){const l=[];for(let h=0;h<n.length;h++){const g=[];for(let _=0;_<n[h].length;_++){const v=Op(n[h][_],r);Er(e,v),g.push(v)}l.push(g)}return l}function dd(n,e,r){const l=[];for(let h=0;h<n.length;h++){const g=nu(n[h],e,r);l.push(g)}return l}function fd(n,e,r,l){if(n[0]<r[0]||n[0]>r[2]){const h=.5*l;let g=n[0]-r[0]>h?-l:r[0]-n[0]>h?l:0;g===0&&(g=n[0]-r[2]>h?-l:r[2]-n[0]>h?l:0),n[0]+=g}Er(e,n)}function pd(n,e,r,l){const h=Math.pow(2,l.z)*Ma,g=[l.x*Ma,l.y*Ma],_=[];for(const v of n)for(const b of v){const E=[b.x+g[0],b.y+g[1]];fd(E,e,r,h),_.push(E)}return _}function md(n,e,r,l){const h=Math.pow(2,l.z)*Ma,g=[l.x*Ma,l.y*Ma],_=[];for(const b of n){const E=[];for(const M of b){const C=[M.x+g[0],M.y+g[1]];Er(e,C),E.push(C)}_.push(E)}if(e[2]-e[0]<=h/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const b of _)for(const E of b)fd(E,e,r,h)}var v;return _}class Mr{constructor(e,r){this.type=ae,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Sr(e[1])){const l=e[1];if(l.type==="FeatureCollection"){const h=[];for(const g of l.features){const{type:_,coordinates:v}=g.geometry;_==="Polygon"&&h.push(v),_==="MultiPolygon"&&h.push(...v)}if(h.length)return new Mr(l,{type:"MultiPolygon",coordinates:h})}else if(l.type==="Feature"){const h=l.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Mr(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new Mr(l,l)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,l){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(l.type==="Polygon"){const v=nu(l.coordinates,g,_),b=pd(r.geometry(),h,g,_);if(!rr(h,g))return!1;for(const E of b)if(!us(E,v))return!1}if(l.type==="MultiPolygon"){const v=dd(l.coordinates,g,_),b=pd(r.geometry(),h,g,_);if(!rr(h,g))return!1;for(const E of b)if(!Up(E,v))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,l){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(l.type==="Polygon"){const v=nu(l.coordinates,g,_),b=md(r.geometry(),h,g,_);if(!rr(h,g))return!1;for(const E of b)if(!ud(E,v))return!1}if(l.type==="MultiPolygon"){const v=dd(l.coordinates,g,_),b=md(r.geometry(),h,g,_);if(!rr(h,g))return!1;for(const E of b)if(!Np(E,v))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let gd=class{constructor(n=[],e=(r,l)=>r<l?-1:r>l?1:0){if(this.data=n,this.length=this.data.length,this.compare=e,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:e,compare:r}=this,l=e[n];for(;n>0;){const h=n-1>>1,g=e[h];if(r(l,g)>=0)break;e[n]=g,n=h}e[n]=l}_down(n){const{data:e,compare:r}=this,l=this.length>>1,h=e[n];for(;n<l;){let g=1+(n<<1);const _=g+1;if(_<this.length&&r(e[_],e[g])<0&&(g=_),r(e[g],h)>=0)break;e[n]=e[g],n=g}e[n]=h}};function Vp(n,e,r,l,h){_d(n,e,r,l||n.length-1,h||jp)}function _d(n,e,r,l,h){for(;l>r;){if(l-r>600){var g=l-r+1,_=e-r+1,v=Math.log(g),b=.5*Math.exp(2*v/3),E=.5*Math.sqrt(v*b*(g-b)/g)*(_-g/2<0?-1:1);_d(n,e,Math.max(r,Math.floor(e-_*b/g+E)),Math.min(l,Math.floor(e+(g-_)*b/g+E)),h)}var M=n[e],C=r,k=l;for(wo(n,r,e),h(n[l],M)>0&&wo(n,r,l);C<k;){for(wo(n,C,k),C++,k--;h(n[C],M)<0;)C++;for(;h(n[k],M)>0;)k--}h(n[r],M)===0?wo(n,r,k):wo(n,++k,l),k<=e&&(r=k+1),e<=k&&(l=k-1)}}function wo(n,e,r){var l=n[e];n[e]=n[r],n[r]=l}function jp(n,e){return n<e?-1:n>e?1:0}function yl(n,e){if(n.length<=1)return[n];const r=[];let l,h;for(const g of n){const _=Zp(g);_!==0&&(g.area=Math.abs(_),h===void 0&&(h=_<0),h===_<0?(l&&r.push(l),l=[g]):l.push(g))}if(l&&r.push(l),e>1)for(let g=0;g<r.length;g++)r[g].length<=e||(Vp(r[g],e,1,r[g].length-1,qp),r[g]=r[g].slice(0,e));return r}function qp(n,e){return e.area-n.area}function Zp(n){let e=0;for(let r,l,h=0,g=n.length,_=g-1;h<g;_=h++)r=n[h],l=n[_],e+=(l.x-r.x)*(r.y+l.y);return e}const yd=1/298.257223563,vd=yd*(2-yd),xd=Math.PI/180;class au{constructor(e){const r=6378.137*xd*1e3,l=Math.cos(e*xd),h=1/(1-vd*(1-l*l)),g=Math.sqrt(h);this.kx=r*g*l,this.ky=r*g*h*(1-vd)}distance(e,r){const l=this.wrap(e[0]-r[0])*this.kx,h=(e[1]-r[1])*this.ky;return Math.sqrt(l*l+h*h)}pointOnLine(e,r){let l,h,g,_,v=1/0;for(let b=0;b<e.length-1;b++){let E=e[b][0],M=e[b][1],C=this.wrap(e[b+1][0]-E)*this.kx,k=(e[b+1][1]-M)*this.ky,L=0;C===0&&k===0||(L=(this.wrap(r[0]-E)*this.kx*C+(r[1]-M)*this.ky*k)/(C*C+k*k),L>1?(E=e[b+1][0],M=e[b+1][1]):L>0&&(E+=C/this.kx*L,M+=k/this.ky*L)),C=this.wrap(r[0]-E)*this.kx,k=(r[1]-M)*this.ky;const O=C*C+k*k;O<v&&(v=O,l=E,h=M,g=b,_=L)}return{point:[l,h],index:g,t:Math.max(0,Math.min(1,_))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function bd(n,e){return e[0]-n[0]}function vl(n){return n[1]-n[0]+1}function Ga(n,e){return n[1]>=n[0]&&n[1]<e}function ru(n,e){if(n[0]>n[1])return[null,null];const r=vl(n);if(e){if(r===2)return[n,null];const h=Math.floor(r/2);return[[n[0],n[0]+h],[n[0]+h,n[1]]]}if(r===1)return[n,null];const l=Math.floor(r/2)-1;return[[n[0],n[0]+l],[n[0]+l+1,n[1]]]}function su(n,e){if(!Ga(e,n.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let l=e[0];l<=e[1];++l)Er(r,n[l]);return r}function ou(n){const e=[1/0,1/0,-1/0,-1/0];for(const r of n)for(const l of r)Er(e,l);return e}function xl(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function lu(n,e,r){if(!xl(n)||!xl(e))return NaN;let l=0,h=0;return n[2]<e[0]&&(l=e[0]-n[2]),n[0]>e[2]&&(l=n[0]-e[2]),n[1]>e[3]&&(h=n[1]-e[3]),n[3]<e[1]&&(h=e[1]-n[3]),r.distance([0,0],[l,h])}function zr(n,e,r){const l=r.pointOnLine(e,n);return r.distance(n,l.point)}function cu(n,e,r,l,h){const g=Math.min(zr(n,[r,l],h),zr(e,[r,l],h)),_=Math.min(zr(r,[n,e],h),zr(l,[n,e],h));return Math.min(g,_)}function Gp(n,e,r,l,h){if(!Ga(e,n.length)||!Ga(l,r.length))return 1/0;let g=1/0;for(let _=e[0];_<e[1];++_){const v=n[_],b=n[_+1];for(let E=l[0];E<l[1];++E){const M=r[E],C=r[E+1];if(_l(v,b,M,C))return 0;g=Math.min(g,cu(v,b,M,C,h))}}return g}function hi(n,e,r,l,h){if(!Ga(e,n.length)||!Ga(l,r.length))return NaN;let g=1/0;for(let _=e[0];_<=e[1];++_)for(let v=l[0];v<=l[1];++v)if(g=Math.min(g,h.distance(n[_],r[v])),g===0)return g;return g}function Hp(n,e,r){if(us(n,e,!0))return 0;let l=1/0;for(const h of e){const g=h[0],_=h[h.length-1];if(g!==_&&(l=Math.min(l,zr(n,[_,g],r)),l===0))return l;const v=r.pointOnLine(h,n);if(l=Math.min(l,r.distance(n,v.point)),l===0)return l}return l}function ve(n,e,r,l){if(!Ga(e,n.length))return NaN;for(let g=e[0];g<=e[1];++g)if(us(n[g],r,!0))return 0;let h=1/0;for(let g=e[0];g<e[1];++g){const _=n[g],v=n[g+1];for(const b of r)for(let E=0,M=b.length,C=M-1;E<M;C=E++){const k=b[C],L=b[E];if(_l(_,v,k,L))return 0;h=Math.min(h,cu(_,v,k,L,l))}}return h}function bl(n,e){for(const r of n)for(const l of r)if(us(l,e,!0))return!0;return!1}function Xe(n,e,r,l=1/0){const h=ou(n),g=ou(e);if(l!==1/0&&lu(h,g,r)>=l)return l;if(rr(h,g)){if(bl(n,e))return 0}else if(bl(e,n))return 0;let _=1/0;for(const v of n)for(let b=0,E=v.length,M=E-1;b<E;M=b++){const C=v[M],k=v[b];for(const L of e)for(let O=0,F=L.length,G=F-1;O<F;G=O++){const Y=L[G],dt=L[O];if(_l(C,k,Y,dt))return 0;_=Math.min(_,cu(C,k,Y,dt,r))}}return _}function Ne(n,e,r,l,h,g){if(!g)return;const _=lu(su(l,g),h,r);_<e&&n.push([_,g,[0,0]])}function Cr(n,e,r,l,h,g,_){if(!g||!_)return;const v=lu(su(l,g),su(h,_),r);v<e&&n.push([v,g,_])}function So(n,e,r,l,h=1/0){let g=Math.min(l.distance(n[0],r[0][0]),h);if(g===0)return g;const _=new gd([[0,[0,n.length-1],[0,0]]],bd),v=ou(r);for(;_.length>0;){const b=_.pop();if(b[0]>=g)continue;const E=b[1],M=e?50:100;if(vl(E)<=M){if(!Ga(E,n.length))return NaN;if(e){const C=ve(n,E,r,l);if(isNaN(C)||C===0)return C;g=Math.min(g,C)}else for(let C=E[0];C<=E[1];++C){const k=Hp(n[C],r,l);if(g=Math.min(g,k),g===0)return 0}}else{const C=ru(E,e);Ne(_,g,l,n,v,C[0]),Ne(_,g,l,n,v,C[1])}}return g}function To(n,e,r,l,h,g=1/0){let _=Math.min(g,h.distance(n[0],r[0]));if(_===0)return _;const v=new gd([[0,[0,n.length-1],[0,r.length-1]]],bd);for(;v.length>0;){const b=v.pop();if(b[0]>=_)continue;const E=b[1],M=b[2],C=e?50:100,k=l?50:100;if(vl(E)<=C&&vl(M)<=k){if(!Ga(E,n.length)&&Ga(M,r.length))return NaN;let L;if(e&&l)L=Gp(n,E,r,M,h),_=Math.min(_,L);else if(e&&!l){const O=n.slice(E[0],E[1]+1);for(let F=M[0];F<=M[1];++F)if(L=zr(r[F],O,h),_=Math.min(_,L),_===0)return _}else if(!e&&l){const O=r.slice(M[0],M[1]+1);for(let F=E[0];F<=E[1];++F)if(L=zr(n[F],O,h),_=Math.min(_,L),_===0)return _}else L=hi(n,E,r,M,h),_=Math.min(_,L)}else{const L=ru(E,e),O=ru(M,l);Cr(v,_,h,n,r,L[0],O[0]),Cr(v,_,h,n,r,L[0],O[1]),Cr(v,_,h,n,r,L[1],O[0]),Cr(v,_,h,n,r,L[1],O[1])}}return _}function uu(n){return n.type==="MultiPolygon"?n.coordinates.map(e=>({type:"Polygon",coordinates:e})):n.type==="MultiLineString"?n.coordinates.map(e=>({type:"LineString",coordinates:e})):n.type==="MultiPoint"?n.coordinates.map(e=>({type:"Point",coordinates:e})):[n]}class Dr{constructor(e,r){this.type=It,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Sr(e[1])){const l=e[1];if(l.type==="FeatureCollection")return new Dr(l,l.features.map(h=>uu(h.geometry)).flat());if(l.type==="Feature")return new Dr(l,uu(l.geometry));if("type"in l&&"coordinates"in l)return new Dr(l,uu(l))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,l){const h=r.geometry(),g=h.flat().map(b=>iu([b.x,b.y],r.canonical));if(h.length===0)return NaN;const _=new au(g[0][1]);let v=1/0;for(const b of l){switch(b.type){case"Point":v=Math.min(v,To(g,!1,[b.coordinates],!1,_,v));break;case"LineString":v=Math.min(v,To(g,!1,b.coordinates,!0,_,v));break;case"Polygon":v=Math.min(v,So(g,!1,b.coordinates,_,v))}if(v===0)return v}return v}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,l){const h=r.geometry(),g=h.flat().map(b=>iu([b.x,b.y],r.canonical));if(h.length===0)return NaN;const _=new au(g[0][1]);let v=1/0;for(const b of l){switch(b.type){case"Point":v=Math.min(v,To(g,!0,[b.coordinates],!1,_,v));break;case"LineString":v=Math.min(v,To(g,!0,b.coordinates,!0,_,v));break;case"Polygon":v=Math.min(v,So(g,!0,b.coordinates,_,v))}if(v===0)return v}return v}(e,this.geometries);if(e.geometryType()==="Polygon")return function(r,l){const h=r.geometry();if(h.length===0||h[0].length===0)return NaN;const g=yl(h,0).map(b=>b.map(E=>E.map(M=>iu([M.x,M.y],r.canonical)))),_=new au(g[0][0][0][1]);let v=1/0;for(const b of l)for(const E of g){switch(b.type){case"Point":v=Math.min(v,So([b.coordinates],!1,E,_,v));break;case"LineString":v=Math.min(v,So(b.coordinates,!0,E,_,v));break;case"Polygon":v=Math.min(v,Xe(E,b.coordinates,_,v))}if(v===0)return v}return v}(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const hs={"==":Pp,"!=":od,">":Lp,"<":ld,">=":cd,"<=":Bp,array:ia,at:Kc,boolean:ia,case:hl,coalesce:pl,collator:bo,format:gl,image:tu,in:Qc,"index-of":os,interpolate:gn,"interpolate-hcl":gn,"interpolate-lab":gn,length:eu,let:ar,literal:ea,match:Jc,number:ia,"number-format":Wc,object:ia,slice:vo,step:ls,string:ia,"to-boolean":na,"to-color":na,"to-number":na,"to-string":na,var:Re,within:Mr,distance:Dr};class Vn{constructor(e,r,l,h){this.name=e,this.type=r,this._evaluate=l,this.args=h}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const l=e[0],h=Vn.definitions[l];if(!h)return r.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(h)?h[0]:h.type,_=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=_.filter(([E])=>!Array.isArray(E)||E.length===e.length-1);let b=null;for(const[E,M]of v){b=new Tr(r.registry,Ao,r.path,null,r.scope);const C=[];let k=!1;for(let L=1;L<e.length;L++){const O=e[L],F=Array.isArray(E)?E[L-1]:E.type,G=b.parse(O,1+C.length,F);if(!G){k=!0;break}C.push(G)}if(!k)if(Array.isArray(E)&&E.length!==C.length)b.error(`Expected ${E.length} arguments, but found ${C.length} instead.`);else{for(let L=0;L<C.length;L++){const O=Array.isArray(E)?E[L]:E.type,F=C[L];b.concat(L+1).checkSubtype(O,F.type)}if(b.errors.length===0)return new Vn(l,g,M,C)}}if(v.length===1)r.errors.push(...b.errors);else{const E=(v.length?v:_).map(([C])=>{return k=C,Array.isArray(k)?`(${k.map(R).join(", ")})`:`(${R(k.type)}...)`;var k}).join(" | "),M=[];for(let C=1;C<e.length;C++){const k=r.parse(e[C],1+M.length);if(!k)return null;M.push(R(k.type))}r.error(`Expected arguments of type ${E}, but found (${M.join(", ")}) instead.`)}return null}static register(e,r){Vn.definitions=r;for(const l in r)e[l]=Vn}}function hu(n,[e,r,l,h]){e=e.evaluate(n),r=r.evaluate(n),l=l.evaluate(n);const g=h?h.evaluate(n):1,_=ss(e,r,l,g);if(_)throw new _i(_);return new Fe(e/255,r/255,l/255,g,!1)}function du(n,e){return n in e}function fu(n,e){const r=e[n];return r===void 0?null:r}function Ir(n){return{type:n}}function Ao(n){if(n instanceof Re)return Ao(n.boundExpression);if(n instanceof Vn&&n.name==="error"||n instanceof bo||n instanceof Mr||n instanceof Dr)return!1;const e=n instanceof na||n instanceof ia;let r=!0;return n.eachChild(l=>{r=e?r&&Ao(l):r&&l instanceof ea}),!!r&&Eo(n)&&Mo(n,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Eo(n){if(n instanceof Vn&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof Mr||n instanceof Dr)return!1;let e=!0;return n.eachChild(r=>{e&&!Eo(r)&&(e=!1)}),e}function ds(n){if(n instanceof Vn&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(r=>{e&&!ds(r)&&(e=!1)}),e}function Mo(n,e){if(n instanceof Vn&&e.indexOf(n.name)>=0)return!1;let r=!0;return n.eachChild(l=>{r&&!Mo(l,e)&&(r=!1)}),r}function wl(n){return{result:"success",value:n}}function fs(n){return{result:"error",value:n}}function ps(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function wd(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function pu(n){return!!n.expression&&n.expression.interpolated}function De(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function Sl(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function Xp(n){return n}function Sd(n,e){const r=e.type==="color",l=n.stops&&typeof n.stops[0][0]=="object",h=l||!(l||n.property!==void 0),g=n.type||(pu(e)?"exponential":"interval");if(r||e.type==="padding"){const M=r?Fe.parse:Cn.parse;(n=Sa({},n)).stops&&(n.stops=n.stops.map(C=>[C[0],M(C[1])])),n.default=M(n.default?n.default:e.default)}if(n.colorSpace&&(_=n.colorSpace)!=="rgb"&&_!=="hcl"&&_!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var _;let v,b,E;if(g==="exponential")v=Ad;else if(g==="interval")v=Tl;else if(g==="categorical"){v=Td,b=Object.create(null);for(const M of n.stops)b[M[0]]=M[1];E=typeof n.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);v=Ed}if(l){const M={},C=[];for(let O=0;O<n.stops.length;O++){const F=n.stops[O],G=F[0].zoom;M[G]===void 0&&(M[G]={zoom:G,type:n.type,property:n.property,default:n.default,stops:[]},C.push(G)),M[G].stops.push([F[0].value,F[1]])}const k=[];for(const O of C)k.push([M[O].zoom,Sd(M[O],e)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:gn.interpolationFactor.bind(void 0,L),zoomStops:k.map(O=>O[0]),evaluate:({zoom:O},F)=>Ad({stops:k,base:n.base},e,O).evaluate(O,F)}}if(h){const M=g==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:gn.interpolationFactor.bind(void 0,M),zoomStops:n.stops.map(C=>C[0]),evaluate:({zoom:C})=>v(n,e,C,b,E)}}return{kind:"source",evaluate(M,C){const k=C&&C.properties?C.properties[n.property]:void 0;return k===void 0?ms(n.default,e.default):v(n,e,k,b,E)}}}function ms(n,e,r){return n!==void 0?n:e!==void 0?e:r!==void 0?r:void 0}function Td(n,e,r,l,h){return ms(typeof r===h?l[r]:void 0,n.default,e.default)}function Tl(n,e,r){if(De(r)!=="number")return ms(n.default,e.default);const l=n.stops.length;if(l===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[l-1][0])return n.stops[l-1][1];const h=dl(n.stops.map(g=>g[0]),r);return n.stops[h][1]}function Ad(n,e,r){const l=n.base!==void 0?n.base:1;if(De(r)!=="number")return ms(n.default,e.default);const h=n.stops.length;if(h===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[h-1][0])return n.stops[h-1][1];const g=dl(n.stops.map(M=>M[0]),r),_=function(M,C,k,L){const O=L-k,F=M-k;return O===0?0:C===1?F/O:(Math.pow(C,F)-1)/(Math.pow(C,O)-1)}(r,l,n.stops[g][0],n.stops[g+1][0]),v=n.stops[g][1],b=n.stops[g+1][1],E=mn[e.type]||Xp;return typeof v.evaluate=="function"?{evaluate(...M){const C=v.evaluate.apply(void 0,M),k=b.evaluate.apply(void 0,M);if(C!==void 0&&k!==void 0)return E(C,k,_,n.colorSpace)}}:E(v,b,_,n.colorSpace)}function Ed(n,e,r){switch(e.type){case"color":r=Fe.parse(r);break;case"formatted":r=zn.fromString(r.toString());break;case"resolvedImage":r=Dn.fromString(r.toString());break;case"padding":r=Cn.parse(r);break;default:De(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return ms(r,n.default,e.default)}Vn.register(hs,{error:[{kind:"error"},[pe],(n,[e])=>{throw new _i(e.evaluate(n))}],typeof:[pe,[ce],(n,[e])=>R(bi(e.evaluate(n)))],"to-rgba":[P(It,4),[pn],(n,[e])=>{const[r,l,h,g]=e.evaluate(n).rgb;return[255*r,255*l,255*h,g]}],rgb:[pn,[It,It,It],hu],rgba:[pn,[It,It,It,It],hu],has:{type:ae,overloads:[[[pe],(n,[e])=>du(e.evaluate(n),n.properties())],[[pe,ta],(n,[e,r])=>du(e.evaluate(n),r.evaluate(n))]]},get:{type:ce,overloads:[[[pe],(n,[e])=>fu(e.evaluate(n),n.properties())],[[pe,ta],(n,[e,r])=>fu(e.evaluate(n),r.evaluate(n))]]},"feature-state":[ce,[pe],(n,[e])=>fu(e.evaluate(n),n.featureState||{})],properties:[ta,[],n=>n.properties()],"geometry-type":[pe,[],n=>n.geometryType()],id:[ce,[],n=>n.id()],zoom:[It,[],n=>n.globals.zoom],"heatmap-density":[It,[],n=>n.globals.heatmapDensity||0],"line-progress":[It,[],n=>n.globals.lineProgress||0],accumulated:[ce,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[It,Ir(It),(n,e)=>{let r=0;for(const l of e)r+=l.evaluate(n);return r}],"*":[It,Ir(It),(n,e)=>{let r=1;for(const l of e)r*=l.evaluate(n);return r}],"-":{type:It,overloads:[[[It,It],(n,[e,r])=>e.evaluate(n)-r.evaluate(n)],[[It],(n,[e])=>-e.evaluate(n)]]},"/":[It,[It,It],(n,[e,r])=>e.evaluate(n)/r.evaluate(n)],"%":[It,[It,It],(n,[e,r])=>e.evaluate(n)%r.evaluate(n)],ln2:[It,[],()=>Math.LN2],pi:[It,[],()=>Math.PI],e:[It,[],()=>Math.E],"^":[It,[It,It],(n,[e,r])=>Math.pow(e.evaluate(n),r.evaluate(n))],sqrt:[It,[It],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[It,[It],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[It,[It],(n,[e])=>Math.log(e.evaluate(n))],log2:[It,[It],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[It,[It],(n,[e])=>Math.sin(e.evaluate(n))],cos:[It,[It],(n,[e])=>Math.cos(e.evaluate(n))],tan:[It,[It],(n,[e])=>Math.tan(e.evaluate(n))],asin:[It,[It],(n,[e])=>Math.asin(e.evaluate(n))],acos:[It,[It],(n,[e])=>Math.acos(e.evaluate(n))],atan:[It,[It],(n,[e])=>Math.atan(e.evaluate(n))],min:[It,Ir(It),(n,e)=>Math.min(...e.map(r=>r.evaluate(n)))],max:[It,Ir(It),(n,e)=>Math.max(...e.map(r=>r.evaluate(n)))],abs:[It,[It],(n,[e])=>Math.abs(e.evaluate(n))],round:[It,[It],(n,[e])=>{const r=e.evaluate(n);return r<0?-Math.round(-r):Math.round(r)}],floor:[It,[It],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[It,[It],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[ae,[pe,ce],(n,[e,r])=>n.properties()[e.value]===r.value],"filter-id-==":[ae,[ce],(n,[e])=>n.id()===e.value],"filter-type-==":[ae,[pe],(n,[e])=>n.geometryType()===e.value],"filter-<":[ae,[pe,ce],(n,[e,r])=>{const l=n.properties()[e.value],h=r.value;return typeof l==typeof h&&l<h}],"filter-id-<":[ae,[ce],(n,[e])=>{const r=n.id(),l=e.value;return typeof r==typeof l&&r<l}],"filter->":[ae,[pe,ce],(n,[e,r])=>{const l=n.properties()[e.value],h=r.value;return typeof l==typeof h&&l>h}],"filter-id->":[ae,[ce],(n,[e])=>{const r=n.id(),l=e.value;return typeof r==typeof l&&r>l}],"filter-<=":[ae,[pe,ce],(n,[e,r])=>{const l=n.properties()[e.value],h=r.value;return typeof l==typeof h&&l<=h}],"filter-id-<=":[ae,[ce],(n,[e])=>{const r=n.id(),l=e.value;return typeof r==typeof l&&r<=l}],"filter->=":[ae,[pe,ce],(n,[e,r])=>{const l=n.properties()[e.value],h=r.value;return typeof l==typeof h&&l>=h}],"filter-id->=":[ae,[ce],(n,[e])=>{const r=n.id(),l=e.value;return typeof r==typeof l&&r>=l}],"filter-has":[ae,[ce],(n,[e])=>e.value in n.properties()],"filter-has-id":[ae,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[ae,[P(pe)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[ae,[P(ce)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[ae,[pe,P(ce)],(n,[e,r])=>r.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[ae,[pe,P(ce)],(n,[e,r])=>function(l,h,g,_){for(;g<=_;){const v=g+_>>1;if(h[v]===l)return!0;h[v]>l?_=v-1:g=v+1}return!1}(n.properties()[e.value],r.value,0,r.value.length-1)],all:{type:ae,overloads:[[[ae,ae],(n,[e,r])=>e.evaluate(n)&&r.evaluate(n)],[Ir(ae),(n,e)=>{for(const r of e)if(!r.evaluate(n))return!1;return!0}]]},any:{type:ae,overloads:[[[ae,ae],(n,[e,r])=>e.evaluate(n)||r.evaluate(n)],[Ir(ae),(n,e)=>{for(const r of e)if(r.evaluate(n))return!0;return!1}]]},"!":[ae,[ae],(n,[e])=>!e.evaluate(n)],"is-supported-script":[ae,[pe],(n,[e])=>{const r=n.globals&&n.globals.isSupportedScript;return!r||r(e.evaluate(n))}],upcase:[pe,[pe],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[pe,[pe],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[pe,Ir(ce),(n,e)=>e.map(r=>yo(r.evaluate(n))).join("")],"resolved-locale":[pe,[Aa],(n,[e])=>e.evaluate(n).resolvedLocale()]});class Al{constructor(e,r){var l;this.expression=e,this._warningHistory={},this._evaluator=new ul,this._defaultValue=r?(l=r).type==="color"&&Sl(l.default)?new Fe(0,0,0,0):l.type==="color"?Fe.parse(l.default)||null:l.type==="padding"?Cn.parse(l.default)||null:l.type==="variableAnchorOffsetCollection"?Nn.parse(l.default)||null:l.default===void 0?null:l.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,l,h,g,_){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=l,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_,this.expression.evaluate(this._evaluator)}evaluate(e,r,l,h,g,_){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=l||null,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new _i(`Expected value to be one of ${Object.keys(this._enumValues).map(b=>JSON.stringify(b)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function El(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in hs}function gs(n,e){const r=new Tr(hs,Ao,[],e?function(h){const g={color:pn,string:pe,number:It,enum:pe,boolean:ae,formatted:Za,padding:nr,resolvedImage:Ea,variableAnchorOffsetCollection:$};return h.type==="array"?P(g[h.value]||ce,h.length):g[h.type]}(e):void 0),l=r.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?wl(new Al(l,e)):fs(r.errors)}class _s{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!ds(r.expression)}evaluateWithoutErrorHandling(e,r,l,h,g,_){return this._styleExpression.evaluateWithoutErrorHandling(e,r,l,h,g,_)}evaluate(e,r,l,h,g,_){return this._styleExpression.evaluate(e,r,l,h,g,_)}}class ys{constructor(e,r,l,h){this.kind=e,this.zoomStops=l,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!ds(r.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,r,l,h,g,_){return this._styleExpression.evaluateWithoutErrorHandling(e,r,l,h,g,_)}evaluate(e,r,l,h,g,_){return this._styleExpression.evaluate(e,r,l,h,g,_)}interpolationFactor(e,r,l){return this.interpolationType?gn.interpolationFactor(this.interpolationType,e,r,l):0}}function mu(n,e){const r=gs(n,e);if(r.result==="error")return r;const l=r.value.expression,h=Eo(l);if(!h&&!ps(e))return fs([new rn("","data expressions not supported")]);const g=Mo(l,["zoom"]);if(!g&&!wd(e))return fs([new rn("","zoom expressions not supported")]);const _=zo(l);return _||g?_ instanceof rn?fs([_]):_ instanceof gn&&!pu(e)?fs([new rn("",'"interpolate" expressions cannot be used with this property')]):wl(_?new ys(h?"camera":"composite",r.value,_.labels,_ instanceof gn?_.interpolation:void 0):new _s(h?"constant":"source",r.value)):fs([new rn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class vs{constructor(e,r){this._parameters=e,this._specification=r,Sa(this,Sd(this._parameters,this._specification))}static deserialize(e){return new vs(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function zo(n){let e=null;if(n instanceof ar)e=zo(n.result);else if(n instanceof pl){for(const r of n.args)if(e=zo(r),e)break}else(n instanceof ls||n instanceof gn)&&n.input instanceof Vn&&n.input.name==="zoom"&&(e=n);return e instanceof rn||n.eachChild(r=>{const l=zo(r);l instanceof rn?e=l:!e&&l?e=new rn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&l&&e!==l&&(e=new rn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Ml(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!Ml(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const zl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function gu(n){if(n==null)return{filter:()=>!0,needGeometry:!1};Ml(n)||(n=Cl(n));const e=gs(n,zl);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,l,h)=>e.value.evaluate(r,l,{},h),needGeometry:Md(n)}}function $p(n,e){return n<e?-1:n>e?1:0}function Md(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(Md(n[e]))return!0;return!1}function Cl(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?_u(n[1],n[2],"=="):e==="!="?Gi(_u(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?_u(n[1],n[2],e):e==="any"?(r=n.slice(1),["any"].concat(r.map(Cl))):e==="all"?["all"].concat(n.slice(1).map(Cl)):e==="none"?["all"].concat(n.slice(1).map(Cl).map(Gi)):e==="in"?Co(n[1],n.slice(2)):e==="!in"?Gi(Co(n[1],n.slice(2))):e==="has"?Do(n[1]):e!=="!has"||Gi(Do(n[1]));var r}function _u(n,e,r){switch(n){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,n,e]}}function Co(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",n,["literal",e.sort($p)]]:["filter-in-small",n,["literal",e]]}}function Do(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Gi(n){return["!",n]}function kr(n){const e=typeof n;if(e==="number"||e==="boolean"||e==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let h="[";for(const g of n)h+=`${kr(g)},`;return`${h}]`}const r=Object.keys(n).sort();let l="{";for(let h=0;h<r.length;h++)l+=`${JSON.stringify(r[h])}:${kr(n[r[h]])},`;return`${l}}`}function zd(n){let e="";for(const r of wr)e+=`/${kr(n[r])}`;return e}function Cd(n){const e=n.value;return e?[new Mt(n.key,e,"constants have been deprecated as of v8")]:[]}function di(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function aa(n){if(Array.isArray(n))return n.map(aa);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const r in n)e[r]=aa(n[r]);return e}return di(n)}function In(n){const e=n.key,r=n.value,l=n.valueSpec||{},h=n.objectElementValidators||{},g=n.style,_=n.styleSpec,v=n.validateSpec;let b=[];const E=De(r);if(E!=="object")return[new Mt(e,r,`object expected, ${E} found`)];for(const M in r){const C=M.split(".")[0],k=l[C]||l["*"];let L;if(h[C])L=h[C];else if(l[C])L=v;else if(h["*"])L=h["*"];else{if(!l["*"]){b.push(new Mt(e,r[M],`unknown property "${M}"`));continue}L=v}b=b.concat(L({key:(e&&`${e}.`)+M,value:r[M],valueSpec:k,style:g,styleSpec:_,object:r,objectKey:M,validateSpec:v},r))}for(const M in l)h[M]||l[M].required&&l[M].default===void 0&&r[M]===void 0&&b.push(new Mt(e,r,`missing required property "${M}"`));return b}function Io(n){const e=n.value,r=n.valueSpec,l=n.style,h=n.styleSpec,g=n.key,_=n.arrayElementValidator||n.validateSpec;if(De(e)!=="array")return[new Mt(g,e,`array expected, ${De(e)} found`)];if(r.length&&e.length!==r.length)return[new Mt(g,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Mt(g,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let v={type:r.value,values:r.values};h.$version<7&&(v.function=r.function),De(r.value)==="object"&&(v=r.value);let b=[];for(let E=0;E<e.length;E++)b=b.concat(_({array:e,arrayIndex:E,value:e[E],valueSpec:v,validateSpec:n.validateSpec,style:l,styleSpec:h,key:`${g}[${E}]`}));return b}function yu(n){const e=n.key,r=n.value,l=n.valueSpec;let h=De(r);return h==="number"&&r!=r&&(h="NaN"),h!=="number"?[new Mt(e,r,`number expected, ${h} found`)]:"minimum"in l&&r<l.minimum?[new Mt(e,r,`${r} is less than the minimum value ${l.minimum}`)]:"maximum"in l&&r>l.maximum?[new Mt(e,r,`${r} is greater than the maximum value ${l.maximum}`)]:[]}function Dl(n){const e=n.valueSpec,r=di(n.value.type);let l,h,g,_={};const v=r!=="categorical"&&n.value.property===void 0,b=!v,E=De(n.value.stops)==="array"&&De(n.value.stops[0])==="array"&&De(n.value.stops[0][0])==="object",M=In({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(L){if(r==="identity")return[new Mt(L.key,L.value,'identity function may not have a "stops" property')];let O=[];const F=L.value;return O=O.concat(Io({key:L.key,value:F,valueSpec:L.valueSpec,validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec,arrayElementValidator:C})),De(F)==="array"&&F.length===0&&O.push(new Mt(L.key,F,"array must have at least one stop")),O},default:function(L){return L.validateSpec({key:L.key,value:L.value,valueSpec:e,validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec})}}});return r==="identity"&&v&&M.push(new Mt(n.key,n.value,'missing required property "property"')),r==="identity"||n.value.stops||M.push(new Mt(n.key,n.value,'missing required property "stops"')),r==="exponential"&&n.valueSpec.expression&&!pu(n.valueSpec)&&M.push(new Mt(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(b&&!ps(n.valueSpec)?M.push(new Mt(n.key,n.value,"property functions not supported")):v&&!wd(n.valueSpec)&&M.push(new Mt(n.key,n.value,"zoom functions not supported"))),r!=="categorical"&&!E||n.value.property!==void 0||M.push(new Mt(n.key,n.value,'"property" property is required')),M;function C(L){let O=[];const F=L.value,G=L.key;if(De(F)!=="array")return[new Mt(G,F,`array expected, ${De(F)} found`)];if(F.length!==2)return[new Mt(G,F,`array length 2 expected, length ${F.length} found`)];if(E){if(De(F[0])!=="object")return[new Mt(G,F,`object expected, ${De(F[0])} found`)];if(F[0].zoom===void 0)return[new Mt(G,F,"object stop key must have zoom")];if(F[0].value===void 0)return[new Mt(G,F,"object stop key must have value")];if(g&&g>di(F[0].zoom))return[new Mt(G,F[0].zoom,"stop zoom values must appear in ascending order")];di(F[0].zoom)!==g&&(g=di(F[0].zoom),h=void 0,_={}),O=O.concat(In({key:`${G}[0]`,value:F[0],valueSpec:{zoom:{}},validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec,objectElementValidators:{zoom:yu,value:k}}))}else O=O.concat(k({key:`${G}[0]`,value:F[0],valueSpec:{},validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec},F));return El(aa(F[1]))?O.concat([new Mt(`${G}[1]`,F[1],"expressions are not allowed in function stops.")]):O.concat(L.validateSpec({key:`${G}[1]`,value:F[1],valueSpec:e,validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec}))}function k(L,O){const F=De(L.value),G=di(L.value),Y=L.value!==null?L.value:O;if(l){if(F!==l)return[new Mt(L.key,Y,`${F} stop domain type must match previous stop domain type ${l}`)]}else l=F;if(F!=="number"&&F!=="string"&&F!=="boolean")return[new Mt(L.key,Y,"stop domain value must be a number, string, or boolean")];if(F!=="number"&&r!=="categorical"){let dt=`number expected, ${F} found`;return ps(e)&&r===void 0&&(dt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Mt(L.key,Y,dt)]}return r!=="categorical"||F!=="number"||isFinite(G)&&Math.floor(G)===G?r!=="categorical"&&F==="number"&&h!==void 0&&G<h?[new Mt(L.key,Y,"stop domain values must appear in ascending order")]:(h=G,r==="categorical"&&G in _?[new Mt(L.key,Y,"stop domain values must be unique")]:(_[G]=!0,[])):[new Mt(L.key,Y,`integer expected, found ${G}`)]}}function xs(n){const e=(n.expressionContext==="property"?mu:gs)(aa(n.value),n.valueSpec);if(e.result==="error")return e.value.map(l=>new Mt(`${n.key}${l.key}`,n.value,l.message));const r=e.value.expression||e.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!r.outputDefined())return[new Mt(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!ds(r))return[new Mt(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!ds(r))return[new Mt(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!Mo(r,["zoom","feature-state"]))return[new Mt(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!Eo(r))return[new Mt(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ha(n){const e=n.key,r=n.value,l=n.valueSpec,h=[];return Array.isArray(l.values)?l.values.indexOf(di(r))===-1&&h.push(new Mt(e,r,`expected one of [${l.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(l.values).indexOf(di(r))===-1&&h.push(new Mt(e,r,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(r)} found`)),h}function vu(n){return Ml(aa(n.value))?xs(Sa({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Il(n)}function Il(n){const e=n.value,r=n.key;if(De(e)!=="array")return[new Mt(r,e,`array expected, ${De(e)} found`)];const l=n.styleSpec;let h,g=[];if(e.length<1)return[new Mt(r,e,"filter array must have at least 1 element")];switch(g=g.concat(Ha({key:`${r}[0]`,value:e[0],valueSpec:l.filter_operator,style:n.style,styleSpec:n.styleSpec})),di(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&di(e[1])==="$type"&&g.push(new Mt(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&g.push(new Mt(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(h=De(e[1]),h!=="string"&&g.push(new Mt(`${r}[1]`,e[1],`string expected, ${h} found`)));for(let _=2;_<e.length;_++)h=De(e[_]),di(e[1])==="$type"?g=g.concat(Ha({key:`${r}[${_}]`,value:e[_],valueSpec:l.geometry_type,style:n.style,styleSpec:n.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&g.push(new Mt(`${r}[${_}]`,e[_],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let _=1;_<e.length;_++)g=g.concat(Il({key:`${r}[${_}]`,value:e[_],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":h=De(e[1]),e.length!==2?g.push(new Mt(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):h!=="string"&&g.push(new Mt(`${r}[1]`,e[1],`string expected, ${h} found`))}return g}function xu(n,e){const r=n.key,l=n.validateSpec,h=n.style,g=n.styleSpec,_=n.value,v=n.objectKey,b=g[`${e}_${n.layerType}`];if(!b)return[];const E=v.match(/^(.*)-transition$/);if(e==="paint"&&E&&b[E[1]]&&b[E[1]].transition)return l({key:r,value:_,valueSpec:g.transition,style:h,styleSpec:g});const M=n.valueSpec||b[v];if(!M)return[new Mt(r,_,`unknown property "${v}"`)];let C;if(De(_)==="string"&&ps(M)&&!M.tokens&&(C=/^{([^}]+)}$/.exec(_)))return[new Mt(r,_,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(C[1])} }\`.`)];const k=[];return n.layerType==="symbol"&&(v==="text-field"&&h&&!h.glyphs&&k.push(new Mt(r,_,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&Sl(aa(_))&&di(_.type)==="identity"&&k.push(new Mt(r,_,'"text-font" does not support identity functions'))),k.concat(l({key:n.key,value:_,valueSpec:M,style:h,styleSpec:g,expressionContext:"property",propertyType:e,propertyKey:v}))}function kl(n){return xu(n,"paint")}function bu(n){return xu(n,"layout")}function wu(n){let e=[];const r=n.value,l=n.key,h=n.style,g=n.styleSpec;r.type||r.ref||e.push(new Mt(l,r,'either "type" or "ref" is required'));let _=di(r.type);const v=di(r.ref);if(r.id){const b=di(r.id);for(let E=0;E<n.arrayIndex;E++){const M=h.layers[E];di(M.id)===b&&e.push(new Mt(l,r.id,`duplicate layer id "${r.id}", previously used at line ${M.id.__line__}`))}}if("ref"in r){let b;["type","source","source-layer","filter","layout"].forEach(E=>{E in r&&e.push(new Mt(l,r[E],`"${E}" is prohibited for ref layers`))}),h.layers.forEach(E=>{di(E.id)===v&&(b=E)}),b?b.ref?e.push(new Mt(l,r.ref,"ref cannot reference another ref layer")):_=di(b.type):e.push(new Mt(l,r.ref,`ref layer "${v}" not found`))}else if(_!=="background")if(r.source){const b=h.sources&&h.sources[r.source],E=b&&di(b.type);b?E==="vector"&&_==="raster"?e.push(new Mt(l,r.source,`layer "${r.id}" requires a raster source`)):E!=="raster-dem"&&_==="hillshade"?e.push(new Mt(l,r.source,`layer "${r.id}" requires a raster-dem source`)):E==="raster"&&_!=="raster"?e.push(new Mt(l,r.source,`layer "${r.id}" requires a vector source`)):E!=="vector"||r["source-layer"]?E==="raster-dem"&&_!=="hillshade"?e.push(new Mt(l,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):_!=="line"||!r.paint||!r.paint["line-gradient"]||E==="geojson"&&b.lineMetrics||e.push(new Mt(l,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Mt(l,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Mt(l,r.source,`source "${r.source}" not found`))}else e.push(new Mt(l,r,'missing required property "source"'));return e=e.concat(In({key:l,value:r,valueSpec:g.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${l}.type`,value:r.type,valueSpec:g.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:r,objectKey:"type"}),filter:vu,layout:b=>In({layer:r,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":E=>bu(Sa({layerType:_},E))}}),paint:b=>In({layer:r,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":E=>kl(Sa({layerType:_},E))}})}})),e}function Rr(n){const e=n.value,r=n.key,l=De(e);return l!=="string"?[new Mt(r,e,`string expected, ${l} found`)]:[]}const Rl={promoteId:function({key:n,value:e}){if(De(e)==="string")return Rr({key:n,value:e});{const r=[];for(const l in e)r.push(...Rr({key:`${n}.${l}`,value:e[l]}));return r}}};function ko(n){const e=n.value,r=n.key,l=n.styleSpec,h=n.style,g=n.validateSpec;if(!e.type)return[new Mt(r,e,'"type" is required')];const _=di(e.type);let v;switch(_){case"vector":case"raster":return v=In({key:r,value:e,valueSpec:l[`source_${_.replace("-","_")}`],style:n.style,styleSpec:l,objectElementValidators:Rl,validateSpec:g}),v;case"raster-dem":return v=function(b){var E;const M=(E=b.sourceName)!==null&&E!==void 0?E:"",C=b.value,k=b.styleSpec,L=k.source_raster_dem,O=b.style;let F=[];const G=De(C);if(C===void 0)return F;if(G!=="object")return F.push(new Mt("source_raster_dem",C,`object expected, ${G} found`)),F;const Y=di(C.encoding)==="custom",dt=["redFactor","greenFactor","blueFactor","baseShift"],et=b.value.encoding?`"${b.value.encoding}"`:"Default";for(const lt in C)!Y&&dt.includes(lt)?F.push(new Mt(lt,C[lt],`In "${M}": "${lt}" is only valid when "encoding" is set to "custom". ${et} encoding found`)):L[lt]?F=F.concat(b.validateSpec({key:lt,value:C[lt],valueSpec:L[lt],validateSpec:b.validateSpec,style:O,styleSpec:k})):F.push(new Mt(lt,C[lt],`unknown property "${lt}"`));return F}({sourceName:r,value:e,style:n.style,styleSpec:l,validateSpec:g}),v;case"geojson":if(v=In({key:r,value:e,valueSpec:l.source_geojson,style:h,styleSpec:l,validateSpec:g,objectElementValidators:Rl}),e.cluster)for(const b in e.clusterProperties){const[E,M]=e.clusterProperties[b],C=typeof E=="string"?[E,["accumulated"],["get",b]]:E;v.push(...xs({key:`${r}.${b}.map`,value:M,validateSpec:g,expressionContext:"cluster-map"})),v.push(...xs({key:`${r}.${b}.reduce`,value:C,validateSpec:g,expressionContext:"cluster-reduce"}))}return v;case"video":return In({key:r,value:e,valueSpec:l.source_video,style:h,validateSpec:g,styleSpec:l});case"image":return In({key:r,value:e,valueSpec:l.source_image,style:h,validateSpec:g,styleSpec:l});case"canvas":return[new Mt(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ha({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:h,validateSpec:g,styleSpec:l})}}function Su(n){const e=n.value,r=n.styleSpec,l=r.light,h=n.style;let g=[];const _=De(e);if(e===void 0)return g;if(_!=="object")return g=g.concat([new Mt("light",e,`object expected, ${_} found`)]),g;for(const v in e){const b=v.match(/^(.*)-transition$/);g=g.concat(b&&l[b[1]]&&l[b[1]].transition?n.validateSpec({key:v,value:e[v],valueSpec:r.transition,validateSpec:n.validateSpec,style:h,styleSpec:r}):l[v]?n.validateSpec({key:v,value:e[v],valueSpec:l[v],validateSpec:n.validateSpec,style:h,styleSpec:r}):[new Mt(v,e[v],`unknown property "${v}"`)])}return g}function Tu(n){const e=n.value,r=n.styleSpec,l=r.sky,h=n.style,g=De(e);if(e===void 0)return[];if(g!=="object")return[new Mt("sky",e,`object expected, ${g} found`)];let _=[];for(const v in e)_=_.concat(l[v]?n.validateSpec({key:v,value:e[v],valueSpec:l[v],style:h,styleSpec:r}):[new Mt(v,e[v],`unknown property "${v}"`)]);return _}function Au(n){const e=n.value,r=n.styleSpec,l=r.terrain,h=n.style;let g=[];const _=De(e);if(e===void 0)return g;if(_!=="object")return g=g.concat([new Mt("terrain",e,`object expected, ${_} found`)]),g;for(const v in e)g=g.concat(l[v]?n.validateSpec({key:v,value:e[v],valueSpec:l[v],validateSpec:n.validateSpec,style:h,styleSpec:r}):[new Mt(v,e[v],`unknown property "${v}"`)]);return g}function Eu(n){let e=[];const r=n.value,l=n.key;if(Array.isArray(r)){const h=[],g=[];for(const _ in r)r[_].id&&h.includes(r[_].id)&&e.push(new Mt(l,r,`all the sprites' ids must be unique, but ${r[_].id} is duplicated`)),h.push(r[_].id),r[_].url&&g.includes(r[_].url)&&e.push(new Mt(l,r,`all the sprites' URLs must be unique, but ${r[_].url} is duplicated`)),g.push(r[_].url),e=e.concat(In({key:`${l}[${_}]`,value:r[_],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return e}return Rr({key:l,value:r})}const Pl={"*":()=>[],array:Io,boolean:function(n){const e=n.value,r=n.key,l=De(e);return l!=="boolean"?[new Mt(r,e,`boolean expected, ${l} found`)]:[]},number:yu,color:function(n){const e=n.key,r=n.value,l=De(r);return l!=="string"?[new Mt(e,r,`color expected, ${l} found`)]:Fe.parse(String(r))?[]:[new Mt(e,r,`color expected, "${r}" found`)]},constants:Cd,enum:Ha,filter:vu,function:Dl,layer:wu,object:In,source:ko,light:Su,sky:Tu,terrain:Au,projection:function(n){const e=n.value,r=n.styleSpec,l=r.projection,h=n.style,g=De(e);if(e===void 0)return[];if(g!=="object")return[new Mt("projection",e,`object expected, ${g} found`)];let _=[];for(const v in e)_=_.concat(l[v]?n.validateSpec({key:v,value:e[v],valueSpec:l[v],style:h,styleSpec:r}):[new Mt(v,e[v],`unknown property "${v}"`)]);return _},string:Rr,formatted:function(n){return Rr(n).length===0?[]:xs(n)},resolvedImage:function(n){return Rr(n).length===0?[]:xs(n)},padding:function(n){const e=n.key,r=n.value;if(De(r)==="array"){if(r.length<1||r.length>4)return[new Mt(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const l={type:"number"};let h=[];for(let g=0;g<r.length;g++)h=h.concat(n.validateSpec({key:`${e}[${g}]`,value:r[g],validateSpec:n.validateSpec,valueSpec:l}));return h}return yu({key:e,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(n){const e=n.key,r=n.value,l=De(r),h=n.styleSpec;if(l!=="array"||r.length<1||r.length%2!=0)return[new Mt(e,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let g=[];for(let _=0;_<r.length;_+=2)g=g.concat(Ha({key:`${e}[${_}]`,value:r[_],valueSpec:h.layout_symbol["text-anchor"]})),g=g.concat(Io({key:`${e}[${_+1}]`,value:r[_+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:h}));return g},sprite:Eu};function bs(n){const e=n.value,r=n.valueSpec,l=n.styleSpec;return n.validateSpec=bs,r.expression&&Sl(di(e))?Dl(n):r.expression&&El(aa(e))?xs(n):r.type&&Pl[r.type]?Pl[r.type](n):In(Sa({},n,{valueSpec:r.type?l[r.type]:r}))}function Dd(n){const e=n.value,r=n.key,l=Rr(n);return l.length||(e.indexOf("{fontstack}")===-1&&l.push(new Mt(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&l.push(new Mt(r,e,'"glyphs" url must include a "{range}" token'))),l}function jn(n,e=gt){let r=[];return r=r.concat(bs({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,validateSpec:bs,objectElementValidators:{glyphs:Dd,"*":()=>[]}})),n.constants&&(r=r.concat(Cd({key:"constants",value:n.constants,style:n,styleSpec:e,validateSpec:bs}))),Mu(r)}function za(n){return function(e){return n({...e,validateSpec:bs})}}function Mu(n){return[].concat(n).sort((e,r)=>e.line-r.line)}function ra(n){return function(...e){return Mu(n.apply(this,e))}}jn.source=ra(za(ko)),jn.sprite=ra(za(Eu)),jn.glyphs=ra(za(Dd)),jn.light=ra(za(Su)),jn.sky=ra(za(Tu)),jn.terrain=ra(za(Au)),jn.layer=ra(za(wu)),jn.filter=ra(za(vu)),jn.paintProperty=ra(za(kl)),jn.layoutProperty=ra(za(bu));const Pr=jn,Yp=Pr.light,Kp=Pr.sky,Id=Pr.paintProperty,kd=Pr.layoutProperty;function zu(n,e){let r=!1;if(e&&e.length)for(const l of e)n.fire(new tr(new Error(l.message))),r=!0;return r}class ws{constructor(e,r,l){const h=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const _=new Int32Array(this.arrayBuffer);e=_[0],this.d=(r=_[1])+2*(l=_[2]);for(let b=0;b<this.d*this.d;b++){const E=_[3+b],M=_[3+b+1];h.push(E===M?null:_.subarray(E,M))}const v=_[3+h.length+1];this.keys=_.subarray(_[3+h.length],v),this.bboxes=_.subarray(v),this.insert=this._insertReadonly}else{this.d=r+2*l;for(let _=0;_<this.d*this.d;_++)h.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=l,this.scale=r/e,this.uid=0;const g=l/r*e;this.min=-g,this.max=e+g}insert(e,r,l,h,g){this._forEachCell(r,l,h,g,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(g)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,l,h,g,_){this.cells[g].push(_)}query(e,r,l,h,g){const _=this.min,v=this.max;if(e<=_&&r<=_&&v<=l&&v<=h&&!g)return Array.prototype.slice.call(this.keys);{const b=[];return this._forEachCell(e,r,l,h,this._queryCell,b,{},g),b}}_queryCell(e,r,l,h,g,_,v,b){const E=this.cells[g];if(E!==null){const M=this.keys,C=this.bboxes;for(let k=0;k<E.length;k++){const L=E[k];if(v[L]===void 0){const O=4*L;(b?b(C[O+0],C[O+1],C[O+2],C[O+3]):e<=C[O+2]&&r<=C[O+3]&&l>=C[O+0]&&h>=C[O+1])?(v[L]=!0,_.push(M[L])):v[L]=!1}}}}_forEachCell(e,r,l,h,g,_,v,b){const E=this._convertToCellCoord(e),M=this._convertToCellCoord(r),C=this._convertToCellCoord(l),k=this._convertToCellCoord(h);for(let L=E;L<=C;L++)for(let O=M;O<=k;O++){const F=this.d*O+L;if((!b||b(this._convertFromCellCoord(L),this._convertFromCellCoord(O),this._convertFromCellCoord(L+1),this._convertFromCellCoord(O+1)))&&g.call(this,e,r,l,h,F,_,v,b))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let l=0;for(let _=0;_<this.cells.length;_++)l+=this.cells[_].length;const h=new Int32Array(r+l+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;let g=r;for(let _=0;_<e.length;_++){const v=e[_];h[3+_]=g,h.set(v,g),g+=v.length}return h[3+e.length]=g,h.set(this.keys,g),g+=this.keys.length,h[3+e.length+1]=g,h.set(this.bboxes,g),g+=this.bboxes.length,h.buffer}static serialize(e,r){const l=e.toArrayBuffer();return r&&r.push(l),{buffer:l}}static deserialize(e){return new ws(e.buffer)}}const qn={};function jt(n,e,r={}){if(qn[n])throw new Error(`${n} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:n,writeable:!1}),qn[n]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}jt("Object",Object),jt("TransferableGridIndex",ws),jt("Color",Fe),jt("Error",Error),jt("AJAXError",Mn),jt("ResolvedImage",Dn),jt("StylePropertyFunction",vs),jt("StyleExpression",Al,{omit:["_evaluator"]}),jt("ZoomDependentExpression",ys),jt("ZoomConstantExpression",_s),jt("CompoundExpression",Vn,{omit:["_evaluate"]});for(const n in hs)hs[n]._classRegistryKey||jt(`Expression_${n}`,hs[n]);function Ll(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Cu(n){return n.$name||n.constructor._classRegistryKey}function Rd(n){return!function(e){if(e===null||typeof e!="object")return!1;const r=Cu(e);return!(!r||r==="Object")}(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||Ll(n)||le(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function Ss(n,e){if(Rd(n))return(Ll(n)||le(n))&&e&&e.push(n),ArrayBuffer.isView(n)&&e&&e.push(n.buffer),n instanceof ImageData&&e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const g=[];for(const _ of n)g.push(Ss(_,e));return g}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const r=Cu(n);if(!r)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!qn[r])throw new Error(`${r} is not registered.`);const{klass:l}=qn[r],h=l.serialize?l.serialize(n,e):{};if(l.serialize){if(e&&h===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const g in n){if(!n.hasOwnProperty(g)||qn[r].omit.indexOf(g)>=0)continue;const _=n[g];h[g]=qn[r].shallow.indexOf(g)>=0?_:Ss(_,e)}n instanceof Error&&(h.message=n.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(h.$name=r),h}function Ts(n){if(Rd(n))return n;if(Array.isArray(n))return n.map(Ts);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const e=Cu(n)||"Object";if(!qn[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=qn[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(n);const l=Object.create(r.prototype);for(const h of Object.keys(n)){if(h==="$name")continue;const g=n[h];l[h]=qn[e].shallow.indexOf(h)>=0?g:Ts(g)}return l}class Du{constructor(){this.first=!0}update(e,r){const l=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=l,!0))}}const we={"Latin-1 Supplement":n=>n>=128&&n<=255,"Hangul Jamo":n=>n>=4352&&n<=4607,Khmer:n=>n>=6016&&n<=6143,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Katakana:n=>n>=12448&&n<=12543,Kanbun:n=>n>=12688&&n<=12703,"CJK Strokes":n=>n>=12736&&n<=12783,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"Private Use Area":n=>n>=57344&&n<=63743,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function Iu(n){for(const e of n)if(Ru(e.charCodeAt(0)))return!0;return!1}function Qp(n){for(const e of n)if(!As(e.charCodeAt(0)))return!1;return!0}function ku(n){const e=n.map(r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}}).filter(r=>r);return new RegExp(e.join("|"),"u")}const Jp=ku(["Arab","Dupl","Mong","Ougr","Syrc"]);function As(n){return!Jp.test(String.fromCodePoint(n))}const Pd=ku(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Ru(n){return!(n!==746&&n!==747&&(n<4352||!(we["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||we["CJK Compatibility"](n)||we["CJK Strokes"](n)||!(!we["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||we["Enclosed CJK Letters and Months"](n)||we["Ideographic Description Characters"](n)||we.Kanbun(n)||we.Katakana(n)&&n!==12540||!(!we["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!we["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||we["Vertical Forms"](n)||we["Yijing Hexagram Symbols"](n)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(n))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(n))||Pd.test(String.fromCodePoint(n)))))}function Ld(n){return!(Ru(n)||function(e){return!!(we["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||we["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||we["Letterlike Symbols"](e)||we["Number Forms"](e)||we["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||we["Control Pictures"](e)&&e!==9251||we["Optical Character Recognition"](e)||we["Enclosed Alphanumerics"](e)||we["Geometric Shapes"](e)||we["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||we["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||we["CJK Symbols and Punctuation"](e)||we.Katakana(e)||we["Private Use Area"](e)||we["CJK Compatibility Forms"](e)||we["Small Form Variants"](e)||we["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(n))}const Wp=ku(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Pu(n){return Wp.test(String.fromCodePoint(n))}function tm(n,e){return!(!e&&Pu(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||we.Khmer(n))}function em(n){for(const e of n)if(Pu(e.charCodeAt(0)))return!0;return!1}const kn=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Qe{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Du,this.transition={})}isSupportedScript(e){return function(r,l){for(const h of r)if(!tm(h.charCodeAt(0),l))return!1;return!0}(e,kn.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),l=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*r}}}class Es{constructor(e,r){this.property=e,this.value=r,this.expression=function(l,h){if(Sl(l))return new vs(l,h);if(El(l)){const g=mu(l,h);if(g.result==="error")throw new Error(g.value.map(_=>`${_.key}: ${_.message}`).join(", "));return g.value}{let g=l;return h.type==="color"&&typeof l=="string"?g=Fe.parse(l):h.type!=="padding"||typeof l!="number"&&!Array.isArray(l)?h.type==="variableAnchorOffsetCollection"&&Array.isArray(l)&&(g=Nn.parse(l)):g=Cn.parse(l),{kind:"constant",evaluate:()=>g}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,l){return this.property.possiblyEvaluate(this,e,r,l)}}class Bl{constructor(e){this.property=e,this.value=new Es(e,void 0)}transitioned(e,r){return new Bd(this.property,this.value,r,Nt({},e.transition,this.transition),e.now)}untransitioned(){return new Bd(this.property,this.value,null,{},0)}}class Ol{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return me(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Bl(this._values[e].property)),this._values[e].value=new Es(this._values[e].property,r===null?void 0:me(r))}getTransition(e){return me(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Bl(this._values[e].property)),this._values[e].transition=me(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const l=this.getValue(r);l!==void 0&&(e[r]=l);const h=this.getTransition(r);h!==void 0&&(e[`${r}-transition`]=h)}return e}transitioned(e,r){const l=new Ro(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].transitioned(e,r._values[h]);return l}untransitioned(){const e=new Ro(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Bd{constructor(e,r,l,h,g){this.property=e,this.value=r,this.begin=g+h.delay||0,this.end=this.begin+h.duration||0,e.specification.transition&&(h.delay||h.duration)&&(this.prior=l)}possiblyEvaluate(e,r,l){const h=e.now||0,g=this.value.possiblyEvaluate(e,r,l),_=this.prior;if(_){if(h>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(h<this.begin)return _.possiblyEvaluate(e,r,l);{const v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(e,r,l),g,function(b){if(b<=0)return 0;if(b>=1)return 1;const E=b*b,M=E*b;return 4*(b<.5?M:3*(b-E)+M-.75)}(v))}}return g}}class Ro{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,l){const h=new Lo(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(e,r,l);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Po{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return me(this._values[e].value)}setValue(e,r){this._values[e]=new Es(this._values[e].property,r===null?void 0:me(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const l=this.getValue(r);l!==void 0&&(e[r]=l)}return e}possiblyEvaluate(e,r,l){const h=new Lo(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(e,r,l);return h}}class Ca{constructor(e,r,l){this.property=e,this.value=r,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,l,h){return this.property.evaluate(this.value,this.parameters,e,r,l,h)}}class Lo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Gt{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,l){const h=mn[this.specification.type];return h?h(e,r,l):e}}class ie{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,l,h){return new Ca(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},l,h)}:e.expression,r)}interpolate(e,r,l){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new Ca(this,{kind:"constant",value:void 0},e.parameters);const h=mn[this.specification.type];if(h){const g=h(e.value.value,r.value.value,l);return new Ca(this,{kind:"constant",value:g},e.parameters)}return e}evaluate(e,r,l,h,g,_){return e.kind==="constant"?e.value:e.evaluate(r,l,h,g,_)}}class Fl extends ie{possiblyEvaluate(e,r,l,h){if(e.value===void 0)return new Ca(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const g=e.expression.evaluate(r,null,{},l,h),_=e.property.specification.type==="resolvedImage"&&typeof g!="string"?g.name:g,v=this._calculate(_,_,_,r);return new Ca(this,{kind:"constant",value:v},r)}if(e.expression.kind==="camera"){const g=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new Ca(this,{kind:"constant",value:g},r)}return new Ca(this,e.expression,r)}evaluate(e,r,l,h,g,_){if(e.kind==="source"){const v=e.evaluate(r,l,h,g,_);return this._calculate(v,v,v,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},l,h),e.evaluate({zoom:Math.floor(r.zoom)},l,h),e.evaluate({zoom:Math.floor(r.zoom)+1},l,h),r):e.value}_calculate(e,r,l,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:l,to:r}}interpolate(e){return e}}class Ul{constructor(e){this.specification=e}possiblyEvaluate(e,r,l,h){if(e.value!==void 0){if(e.expression.kind==="constant"){const g=e.expression.evaluate(r,null,{},l,h);return this._calculate(g,g,g,r)}return this._calculate(e.expression.evaluate(new Qe(Math.floor(r.zoom-1),r)),e.expression.evaluate(new Qe(Math.floor(r.zoom),r)),e.expression.evaluate(new Qe(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,l,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:l,to:r}}interpolate(e){return e}}class Lu{constructor(e){this.specification=e}possiblyEvaluate(e,r,l,h){return!!e.expression.evaluate(r,null,{},l,h)}interpolate(){return!1}}class m{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const l=e[r];l.specification.overridable&&this.overridableProperties.push(r);const h=this.defaultPropertyValues[r]=new Es(l,void 0),g=this.defaultTransitionablePropertyValues[r]=new Bl(l);this.defaultTransitioningPropertyValues[r]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=h.possiblyEvaluate({})}}}jt("DataDrivenProperty",ie),jt("DataConstantProperty",Gt),jt("CrossFadedDataDrivenProperty",Fl),jt("CrossFadedProperty",Ul),jt("ColorRampProperty",Lu);const t="-transition";class s extends ns{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new Po(r.layout)),r.paint)){this._transitionablePaint=new Ol(r.paint);for(const l in e.paint)this.setPaintProperty(l,e.paint[l],{validate:!1});for(const l in e.layout)this.setLayoutProperty(l,e.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Lo(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,l={}){r!=null&&this._validate(kd,`layers.${this.id}.layout.${e}`,e,r,l)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(t)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,l={}){if(r!=null&&this._validate(Id,`layers.${this.id}.paint.${e}`,e,r,l))return!1;if(e.endsWith(t))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const h=this._transitionablePaint._values[e],g=h.property.specification["property-type"]==="cross-faded-data-driven",_=h.value.isDataDriven(),v=h.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const b=this._transitionablePaint._values[e].value;return b.isDataDriven()||_||g||this._handleOverridablePaintPropertyUpdate(e,v,b)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),ye(e,(r,l)=>!(r===void 0||l==="layout"&&!Object.keys(r).length||l==="paint"&&!Object.keys(r).length))}_validate(e,r,l,h,g={}){return(!g||g.validate!==!1)&&zu(this,e.call(Pr,{key:r,layerType:this.type,objectKey:l,value:h,styleSpec:gt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof Ca&&ps(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const c={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class u{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class p{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function x(n,e=1){let r=0,l=0;return{members:n.map(h=>{const g=c[h.type].BYTES_PER_ELEMENT,_=r=S(r,Math.max(e,g)),v=h.components||1;return l=Math.max(l,g),r+=g*v,{name:h.name,type:h.type,components:v,offset:_}}),size:S(r,Math.max(l,e)),alignment:e}}function S(n,e){return Math.ceil(n/e)*e}class A extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,r)}emplace(e,r,l){const h=2*e;return this.int16[h+0]=r,this.int16[h+1]=l,e}}A.prototype.bytesPerElement=4,jt("StructArrayLayout2i4",A);class z extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,l)}emplace(e,r,l,h){const g=3*e;return this.int16[g+0]=r,this.int16[g+1]=l,this.int16[g+2]=h,e}}z.prototype.bytesPerElement=6,jt("StructArrayLayout3i6",z);class D extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,l,h)}emplace(e,r,l,h,g){const _=4*e;return this.int16[_+0]=r,this.int16[_+1]=l,this.int16[_+2]=h,this.int16[_+3]=g,e}}D.prototype.bytesPerElement=8,jt("StructArrayLayout4i8",D);class I extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,h,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,l,h,g,_)}emplace(e,r,l,h,g,_,v){const b=6*e;return this.int16[b+0]=r,this.int16[b+1]=l,this.int16[b+2]=h,this.int16[b+3]=g,this.int16[b+4]=_,this.int16[b+5]=v,e}}I.prototype.bytesPerElement=12,jt("StructArrayLayout2i4i12",I);class B extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,h,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,l,h,g,_)}emplace(e,r,l,h,g,_,v){const b=4*e,E=8*e;return this.int16[b+0]=r,this.int16[b+1]=l,this.uint8[E+4]=h,this.uint8[E+5]=g,this.uint8[E+6]=_,this.uint8[E+7]=v,e}}B.prototype.bytesPerElement=8,jt("StructArrayLayout2i4ub8",B);class U extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,r)}emplace(e,r,l){const h=2*e;return this.float32[h+0]=r,this.float32[h+1]=l,e}}U.prototype.bytesPerElement=8,jt("StructArrayLayout2f8",U);class j extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,h,g,_,v,b,E,M){const C=this.length;return this.resize(C+1),this.emplace(C,e,r,l,h,g,_,v,b,E,M)}emplace(e,r,l,h,g,_,v,b,E,M,C){const k=10*e;return this.uint16[k+0]=r,this.uint16[k+1]=l,this.uint16[k+2]=h,this.uint16[k+3]=g,this.uint16[k+4]=_,this.uint16[k+5]=v,this.uint16[k+6]=b,this.uint16[k+7]=E,this.uint16[k+8]=M,this.uint16[k+9]=C,e}}j.prototype.bytesPerElement=20,jt("StructArrayLayout10ui20",j);class X extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,h,g,_,v,b,E,M,C,k){const L=this.length;return this.resize(L+1),this.emplace(L,e,r,l,h,g,_,v,b,E,M,C,k)}emplace(e,r,l,h,g,_,v,b,E,M,C,k,L){const O=12*e;return this.int16[O+0]=r,this.int16[O+1]=l,this.int16[O+2]=h,this.int16[O+3]=g,this.uint16[O+4]=_,this.uint16[O+5]=v,this.uint16[O+6]=b,this.uint16[O+7]=E,this.int16[O+8]=M,this.int16[O+9]=C,this.int16[O+10]=k,this.int16[O+11]=L,e}}X.prototype.bytesPerElement=24,jt("StructArrayLayout4i4ui4i24",X);class K extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,l)}emplace(e,r,l,h){const g=3*e;return this.float32[g+0]=r,this.float32[g+1]=l,this.float32[g+2]=h,e}}K.prototype.bytesPerElement=12,jt("StructArrayLayout3f12",K);class Q extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Q.prototype.bytesPerElement=4,jt("StructArrayLayout1ul4",Q);class W extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,h,g,_,v,b,E){const M=this.length;return this.resize(M+1),this.emplace(M,e,r,l,h,g,_,v,b,E)}emplace(e,r,l,h,g,_,v,b,E,M){const C=10*e,k=5*e;return this.int16[C+0]=r,this.int16[C+1]=l,this.int16[C+2]=h,this.int16[C+3]=g,this.int16[C+4]=_,this.int16[C+5]=v,this.uint32[k+3]=b,this.uint16[C+8]=E,this.uint16[C+9]=M,e}}W.prototype.bytesPerElement=20,jt("StructArrayLayout6i1ul2ui20",W);class Z extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,h,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,l,h,g,_)}emplace(e,r,l,h,g,_,v){const b=6*e;return this.int16[b+0]=r,this.int16[b+1]=l,this.int16[b+2]=h,this.int16[b+3]=g,this.int16[b+4]=_,this.int16[b+5]=v,e}}Z.prototype.bytesPerElement=12,jt("StructArrayLayout2i2i2i12",Z);class at extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,h,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,l,h,g)}emplace(e,r,l,h,g,_){const v=4*e,b=8*e;return this.float32[v+0]=r,this.float32[v+1]=l,this.float32[v+2]=h,this.int16[b+6]=g,this.int16[b+7]=_,e}}at.prototype.bytesPerElement=16,jt("StructArrayLayout2f1f2i16",at);class ot extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,h,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,l,h,g,_)}emplace(e,r,l,h,g,_,v){const b=16*e,E=4*e,M=8*e;return this.uint8[b+0]=r,this.uint8[b+1]=l,this.float32[E+1]=h,this.float32[E+2]=g,this.int16[M+6]=_,this.int16[M+7]=v,e}}ot.prototype.bytesPerElement=16,jt("StructArrayLayout2ub2f2i16",ot);class ft extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,l)}emplace(e,r,l,h){const g=3*e;return this.uint16[g+0]=r,this.uint16[g+1]=l,this.uint16[g+2]=h,e}}ft.prototype.bytesPerElement=6,jt("StructArrayLayout3ui6",ft);class wt extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,h,g,_,v,b,E,M,C,k,L,O,F,G,Y){const dt=this.length;return this.resize(dt+1),this.emplace(dt,e,r,l,h,g,_,v,b,E,M,C,k,L,O,F,G,Y)}emplace(e,r,l,h,g,_,v,b,E,M,C,k,L,O,F,G,Y,dt){const et=24*e,lt=12*e,_t=48*e;return this.int16[et+0]=r,this.int16[et+1]=l,this.uint16[et+2]=h,this.uint16[et+3]=g,this.uint32[lt+2]=_,this.uint32[lt+3]=v,this.uint32[lt+4]=b,this.uint16[et+10]=E,this.uint16[et+11]=M,this.uint16[et+12]=C,this.float32[lt+7]=k,this.float32[lt+8]=L,this.uint8[_t+36]=O,this.uint8[_t+37]=F,this.uint8[_t+38]=G,this.uint32[lt+10]=Y,this.int16[et+22]=dt,e}}wt.prototype.bytesPerElement=48,jt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",wt);class Et extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,h,g,_,v,b,E,M,C,k,L,O,F,G,Y,dt,et,lt,_t,At,Ft,ee,Lt,Rt,Yt,Zt){const Vt=this.length;return this.resize(Vt+1),this.emplace(Vt,e,r,l,h,g,_,v,b,E,M,C,k,L,O,F,G,Y,dt,et,lt,_t,At,Ft,ee,Lt,Rt,Yt,Zt)}emplace(e,r,l,h,g,_,v,b,E,M,C,k,L,O,F,G,Y,dt,et,lt,_t,At,Ft,ee,Lt,Rt,Yt,Zt,Vt){const xt=32*e,Kt=16*e;return this.int16[xt+0]=r,this.int16[xt+1]=l,this.int16[xt+2]=h,this.int16[xt+3]=g,this.int16[xt+4]=_,this.int16[xt+5]=v,this.int16[xt+6]=b,this.int16[xt+7]=E,this.uint16[xt+8]=M,this.uint16[xt+9]=C,this.uint16[xt+10]=k,this.uint16[xt+11]=L,this.uint16[xt+12]=O,this.uint16[xt+13]=F,this.uint16[xt+14]=G,this.uint16[xt+15]=Y,this.uint16[xt+16]=dt,this.uint16[xt+17]=et,this.uint16[xt+18]=lt,this.uint16[xt+19]=_t,this.uint16[xt+20]=At,this.uint16[xt+21]=Ft,this.uint16[xt+22]=ee,this.uint32[Kt+12]=Lt,this.float32[Kt+13]=Rt,this.float32[Kt+14]=Yt,this.uint16[xt+30]=Zt,this.uint16[xt+31]=Vt,e}}Et.prototype.bytesPerElement=64,jt("StructArrayLayout8i15ui1ul2f2ui64",Et);class Pt extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Pt.prototype.bytesPerElement=4,jt("StructArrayLayout1f4",Pt);class Ut extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,l)}emplace(e,r,l,h){const g=3*e;return this.uint16[6*e+0]=r,this.float32[g+1]=l,this.float32[g+2]=h,e}}Ut.prototype.bytesPerElement=12,jt("StructArrayLayout1ui2f12",Ut);class Dt extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,l)}emplace(e,r,l,h){const g=4*e;return this.uint32[2*e+0]=r,this.uint16[g+2]=l,this.uint16[g+3]=h,e}}Dt.prototype.bytesPerElement=8,jt("StructArrayLayout1ul2ui8",Dt);class Ct extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,r)}emplace(e,r,l){const h=2*e;return this.uint16[h+0]=r,this.uint16[h+1]=l,e}}Ct.prototype.bytesPerElement=4,jt("StructArrayLayout2ui4",Ct);class Ht extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}Ht.prototype.bytesPerElement=2,jt("StructArrayLayout1ui2",Ht);class oe extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,l,h)}emplace(e,r,l,h,g){const _=4*e;return this.float32[_+0]=r,this.float32[_+1]=l,this.float32[_+2]=h,this.float32[_+3]=g,e}}oe.prototype.bytesPerElement=16,jt("StructArrayLayout4f16",oe);class kt extends u{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new tt(this.anchorPointX,this.anchorPointY)}}kt.prototype.size=20;class Bt extends W{get(e){return new kt(this,e)}}jt("CollisionBoxArray",Bt);class re extends u{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}re.prototype.size=48;class Je extends wt{get(e){return new re(this,e)}}jt("PlacedSymbolArray",Je);class de extends u{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}de.prototype.size=64;class be extends Et{get(e){return new de(this,e)}}jt("SymbolInstanceArray",be);class We extends Pt{getoffsetX(e){return this.float32[1*e+0]}}jt("GlyphOffsetArray",We);class Hi extends z{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}jt("SymbolLineVertexArray",Hi);class sa extends u{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}sa.prototype.size=12;class ti extends Ut{get(e){return new sa(this,e)}}jt("TextAnchorOffsetArray",ti);class _n extends u{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}_n.prototype.size=8;class on extends Dt{get(e){return new _n(this,e)}}jt("FeatureIndexArray",on);class Xi extends A{}class ln extends A{}class Da extends A{}class Ms extends I{}class Nl extends B{}class zs extends U{}class Zn extends j{}class Vl extends X{}class Bu extends K{}class Gn extends Q{}class Hn extends Z{}class sr extends ot{}class oa extends ft{}class Fi extends Ct{}const $i=x([{name:"a_pos",components:2,type:"Int16"}],4),{members:Rn}=$i;class Se{constructor(e=[]){this.segments=e}prepareSegment(e,r,l,h){let g=this.segments[this.segments.length-1];return e>Se.MAX_VERTEX_ARRAY_LENGTH&&Ai(`Max vertices per segment is ${Se.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!g||g.vertexLength+e>Se.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==h)&&(g={vertexOffset:r.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},h!==void 0&&(g.sortKey=h),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,l,h){return new Se([{vertexOffset:e,primitiveOffset:r,vertexLength:l,primitiveLength:h,vaos:{},sortKey:0}])}}function Lr(n,e){return 256*(n=Ot(Math.floor(n),0,255))+Ot(Math.floor(e),0,255)}Se.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,jt("SegmentVector",Se);const Cs=x([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Ds={exports:{}},Od={exports:{}};Od.exports=function(n,e){var r,l,h,g,_,v,b,E;for(l=n.length-(r=3&n.length),h=e,_=3432918353,v=461845907,E=0;E<l;)b=255&n.charCodeAt(E)|(255&n.charCodeAt(++E))<<8|(255&n.charCodeAt(++E))<<16|(255&n.charCodeAt(++E))<<24,++E,h=27492+(65535&(g=5*(65535&(h=(h^=b=(65535&(b=(b=(65535&b)*_+(((b>>>16)*_&65535)<<16)&4294967295)<<15|b>>>17))*v+(((b>>>16)*v&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(b=0,r){case 3:b^=(255&n.charCodeAt(E+2))<<16;case 2:b^=(255&n.charCodeAt(E+1))<<8;case 1:h^=b=(65535&(b=(b=(65535&(b^=255&n.charCodeAt(E)))*_+(((b>>>16)*_&65535)<<16)&4294967295)<<15|b>>>17))*v+(((b>>>16)*v&65535)<<16)&4294967295}return h^=n.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0};var im=Od.exports,Fd={exports:{}};Fd.exports=function(n,e){for(var r,l=n.length,h=e^l,g=0;l>=4;)r=1540483477*(65535&(r=255&n.charCodeAt(g)|(255&n.charCodeAt(++g))<<8|(255&n.charCodeAt(++g))<<16|(255&n.charCodeAt(++g))<<24))+((1540483477*(r>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),l-=4,++g;switch(l){case 3:h^=(255&n.charCodeAt(g+2))<<16;case 2:h^=(255&n.charCodeAt(g+1))<<8;case 1:h=1540483477*(65535&(h^=255&n.charCodeAt(g)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0};var or=im,Ud=Fd.exports;Ds.exports=or,Ds.exports.murmur3=or,Ds.exports.murmur2=Ud;var jl=q(Ds.exports);class Bo{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,l,h){this.ids.push(ql(e)),this.positions.push(r,l,h)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=ql(e);let l=0,h=this.ids.length-1;for(;l<h;){const _=l+h>>1;this.ids[_]>=r?h=_:l=_+1}const g=[];for(;this.ids[l]===r;)g.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return g}static serialize(e,r){const l=new Float64Array(e.ids),h=new Uint32Array(e.positions);return Zl(l,h,0,l.length-1),r&&r.push(l.buffer,h.buffer),{ids:l,positions:h}}static deserialize(e){const r=new Bo;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function ql(n){const e=+n;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:jl(String(n))}function Zl(n,e,r,l){for(;r<l;){const h=n[r+l>>1];let g=r-1,_=l+1;for(;;){do g++;while(n[g]<h);do _--;while(n[_]>h);if(g>=_)break;Is(n,g,_),Is(e,3*g,3*_),Is(e,3*g+1,3*_+1),Is(e,3*g+2,3*_+2)}_-r<l-_?(Zl(n,e,r,_),r=_+1):(Zl(n,e,_+1,l),l=_)}}function Is(n,e,r){const l=n[e];n[e]=n[r],n[r]=l}jt("FeaturePositionMap",Bo);class Oo{constructor(e,r){this.gl=e.gl,this.location=r}}class Nd extends Oo{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class wy extends Oo{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Sy extends Oo{constructor(e,r){super(e,r),this.current=Fe.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const zw=new Float32Array(16);function nm(n){return[Lr(255*n.r,255*n.g),Lr(255*n.b,255*n.a)]}class Ou{constructor(e,r,l){this.value=e,this.uniformNames=r.map(h=>`u_${h}`),this.type=l}setUniform(e,r,l){e.set(l.constantOr(this.value))}getBinding(e,r,l){return this.type==="color"?new Sy(e,r):new Nd(e,r)}}class Gl{constructor(e,r){this.uniformNames=r.map(l=>`u_${l}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,l,h){const g=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&e.set(g)}getBinding(e,r,l){return l.substr(0,9)==="u_pattern"?new wy(e,r):new Nd(e,r)}}class Br{constructor(e,r,l,h){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=r.map(g=>({name:`a_${g}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,r,l,h,g){const _=this.paintVertexArray.length,v=this.expression.evaluate(new Qe(0),r,{},h,[],g);this.paintVertexArray.resize(e),this._setPaintValue(_,e,v)}updatePaintArray(e,r,l,h){const g=this.expression.evaluate({zoom:0},l,h);this._setPaintValue(e,r,g)}_setPaintValue(e,r,l){if(this.type==="color"){const h=nm(l);for(let g=e;g<r;g++)this.paintVertexArray.emplace(g,h[0],h[1])}else{for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Xa{constructor(e,r,l,h,g,_){this.expression=e,this.uniformNames=r.map(v=>`u_${v}_t`),this.type=l,this.useIntegerZoom=h,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=r.map(v=>({name:`a_${v}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(e,r,l,h,g){const _=this.expression.evaluate(new Qe(this.zoom),r,{},h,[],g),v=this.expression.evaluate(new Qe(this.zoom+1),r,{},h,[],g),b=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(b,e,_,v)}updatePaintArray(e,r,l,h){const g=this.expression.evaluate({zoom:this.zoom},l,h),_=this.expression.evaluate({zoom:this.zoom+1},l,h);this._setPaintValue(e,r,g,_)}_setPaintValue(e,r,l,h){if(this.type==="color"){const g=nm(l),_=nm(h);for(let v=e;v<r;v++)this.paintVertexArray.emplace(v,g[0],g[1],_[0],_[1])}else{for(let g=e;g<r;g++)this.paintVertexArray.emplace(g,l,h);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const l=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,h=Ot(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);e.set(h)}getBinding(e,r,l){return new Nd(e,r)}}class ks{constructor(e,r,l,h,g,_){this.expression=e,this.type=r,this.useIntegerZoom=l,this.zoom=h,this.layerId=_,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(e,r,l){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(h,e,r.patterns&&r.patterns[this.layerId],l)}updatePaintArray(e,r,l,h,g){this._setPaintValues(e,r,l.patterns&&l.patterns[this.layerId],g)}_setPaintValues(e,r,l,h){if(!h||!l)return;const{min:g,mid:_,max:v}=l,b=h[g],E=h[_],M=h[v];if(b&&E&&M)for(let C=e;C<r;C++)this.zoomInPaintVertexArray.emplace(C,E.tl[0],E.tl[1],E.br[0],E.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1],E.pixelRatio,b.pixelRatio),this.zoomOutPaintVertexArray.emplace(C,E.tl[0],E.tl[1],E.br[0],E.br[1],M.tl[0],M.tl[1],M.br[0],M.br[1],E.pixelRatio,M.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Cs.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Cs.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ty{constructor(e,r,l){this.binders={},this._buffers=[];const h=[];for(const g in e.paint._values){if(!l(g))continue;const _=e.paint.get(g);if(!(_ instanceof Ca&&ps(_.property.specification)))continue;const v=Cw(g,e.type),b=_.value,E=_.property.specification.type,M=_.property.useIntegerZoom,C=_.property.specification["property-type"],k=C==="cross-faded"||C==="cross-faded-data-driven";if(b.kind==="constant")this.binders[g]=k?new Gl(b.value,v):new Ou(b.value,v,E),h.push(`/u_${g}`);else if(b.kind==="source"||k){const L=Ay(g,E,"source");this.binders[g]=k?new ks(b,E,M,r,L,e.id):new Br(b,v,E,L),h.push(`/a_${g}`)}else{const L=Ay(g,E,"composite");this.binders[g]=new Xa(b,v,E,M,r,L),h.push(`/z_${g}`)}}this.cacheKey=h.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof Br||r instanceof Xa?r.maxValue:0}populatePaintArrays(e,r,l,h,g){for(const _ in this.binders){const v=this.binders[_];(v instanceof Br||v instanceof Xa||v instanceof ks)&&v.populatePaintArray(e,r,l,h,g)}}setConstantPatternPositions(e,r){for(const l in this.binders){const h=this.binders[l];h instanceof Gl&&h.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,l,h,g){let _=!1;for(const v in e){const b=r.getPositions(v);for(const E of b){const M=l.feature(E.index);for(const C in this.binders){const k=this.binders[C];if((k instanceof Br||k instanceof Xa||k instanceof ks)&&k.expression.isStateDependent===!0){const L=h.paint.get(C);k.expression=L.value,k.updatePaintArray(E.start,E.end,M,e[v],g),_=!0}}}}return _}defines(){const e=[];for(const r in this.binders){const l=this.binders[r];(l instanceof Ou||l instanceof Gl)&&e.push(...l.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const l=this.binders[r];if(l instanceof Br||l instanceof Xa)for(let h=0;h<l.paintVertexAttributes.length;h++)e.push(l.paintVertexAttributes[h].name);else if(l instanceof ks)for(let h=0;h<Cs.members.length;h++)e.push(Cs.members[h].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const l=this.binders[r];if(l instanceof Ou||l instanceof Gl||l instanceof Xa)for(const h of l.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const l=[];for(const h in this.binders){const g=this.binders[h];if(g instanceof Ou||g instanceof Gl||g instanceof Xa){for(const _ of g.uniformNames)if(r[_]){const v=g.getBinding(e,r[_],_);l.push({name:_,property:h,binding:v})}}}return l}setUniforms(e,r,l,h){for(const{name:g,property:_,binding:v}of r)this.binders[_].setUniform(v,h,l.get(_),g)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const l=this.binders[r];if(e&&l instanceof ks){const h=e.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(l instanceof Br||l instanceof Xa)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(e){for(const r in this.binders){const l=this.binders[r];(l instanceof Br||l instanceof Xa||l instanceof ks)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof Br||r instanceof Xa||r instanceof ks)&&r.destroy()}}}class Fo{constructor(e,r,l=()=>!0){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new Ty(h,r,l);this.needsUpload=!1,this._featureMap=new Bo,this._bufferOffset=0}populatePaintArrays(e,r,l,h,g,_){for(const v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(e,r,h,g,_);r.id!==void 0&&this._featureMap.add(r.id,l,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,l,h){for(const g of l)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(e,this._featureMap,r,g,h)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Cw(n,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}function Ay(n,e,r){const l={color:{source:U,composite:oe},number:{source:Pt,composite:U}},h=function(g){return{"line-pattern":{source:Zn,composite:Zn},"fill-pattern":{source:Zn,composite:Zn},"fill-extrusion-pattern":{source:Zn,composite:Zn}}[g]}(n);return h&&h[r]||l[e][r]}jt("ConstantBinder",Ou),jt("CrossFadedConstantBinder",Gl),jt("SourceExpressionBinder",Br),jt("CrossFadedCompositeBinder",ks),jt("CompositeExpressionBinder",Xa),jt("ProgramConfiguration",Ty,{omit:["_buffers"]}),jt("ProgramConfigurationSet",Fo);const wi=8192,am=Math.pow(2,14)-1,Ey=-am-1;function Uo(n){const e=wi/n.extent,r=n.loadGeometry();for(let l=0;l<r.length;l++){const h=r[l];for(let g=0;g<h.length;g++){const _=h[g],v=Math.round(_.x*e),b=Math.round(_.y*e);_.x=Ot(v,Ey,am),_.y=Ot(b,Ey,am),(v<_.x||v>_.x+1||b<_.y||b>_.y+1)&&Ai("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function No(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?Uo(n):[]}}function Vd(n,e,r,l,h){n.emplaceBack(2*e+(l+1)/2,2*r+(h+1)/2)}class rm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new ln,this.indexArray=new oa,this.segments=new Se,this.programConfigurations=new Fo(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,l){const h=this.layers[0],g=[];let _=null,v=!1;h.type==="circle"&&(_=h.layout.get("circle-sort-key"),v=!_.isConstant());for(const{feature:b,id:E,index:M,sourceLayerIndex:C}of e){const k=this.layers[0]._featureFilter.needGeometry,L=No(b,k);if(!this.layers[0]._featureFilter.filter(new Qe(this.zoom),L,l))continue;const O=v?_.evaluate(L,{},l):void 0,F={id:E,properties:b.properties,type:b.type,sourceLayerIndex:C,index:M,geometry:k?L.geometry:Uo(b),patterns:{},sortKey:O};g.push(F)}v&&g.sort((b,E)=>b.sortKey-E.sortKey);for(const b of g){const{geometry:E,index:M,sourceLayerIndex:C}=b,k=e[M].feature;this.addFeature(b,E,M,l),r.featureIndex.insert(k,E,M,C,this.index)}}update(e,r,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Rn),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,l,h){for(const g of r)for(const _ of g){const v=_.x,b=_.y;if(v<0||v>=wi||b<0||b>=wi)continue;const E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),M=E.vertexLength;Vd(this.layoutVertexArray,v,b,-1,-1),Vd(this.layoutVertexArray,v,b,1,-1),Vd(this.layoutVertexArray,v,b,1,1),Vd(this.layoutVertexArray,v,b,-1,1),this.indexArray.emplaceBack(M,M+1,M+2),this.indexArray.emplaceBack(M,M+3,M+2),E.vertexLength+=4,E.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},h)}}function My(n,e){for(let r=0;r<n.length;r++)if(Hl(e,n[r]))return!0;for(let r=0;r<e.length;r++)if(Hl(n,e[r]))return!0;return!!sm(n,e)}function Dw(n,e,r){return!!Hl(n,e)||!!om(e,n,r)}function zy(n,e){if(n.length===1)return Dy(e,n[0]);for(let r=0;r<e.length;r++){const l=e[r];for(let h=0;h<l.length;h++)if(Hl(n,l[h]))return!0}for(let r=0;r<n.length;r++)if(Dy(e,n[r]))return!0;for(let r=0;r<e.length;r++)if(sm(n,e[r]))return!0;return!1}function Iw(n,e,r){if(n.length>1){if(sm(n,e))return!0;for(let l=0;l<e.length;l++)if(om(e[l],n,r))return!0}for(let l=0;l<n.length;l++)if(om(n[l],e,r))return!0;return!1}function sm(n,e){if(n.length===0||e.length===0)return!1;for(let r=0;r<n.length-1;r++){const l=n[r],h=n[r+1];for(let g=0;g<e.length-1;g++)if(kw(l,h,e[g],e[g+1]))return!0}return!1}function kw(n,e,r,l){return Bi(n,r,l)!==Bi(e,r,l)&&Bi(n,e,r)!==Bi(n,e,l)}function om(n,e,r){const l=r*r;if(e.length===1)return n.distSqr(e[0])<l;for(let h=1;h<e.length;h++)if(Cy(n,e[h-1],e[h])<l)return!0;return!1}function Cy(n,e,r){const l=e.distSqr(r);if(l===0)return n.distSqr(e);const h=((n.x-e.x)*(r.x-e.x)+(n.y-e.y)*(r.y-e.y))/l;return n.distSqr(h<0?e:h>1?r:r.sub(e)._mult(h)._add(e))}function Dy(n,e){let r,l,h,g=!1;for(let _=0;_<n.length;_++){r=n[_];for(let v=0,b=r.length-1;v<r.length;b=v++)l=r[v],h=r[b],l.y>e.y!=h.y>e.y&&e.x<(h.x-l.x)*(e.y-l.y)/(h.y-l.y)+l.x&&(g=!g)}return g}function Hl(n,e){let r=!1;for(let l=0,h=n.length-1;l<n.length;h=l++){const g=n[l],_=n[h];g.y>e.y!=_.y>e.y&&e.x<(_.x-g.x)*(e.y-g.y)/(_.y-g.y)+g.x&&(r=!r)}return r}function Rw(n,e,r){const l=r[0],h=r[2];if(n.x<l.x&&e.x<l.x||n.x>h.x&&e.x>h.x||n.y<l.y&&e.y<l.y||n.y>h.y&&e.y>h.y)return!1;const g=Bi(n,e,r[0]);return g!==Bi(n,e,r[1])||g!==Bi(n,e,r[2])||g!==Bi(n,e,r[3])}function Fu(n,e,r){const l=e.paint.get(n).value;return l.kind==="constant"?l.value:r.programConfigurations.get(e.id).getMaxValue(n)}function jd(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function qd(n,e,r,l,h){if(!e[0]&&!e[1])return n;const g=tt.convert(e)._mult(h);r==="viewport"&&g._rotate(-l);const _=[];for(let v=0;v<n.length;v++)_.push(n[v].sub(g));return _}let Iy,ky;jt("CircleBucket",rm,{omit:["layers"]});var Pw={get paint(){return ky=ky||new m({"circle-radius":new ie(gt.paint_circle["circle-radius"]),"circle-color":new ie(gt.paint_circle["circle-color"]),"circle-blur":new ie(gt.paint_circle["circle-blur"]),"circle-opacity":new ie(gt.paint_circle["circle-opacity"]),"circle-translate":new Gt(gt.paint_circle["circle-translate"]),"circle-translate-anchor":new Gt(gt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Gt(gt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Gt(gt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ie(gt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ie(gt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ie(gt.paint_circle["circle-stroke-opacity"])})},get layout(){return Iy=Iy||new m({"circle-sort-key":new ie(gt.layout_circle["circle-sort-key"])})}},yn=1e-6,Xl=typeof Float32Array<"u"?Float32Array:Array;function lm(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Ry(n,e,r){var l=e[0],h=e[1],g=e[2],_=e[3],v=e[4],b=e[5],E=e[6],M=e[7],C=e[8],k=e[9],L=e[10],O=e[11],F=e[12],G=e[13],Y=e[14],dt=e[15],et=r[0],lt=r[1],_t=r[2],At=r[3];return n[0]=et*l+lt*v+_t*C+At*F,n[1]=et*h+lt*b+_t*k+At*G,n[2]=et*g+lt*E+_t*L+At*Y,n[3]=et*_+lt*M+_t*O+At*dt,n[4]=(et=r[4])*l+(lt=r[5])*v+(_t=r[6])*C+(At=r[7])*F,n[5]=et*h+lt*b+_t*k+At*G,n[6]=et*g+lt*E+_t*L+At*Y,n[7]=et*_+lt*M+_t*O+At*dt,n[8]=(et=r[8])*l+(lt=r[9])*v+(_t=r[10])*C+(At=r[11])*F,n[9]=et*h+lt*b+_t*k+At*G,n[10]=et*g+lt*E+_t*L+At*Y,n[11]=et*_+lt*M+_t*O+At*dt,n[12]=(et=r[12])*l+(lt=r[13])*v+(_t=r[14])*C+(At=r[15])*F,n[13]=et*h+lt*b+_t*k+At*G,n[14]=et*g+lt*E+_t*L+At*Y,n[15]=et*_+lt*M+_t*O+At*dt,n}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var Uu,Lw=Ry;function Zd(n,e,r){var l=e[0],h=e[1],g=e[2],_=e[3];return n[0]=r[0]*l+r[4]*h+r[8]*g+r[12]*_,n[1]=r[1]*l+r[5]*h+r[9]*g+r[13]*_,n[2]=r[2]*l+r[6]*h+r[10]*g+r[14]*_,n[3]=r[3]*l+r[7]*h+r[11]*g+r[15]*_,n}Uu=new Xl(4),Xl!=Float32Array&&(Uu[0]=0,Uu[1]=0,Uu[2]=0,Uu[3]=0);class Bw extends s{constructor(e){super(e,Pw)}createBucket(e){return new rm(e)}queryRadius(e){const r=e;return Fu("circle-radius",this,r)+Fu("circle-stroke-width",this,r)+jd(this.paint.get("circle-translate"))}queryIntersectsFeature(e,r,l,h,g,_,v,b){const E=qd(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,v),M=this.paint.get("circle-radius").evaluate(r,l)+this.paint.get("circle-stroke-width").evaluate(r,l),C=this.paint.get("circle-pitch-alignment")==="map",k=C?E:function(O,F){return O.map(G=>Py(G,F))}(E,b),L=C?M*v:M;for(const O of h)for(const F of O){const G=C?F:Py(F,b);let Y=L;const dt=Zd([],[F.x,F.y,0,1],b);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Y*=dt[3]/_.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Y*=_.cameraToCenterDistance/dt[3]),Dw(k,G,Y))return!0}return!1}}function Py(n,e){const r=Zd([],[n.x,n.y,0,1],e);return new tt(r[0]/r[3],r[1]/r[3])}class Ly extends rm{}let By;jt("HeatmapBucket",Ly,{omit:["layers"]});var Ow={get paint(){return By=By||new m({"heatmap-radius":new ie(gt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ie(gt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Gt(gt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Lu(gt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Gt(gt.paint_heatmap["heatmap-opacity"])})}};function cm(n,{width:e,height:r},l,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*r*l)throw new RangeError(`mismatched image size. expected: ${h.length} but got: ${e*r*l}`)}else h=new Uint8Array(e*r*l);return n.width=e,n.height=r,n.data=h,n}function Oy(n,{width:e,height:r},l){if(e===n.width&&r===n.height)return;const h=cm({},{width:e,height:r},l);um(n,h,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,e),height:Math.min(n.height,r)},l),n.width=e,n.height=r,n.data=h.data}function um(n,e,r,l,h,g){if(h.width===0||h.height===0)return e;if(h.width>n.width||h.height>n.height||r.x>n.width-h.width||r.y>n.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||l.x>e.width-h.width||l.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const _=n.data,v=e.data;if(_===v)throw new Error("srcData equals dstData, so image is already copied");for(let b=0;b<h.height;b++){const E=((r.y+b)*n.width+r.x)*g,M=((l.y+b)*e.width+l.x)*g;for(let C=0;C<h.width*g;C++)v[M+C]=_[E+C]}return e}class Nu{constructor(e,r){cm(this,e,1,r)}resize(e){Oy(this,e,1)}clone(){return new Nu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,l,h,g){um(e,r,l,h,g,1)}}class la{constructor(e,r){cm(this,e,4,r)}resize(e){Oy(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new la({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,l,h,g){um(e,r,l,h,g,4)}}function Fy(n){const e={},r=n.resolution||256,l=n.clips?n.clips.length:1,h=n.image||new la({width:r,height:l});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const g=(_,v,b)=>{e[n.evaluationKey]=b;const E=n.expression.evaluate(e);h.data[_+v+0]=Math.floor(255*E.r/E.a),h.data[_+v+1]=Math.floor(255*E.g/E.a),h.data[_+v+2]=Math.floor(255*E.b/E.a),h.data[_+v+3]=Math.floor(255*E.a)};if(n.clips)for(let _=0,v=0;_<l;++_,v+=4*r)for(let b=0,E=0;b<r;b++,E+=4){const M=b/(r-1),{start:C,end:k}=n.clips[_];g(v,E,C*(1-M)+k*M)}else for(let _=0,v=0;_<r;_++,v+=4)g(0,v,_/(r-1));return h}jt("AlphaImage",Nu),jt("RGBAImage",la);const hm="big-fb";class Fw extends s{createBucket(e){return new Ly(e)}constructor(e){super(e,Ow),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Fy({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(hm)&&this.heatmapFbos.delete(hm)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Uy;var Uw={get paint(){return Uy=Uy||new m({"hillshade-illumination-direction":new Gt(gt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Gt(gt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Gt(gt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Gt(gt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Gt(gt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Gt(gt.paint_hillshade["hillshade-accent-color"])})}};class Nw extends s{constructor(e){super(e,Uw)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Vw=x([{name:"a_pos",components:2,type:"Int16"}],4),{members:jw}=Vw;function Ny(n,e,r=2){const l=e&&e.length,h=l?e[0]*r:n.length;let g=Vy(n,0,h,r,!0);const _=[];if(!g||g.next===g.prev)return _;let v,b,E;if(l&&(g=function(M,C,k,L){const O=[];for(let F=0,G=C.length;F<G;F++){const Y=Vy(M,C[F]*L,F<G-1?C[F+1]*L:M.length,L,!1);Y===Y.next&&(Y.steiner=!0),O.push(Kw(Y))}O.sort(Xw);for(let F=0;F<O.length;F++)k=$w(O[F],k);return k}(n,e,g,r)),n.length>80*r){v=1/0,b=1/0;let M=-1/0,C=-1/0;for(let k=r;k<h;k+=r){const L=n[k],O=n[k+1];L<v&&(v=L),O<b&&(b=O),L>M&&(M=L),O>C&&(C=O)}E=Math.max(M-v,C-b),E=E!==0?32767/E:0}return Vu(g,_,r,v,b,E,0),_}function Vy(n,e,r,l,h){let g;if(h===function(_,v,b,E){let M=0;for(let C=v,k=b-E;C<b;C+=E)M+=(_[k]-_[C])*(_[C+1]+_[k+1]),k=C;return M}(n,e,r,l)>0)for(let _=e;_<r;_+=l)g=Zy(_/l|0,n[_],n[_+1],g);else for(let _=r-l;_>=e;_-=l)g=Zy(_/l|0,n[_],n[_+1],g);return g&&Gd(g,g.next)&&(qu(g),g=g.next),g}function Vo(n,e){if(!n)return n;e||(e=n);let r,l=n;do if(r=!1,l.steiner||!Gd(l,l.next)&&yi(l.prev,l,l.next)!==0)l=l.next;else{if(qu(l),l=e=l.prev,l===l.next)break;r=!0}while(r||l!==e);return e}function Vu(n,e,r,l,h,g,_){if(!n)return;!_&&g&&function(b,E,M,C){let k=b;do k.z===0&&(k.z=dm(k.x,k.y,E,M,C)),k.prevZ=k.prev,k.nextZ=k.next,k=k.next;while(k!==b);k.prevZ.nextZ=null,k.prevZ=null,function(L){let O,F=1;do{let G,Y=L;L=null;let dt=null;for(O=0;Y;){O++;let et=Y,lt=0;for(let At=0;At<F&&(lt++,et=et.nextZ,et);At++);let _t=F;for(;lt>0||_t>0&&et;)lt!==0&&(_t===0||!et||Y.z<=et.z)?(G=Y,Y=Y.nextZ,lt--):(G=et,et=et.nextZ,_t--),dt?dt.nextZ=G:L=G,G.prevZ=dt,dt=G;Y=et}dt.nextZ=null,F*=2}while(O>1)}(k)}(n,l,h,g);let v=n;for(;n.prev!==n.next;){const b=n.prev,E=n.next;if(g?Zw(n,l,h,g):qw(n))e.push(b.i,n.i,E.i),qu(n),n=E.next,v=E.next;else if((n=E)===v){_?_===1?Vu(n=Gw(Vo(n),e),e,r,l,h,g,2):_===2&&Hw(n,e,r,l,h,g):Vu(Vo(n),e,r,l,h,g,1);break}}}function qw(n){const e=n.prev,r=n,l=n.next;if(yi(e,r,l)>=0)return!1;const h=e.x,g=r.x,_=l.x,v=e.y,b=r.y,E=l.y,M=h<g?h<_?h:_:g<_?g:_,C=v<b?v<E?v:E:b<E?b:E,k=h>g?h>_?h:_:g>_?g:_,L=v>b?v>E?v:E:b>E?b:E;let O=l.next;for(;O!==e;){if(O.x>=M&&O.x<=k&&O.y>=C&&O.y<=L&&$l(h,v,g,b,_,E,O.x,O.y)&&yi(O.prev,O,O.next)>=0)return!1;O=O.next}return!0}function Zw(n,e,r,l){const h=n.prev,g=n,_=n.next;if(yi(h,g,_)>=0)return!1;const v=h.x,b=g.x,E=_.x,M=h.y,C=g.y,k=_.y,L=v<b?v<E?v:E:b<E?b:E,O=M<C?M<k?M:k:C<k?C:k,F=v>b?v>E?v:E:b>E?b:E,G=M>C?M>k?M:k:C>k?C:k,Y=dm(L,O,e,r,l),dt=dm(F,G,e,r,l);let et=n.prevZ,lt=n.nextZ;for(;et&&et.z>=Y&&lt&&lt.z<=dt;){if(et.x>=L&&et.x<=F&&et.y>=O&&et.y<=G&&et!==h&&et!==_&&$l(v,M,b,C,E,k,et.x,et.y)&&yi(et.prev,et,et.next)>=0||(et=et.prevZ,lt.x>=L&&lt.x<=F&&lt.y>=O&&lt.y<=G&&lt!==h&&lt!==_&&$l(v,M,b,C,E,k,lt.x,lt.y)&&yi(lt.prev,lt,lt.next)>=0))return!1;lt=lt.nextZ}for(;et&&et.z>=Y;){if(et.x>=L&&et.x<=F&&et.y>=O&&et.y<=G&&et!==h&&et!==_&&$l(v,M,b,C,E,k,et.x,et.y)&&yi(et.prev,et,et.next)>=0)return!1;et=et.prevZ}for(;lt&&lt.z<=dt;){if(lt.x>=L&&lt.x<=F&&lt.y>=O&&lt.y<=G&&lt!==h&&lt!==_&&$l(v,M,b,C,E,k,lt.x,lt.y)&&yi(lt.prev,lt,lt.next)>=0)return!1;lt=lt.nextZ}return!0}function Gw(n,e){let r=n;do{const l=r.prev,h=r.next.next;!Gd(l,h)&&jy(l,r,r.next,h)&&ju(l,h)&&ju(h,l)&&(e.push(l.i,r.i,h.i),qu(r),qu(r.next),r=n=h),r=r.next}while(r!==n);return Vo(r)}function Hw(n,e,r,l,h,g){let _=n;do{let v=_.next.next;for(;v!==_.prev;){if(_.i!==v.i&&Qw(_,v)){let b=qy(_,v);return _=Vo(_,_.next),b=Vo(b,b.next),Vu(_,e,r,l,h,g,0),void Vu(b,e,r,l,h,g,0)}v=v.next}_=_.next}while(_!==n)}function Xw(n,e){return n.x-e.x}function $w(n,e){const r=function(h,g){let _=g;const v=h.x,b=h.y;let E,M=-1/0;do{if(b<=_.y&&b>=_.next.y&&_.next.y!==_.y){const F=_.x+(b-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(F<=v&&F>M&&(M=F,E=_.x<_.next.x?_:_.next,F===v))return E}_=_.next}while(_!==g);if(!E)return null;const C=E,k=E.x,L=E.y;let O=1/0;_=E;do{if(v>=_.x&&_.x>=k&&v!==_.x&&$l(b<L?v:M,b,k,L,b<L?M:v,b,_.x,_.y)){const F=Math.abs(b-_.y)/(v-_.x);ju(_,h)&&(F<O||F===O&&(_.x>E.x||_.x===E.x&&Yw(E,_)))&&(E=_,O=F)}_=_.next}while(_!==C);return E}(n,e);if(!r)return e;const l=qy(r,n);return Vo(l,l.next),Vo(r,r.next)}function Yw(n,e){return yi(n.prev,n,e.prev)<0&&yi(e.next,n,n.next)<0}function dm(n,e,r,l,h){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*h|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Kw(n){let e=n,r=n;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==n);return r}function $l(n,e,r,l,h,g,_,v){return(h-_)*(e-v)>=(n-_)*(g-v)&&(n-_)*(l-v)>=(r-_)*(e-v)&&(r-_)*(g-v)>=(h-_)*(l-v)}function Qw(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(r,l){let h=r;do{if(h.i!==r.i&&h.next.i!==r.i&&h.i!==l.i&&h.next.i!==l.i&&jy(h,h.next,r,l))return!0;h=h.next}while(h!==r);return!1}(n,e)&&(ju(n,e)&&ju(e,n)&&function(r,l){let h=r,g=!1;const _=(r.x+l.x)/2,v=(r.y+l.y)/2;do h.y>v!=h.next.y>v&&h.next.y!==h.y&&_<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(g=!g),h=h.next;while(h!==r);return g}(n,e)&&(yi(n.prev,n,e.prev)||yi(n,e.prev,e))||Gd(n,e)&&yi(n.prev,n,n.next)>0&&yi(e.prev,e,e.next)>0)}function yi(n,e,r){return(e.y-n.y)*(r.x-e.x)-(e.x-n.x)*(r.y-e.y)}function Gd(n,e){return n.x===e.x&&n.y===e.y}function jy(n,e,r,l){const h=Xd(yi(n,e,r)),g=Xd(yi(n,e,l)),_=Xd(yi(r,l,n)),v=Xd(yi(r,l,e));return h!==g&&_!==v||!(h!==0||!Hd(n,r,e))||!(g!==0||!Hd(n,l,e))||!(_!==0||!Hd(r,n,l))||!(v!==0||!Hd(r,e,l))}function Hd(n,e,r){return e.x<=Math.max(n.x,r.x)&&e.x>=Math.min(n.x,r.x)&&e.y<=Math.max(n.y,r.y)&&e.y>=Math.min(n.y,r.y)}function Xd(n){return n>0?1:n<0?-1:0}function ju(n,e){return yi(n.prev,n,n.next)<0?yi(n,e,n.next)>=0&&yi(n,n.prev,e)>=0:yi(n,e,n.prev)<0||yi(n,n.next,e)<0}function qy(n,e){const r=fm(n.i,n.x,n.y),l=fm(e.i,e.x,e.y),h=n.next,g=e.prev;return n.next=e,e.prev=n,r.next=h,h.prev=r,l.next=r,r.prev=l,g.next=l,l.prev=g,l}function Zy(n,e,r,l){const h=fm(n,e,r);return l?(h.next=l.next,h.prev=l,l.next.prev=h,l.next=h):(h.prev=h,h.next=h),h}function qu(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function fm(n,e,r){return{i:n,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function pm(n,e,r){const l=r.patternDependencies;let h=!1;for(const g of e){const _=g.paint.get(`${n}-pattern`);_.isConstant()||(h=!0);const v=_.constantOr(null);v&&(h=!0,l[v.to]=!0,l[v.from]=!0)}return h}function mm(n,e,r,l,h){const g=h.patternDependencies;for(const _ of e){const v=_.paint.get(`${n}-pattern`).value;if(v.kind!=="constant"){let b=v.evaluate({zoom:l-1},r,{},h.availableImages),E=v.evaluate({zoom:l},r,{},h.availableImages),M=v.evaluate({zoom:l+1},r,{},h.availableImages);b=b&&b.name?b.name:b,E=E&&E.name?E.name:E,M=M&&M.name?M.name:M,g[b]=!0,g[E]=!0,g[M]=!0,r.patterns[_.id]={min:b,mid:E,max:M}}}return r}class gm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Da,this.indexArray=new oa,this.indexArray2=new Fi,this.programConfigurations=new Fo(e.layers,e.zoom),this.segments=new Se,this.segments2=new Se,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,l){this.hasPattern=pm("fill",this.layers,r);const h=this.layers[0].layout.get("fill-sort-key"),g=!h.isConstant(),_=[];for(const{feature:v,id:b,index:E,sourceLayerIndex:M}of e){const C=this.layers[0]._featureFilter.needGeometry,k=No(v,C);if(!this.layers[0]._featureFilter.filter(new Qe(this.zoom),k,l))continue;const L=g?h.evaluate(k,{},l,r.availableImages):void 0,O={id:b,properties:v.properties,type:v.type,sourceLayerIndex:M,index:E,geometry:C?k.geometry:Uo(v),patterns:{},sortKey:L};_.push(O)}g&&_.sort((v,b)=>v.sortKey-b.sortKey);for(const v of _){const{geometry:b,index:E,sourceLayerIndex:M}=v;if(this.hasPattern){const C=mm("fill",this.layers,v,this.zoom,r);this.patternFeatures.push(C)}else this.addFeature(v,b,E,l,{});r.featureIndex.insert(e[E].feature,b,E,M,this.index)}}update(e,r,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,l)}addFeatures(e,r,l){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,r,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,jw),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,l,h,g){for(const _ of yl(r,500)){let v=0;for(const L of _)v+=L.length;const b=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray),E=b.vertexLength,M=[],C=[];for(const L of _){if(L.length===0)continue;L!==_[0]&&C.push(M.length/2);const O=this.segments2.prepareSegment(L.length,this.layoutVertexArray,this.indexArray2),F=O.vertexLength;this.layoutVertexArray.emplaceBack(L[0].x,L[0].y),this.indexArray2.emplaceBack(F+L.length-1,F),M.push(L[0].x),M.push(L[0].y);for(let G=1;G<L.length;G++)this.layoutVertexArray.emplaceBack(L[G].x,L[G].y),this.indexArray2.emplaceBack(F+G-1,F+G),M.push(L[G].x),M.push(L[G].y);O.vertexLength+=L.length,O.primitiveLength+=L.length}const k=Ny(M,C);for(let L=0;L<k.length;L+=3)this.indexArray.emplaceBack(E+k[L],E+k[L+1],E+k[L+2]);b.vertexLength+=v,b.primitiveLength+=k.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,g,h)}}let Gy,Hy;jt("FillBucket",gm,{omit:["layers","patternFeatures"]});var Jw={get paint(){return Hy=Hy||new m({"fill-antialias":new Gt(gt.paint_fill["fill-antialias"]),"fill-opacity":new ie(gt.paint_fill["fill-opacity"]),"fill-color":new ie(gt.paint_fill["fill-color"]),"fill-outline-color":new ie(gt.paint_fill["fill-outline-color"]),"fill-translate":new Gt(gt.paint_fill["fill-translate"]),"fill-translate-anchor":new Gt(gt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Fl(gt.paint_fill["fill-pattern"])})},get layout(){return Gy=Gy||new m({"fill-sort-key":new ie(gt.layout_fill["fill-sort-key"])})}};class Ww extends s{constructor(e){super(e,Jw)}recalculate(e,r){super.recalculate(e,r);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new gm(e)}queryRadius(){return jd(this.paint.get("fill-translate"))}queryIntersectsFeature(e,r,l,h,g,_,v){return zy(qd(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,v),h)}isTileClipped(){return!0}}const t2=x([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),e2=x([{name:"a_centroid",components:2,type:"Int16"}],4),{members:i2}=t2;var Rs={},n2=ct,Xy=Yl;function Yl(n,e,r,l,h){this.properties={},this.extent=r,this.type=0,this._pbf=n,this._geometry=-1,this._keys=l,this._values=h,n.readFields(a2,this,e)}function a2(n,e,r){n==1?e.id=r.readVarint():n==2?function(l,h){for(var g=l.readVarint()+l.pos;l.pos<g;){var _=h._keys[l.readVarint()],v=h._values[l.readVarint()];h.properties[_]=v}}(r,e):n==3?e.type=r.readVarint():n==4&&(e._geometry=r.pos)}function r2(n){for(var e,r,l=0,h=0,g=n.length,_=g-1;h<g;_=h++)l+=((r=n[_]).x-(e=n[h]).x)*(e.y+r.y);return l}Yl.types=["Unknown","Point","LineString","Polygon"],Yl.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var e,r=n.readVarint()+n.pos,l=1,h=0,g=0,_=0,v=[];n.pos<r;){if(h<=0){var b=n.readVarint();l=7&b,h=b>>3}if(h--,l===1||l===2)g+=n.readSVarint(),_+=n.readSVarint(),l===1&&(e&&v.push(e),e=[]),e.push(new n2(g,_));else{if(l!==7)throw new Error("unknown command "+l);e&&e.push(e[0].clone())}}return e&&v.push(e),v},Yl.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var e=n.readVarint()+n.pos,r=1,l=0,h=0,g=0,_=1/0,v=-1/0,b=1/0,E=-1/0;n.pos<e;){if(l<=0){var M=n.readVarint();r=7&M,l=M>>3}if(l--,r===1||r===2)(h+=n.readSVarint())<_&&(_=h),h>v&&(v=h),(g+=n.readSVarint())<b&&(b=g),g>E&&(E=g);else if(r!==7)throw new Error("unknown command "+r)}return[_,b,v,E]},Yl.prototype.toGeoJSON=function(n,e,r){var l,h,g=this.extent*Math.pow(2,r),_=this.extent*n,v=this.extent*e,b=this.loadGeometry(),E=Yl.types[this.type];function M(L){for(var O=0;O<L.length;O++){var F=L[O];L[O]=[360*(F.x+_)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(F.y+v)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var C=[];for(l=0;l<b.length;l++)C[l]=b[l][0];M(b=C);break;case 2:for(l=0;l<b.length;l++)M(b[l]);break;case 3:for(b=function(L){var O=L.length;if(O<=1)return[L];for(var F,G,Y=[],dt=0;dt<O;dt++){var et=r2(L[dt]);et!==0&&(G===void 0&&(G=et<0),G===et<0?(F&&Y.push(F),F=[L[dt]]):F.push(L[dt]))}return F&&Y.push(F),Y}(b),l=0;l<b.length;l++)for(h=0;h<b[l].length;h++)M(b[l][h])}b.length===1?b=b[0]:E="Multi"+E;var k={type:"Feature",geometry:{type:E,coordinates:b},properties:this.properties};return"id"in this&&(k.id=this.id),k};var s2=Xy,$y=Yy;function Yy(n,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(o2,this,e),this.length=this._features.length}function o2(n,e,r){n===15?e.version=r.readVarint():n===1?e.name=r.readString():n===5?e.extent=r.readVarint():n===2?e._features.push(r.pos):n===3?e._keys.push(r.readString()):n===4&&e._values.push(function(l){for(var h=null,g=l.readVarint()+l.pos;l.pos<g;){var _=l.readVarint()>>3;h=_===1?l.readString():_===2?l.readFloat():_===3?l.readDouble():_===4?l.readVarint64():_===5?l.readVarint():_===6?l.readSVarint():_===7?l.readBoolean():null}return h}(r))}Yy.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var e=this._pbf.readVarint()+this._pbf.pos;return new s2(this._pbf,e,this.extent,this._keys,this._values)};var l2=$y;function c2(n,e,r){if(n===3){var l=new l2(r,r.readVarint()+r.pos);l.length&&(e[l.name]=l)}}Rs.VectorTile=function(n,e){this.layers=n.readFields(c2,{},e)},Rs.VectorTileFeature=Xy,Rs.VectorTileLayer=$y;const u2=Rs.VectorTileFeature.types,_m=Math.pow(2,13);function Zu(n,e,r,l,h,g,_,v){n.emplaceBack(e,r,2*Math.floor(l*_m)+_,h*_m*2,g*_m*2,Math.round(v))}class ym{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Ms,this.centroidVertexArray=new Xi,this.indexArray=new oa,this.programConfigurations=new Fo(e.layers,e.zoom),this.segments=new Se,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,l){this.features=[],this.hasPattern=pm("fill-extrusion",this.layers,r);for(const{feature:h,id:g,index:_,sourceLayerIndex:v}of e){const b=this.layers[0]._featureFilter.needGeometry,E=No(h,b);if(!this.layers[0]._featureFilter.filter(new Qe(this.zoom),E,l))continue;const M={id:g,sourceLayerIndex:v,index:_,geometry:b?E.geometry:Uo(h),properties:h.properties,type:h.type,patterns:{}};this.hasPattern?this.features.push(mm("fill-extrusion",this.layers,M,this.zoom,r)):this.addFeature(M,M.geometry,_,l,{}),r.featureIndex.insert(h,M.geometry,_,v,this.index,!0)}}addFeatures(e,r,l){for(const h of this.features){const{geometry:g}=h;this.addFeature(h,g,h.index,r,l)}}update(e,r,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,l)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,i2),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,e2.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,l,h,g){for(const _ of yl(r,500)){const v={x:0,y:0,vertexCount:0};let b=0;for(const O of _)b+=O.length;let E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const O of _){if(O.length===0||d2(O))continue;let F=0;for(let G=0;G<O.length;G++){const Y=O[G];if(G>=1){const dt=O[G-1];if(!h2(Y,dt)){E.vertexLength+4>Se.MAX_VERTEX_ARRAY_LENGTH&&(E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const et=Y.sub(dt)._perp()._unit(),lt=dt.dist(Y);F+lt>32768&&(F=0),Zu(this.layoutVertexArray,Y.x,Y.y,et.x,et.y,0,0,F),Zu(this.layoutVertexArray,Y.x,Y.y,et.x,et.y,0,1,F),v.x+=2*Y.x,v.y+=2*Y.y,v.vertexCount+=2,F+=lt,Zu(this.layoutVertexArray,dt.x,dt.y,et.x,et.y,0,0,F),Zu(this.layoutVertexArray,dt.x,dt.y,et.x,et.y,0,1,F),v.x+=2*dt.x,v.y+=2*dt.y,v.vertexCount+=2;const _t=E.vertexLength;this.indexArray.emplaceBack(_t,_t+2,_t+1),this.indexArray.emplaceBack(_t+1,_t+2,_t+3),E.vertexLength+=4,E.primitiveLength+=2}}}}if(E.vertexLength+b>Se.MAX_VERTEX_ARRAY_LENGTH&&(E=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray)),u2[e.type]!=="Polygon")continue;const M=[],C=[],k=E.vertexLength;for(const O of _)if(O.length!==0){O!==_[0]&&C.push(M.length/2);for(let F=0;F<O.length;F++){const G=O[F];Zu(this.layoutVertexArray,G.x,G.y,0,0,1,1,0),v.x+=G.x,v.y+=G.y,v.vertexCount+=1,M.push(G.x),M.push(G.y)}}const L=Ny(M,C);for(let O=0;O<L.length;O+=3)this.indexArray.emplaceBack(k+L[O],k+L[O+2],k+L[O+1]);E.primitiveLength+=L.length/3,E.vertexLength+=b;for(let O=0;O<v.vertexCount;O++){const F=Math.floor(v.x/v.vertexCount),G=Math.floor(v.y/v.vertexCount);this.centroidVertexArray.emplaceBack(F,G)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,g,h)}}function h2(n,e){return n.x===e.x&&(n.x<0||n.x>wi)||n.y===e.y&&(n.y<0||n.y>wi)}function d2(n){return n.every(e=>e.x<0)||n.every(e=>e.x>wi)||n.every(e=>e.y<0)||n.every(e=>e.y>wi)}let Ky;jt("FillExtrusionBucket",ym,{omit:["layers","features"]});var f2={get paint(){return Ky=Ky||new m({"fill-extrusion-opacity":new Gt(gt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ie(gt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Gt(gt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Gt(gt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Fl(gt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ie(gt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ie(gt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Gt(gt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class p2 extends s{constructor(e){super(e,f2)}createBucket(e){return new ym(e)}queryRadius(){return jd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,r,l,h,g,_,v,b){const E=qd(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,v),M=this.paint.get("fill-extrusion-height").evaluate(r,l),C=this.paint.get("fill-extrusion-base").evaluate(r,l),k=function(O,F,G,Y){const dt=[];for(const et of O){const lt=[et.x,et.y,0,1];Zd(lt,lt,F),dt.push(new tt(lt[0]/lt[3],lt[1]/lt[3]))}return dt}(E,b),L=function(O,F,G,Y){const dt=[],et=[],lt=Y[8]*F,_t=Y[9]*F,At=Y[10]*F,Ft=Y[11]*F,ee=Y[8]*G,Lt=Y[9]*G,Rt=Y[10]*G,Yt=Y[11]*G;for(const Zt of O){const Vt=[],xt=[];for(const Kt of Zt){const $t=Kt.x,se=Kt.y,He=Y[0]*$t+Y[4]*se+Y[12],je=Y[1]*$t+Y[5]*se+Y[13],Ii=Y[2]*$t+Y[6]*se+Y[14],Ia=Y[3]*$t+Y[7]*se+Y[15],Ki=Ii+At,ki=Ia+Ft,vn=He+ee,xn=je+Lt,bn=Ii+Rt,fi=Ia+Yt,Ri=new tt((He+lt)/ki,(je+_t)/ki);Ri.z=Ki/ki,Vt.push(Ri);const cn=new tt(vn/fi,xn/fi);cn.z=bn/fi,xt.push(cn)}dt.push(Vt),et.push(xt)}return[dt,et]}(h,C,M,b);return function(O,F,G){let Y=1/0;zy(G,F)&&(Y=Qy(G,F[0]));for(let dt=0;dt<F.length;dt++){const et=F[dt],lt=O[dt];for(let _t=0;_t<et.length-1;_t++){const At=et[_t],Ft=[At,et[_t+1],lt[_t+1],lt[_t],At];My(G,Ft)&&(Y=Math.min(Y,Qy(G,Ft)))}}return Y!==1/0&&Y}(L[0],L[1],k)}}function Gu(n,e){return n.x*e.x+n.y*e.y}function Qy(n,e){if(n.length===1){let r=0;const l=e[r++];let h;for(;!h||l.equals(h);)if(h=e[r++],!h)return 1/0;for(;r<e.length;r++){const g=e[r],_=n[0],v=h.sub(l),b=g.sub(l),E=_.sub(l),M=Gu(v,v),C=Gu(v,b),k=Gu(b,b),L=Gu(E,v),O=Gu(E,b),F=M*k-C*C,G=(k*L-C*O)/F,Y=(M*O-C*L)/F,dt=l.z*(1-G-Y)+h.z*G+g.z*Y;if(isFinite(dt))return dt}return 1/0}{let r=1/0;for(const l of e)r=Math.min(r,l.z);return r}}const m2=x([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:g2}=m2,_2=x([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:y2}=_2,v2=Rs.VectorTileFeature.types,x2=Math.cos(Math.PI/180*37.5),Jy=Math.pow(2,14)/.5;class vm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Nl,this.layoutVertexArray2=new zs,this.indexArray=new oa,this.programConfigurations=new Fo(e.layers,e.zoom),this.segments=new Se,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,l){this.hasPattern=pm("line",this.layers,r);const h=this.layers[0].layout.get("line-sort-key"),g=!h.isConstant(),_=[];for(const{feature:v,id:b,index:E,sourceLayerIndex:M}of e){const C=this.layers[0]._featureFilter.needGeometry,k=No(v,C);if(!this.layers[0]._featureFilter.filter(new Qe(this.zoom),k,l))continue;const L=g?h.evaluate(k,{},l):void 0,O={id:b,properties:v.properties,type:v.type,sourceLayerIndex:M,index:E,geometry:C?k.geometry:Uo(v),patterns:{},sortKey:L};_.push(O)}g&&_.sort((v,b)=>v.sortKey-b.sortKey);for(const v of _){const{geometry:b,index:E,sourceLayerIndex:M}=v;if(this.hasPattern){const C=mm("line",this.layers,v,this.zoom,r);this.patternFeatures.push(C)}else this.addFeature(v,b,E,l,{});r.featureIndex.insert(e[E].feature,b,E,M,this.index)}}update(e,r,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,l)}addFeatures(e,r,l){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,r,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,y2)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,g2),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,l,h,g){const _=this.layers[0].layout,v=_.get("line-join").evaluate(e,{}),b=_.get("line-cap"),E=_.get("line-miter-limit"),M=_.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const C of r)this.addLine(C,e,v,b,E,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,g,h)}addLine(e,r,l,h,g,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Y=0;Y<e.length-1;Y++)this.totalDistance+=e[Y].dist(e[Y+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v=v2[r.type]==="Polygon";let b=e.length;for(;b>=2&&e[b-1].equals(e[b-2]);)b--;let E=0;for(;E<b-1&&e[E].equals(e[E+1]);)E++;if(b<(v?3:2))return;l==="bevel"&&(g=1.05);const M=this.overscaling<=16?15*wi/(512*this.overscaling):0,C=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let k,L,O,F,G;this.e1=this.e2=-1,v&&(k=e[b-2],G=e[E].sub(k)._unit()._perp());for(let Y=E;Y<b;Y++){if(O=Y===b-1?v?e[E+1]:void 0:e[Y+1],O&&e[Y].equals(O))continue;G&&(F=G),k&&(L=k),k=e[Y],G=O?O.sub(k)._unit()._perp():F,F=F||G;let dt=F.add(G);dt.x===0&&dt.y===0||dt._unit();const et=F.x*G.x+F.y*G.y,lt=dt.x*G.x+dt.y*G.y,_t=lt!==0?1/lt:1/0,At=2*Math.sqrt(2-2*lt),Ft=lt<x2&&L&&O,ee=F.x*G.y-F.y*G.x>0;if(Ft&&Y>E){const Yt=k.dist(L);if(Yt>2*M){const Zt=k.sub(k.sub(L)._mult(M/Yt)._round());this.updateDistance(L,Zt),this.addCurrentVertex(Zt,F,0,0,C),L=Zt}}const Lt=L&&O;let Rt=Lt?l:v?"butt":h;if(Lt&&Rt==="round"&&(_t<_?Rt="miter":_t<=2&&(Rt="fakeround")),Rt==="miter"&&_t>g&&(Rt="bevel"),Rt==="bevel"&&(_t>2&&(Rt="flipbevel"),_t<g&&(Rt="miter")),L&&this.updateDistance(L,k),Rt==="miter")dt._mult(_t),this.addCurrentVertex(k,dt,0,0,C);else if(Rt==="flipbevel"){if(_t>100)dt=G.mult(-1);else{const Yt=_t*F.add(G).mag()/F.sub(G).mag();dt._perp()._mult(Yt*(ee?-1:1))}this.addCurrentVertex(k,dt,0,0,C),this.addCurrentVertex(k,dt.mult(-1),0,0,C)}else if(Rt==="bevel"||Rt==="fakeround"){const Yt=-Math.sqrt(_t*_t-1),Zt=ee?Yt:0,Vt=ee?0:Yt;if(L&&this.addCurrentVertex(k,F,Zt,Vt,C),Rt==="fakeround"){const xt=Math.round(180*At/Math.PI/20);for(let Kt=1;Kt<xt;Kt++){let $t=Kt/xt;if($t!==.5){const He=$t-.5;$t+=$t*He*($t-1)*((1.0904+et*(et*(3.55645-1.43519*et)-3.2452))*He*He+(.848013+et*(.215638*et-1.06021)))}const se=G.sub(F)._mult($t)._add(F)._unit()._mult(ee?-1:1);this.addHalfVertex(k,se.x,se.y,!1,ee,0,C)}}O&&this.addCurrentVertex(k,G,-Zt,-Vt,C)}else if(Rt==="butt")this.addCurrentVertex(k,dt,0,0,C);else if(Rt==="square"){const Yt=L?1:-1;this.addCurrentVertex(k,dt,Yt,Yt,C)}else Rt==="round"&&(L&&(this.addCurrentVertex(k,F,0,0,C),this.addCurrentVertex(k,F,1,1,C,!0)),O&&(this.addCurrentVertex(k,G,-1,-1,C,!0),this.addCurrentVertex(k,G,0,0,C)));if(Ft&&Y<b-1){const Yt=k.dist(O);if(Yt>2*M){const Zt=k.add(O.sub(k)._mult(M/Yt)._round());this.updateDistance(k,Zt),this.addCurrentVertex(Zt,G,0,0,C),k=Zt}}}}addCurrentVertex(e,r,l,h,g,_=!1){const v=r.y*h-r.x,b=-r.y-r.x*h;this.addHalfVertex(e,r.x+r.y*l,r.y-r.x*l,_,!1,l,g),this.addHalfVertex(e,v,b,_,!0,-h,g),this.distance>Jy/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,r,l,h,g,_))}addHalfVertex({x:e,y:r},l,h,g,_,v,b){const E=.5*(this.lineClips?this.scaledDistance*(Jy-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(g?1:0),(r<<1)+(_?1:0),Math.round(63*l)+128,Math.round(63*h)+128,1+(v===0?0:v<0?-1:1)|(63&E)<<2,E>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const M=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),b.primitiveLength++),_?this.e2=M:this.e1=M}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}let Wy,t0;jt("LineBucket",vm,{omit:["layers","patternFeatures"]});var e0={get paint(){return t0=t0||new m({"line-opacity":new ie(gt.paint_line["line-opacity"]),"line-color":new ie(gt.paint_line["line-color"]),"line-translate":new Gt(gt.paint_line["line-translate"]),"line-translate-anchor":new Gt(gt.paint_line["line-translate-anchor"]),"line-width":new ie(gt.paint_line["line-width"]),"line-gap-width":new ie(gt.paint_line["line-gap-width"]),"line-offset":new ie(gt.paint_line["line-offset"]),"line-blur":new ie(gt.paint_line["line-blur"]),"line-dasharray":new Ul(gt.paint_line["line-dasharray"]),"line-pattern":new Fl(gt.paint_line["line-pattern"]),"line-gradient":new Lu(gt.paint_line["line-gradient"])})},get layout(){return Wy=Wy||new m({"line-cap":new Gt(gt.layout_line["line-cap"]),"line-join":new ie(gt.layout_line["line-join"]),"line-miter-limit":new Gt(gt.layout_line["line-miter-limit"]),"line-round-limit":new Gt(gt.layout_line["line-round-limit"]),"line-sort-key":new ie(gt.layout_line["line-sort-key"])})}};class b2 extends ie{possiblyEvaluate(e,r){return r=new Qe(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,l,h){return r=Nt({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,l,h)}}let $d;class w2 extends s{constructor(e){super(e,e0),this.gradientVersion=0,$d||($d=new b2(e0.paint.properties["line-width"].specification),$d.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(l){return l._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof ls,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,r){super.recalculate(e,r),this.paint._values["line-floorwidth"]=$d.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new vm(e)}queryRadius(e){const r=e,l=i0(Fu("line-width",this,r),Fu("line-gap-width",this,r)),h=Fu("line-offset",this,r);return l/2+Math.abs(h)+jd(this.paint.get("line-translate"))}queryIntersectsFeature(e,r,l,h,g,_,v){const b=qd(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,v),E=v/2*i0(this.paint.get("line-width").evaluate(r,l),this.paint.get("line-gap-width").evaluate(r,l)),M=this.paint.get("line-offset").evaluate(r,l);return M&&(h=function(C,k){const L=[];for(let O=0;O<C.length;O++){const F=C[O],G=[];for(let Y=0;Y<F.length;Y++){const dt=F[Y-1],et=F[Y],lt=F[Y+1],_t=Y===0?new tt(0,0):et.sub(dt)._unit()._perp(),At=Y===F.length-1?new tt(0,0):lt.sub(et)._unit()._perp(),Ft=_t._add(At)._unit(),ee=Ft.x*At.x+Ft.y*At.y;ee!==0&&Ft._mult(1/ee),G.push(Ft._mult(k)._add(et))}L.push(G)}return L}(h,M*v)),function(C,k,L){for(let O=0;O<k.length;O++){const F=k[O];if(C.length>=3){for(let G=0;G<F.length;G++)if(Hl(C,F[G]))return!0}if(Iw(C,F,L))return!0}return!1}(b,h,E)}isTileClipped(){return!0}}function i0(n,e){return e>0?e+2*n:n}const S2=x([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),T2=x([{name:"a_projected_pos",components:3,type:"Float32"}],4);x([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const A2=x([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);x([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const n0=x([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),E2=x([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function M2(n,e,r){return n.sections.forEach(l=>{l.text=function(h,g,_){const v=g.layout.get("text-transform").evaluate(_,{});return v==="uppercase"?h=h.toLocaleUpperCase():v==="lowercase"&&(h=h.toLocaleLowerCase()),kn.applyArabicShaping&&(h=kn.applyArabicShaping(h)),h}(l.text,e,r)}),n}x([{name:"triangle",components:3,type:"Uint16"}]),x([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),x([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),x([{type:"Float32",name:"offsetX"}]),x([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),x([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Hu={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Mi=24,a0=Ve,r0=function(n,e,r,l,h){var g,_,v=8*h-l-1,b=(1<<v)-1,E=b>>1,M=-7,C=h-1,k=-1,L=n[e+C];for(C+=k,g=L&(1<<-M)-1,L>>=-M,M+=v;M>0;g=256*g+n[e+C],C+=k,M-=8);for(_=g&(1<<-M)-1,g>>=-M,M+=l;M>0;_=256*_+n[e+C],C+=k,M-=8);if(g===0)g=1-E;else{if(g===b)return _?NaN:1/0*(L?-1:1);_+=Math.pow(2,l),g-=E}return(L?-1:1)*_*Math.pow(2,g-l)},s0=function(n,e,r,l,h,g){var _,v,b,E=8*g-h-1,M=(1<<E)-1,C=M>>1,k=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,L=0,O=1,F=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(v=isNaN(e)?1:0,_=M):(_=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-_))<1&&(_--,b*=2),(e+=_+C>=1?k/b:k*Math.pow(2,1-C))*b>=2&&(_++,b/=2),_+C>=M?(v=0,_=M):_+C>=1?(v=(e*b-1)*Math.pow(2,h),_+=C):(v=e*Math.pow(2,C-1)*Math.pow(2,h),_=0));h>=8;n[r+L]=255&v,L+=O,v/=256,h-=8);for(_=_<<h|v,E+=h;E>0;n[r+L]=255&_,L+=O,_/=256,E-=8);n[r+L-O]|=128*F};function Ve(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}Ve.Varint=0,Ve.Fixed64=1,Ve.Bytes=2,Ve.Fixed32=5;var xm=4294967296,o0=1/xm,l0=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function Or(n){return n.type===Ve.Bytes?n.readVarint()+n.pos:n.pos+1}function Kl(n,e,r){return r?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}function c0(n,e,r){var l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(l);for(var h=r.pos-1;h>=n;h--)r.buf[h+l]=r.buf[h]}function z2(n,e){for(var r=0;r<n.length;r++)e.writeVarint(n[r])}function C2(n,e){for(var r=0;r<n.length;r++)e.writeSVarint(n[r])}function D2(n,e){for(var r=0;r<n.length;r++)e.writeFloat(n[r])}function I2(n,e){for(var r=0;r<n.length;r++)e.writeDouble(n[r])}function k2(n,e){for(var r=0;r<n.length;r++)e.writeBoolean(n[r])}function R2(n,e){for(var r=0;r<n.length;r++)e.writeFixed32(n[r])}function P2(n,e){for(var r=0;r<n.length;r++)e.writeSFixed32(n[r])}function L2(n,e){for(var r=0;r<n.length;r++)e.writeFixed64(n[r])}function B2(n,e){for(var r=0;r<n.length;r++)e.writeSFixed64(n[r])}function Yd(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+16777216*n[e+3]}function Ql(n,e,r){n[r]=e,n[r+1]=e>>>8,n[r+2]=e>>>16,n[r+3]=e>>>24}function u0(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+(n[e+3]<<24)}Ve.prototype={destroy:function(){this.buf=null},readFields:function(n,e,r){for(r=r||this.length;this.pos<r;){var l=this.readVarint(),h=l>>3,g=this.pos;this.type=7&l,n(h,e,this),this.pos===g&&this.skip(l)}return e},readMessage:function(n,e){return this.readFields(n,e,this.readVarint()+this.pos)},readFixed32:function(){var n=Yd(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=u0(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=Yd(this.buf,this.pos)+Yd(this.buf,this.pos+4)*xm;return this.pos+=8,n},readSFixed64:function(){var n=Yd(this.buf,this.pos)+u0(this.buf,this.pos+4)*xm;return this.pos+=8,n},readFloat:function(){var n=r0(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=r0(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var e,r,l=this.buf;return e=127&(r=l[this.pos++]),r<128?e:(e|=(127&(r=l[this.pos++]))<<7,r<128?e:(e|=(127&(r=l[this.pos++]))<<14,r<128?e:(e|=(127&(r=l[this.pos++]))<<21,r<128?e:function(h,g,_){var v,b,E=_.buf;if(v=(112&(b=E[_.pos++]))>>4,b<128||(v|=(127&(b=E[_.pos++]))<<3,b<128)||(v|=(127&(b=E[_.pos++]))<<10,b<128)||(v|=(127&(b=E[_.pos++]))<<17,b<128)||(v|=(127&(b=E[_.pos++]))<<24,b<128)||(v|=(1&(b=E[_.pos++]))<<31,b<128))return Kl(h,v,g);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=l[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=12&&l0?function(r,l,h){return l0.decode(r.subarray(l,h))}(this.buf,e,n):function(r,l,h){for(var g="",_=l;_<h;){var v,b,E,M=r[_],C=null,k=M>239?4:M>223?3:M>191?2:1;if(_+k>h)break;k===1?M<128&&(C=M):k===2?(192&(v=r[_+1]))==128&&(C=(31&M)<<6|63&v)<=127&&(C=null):k===3?(b=r[_+2],(192&(v=r[_+1]))==128&&(192&b)==128&&((C=(15&M)<<12|(63&v)<<6|63&b)<=2047||C>=55296&&C<=57343)&&(C=null)):k===4&&(b=r[_+2],E=r[_+3],(192&(v=r[_+1]))==128&&(192&b)==128&&(192&E)==128&&((C=(15&M)<<18|(63&v)<<12|(63&b)<<6|63&E)<=65535||C>=1114112)&&(C=null)),C===null?(C=65533,k=1):C>65535&&(C-=65536,g+=String.fromCharCode(C>>>10&1023|55296),C=56320|1023&C),g+=String.fromCharCode(C),_+=k}return g}(this.buf,e,n)},readBytes:function(){var n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e},readPackedVarint:function(n,e){if(this.type!==Ve.Bytes)return n.push(this.readVarint(e));var r=Or(this);for(n=n||[];this.pos<r;)n.push(this.readVarint(e));return n},readPackedSVarint:function(n){if(this.type!==Ve.Bytes)return n.push(this.readSVarint());var e=Or(this);for(n=n||[];this.pos<e;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==Ve.Bytes)return n.push(this.readBoolean());var e=Or(this);for(n=n||[];this.pos<e;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==Ve.Bytes)return n.push(this.readFloat());var e=Or(this);for(n=n||[];this.pos<e;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==Ve.Bytes)return n.push(this.readDouble());var e=Or(this);for(n=n||[];this.pos<e;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==Ve.Bytes)return n.push(this.readFixed32());var e=Or(this);for(n=n||[];this.pos<e;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==Ve.Bytes)return n.push(this.readSFixed32());var e=Or(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==Ve.Bytes)return n.push(this.readFixed64());var e=Or(this);for(n=n||[];this.pos<e;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==Ve.Bytes)return n.push(this.readSFixed64());var e=Or(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed64());return n},skip:function(n){var e=7&n;if(e===Ve.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ve.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ve.Fixed32)this.pos+=4;else{if(e!==Ve.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(n,e){this.writeVarint(n<<3|e)},realloc:function(n){for(var e=this.length||16;e<this.pos+n;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),Ql(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),Ql(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),Ql(this.buf,-1&n,this.pos),Ql(this.buf,Math.floor(n*o0),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),Ql(this.buf,-1&n,this.pos),Ql(this.buf,Math.floor(n*o0),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(e,r){var l,h;if(e>=0?(l=e%4294967296|0,h=e/4294967296|0):(h=~(-e/4294967296),4294967295^(l=~(-e%4294967296))?l=l+1|0:(l=0,h=h+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(g,_,v){v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,v.buf[v.pos]=127&(g>>>=7)}(l,0,r),function(g,_){var v=(7&g)<<4;_.buf[_.pos++]|=v|((g>>>=3)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g)))))}(h,r)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var e=this.pos;this.pos=function(l,h,g){for(var _,v,b=0;b<h.length;b++){if((_=h.charCodeAt(b))>55295&&_<57344){if(!v){_>56319||b+1===h.length?(l[g++]=239,l[g++]=191,l[g++]=189):v=_;continue}if(_<56320){l[g++]=239,l[g++]=191,l[g++]=189,v=_;continue}_=v-55296<<10|_-56320|65536,v=null}else v&&(l[g++]=239,l[g++]=191,l[g++]=189,v=null);_<128?l[g++]=_:(_<2048?l[g++]=_>>6|192:(_<65536?l[g++]=_>>12|224:(l[g++]=_>>18|240,l[g++]=_>>12&63|128),l[g++]=_>>6&63|128),l[g++]=63&_|128)}return g}(this.buf,n,this.pos);var r=this.pos-e;r>=128&&c0(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(n){this.realloc(4),s0(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),s0(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var e=n.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=n[r]},writeRawMessage:function(n,e){this.pos++;var r=this.pos;n(e,this);var l=this.pos-r;l>=128&&c0(r,l,this),this.pos=r-1,this.writeVarint(l),this.pos+=l},writeMessage:function(n,e,r){this.writeTag(n,Ve.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(n,e){e.length&&this.writeMessage(n,z2,e)},writePackedSVarint:function(n,e){e.length&&this.writeMessage(n,C2,e)},writePackedBoolean:function(n,e){e.length&&this.writeMessage(n,k2,e)},writePackedFloat:function(n,e){e.length&&this.writeMessage(n,D2,e)},writePackedDouble:function(n,e){e.length&&this.writeMessage(n,I2,e)},writePackedFixed32:function(n,e){e.length&&this.writeMessage(n,R2,e)},writePackedSFixed32:function(n,e){e.length&&this.writeMessage(n,P2,e)},writePackedFixed64:function(n,e){e.length&&this.writeMessage(n,L2,e)},writePackedSFixed64:function(n,e){e.length&&this.writeMessage(n,B2,e)},writeBytesField:function(n,e){this.writeTag(n,Ve.Bytes),this.writeBytes(e)},writeFixed32Field:function(n,e){this.writeTag(n,Ve.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(n,e){this.writeTag(n,Ve.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(n,e){this.writeTag(n,Ve.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(n,e){this.writeTag(n,Ve.Fixed64),this.writeSFixed64(e)},writeVarintField:function(n,e){this.writeTag(n,Ve.Varint),this.writeVarint(e)},writeSVarintField:function(n,e){this.writeTag(n,Ve.Varint),this.writeSVarint(e)},writeStringField:function(n,e){this.writeTag(n,Ve.Bytes),this.writeString(e)},writeFloatField:function(n,e){this.writeTag(n,Ve.Fixed32),this.writeFloat(e)},writeDoubleField:function(n,e){this.writeTag(n,Ve.Fixed64),this.writeDouble(e)},writeBooleanField:function(n,e){this.writeVarintField(n,!!e)}};var bm=q(a0);const wm=3;function O2(n,e,r){n===1&&r.readMessage(F2,e)}function F2(n,e,r){if(n===3){const{id:l,bitmap:h,width:g,height:_,left:v,top:b,advance:E}=r.readMessage(U2,{});e.push({id:l,bitmap:new Nu({width:g+2*wm,height:_+2*wm},h),metrics:{width:g,height:_,left:v,top:b,advance:E}})}}function U2(n,e,r){n===1?e.id=r.readVarint():n===2?e.bitmap=r.readBytes():n===3?e.width=r.readVarint():n===4?e.height=r.readVarint():n===5?e.left=r.readSVarint():n===6?e.top=r.readSVarint():n===7&&(e.advance=r.readVarint())}const h0=wm;function d0(n){let e=0,r=0;for(const _ of n)e+=_.w*_.h,r=Math.max(r,_.w);n.sort((_,v)=>v.h-_.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let h=0,g=0;for(const _ of n)for(let v=l.length-1;v>=0;v--){const b=l[v];if(!(_.w>b.w||_.h>b.h)){if(_.x=b.x,_.y=b.y,g=Math.max(g,_.y+_.h),h=Math.max(h,_.x+_.w),_.w===b.w&&_.h===b.h){const E=l.pop();v<l.length&&(l[v]=E)}else _.h===b.h?(b.x+=_.w,b.w-=_.w):_.w===b.w?(b.y+=_.h,b.h-=_.h):(l.push({x:b.x+_.w,y:b.y,w:b.w-_.w,h:_.h}),b.y+=_.h,b.h-=_.h);break}}return{w:h,h:g,fill:e/(h*g)||0}}const Pn=1;class Sm{constructor(e,{pixelRatio:r,version:l,stretchX:h,stretchY:g,content:_,textFitWidth:v,textFitHeight:b}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=h,this.stretchY=g,this.content=_,this.version=l,this.textFitWidth=v,this.textFitHeight=b}get tl(){return[this.paddedRect.x+Pn,this.paddedRect.y+Pn]}get br(){return[this.paddedRect.x+this.paddedRect.w-Pn,this.paddedRect.y+this.paddedRect.h-Pn]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Pn)/this.pixelRatio,(this.paddedRect.h-2*Pn)/this.pixelRatio]}}class f0{constructor(e,r){const l={},h={};this.haveRenderCallbacks=[];const g=[];this.addImages(e,l,g),this.addImages(r,h,g);const{w:_,h:v}=d0(g),b=new la({width:_||1,height:v||1});for(const E in e){const M=e[E],C=l[E].paddedRect;la.copy(M.data,b,{x:0,y:0},{x:C.x+Pn,y:C.y+Pn},M.data)}for(const E in r){const M=r[E],C=h[E].paddedRect,k=C.x+Pn,L=C.y+Pn,O=M.data.width,F=M.data.height;la.copy(M.data,b,{x:0,y:0},{x:k,y:L},M.data),la.copy(M.data,b,{x:0,y:F-1},{x:k,y:L-1},{width:O,height:1}),la.copy(M.data,b,{x:0,y:0},{x:k,y:L+F},{width:O,height:1}),la.copy(M.data,b,{x:O-1,y:0},{x:k-1,y:L},{width:1,height:F}),la.copy(M.data,b,{x:0,y:0},{x:k+O,y:L},{width:1,height:F})}this.image=b,this.iconPositions=l,this.patternPositions=h}addImages(e,r,l){for(const h in e){const g=e[h],_={x:0,y:0,w:g.data.width+2*Pn,h:g.data.height+2*Pn};l.push(_),r[h]=new Sm(_,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in e.updatedImages)this.patchUpdatedImage(this.iconPositions[l],e.getImage(l),r),this.patchUpdatedImage(this.patternPositions[l],e.getImage(l),r)}patchUpdatedImage(e,r,l){if(!e||!r||e.version===r.version)return;e.version=r.version;const[h,g]=e.tl;l.update(r.data,void 0,{x:h,y:g})}}var Ps;jt("ImagePosition",Sm),jt("ImageAtlas",f0),T.ah=void 0,(Ps=T.ah||(T.ah={}))[Ps.none=0]="none",Ps[Ps.horizontal=1]="horizontal",Ps[Ps.vertical=2]="vertical",Ps[Ps.horizontalOnly=3]="horizontalOnly";const Xu=-17;class $u{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const l=new $u;return l.scale=e||1,l.fontStack=r,l}static forImage(e){const r=new $u;return r.imageName=e,r}}class Jl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const l=new Jl;for(let h=0;h<e.sections.length;h++){const g=e.sections[h];g.image?l.addImageSection(g):l.addTextSection(g,r)}return l}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let l=0;l<e.length;l++){const h=e.charCodeAt(l+1)||null,g=e.charCodeAt(l-1)||null;r+=h&&Ld(h)&&!Hu[e[l+1]]||g&&Ld(g)&&!Hu[e[l-1]]||!Hu[e[l]]?e[l]:Hu[e[l]]}return r}(this.text)}trim(){let e=0;for(let l=0;l<this.text.length&&Qd[this.text.charCodeAt(l)];l++)e++;let r=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&Qd[this.text.charCodeAt(l)];l--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const l=new Jl;return l.text=this.text.substring(e,r),l.sectionIndex=this.sectionIndex.slice(e,r),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push($u.forText(e.scale,e.fontStack||r));const l=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(l)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void Ai("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push($u.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Ai("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Kd(n,e,r,l,h,g,_,v,b,E,M,C,k,L,O){const F=Jl.fromFeature(n,h);let G;C===T.ah.vertical&&F.verticalizePunctuation();const{processBidirectionalText:Y,processStyledBidirectionalText:dt}=kn;if(Y&&F.sections.length===1){G=[];const _t=Y(F.toString(),Tm(F,E,g,e,l,L));for(const At of _t){const Ft=new Jl;Ft.text=At,Ft.sections=F.sections;for(let ee=0;ee<At.length;ee++)Ft.sectionIndex.push(0);G.push(Ft)}}else if(dt){G=[];const _t=dt(F.text,F.sectionIndex,Tm(F,E,g,e,l,L));for(const At of _t){const Ft=new Jl;Ft.text=At[0],Ft.sectionIndex=At[1],Ft.sections=F.sections,G.push(Ft)}}else G=function(_t,At){const Ft=[],ee=_t.text;let Lt=0;for(const Rt of At)Ft.push(_t.substring(Lt,Rt)),Lt=Rt;return Lt<ee.length&&Ft.push(_t.substring(Lt,ee.length)),Ft}(F,Tm(F,E,g,e,l,L));const et=[],lt={positionedLines:et,text:F.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:C,iconsInText:!1,verticalizable:!1};return function(_t,At,Ft,ee,Lt,Rt,Yt,Zt,Vt,xt,Kt,$t){let se=0,He=Xu,je=0,Ii=0;const Ia=Zt==="right"?1:Zt==="left"?0:.5;let Ki=0;for(const fi of Lt){fi.trim();const Ri=fi.getMaxScale(),cn=(Ri-1)*Mi,Qi={positionedGlyphs:[],lineOffset:0};_t.positionedLines[Ki]=Qi;const wn=Qi.positionedGlyphs;let Ji=0;if(!fi.length()){He+=Rt,++Ki;continue}for(let Ln=0;Ln<fi.length();Ln++){const Ie=fi.getSection(Ln),$e=fi.getSectionIndex(Ln),ei=fi.getCharCode(Ln);let Xn=0,ci=null,ic=null,cr=null,ur=Mi;const ka=!(Vt===T.ah.horizontal||!Kt&&!Ru(ei)||Kt&&(Qd[ei]||(ki=ei,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(ki)))));if(Ie.imageName){const ha=ee[Ie.imageName];if(!ha)continue;cr=Ie.imageName,_t.iconsInText=_t.iconsInText||!0,ic=ha.paddedRect;const Ui=ha.displaySize;Ie.scale=Ie.scale*Mi/$t,ci={width:Ui[0],height:Ui[1],left:Pn,top:-h0,advance:ka?Ui[1]:Ui[0]},Xn=cn+(Mi-Ui[1]*Ie.scale),ur=ci.advance;const Fr=ka?Ui[0]*Ie.scale-Mi*Ri:Ui[1]*Ie.scale-Mi*Ri;Fr>0&&Fr>Ji&&(Ji=Fr)}else{const ha=Ft[Ie.fontStack],Ui=ha&&ha[ei];if(Ui&&Ui.rect)ic=Ui.rect,ci=Ui.metrics;else{const Fr=At[Ie.fontStack],th=Fr&&Fr[ei];if(!th)continue;ci=th.metrics}Xn=(Ri-Ie.scale)*Mi}ka?(_t.verticalizable=!0,wn.push({glyph:ei,imageName:cr,x:se,y:He+Xn,vertical:ka,scale:Ie.scale,fontStack:Ie.fontStack,sectionIndex:$e,metrics:ci,rect:ic}),se+=ur*Ie.scale+xt):(wn.push({glyph:ei,imageName:cr,x:se,y:He+Xn,vertical:ka,scale:Ie.scale,fontStack:Ie.fontStack,sectionIndex:$e,metrics:ci,rect:ic}),se+=ci.advance*Ie.scale+xt)}wn.length!==0&&(je=Math.max(se-xt,je),q2(wn,0,wn.length-1,Ia,Ji)),se=0;const ua=Rt*Ri+Ji;Qi.lineOffset=Math.max(Ji,cn),He+=ua,Ii=Math.max(ua,Ii),++Ki}var ki;const vn=He-Xu,{horizontalAlign:xn,verticalAlign:bn}=Am(Yt);(function(fi,Ri,cn,Qi,wn,Ji,ua,Ln,Ie){const $e=(Ri-cn)*wn;let ei=0;ei=Ji!==ua?-Ln*Qi-Xu:(-Qi*Ie+.5)*ua;for(const Xn of fi)for(const ci of Xn.positionedGlyphs)ci.x+=$e,ci.y+=ei})(_t.positionedLines,Ia,xn,bn,je,Ii,Rt,vn,Lt.length),_t.top+=-bn*vn,_t.bottom=_t.top+vn,_t.left+=-xn*je,_t.right=_t.left+je}(lt,e,r,l,G,_,v,b,C,E,k,O),!function(_t){for(const At of _t)if(At.positionedGlyphs.length!==0)return!1;return!0}(et)&&lt}const Qd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},N2={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},V2={40:!0};function p0(n,e,r,l,h,g){if(e.imageName){const _=l[e.imageName];return _?_.displaySize[0]*e.scale*Mi/g+h:0}{const _=r[e.fontStack],v=_&&_[n];return v?v.metrics.advance*e.scale+h:0}}function m0(n,e,r,l){const h=Math.pow(n-e,2);return l?n<e?h/2:2*h:h+Math.abs(r)*r}function j2(n,e,r){let l=0;return n===10&&(l-=1e4),r&&(l+=150),n!==40&&n!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function g0(n,e,r,l,h,g){let _=null,v=m0(e,r,h,g);for(const b of l){const E=m0(e-b.x,r,h,g)+b.badness;E<=v&&(_=b,v=E)}return{index:n,x:e,priorBreak:_,badness:v}}function _0(n){return n?_0(n.priorBreak).concat(n.index):[]}function Tm(n,e,r,l,h,g){if(!n)return[];const _=[],v=function(C,k,L,O,F,G){let Y=0;for(let dt=0;dt<C.length();dt++){const et=C.getSection(dt);Y+=p0(C.getCharCode(dt),et,O,F,k,G)}return Y/Math.max(1,Math.ceil(Y/L))}(n,e,r,l,h,g),b=n.text.indexOf("")>=0;let E=0;for(let C=0;C<n.length();C++){const k=n.getSection(C),L=n.getCharCode(C);if(Qd[L]||(E+=p0(L,k,l,h,e,g)),C<n.length()-1){const O=!((M=L)<11904)&&(!!we["CJK Compatibility Forms"](M)||!!we["CJK Compatibility"](M)||!!we["CJK Strokes"](M)||!!we["CJK Symbols and Punctuation"](M)||!!we["Enclosed CJK Letters and Months"](M)||!!we["Halfwidth and Fullwidth Forms"](M)||!!we["Ideographic Description Characters"](M)||!!we["Vertical Forms"](M)||Pd.test(String.fromCodePoint(M)));(N2[L]||O||k.imageName||C!==n.length()-2&&V2[n.getCharCode(C+1)])&&_.push(g0(C+1,E,v,_,j2(L,n.getCharCode(C+1),O&&b),!1))}}var M;return _0(g0(n.length(),E,v,_,0,!0))}function Am(n){let e=.5,r=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function q2(n,e,r,l,h){if(!l&&!h)return;const g=n[r],_=(n[r].x+g.metrics.advance*g.scale)*l;for(let v=e;v<=r;v++)n[v].x-=_,n[v].y+=h}function Z2(n,e,r){const{horizontalAlign:l,verticalAlign:h}=Am(r),g=e[0]-n.displaySize[0]*l,_=e[1]-n.displaySize[1]*h;return{image:n,top:_,bottom:_+n.displaySize[1],left:g,right:g+n.displaySize[0]}}function y0(n){var e,r;let l=n.left,h=n.top,g=n.right-l,_=n.bottom-h;const v=(e=n.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",b=(r=n.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",E=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(b==="proportional"){if(v==="stretchOnly"&&g/_<E||v==="proportional"){const M=Math.ceil(_*E);l*=M/g,g=M}}else if(v==="proportional"&&b==="stretchOnly"&&E!==0&&g/_>E){const M=Math.ceil(g/E);h*=M/_,_=M}return{x1:l,y1:h,x2:l+g,y2:h+_}}function v0(n,e,r,l,h,g){const _=n.image;let v;if(_.content){const G=_.content,Y=_.pixelRatio||1;v=[G[0]/Y,G[1]/Y,_.displaySize[0]-G[2]/Y,_.displaySize[1]-G[3]/Y]}const b=e.left*g,E=e.right*g;let M,C,k,L;r==="width"||r==="both"?(L=h[0]+b-l[3],C=h[0]+E+l[1]):(L=h[0]+(b+E-_.displaySize[0])/2,C=L+_.displaySize[0]);const O=e.top*g,F=e.bottom*g;return r==="height"||r==="both"?(M=h[1]+O-l[0],k=h[1]+F+l[2]):(M=h[1]+(O+F-_.displaySize[1])/2,k=M+_.displaySize[1]),{image:_,top:M,right:C,bottom:k,left:L,collisionPadding:v}}const Yu=255,lr=128,Ls=Yu*lr;function x0(n,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Qe(n+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:h}=r;let g=0;for(;g<l.length&&l[g]<=n;)g++;g=Math.max(0,g-1);let _=g;for(;_<l.length&&l[_]<n+1;)_++;_=Math.min(l.length-1,_);const v=l[g],b=l[_];return r.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:b,interpolationType:h}:{kind:"camera",minZoom:v,maxZoom:b,minSize:r.evaluate(new Qe(v)),maxSize:r.evaluate(new Qe(b)),interpolationType:h}}}function Em(n,e,r){let l="never";const h=n.get(e);return h?l=h:n.get(r)&&(l="always"),l}const G2=Rs.VectorTileFeature.types,H2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Jd(n,e,r,l,h,g,_,v,b,E,M,C,k){const L=v?Math.min(Ls,Math.round(v[0])):0,O=v?Math.min(Ls,Math.round(v[1])):0;n.emplaceBack(e,r,Math.round(32*l),Math.round(32*h),g,_,(L<<1)+(b?1:0),O,16*E,16*M,256*C,256*k)}function Mm(n,e,r){n.emplaceBack(e.x,e.y,r),n.emplaceBack(e.x,e.y,r),n.emplaceBack(e.x,e.y,r),n.emplaceBack(e.x,e.y,r)}function X2(n){for(const e of n.sections)if(em(e.text))return!0;return!1}class zm{constructor(e){this.layoutVertexArray=new Vl,this.indexArray=new oa,this.programConfigurations=e,this.segments=new Se,this.dynamicLayoutVertexArray=new Bu,this.opacityVertexArray=new Gn,this.hasVisibleVertices=!1,this.placedSymbolArray=new Je}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,l,h){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,S2.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,T2.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,H2,!0),this.opacityVertexBuffer.itemSize=1),(l||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}jt("SymbolBuffers",zm);class Cm{constructor(e,r,l){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new l,this.segments=new Se,this.collisionVertexArray=new sr}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,A2.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}jt("CollisionBuffers",Cm);class Wl{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(_=>_.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=lm([]),this.placementViewportMatrix=lm([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=x0(this.zoom,r["text-size"]),this.iconSizeData=x0(this.zoom,r["icon-size"]);const l=this.layers[0].layout,h=l.get("symbol-sort-key"),g=l.get("symbol-z-order");this.canOverlap=Em(l,"text-overlap","text-allow-overlap")!=="never"||Em(l,"icon-overlap","icon-allow-overlap")!=="never"||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&!h.isConstant(),this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map(_=>T.ah[_])),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=e.sourceID}createArrays(){this.text=new zm(new Fo(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new zm(new Fo(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new We,this.lineVertexArray=new Hi,this.symbolInstances=new be,this.textAnchorOffsets=new ti}calculateGlyphDependencies(e,r,l,h,g){for(let _=0;_<e.length;_++)if(r[e.charCodeAt(_)]=!0,(l||h)&&g){const v=Hu[e.charAt(_)];v&&(r[v.charCodeAt(0)]=!0)}}populate(e,r,l){const h=this.layers[0],g=h.layout,_=g.get("text-font"),v=g.get("text-field"),b=g.get("icon-image"),E=(v.value.kind!=="constant"||v.value.value instanceof zn&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(_.value.kind!=="constant"||_.value.value.length>0),M=b.value.kind!=="constant"||!!b.value.value||Object.keys(b.parameters).length>0,C=g.get("symbol-sort-key");if(this.features=[],!E&&!M)return;const k=r.iconDependencies,L=r.glyphDependencies,O=r.availableImages,F=new Qe(this.zoom);for(const{feature:G,id:Y,index:dt,sourceLayerIndex:et}of e){const lt=h._featureFilter.needGeometry,_t=No(G,lt);if(!h._featureFilter.filter(F,_t,l))continue;let At,Ft;if(lt||(_t.geometry=Uo(G)),E){const Lt=h.getValueAndResolveTokens("text-field",_t,l,O),Rt=zn.factory(Lt),Yt=this.hasRTLText=this.hasRTLText||X2(Rt);(!Yt||kn.getRTLTextPluginStatus()==="unavailable"||Yt&&kn.isParsed())&&(At=M2(Rt,h,_t))}if(M){const Lt=h.getValueAndResolveTokens("icon-image",_t,l,O);Ft=Lt instanceof Dn?Lt:Dn.fromString(Lt)}if(!At&&!Ft)continue;const ee=this.sortFeaturesByKey?C.evaluate(_t,{},l):void 0;if(this.features.push({id:Y,text:At,icon:Ft,index:dt,sourceLayerIndex:et,geometry:_t.geometry,properties:G.properties,type:G2[G.type],sortKey:ee}),Ft&&(k[Ft.name]=!0),At){const Lt=_.evaluate(_t,{},l).join(","),Rt=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(T.ah.vertical)>=0;for(const Yt of At.sections)if(Yt.image)k[Yt.image.name]=!0;else{const Zt=Iu(At.toString()),Vt=Yt.fontStack||Lt,xt=L[Vt]=L[Vt]||{};this.calculateGlyphDependencies(Yt.text,xt,Rt,this.allowVerticalPlacement,Zt)}}}g.get("symbol-placement")==="line"&&(this.features=function(G){const Y={},dt={},et=[];let lt=0;function _t(Lt){et.push(G[Lt]),lt++}function At(Lt,Rt,Yt){const Zt=dt[Lt];return delete dt[Lt],dt[Rt]=Zt,et[Zt].geometry[0].pop(),et[Zt].geometry[0]=et[Zt].geometry[0].concat(Yt[0]),Zt}function Ft(Lt,Rt,Yt){const Zt=Y[Rt];return delete Y[Rt],Y[Lt]=Zt,et[Zt].geometry[0].shift(),et[Zt].geometry[0]=Yt[0].concat(et[Zt].geometry[0]),Zt}function ee(Lt,Rt,Yt){const Zt=Yt?Rt[0][Rt[0].length-1]:Rt[0][0];return`${Lt}:${Zt.x}:${Zt.y}`}for(let Lt=0;Lt<G.length;Lt++){const Rt=G[Lt],Yt=Rt.geometry,Zt=Rt.text?Rt.text.toString():null;if(!Zt){_t(Lt);continue}const Vt=ee(Zt,Yt),xt=ee(Zt,Yt,!0);if(Vt in dt&&xt in Y&&dt[Vt]!==Y[xt]){const Kt=Ft(Vt,xt,Yt),$t=At(Vt,xt,et[Kt].geometry);delete Y[Vt],delete dt[xt],dt[ee(Zt,et[$t].geometry,!0)]=$t,et[Kt].geometry=null}else Vt in dt?At(Vt,xt,Yt):xt in Y?Ft(Vt,xt,Yt):(_t(Lt),Y[Vt]=lt-1,dt[xt]=lt-1)}return et.filter(Lt=>Lt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((G,Y)=>G.sortKey-Y.sortKey)}update(e,r,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,l),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,l))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const l=this.lineVertexArray.length;if(e.segment!==void 0){let h=e.dist(r[e.segment+1]),g=e.dist(r[e.segment]);const _={};for(let v=e.segment+1;v<r.length;v++)_[v]={x:r[v].x,y:r[v].y,tileUnitDistanceFromAnchor:h},v<r.length-1&&(h+=r[v+1].dist(r[v]));for(let v=e.segment||0;v>=0;v--)_[v]={x:r[v].x,y:r[v].y,tileUnitDistanceFromAnchor:g},v>0&&(g+=r[v-1].dist(r[v]));for(let v=0;v<r.length;v++){const b=_[v];this.lineVertexArray.emplaceBack(b.x,b.y,b.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,r,l,h,g,_,v,b,E,M,C,k){const L=e.indexArray,O=e.layoutVertexArray,F=e.segments.prepareSegment(4*r.length,O,L,this.canOverlap?_.sortKey:void 0),G=this.glyphOffsetArray.length,Y=F.vertexLength,dt=this.allowVerticalPlacement&&v===T.ah.vertical?Math.PI/2:0,et=_.text&&_.text.sections;for(let lt=0;lt<r.length;lt++){const{tl:_t,tr:At,bl:Ft,br:ee,tex:Lt,pixelOffsetTL:Rt,pixelOffsetBR:Yt,minFontScaleX:Zt,minFontScaleY:Vt,glyphOffset:xt,isSDF:Kt,sectionIndex:$t}=r[lt],se=F.vertexLength,He=xt[1];Jd(O,b.x,b.y,_t.x,He+_t.y,Lt.x,Lt.y,l,Kt,Rt.x,Rt.y,Zt,Vt),Jd(O,b.x,b.y,At.x,He+At.y,Lt.x+Lt.w,Lt.y,l,Kt,Yt.x,Rt.y,Zt,Vt),Jd(O,b.x,b.y,Ft.x,He+Ft.y,Lt.x,Lt.y+Lt.h,l,Kt,Rt.x,Yt.y,Zt,Vt),Jd(O,b.x,b.y,ee.x,He+ee.y,Lt.x+Lt.w,Lt.y+Lt.h,l,Kt,Yt.x,Yt.y,Zt,Vt),Mm(e.dynamicLayoutVertexArray,b,dt),L.emplaceBack(se,se+1,se+2),L.emplaceBack(se+1,se+2,se+3),F.vertexLength+=4,F.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(xt[0]),lt!==r.length-1&&$t===r[lt+1].sectionIndex||e.programConfigurations.populatePaintArrays(O.length,_,_.index,{},k,et&&et[$t])}e.placedSymbolArray.emplaceBack(b.x,b.y,G,this.glyphOffsetArray.length-G,Y,E,M,b.segment,l?l[0]:0,l?l[1]:0,h[0],h[1],v,0,!1,0,C)}_addCollisionDebugVertex(e,r,l,h,g,_){return r.emplaceBack(0,0),e.emplaceBack(l.x,l.y,h,g,Math.round(_.x),Math.round(_.y))}addCollisionDebugVertices(e,r,l,h,g,_,v){const b=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),E=b.vertexLength,M=g.layoutVertexArray,C=g.collisionVertexArray,k=v.anchorX,L=v.anchorY;this._addCollisionDebugVertex(M,C,_,k,L,new tt(e,r)),this._addCollisionDebugVertex(M,C,_,k,L,new tt(l,r)),this._addCollisionDebugVertex(M,C,_,k,L,new tt(l,h)),this._addCollisionDebugVertex(M,C,_,k,L,new tt(e,h)),b.vertexLength+=4;const O=g.indexArray;O.emplaceBack(E,E+1),O.emplaceBack(E+1,E+2),O.emplaceBack(E+2,E+3),O.emplaceBack(E+3,E),b.primitiveLength+=4}addDebugCollisionBoxes(e,r,l,h){for(let g=e;g<r;g++){const _=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(_.x1,_.y1,_.x2,_.y2,h?this.textCollisionBox:this.iconCollisionBox,_.anchorPoint,l)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Cm(Hn,n0.members,Fi),this.iconCollisionBox=new Cm(Hn,n0.members,Fi);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,l,h,g,_,v,b,E){const M={};for(let C=r;C<l;C++){const k=e.get(C);M.textBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,anchorPointX:k.anchorPointX,anchorPointY:k.anchorPointY},M.textFeatureIndex=k.featureIndex;break}for(let C=h;C<g;C++){const k=e.get(C);M.verticalTextBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,anchorPointX:k.anchorPointX,anchorPointY:k.anchorPointY},M.verticalTextFeatureIndex=k.featureIndex;break}for(let C=_;C<v;C++){const k=e.get(C);M.iconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,anchorPointX:k.anchorPointX,anchorPointY:k.anchorPointY},M.iconFeatureIndex=k.featureIndex;break}for(let C=b;C<E;C++){const k=e.get(C);M.verticalIconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,anchorPointX:k.anchorPointX,anchorPointY:k.anchorPointY},M.verticalIconFeatureIndex=k.featureIndex;break}return M}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const l=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const l=e.placedSymbolArray.get(r),h=l.vertexStartIndex+4*l.numGlyphs;for(let g=l.vertexStartIndex;g<h;g+=4)e.indexArray.emplaceBack(g,g+1,g+2),e.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),l=Math.cos(e),h=[],g=[],_=[];for(let v=0;v<this.symbolInstances.length;++v){_.push(v);const b=this.symbolInstances.get(v);h.push(0|Math.round(r*b.anchorX+l*b.anchorY)),g.push(b.featureIndex)}return _.sort((v,b)=>h[v]-h[b]||g[b]-g[v]),_}addToSortKeyRanges(e,r){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===r?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const l=this.symbolInstances.get(r);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach((h,g,_)=>{h>=0&&_.indexOf(h)===g&&this.addIndicesForPlacedSymbol(this.text,h)}),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let b0,w0;jt("SymbolBucket",Wl,{omit:["layers","collisionBoxArray","features","compareText"]}),Wl.MAX_GLYPHS=65535,Wl.addDynamicAttributes=Mm;var Dm={get paint(){return w0=w0||new m({"icon-opacity":new ie(gt.paint_symbol["icon-opacity"]),"icon-color":new ie(gt.paint_symbol["icon-color"]),"icon-halo-color":new ie(gt.paint_symbol["icon-halo-color"]),"icon-halo-width":new ie(gt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ie(gt.paint_symbol["icon-halo-blur"]),"icon-translate":new Gt(gt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Gt(gt.paint_symbol["icon-translate-anchor"]),"text-opacity":new ie(gt.paint_symbol["text-opacity"]),"text-color":new ie(gt.paint_symbol["text-color"],{runtimeType:pn,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new ie(gt.paint_symbol["text-halo-color"]),"text-halo-width":new ie(gt.paint_symbol["text-halo-width"]),"text-halo-blur":new ie(gt.paint_symbol["text-halo-blur"]),"text-translate":new Gt(gt.paint_symbol["text-translate"]),"text-translate-anchor":new Gt(gt.paint_symbol["text-translate-anchor"])})},get layout(){return b0=b0||new m({"symbol-placement":new Gt(gt.layout_symbol["symbol-placement"]),"symbol-spacing":new Gt(gt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Gt(gt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ie(gt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Gt(gt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Gt(gt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Gt(gt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Gt(gt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Gt(gt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Gt(gt.layout_symbol["icon-rotation-alignment"]),"icon-size":new ie(gt.layout_symbol["icon-size"]),"icon-text-fit":new Gt(gt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Gt(gt.layout_symbol["icon-text-fit-padding"]),"icon-image":new ie(gt.layout_symbol["icon-image"]),"icon-rotate":new ie(gt.layout_symbol["icon-rotate"]),"icon-padding":new ie(gt.layout_symbol["icon-padding"]),"icon-keep-upright":new Gt(gt.layout_symbol["icon-keep-upright"]),"icon-offset":new ie(gt.layout_symbol["icon-offset"]),"icon-anchor":new ie(gt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Gt(gt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Gt(gt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Gt(gt.layout_symbol["text-rotation-alignment"]),"text-field":new ie(gt.layout_symbol["text-field"]),"text-font":new ie(gt.layout_symbol["text-font"]),"text-size":new ie(gt.layout_symbol["text-size"]),"text-max-width":new ie(gt.layout_symbol["text-max-width"]),"text-line-height":new Gt(gt.layout_symbol["text-line-height"]),"text-letter-spacing":new ie(gt.layout_symbol["text-letter-spacing"]),"text-justify":new ie(gt.layout_symbol["text-justify"]),"text-radial-offset":new ie(gt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Gt(gt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ie(gt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ie(gt.layout_symbol["text-anchor"]),"text-max-angle":new Gt(gt.layout_symbol["text-max-angle"]),"text-writing-mode":new Gt(gt.layout_symbol["text-writing-mode"]),"text-rotate":new ie(gt.layout_symbol["text-rotate"]),"text-padding":new Gt(gt.layout_symbol["text-padding"]),"text-keep-upright":new Gt(gt.layout_symbol["text-keep-upright"]),"text-transform":new ie(gt.layout_symbol["text-transform"]),"text-offset":new ie(gt.layout_symbol["text-offset"]),"text-allow-overlap":new Gt(gt.layout_symbol["text-allow-overlap"]),"text-overlap":new Gt(gt.layout_symbol["text-overlap"]),"text-ignore-placement":new Gt(gt.layout_symbol["text-ignore-placement"]),"text-optional":new Gt(gt.layout_symbol["text-optional"])})}};class S0{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:ir,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}jt("FormatSectionOverride",S0,{omit:["defaultValue"]});class Wd extends s{constructor(e){super(e,Dm)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const l=this.layout.get("text-writing-mode");if(l){const h=[];for(const g of l)h.indexOf(g)<0&&h.push(g);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,l,h){const g=this.layout.get(e).evaluate(r,{},l,h),_=this._unevaluatedLayout._values[e];return _.isDataDriven()||El(_.value)||!g?g:function(v,b){return b.replace(/{([^{}]+)}/g,(E,M)=>v&&M in v?String(v[M]):"")}(r.properties,g)}createBucket(e){return new Wl(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Dm.paint.overridableProperties){if(!Wd.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),l=new S0(r),h=new Al(l,r.property.specification);let g=null;g=r.value.kind==="constant"||r.value.kind==="source"?new _s("source",h):new ys("composite",h,r.value.zoomStops),this.paint._values[e]=new Ca(r.property,g,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,l){return!(!this.layout||r.isDataDriven()||l.isDataDriven())&&Wd.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const l=e.get("text-field"),h=Dm.paint.properties[r];let g=!1;const _=v=>{for(const b of v)if(h.overrides&&h.overrides.hasOverride(b))return void(g=!0)};if(l.value.kind==="constant"&&l.value.value instanceof zn)_(l.value.value.sections);else if(l.value.kind==="source"){const v=E=>{g||(E instanceof ea&&bi(E.value)===Za?_(E.value.sections):E instanceof gl?_(E.sections):E.eachChild(v))},b=l.value;b._styleExpression&&v(b._styleExpression.expression)}return g}}let T0;var $2={get paint(){return T0=T0||new m({"background-color":new Gt(gt.paint_background["background-color"]),"background-pattern":new Ul(gt.paint_background["background-pattern"]),"background-opacity":new Gt(gt.paint_background["background-opacity"])})}};class Y2 extends s{constructor(e){super(e,$2)}}let A0;var K2={get paint(){return A0=A0||new m({"raster-opacity":new Gt(gt.paint_raster["raster-opacity"]),"raster-hue-rotate":new Gt(gt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Gt(gt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Gt(gt.paint_raster["raster-brightness-max"]),"raster-saturation":new Gt(gt.paint_raster["raster-saturation"]),"raster-contrast":new Gt(gt.paint_raster["raster-contrast"]),"raster-resampling":new Gt(gt.paint_raster["raster-resampling"]),"raster-fade-duration":new Gt(gt.paint_raster["raster-fade-duration"])})}};class Q2 extends s{constructor(e){super(e,K2)}}class J2 extends s{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class W2{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Im=63710088e-1;class Bs{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Bs(ne(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,l=this.lat*r,h=e.lat*r,g=Math.sin(l)*Math.sin(h)+Math.cos(l)*Math.cos(h)*Math.cos((e.lng-this.lng)*r);return Im*Math.acos(Math.min(g,1))}static convert(e){if(e instanceof Bs)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Bs(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Bs(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const E0=2*Math.PI*Im;function M0(n){return E0*Math.cos(n*Math.PI/180)}function z0(n){return(180+n)/360}function C0(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function D0(n,e){return n/M0(e)}function km(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}class Ku{constructor(e,r,l=0){this.x=+e,this.y=+r,this.z=+l}static fromLngLat(e,r=0){const l=Bs.convert(e);return new Ku(z0(l.lng),C0(l.lat),D0(r,l.lat))}toLngLat(){return new Bs(360*this.x-180,km(this.y))}toAltitude(){return this.z*M0(km(this.y))}meterInMercatorCoordinateUnits(){return 1/E0*(e=km(this.y),1/Math.cos(e*Math.PI/180));var e}}function I0(n,e,r){var l=2*Math.PI*6378137/256/Math.pow(2,r);return[n*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}class Rm{constructor(e,r,l){if(!function(h,g,_){return!(h<0||h>25||_<0||_>=Math.pow(2,h)||g<0||g>=Math.pow(2,h))}(e,r,l))throw new Error(`x=${r}, y=${l}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=l,this.key=Qu(0,e,e,r,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,l){const h=(_=this.y,v=this.z,b=I0(256*(g=this.x),256*(_=Math.pow(2,v)-_-1),v),E=I0(256*(g+1),256*(_+1),v),b[0]+","+b[1]+","+E[0]+","+E[1]);var g,_,v,b,E;const M=function(C,k,L){let O,F="";for(let G=C;G>0;G--)O=1<<G-1,F+=(k&O?1:0)+(L&O?2:0);return F}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,M).replace(/{bbox-epsg-3857}/g,h)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new tt((e.x*r-this.x)*wi,(e.y*r-this.y)*wi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class k0{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Qu(e,r.z,r.z,r.x,r.y)}}class ca{constructor(e,r,l,h,g){if(e<l)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${l}`);this.overscaledZ=e,this.wrap=r,this.canonical=new Rm(l,+h,+g),this.key=Qu(r,e,l,h,g)}clone(){return new ca(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new ca(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ca(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-e;return e>this.canonical.z?Qu(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):Qu(this.wrap*+r,e,e,this.canonical.x>>l,this.canonical.y>>l)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new ca(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,l=2*this.canonical.x,h=2*this.canonical.y;return[new ca(r,this.wrap,r,l,h),new ca(r,this.wrap,r,l+1,h),new ca(r,this.wrap,r,l,h+1),new ca(r,this.wrap,r,l+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ca(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ca(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new k0(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Ku(e.x-this.wrap,e.y))}}function Qu(n,e,r,l,h){(n*=2)<0&&(n=-1*n-1);const g=1<<r;return(g*g*n+g*h+l).toString(36)+r.toString(36)+e.toString(36)}jt("CanonicalTileID",Rm),jt("OverscaledTileID",ca,{omit:["posMatrix"]});class R0{constructor(e,r,l,h=1,g=1,_=1,v=0){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(l&&!["mapbox","terrarium","custom"].includes(l))return void Ai(`"${l}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const b=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),l){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=h,this.greenFactor=g,this.blueFactor=_,this.baseShift=v;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let E=0;E<b;E++)this.data[this._idx(-1,E)]=this.data[this._idx(0,E)],this.data[this._idx(b,E)]=this.data[this._idx(b-1,E)],this.data[this._idx(E,-1)]=this.data[this._idx(E,0)],this.data[this._idx(E,b)]=this.data[this._idx(E,b-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(b,-1)]=this.data[this._idx(b-1,0)],this.data[this._idx(-1,b)]=this.data[this._idx(0,b-1)],this.data[this._idx(b,b)]=this.data[this._idx(b-1,b-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let E=0;E<b;E++)for(let M=0;M<b;M++){const C=this.get(E,M);C>this.max&&(this.max=C),C<this.min&&(this.min=C)}}get(e,r){const l=new Uint8Array(this.data.buffer),h=4*this._idx(e,r);return this.unpack(l[h],l[h+1],l[h+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}unpack(e,r,l){return e*this.redFactor+r*this.greenFactor+l*this.blueFactor-this.baseShift}getPixels(){return new la({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=r*this.dim,g=r*this.dim+this.dim,_=l*this.dim,v=l*this.dim+this.dim;switch(r){case-1:h=g-1;break;case 1:g=h+1}switch(l){case-1:_=v-1;break;case 1:v=_+1}const b=-r*this.dim,E=-l*this.dim;for(let M=_;M<v;M++)for(let C=h;C<g;C++)this.data[this._idx(C,M)]=e.data[this._idx(C+b,M+E)]}}jt("DEMData",R0);class P0{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const l=e[r];this._stringToNumber[l]=r,this._numberToString[r]=l}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class L0{constructor(e,r,l,h,g){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=l,e._y=h,this.properties=e.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class B0{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ws(wi,16,0),this.grid3D=new ws(wi,16,0),this.featureIndexArray=new on,this.promoteId=r}insert(e,r,l,h,g,_){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,h,g);const b=_?this.grid3D:this.grid;for(let E=0;E<r.length;E++){const M=r[E],C=[1/0,1/0,-1/0,-1/0];for(let k=0;k<M.length;k++){const L=M[k];C[0]=Math.min(C[0],L.x),C[1]=Math.min(C[1],L.y),C[2]=Math.max(C[2],L.x),C[3]=Math.max(C[3],L.y)}C[0]<wi&&C[1]<wi&&C[2]>=0&&C[3]>=0&&b.insert(v,C[0],C[1],C[2],C[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Rs.VectorTile(new bm(this.rawTileData)).layers,this.sourceLayerCoder=new P0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,l,h){this.loadVTLayers();const g=e.params||{},_=wi/e.tileSize/e.scale,v=gu(g.filter),b=e.queryGeometry,E=e.queryPadding*_,M=F0(b),C=this.grid.query(M.minX-E,M.minY-E,M.maxX+E,M.maxY+E),k=F0(e.cameraQueryGeometry),L=this.grid3D.query(k.minX-E,k.minY-E,k.maxX+E,k.maxY+E,(G,Y,dt,et)=>function(lt,_t,At,Ft,ee){for(const Rt of lt)if(_t<=Rt.x&&At<=Rt.y&&Ft>=Rt.x&&ee>=Rt.y)return!0;const Lt=[new tt(_t,At),new tt(_t,ee),new tt(Ft,ee),new tt(Ft,At)];if(lt.length>2){for(const Rt of Lt)if(Hl(lt,Rt))return!0}for(let Rt=0;Rt<lt.length-1;Rt++)if(Rw(lt[Rt],lt[Rt+1],Lt))return!0;return!1}(e.cameraQueryGeometry,G-E,Y-E,dt+E,et+E));for(const G of L)C.push(G);C.sort(tS);const O={};let F;for(let G=0;G<C.length;G++){const Y=C[G];if(Y===F)continue;F=Y;const dt=this.featureIndexArray.get(Y);let et=null;this.loadMatchingFeature(O,dt.bucketIndex,dt.sourceLayerIndex,dt.featureIndex,v,g.layers,g.availableImages,r,l,h,(lt,_t,At)=>(et||(et=Uo(lt)),_t.queryIntersectsFeature(b,lt,At,et,this.z,e.transform,_,e.pixelPosMatrix)))}return O}loadMatchingFeature(e,r,l,h,g,_,v,b,E,M,C){const k=this.bucketLayerIDs[r];if(_&&!function(G,Y){for(let dt=0;dt<G.length;dt++)if(Y.indexOf(G[dt])>=0)return!0;return!1}(_,k))return;const L=this.sourceLayerCoder.decode(l),O=this.vtLayers[L].feature(h);if(g.needGeometry){const G=No(O,!0);if(!g.filter(new Qe(this.tileID.overscaledZ),G,this.tileID.canonical))return}else if(!g.filter(new Qe(this.tileID.overscaledZ),O))return;const F=this.getId(O,L);for(let G=0;G<k.length;G++){const Y=k[G];if(_&&_.indexOf(Y)<0)continue;const dt=b[Y];if(!dt)continue;let et={};F&&M&&(et=M.getState(dt.sourceLayer||"_geojsonTileLayer",F));const lt=Nt({},E[Y]);lt.paint=O0(lt.paint,dt.paint,O,et,v),lt.layout=O0(lt.layout,dt.layout,O,et,v);const _t=!C||C(O,dt,et);if(!_t)continue;const At=new L0(O,this.z,this.x,this.y,F);At.layer=lt;let Ft=e[Y];Ft===void 0&&(Ft=e[Y]=[]),Ft.push({featureIndex:h,feature:At,intersectionZ:_t})}}lookupSymbolFeatures(e,r,l,h,g,_,v,b){const E={};this.loadVTLayers();const M=gu(g);for(const C of e)this.loadMatchingFeature(E,l,h,C,M,_,v,b,r);return E}hasLayer(e){for(const r of this.bucketLayerIDs)for(const l of r)if(e===l)return!0;return!1}getId(e,r){let l=e.id;return this.promoteId&&(l=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof l=="boolean"&&(l=Number(l))),l}}function O0(n,e,r,l,h){return Pe(n,(g,_)=>{const v=e instanceof Lo?e.get(_):null;return v&&v.evaluate?v.evaluate(r,l,h):v})}function F0(n){let e=1/0,r=1/0,l=-1/0,h=-1/0;for(const g of n)e=Math.min(e,g.x),r=Math.min(r,g.y),l=Math.max(l,g.x),h=Math.max(h,g.y);return{minX:e,minY:r,maxX:l,maxY:h}}function tS(n,e){return e-n}function U0(n,e,r,l,h){const g=[];for(let _=0;_<n.length;_++){const v=n[_];let b;for(let E=0;E<v.length-1;E++){let M=v[E],C=v[E+1];M.x<e&&C.x<e||(M.x<e?M=new tt(e,M.y+(e-M.x)/(C.x-M.x)*(C.y-M.y))._round():C.x<e&&(C=new tt(e,M.y+(e-M.x)/(C.x-M.x)*(C.y-M.y))._round()),M.y<r&&C.y<r||(M.y<r?M=new tt(M.x+(r-M.y)/(C.y-M.y)*(C.x-M.x),r)._round():C.y<r&&(C=new tt(M.x+(r-M.y)/(C.y-M.y)*(C.x-M.x),r)._round()),M.x>=l&&C.x>=l||(M.x>=l?M=new tt(l,M.y+(l-M.x)/(C.x-M.x)*(C.y-M.y))._round():C.x>=l&&(C=new tt(l,M.y+(l-M.x)/(C.x-M.x)*(C.y-M.y))._round()),M.y>=h&&C.y>=h||(M.y>=h?M=new tt(M.x+(h-M.y)/(C.y-M.y)*(C.x-M.x),h)._round():C.y>=h&&(C=new tt(M.x+(h-M.y)/(C.y-M.y)*(C.x-M.x),h)._round()),b&&M.equals(b[b.length-1])||(b=[M],g.push(b)),b.push(C)))))}}return g}jt("FeatureIndex",B0,{omit:["rawTileData","sourceLayerCoder"]});class Os extends tt{constructor(e,r,l,h){super(e,r),this.angle=l,h!==void 0&&(this.segment=h)}clone(){return new Os(this.x,this.y,this.angle,this.segment)}}function N0(n,e,r,l,h){if(e.segment===void 0||r===0)return!0;let g=e,_=e.segment+1,v=0;for(;v>-r/2;){if(_--,_<0)return!1;v-=n[_].dist(g),g=n[_]}v+=n[_].dist(n[_+1]),_++;const b=[];let E=0;for(;v<r/2;){const M=n[_],C=n[_+1];if(!C)return!1;let k=n[_-1].angleTo(M)-M.angleTo(C);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:v,angleDelta:k}),E+=k;v-b[0].distance>l;)E-=b.shift().angleDelta;if(E>h)return!1;_++,v+=M.dist(C)}return!0}function V0(n){let e=0;for(let r=0;r<n.length-1;r++)e+=n[r].dist(n[r+1]);return e}function j0(n,e,r){return n?.6*e*r:0}function q0(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function eS(n,e,r,l,h,g){const _=j0(r,h,g),v=q0(r,l)*g;let b=0;const E=V0(n)/2;for(let M=0;M<n.length-1;M++){const C=n[M],k=n[M+1],L=C.dist(k);if(b+L>E){const O=(E-b)/L,F=mn.number(C.x,k.x,O),G=mn.number(C.y,k.y,O),Y=new Os(F,G,k.angleTo(C),M);return Y._round(),!_||N0(n,Y,v,_,e)?Y:void 0}b+=L}}function iS(n,e,r,l,h,g,_,v,b){const E=j0(l,g,_),M=q0(l,h),C=M*_,k=n[0].x===0||n[0].x===b||n[0].y===0||n[0].y===b;return e-C<e/4&&(e=C+e/4),Z0(n,k?e/2*v%e:(M/2+2*g)*_*v%e,e,E,r,C,k,!1,b)}function Z0(n,e,r,l,h,g,_,v,b){const E=g/2,M=V0(n);let C=0,k=e-r,L=[];for(let O=0;O<n.length-1;O++){const F=n[O],G=n[O+1],Y=F.dist(G),dt=G.angleTo(F);for(;k+r<C+Y;){k+=r;const et=(k-C)/Y,lt=mn.number(F.x,G.x,et),_t=mn.number(F.y,G.y,et);if(lt>=0&&lt<b&&_t>=0&&_t<b&&k-E>=0&&k+E<=M){const At=new Os(lt,_t,dt,O);At._round(),l&&!N0(n,At,g,l,h)||L.push(At)}}C+=Y}return v||L.length||_||(L=Z0(n,C/2,r,l,h,g,_,!0,b)),L}jt("Anchor",Os);const tc=Pn;function G0(n,e,r,l){const h=[],g=n.image,_=g.pixelRatio,v=g.paddedRect.w-2*tc,b=g.paddedRect.h-2*tc;let E={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const M=g.stretchX||[[0,v]],C=g.stretchY||[[0,b]],k=(xt,Kt)=>xt+Kt[1]-Kt[0],L=M.reduce(k,0),O=C.reduce(k,0),F=v-L,G=b-O;let Y=0,dt=L,et=0,lt=O,_t=0,At=F,Ft=0,ee=G;if(g.content&&l){const xt=g.content,Kt=xt[2]-xt[0],$t=xt[3]-xt[1];(g.textFitWidth||g.textFitHeight)&&(E=y0(n)),Y=tf(M,0,xt[0]),et=tf(C,0,xt[1]),dt=tf(M,xt[0],xt[2]),lt=tf(C,xt[1],xt[3]),_t=xt[0]-Y,Ft=xt[1]-et,At=Kt-dt,ee=$t-lt}const Lt=E.x1,Rt=E.y1,Yt=E.x2-Lt,Zt=E.y2-Rt,Vt=(xt,Kt,$t,se)=>{const He=ef(xt.stretch-Y,dt,Yt,Lt),je=nf(xt.fixed-_t,At,xt.stretch,L),Ii=ef(Kt.stretch-et,lt,Zt,Rt),Ia=nf(Kt.fixed-Ft,ee,Kt.stretch,O),Ki=ef($t.stretch-Y,dt,Yt,Lt),ki=nf($t.fixed-_t,At,$t.stretch,L),vn=ef(se.stretch-et,lt,Zt,Rt),xn=nf(se.fixed-Ft,ee,se.stretch,O),bn=new tt(He,Ii),fi=new tt(Ki,Ii),Ri=new tt(Ki,vn),cn=new tt(He,vn),Qi=new tt(je/_,Ia/_),wn=new tt(ki/_,xn/_),Ji=e*Math.PI/180;if(Ji){const Ie=Math.sin(Ji),$e=Math.cos(Ji),ei=[$e,-Ie,Ie,$e];bn._matMult(ei),fi._matMult(ei),cn._matMult(ei),Ri._matMult(ei)}const ua=xt.stretch+xt.fixed,Ln=Kt.stretch+Kt.fixed;return{tl:bn,tr:fi,bl:cn,br:Ri,tex:{x:g.paddedRect.x+tc+ua,y:g.paddedRect.y+tc+Ln,w:$t.stretch+$t.fixed-ua,h:se.stretch+se.fixed-Ln},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Qi,pixelOffsetBR:wn,minFontScaleX:At/_/Yt,minFontScaleY:ee/_/Zt,isSDF:r}};if(l&&(g.stretchX||g.stretchY)){const xt=H0(M,F,L),Kt=H0(C,G,O);for(let $t=0;$t<xt.length-1;$t++){const se=xt[$t],He=xt[$t+1];for(let je=0;je<Kt.length-1;je++)h.push(Vt(se,Kt[je],He,Kt[je+1]))}}else h.push(Vt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:b+1}));return h}function tf(n,e,r){let l=0;for(const h of n)l+=Math.max(e,Math.min(r,h[1]))-Math.max(e,Math.min(r,h[0]));return l}function H0(n,e,r){const l=[{fixed:-tc,stretch:0}];for(const[h,g]of n){const _=l[l.length-1];l.push({fixed:h-_.stretch,stretch:_.stretch}),l.push({fixed:h-_.stretch,stretch:_.stretch+(g-h)})}return l.push({fixed:e+tc,stretch:r}),l}function ef(n,e,r,l){return n/e*r+l}function nf(n,e,r,l){return n-e*r/l}class af{constructor(e,r,l,h,g,_,v,b,E,M){var C;if(this.boxStartIndex=e.length,E){let k=_.top,L=_.bottom;const O=_.collisionPadding;O&&(k-=O[1],L+=O[3]);let F=L-k;F>0&&(F=Math.max(10,F),this.circleDiameter=F)}else{const k=!((C=_.image)===null||C===void 0)&&C.content&&(_.image.textFitWidth||_.image.textFitHeight)?y0(_):{x1:_.left,y1:_.top,x2:_.right,y2:_.bottom};k.y1=k.y1*v-b[0],k.y2=k.y2*v+b[2],k.x1=k.x1*v-b[3],k.x2=k.x2*v+b[1];const L=_.collisionPadding;if(L&&(k.x1-=L[0]*v,k.y1-=L[1]*v,k.x2+=L[2]*v,k.y2+=L[3]*v),M){const O=new tt(k.x1,k.y1),F=new tt(k.x2,k.y1),G=new tt(k.x1,k.y2),Y=new tt(k.x2,k.y2),dt=M*Math.PI/180;O._rotate(dt),F._rotate(dt),G._rotate(dt),Y._rotate(dt),k.x1=Math.min(O.x,F.x,G.x,Y.x),k.x2=Math.max(O.x,F.x,G.x,Y.x),k.y1=Math.min(O.y,F.y,G.y,Y.y),k.y2=Math.max(O.y,F.y,G.y,Y.y)}e.emplaceBack(r.x,r.y,k.x1,k.y1,k.x2,k.y2,l,h,g)}this.boxEndIndex=e.length}}class nS{constructor(e=[],r=(l,h)=>l<h?-1:l>h?1:0){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:l}=this,h=r[e];for(;e>0;){const g=e-1>>1,_=r[g];if(l(h,_)>=0)break;r[e]=_,e=g}r[e]=h}_down(e){const{data:r,compare:l}=this,h=this.length>>1,g=r[e];for(;e<h;){let _=1+(e<<1);const v=_+1;if(v<this.length&&l(r[v],r[_])<0&&(_=v),l(r[_],g)>=0)break;r[e]=r[_],e=_}r[e]=g}}function aS(n,e=1,r=!1){let l=1/0,h=1/0,g=-1/0,_=-1/0;const v=n[0];for(let L=0;L<v.length;L++){const O=v[L];(!L||O.x<l)&&(l=O.x),(!L||O.y<h)&&(h=O.y),(!L||O.x>g)&&(g=O.x),(!L||O.y>_)&&(_=O.y)}const b=Math.min(g-l,_-h);let E=b/2;const M=new nS([],rS);if(b===0)return new tt(l,h);for(let L=l;L<g;L+=b)for(let O=h;O<_;O+=b)M.push(new ec(L+E,O+E,E,n));let C=function(L){let O=0,F=0,G=0;const Y=L[0];for(let dt=0,et=Y.length,lt=et-1;dt<et;lt=dt++){const _t=Y[dt],At=Y[lt],Ft=_t.x*At.y-At.x*_t.y;F+=(_t.x+At.x)*Ft,G+=(_t.y+At.y)*Ft,O+=3*Ft}return new ec(F/O,G/O,0,L)}(n),k=M.length;for(;M.length;){const L=M.pop();(L.d>C.d||!C.d)&&(C=L,r&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,k)),L.max-C.d<=e||(E=L.h/2,M.push(new ec(L.p.x-E,L.p.y-E,E,n)),M.push(new ec(L.p.x+E,L.p.y-E,E,n)),M.push(new ec(L.p.x-E,L.p.y+E,E,n)),M.push(new ec(L.p.x+E,L.p.y+E,E,n)),k+=4)}return r&&(console.log(`num probes: ${k}`),console.log(`best distance: ${C.d}`)),C.p}function rS(n,e){return e.max-n.max}function ec(n,e,r,l){this.p=new tt(n,e),this.h=r,this.d=function(h,g){let _=!1,v=1/0;for(let b=0;b<g.length;b++){const E=g[b];for(let M=0,C=E.length,k=C-1;M<C;k=M++){const L=E[M],O=E[k];L.y>h.y!=O.y>h.y&&h.x<(O.x-L.x)*(h.y-L.y)/(O.y-L.y)+L.x&&(_=!_),v=Math.min(v,Cy(h,L,O))}}return(_?1:-1)*Math.sqrt(v)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}var Yi;T.aq=void 0,(Yi=T.aq||(T.aq={}))[Yi.center=1]="center",Yi[Yi.left=2]="left",Yi[Yi.right=3]="right",Yi[Yi.top=4]="top",Yi[Yi.bottom=5]="bottom",Yi[Yi["top-left"]=6]="top-left",Yi[Yi["top-right"]=7]="top-right",Yi[Yi["bottom-left"]=8]="bottom-left",Yi[Yi["bottom-right"]=9]="bottom-right";const Fs=7,Pm=Number.POSITIVE_INFINITY;function X0(n,e){return e[1]!==Pm?function(r,l,h){let g=0,_=0;switch(l=Math.abs(l),h=Math.abs(h),r){case"top-right":case"top-left":case"top":_=h-Fs;break;case"bottom-right":case"bottom-left":case"bottom":_=-h+Fs}switch(r){case"top-right":case"bottom-right":case"right":g=-l;break;case"top-left":case"bottom-left":case"left":g=l}return[g,_]}(n,e[0],e[1]):function(r,l){let h=0,g=0;l<0&&(l=0);const _=l/Math.SQRT2;switch(r){case"top-right":case"top-left":g=_-Fs;break;case"bottom-right":case"bottom-left":g=-_+Fs;break;case"bottom":g=-l+Fs;break;case"top":g=l-Fs}switch(r){case"top-right":case"bottom-right":h=-_;break;case"top-left":case"bottom-left":h=_;break;case"left":h=l;break;case"right":h=-l}return[h,g]}(n,e[0])}function $0(n,e,r){var l;const h=n.layout,g=(l=h.get("text-variable-anchor-offset"))===null||l===void 0?void 0:l.evaluate(e,{},r);if(g){const v=g.values,b=[];for(let E=0;E<v.length;E+=2){const M=b[E]=v[E],C=v[E+1].map(k=>k*Mi);M.startsWith("top")?C[1]-=Fs:M.startsWith("bottom")&&(C[1]+=Fs),b[E+1]=C}return new Nn(b)}const _=h.get("text-variable-anchor");if(_){let v;v=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[h.get("text-radial-offset").evaluate(e,{},r)*Mi,Pm]:h.get("text-offset").evaluate(e,{},r).map(E=>E*Mi);const b=[];for(const E of _)b.push(E,X0(E,v));return new Nn(b)}return null}function Lm(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function sS(n,e,r,l,h,g,_,v,b,E,M){let C=g.textMaxSize.evaluate(e,{});C===void 0&&(C=_);const k=n.layers[0].layout,L=k.get("icon-offset").evaluate(e,{},M),O=K0(r.horizontal),F=_/24,G=n.tilePixelRatio*F,Y=n.tilePixelRatio*C/24,dt=n.tilePixelRatio*v,et=n.tilePixelRatio*k.get("symbol-spacing"),lt=k.get("text-padding")*n.tilePixelRatio,_t=function(xt,Kt,$t,se=1){const He=xt.get("icon-padding").evaluate(Kt,{},$t),je=He&&He.values;return[je[0]*se,je[1]*se,je[2]*se,je[3]*se]}(k,e,M,n.tilePixelRatio),At=k.get("text-max-angle")/180*Math.PI,Ft=k.get("text-rotation-alignment")!=="viewport"&&k.get("symbol-placement")!=="point",ee=k.get("icon-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",Lt=k.get("symbol-placement"),Rt=et/2,Yt=k.get("icon-text-fit");let Zt;l&&Yt!=="none"&&(n.allowVerticalPlacement&&r.vertical&&(Zt=v0(l,r.vertical,Yt,k.get("icon-text-fit-padding"),L,F)),O&&(l=v0(l,O,Yt,k.get("icon-text-fit-padding"),L,F)));const Vt=(xt,Kt)=>{Kt.x<0||Kt.x>=wi||Kt.y<0||Kt.y>=wi||function($t,se,He,je,Ii,Ia,Ki,ki,vn,xn,bn,fi,Ri,cn,Qi,wn,Ji,ua,Ln,Ie,$e,ei,Xn,ci,ic){const cr=$t.addToLineVertexArray(se,He);let ur,ka,ha,Ui,Fr=0,th=0,tv=0,ev=0,qm=-1,Zm=-1;const Ur={};let iv=jl("");if($t.allowVerticalPlacement&&je.vertical){const un=ki.layout.get("text-rotate").evaluate($e,{},ci)+90;ha=new af(vn,se,xn,bn,fi,je.vertical,Ri,cn,Qi,un),Ki&&(Ui=new af(vn,se,xn,bn,fi,Ki,Ji,ua,Qi,un))}if(Ii){const un=ki.layout.get("icon-rotate").evaluate($e,{}),da=ki.layout.get("icon-text-fit")!=="none",jo=G0(Ii,un,Xn,da),Ya=Ki?G0(Ki,un,Xn,da):void 0;ka=new af(vn,se,xn,bn,fi,Ii,Ji,ua,!1,un),Fr=4*jo.length;const qo=$t.iconSizeData;let hr=null;qo.kind==="source"?(hr=[lr*ki.layout.get("icon-size").evaluate($e,{})],hr[0]>Ls&&Ai(`${$t.layerIds[0]}: Value for "icon-size" is >= ${Yu}. Reduce your "icon-size".`)):qo.kind==="composite"&&(hr=[lr*ei.compositeIconSizes[0].evaluate($e,{},ci),lr*ei.compositeIconSizes[1].evaluate($e,{},ci)],(hr[0]>Ls||hr[1]>Ls)&&Ai(`${$t.layerIds[0]}: Value for "icon-size" is >= ${Yu}. Reduce your "icon-size".`)),$t.addSymbols($t.icon,jo,hr,Ie,Ln,$e,T.ah.none,se,cr.lineStartIndex,cr.lineLength,-1,ci),qm=$t.icon.placedSymbolArray.length-1,Ya&&(th=4*Ya.length,$t.addSymbols($t.icon,Ya,hr,Ie,Ln,$e,T.ah.vertical,se,cr.lineStartIndex,cr.lineLength,-1,ci),Zm=$t.icon.placedSymbolArray.length-1)}const nv=Object.keys(je.horizontal);for(const un of nv){const da=je.horizontal[un];if(!ur){iv=jl(da.text);const Ya=ki.layout.get("text-rotate").evaluate($e,{},ci);ur=new af(vn,se,xn,bn,fi,da,Ri,cn,Qi,Ya)}const jo=da.positionedLines.length===1;if(tv+=Y0($t,se,da,Ia,ki,Qi,$e,wn,cr,je.vertical?T.ah.horizontal:T.ah.horizontalOnly,jo?nv:[un],Ur,qm,ei,ci),jo)break}je.vertical&&(ev+=Y0($t,se,je.vertical,Ia,ki,Qi,$e,wn,cr,T.ah.vertical,["vertical"],Ur,Zm,ei,ci));const cS=ur?ur.boxStartIndex:$t.collisionBoxArray.length,uS=ur?ur.boxEndIndex:$t.collisionBoxArray.length,hS=ha?ha.boxStartIndex:$t.collisionBoxArray.length,dS=ha?ha.boxEndIndex:$t.collisionBoxArray.length,fS=ka?ka.boxStartIndex:$t.collisionBoxArray.length,pS=ka?ka.boxEndIndex:$t.collisionBoxArray.length,mS=Ui?Ui.boxStartIndex:$t.collisionBoxArray.length,gS=Ui?Ui.boxEndIndex:$t.collisionBoxArray.length;let $a=-1;const sf=(un,da)=>un&&un.circleDiameter?Math.max(un.circleDiameter,da):da;$a=sf(ur,$a),$a=sf(ha,$a),$a=sf(ka,$a),$a=sf(Ui,$a);const av=$a>-1?1:0;av&&($a*=ic/Mi),$t.glyphOffsetArray.length>=Wl.MAX_GLYPHS&&Ai("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),$e.sortKey!==void 0&&$t.addToSortKeyRanges($t.symbolInstances.length,$e.sortKey);const _S=$0(ki,$e,ci),[yS,vS]=function(un,da){const jo=un.length,Ya=da==null?void 0:da.values;if((Ya==null?void 0:Ya.length)>0)for(let qo=0;qo<Ya.length;qo+=2){const hr=Ya[qo+1];un.emplaceBack(T.aq[Ya[qo]],hr[0],hr[1])}return[jo,un.length]}($t.textAnchorOffsets,_S);$t.symbolInstances.emplaceBack(se.x,se.y,Ur.right>=0?Ur.right:-1,Ur.center>=0?Ur.center:-1,Ur.left>=0?Ur.left:-1,Ur.vertical||-1,qm,Zm,iv,cS,uS,hS,dS,fS,pS,mS,gS,xn,tv,ev,Fr,th,av,0,Ri,$a,yS,vS)}(n,Kt,xt,r,l,h,Zt,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,G,[lt,lt,lt,lt],Ft,b,dt,_t,ee,L,e,g,E,M,_)};if(Lt==="line")for(const xt of U0(e.geometry,0,0,wi,wi)){const Kt=iS(xt,et,At,r.vertical||O,l,24,Y,n.overscaling,wi);for(const $t of Kt)O&&oS(n,O.text,Rt,$t)||Vt(xt,$t)}else if(Lt==="line-center"){for(const xt of e.geometry)if(xt.length>1){const Kt=eS(xt,At,r.vertical||O,l,24,Y);Kt&&Vt(xt,Kt)}}else if(e.type==="Polygon")for(const xt of yl(e.geometry,0)){const Kt=aS(xt,16);Vt(xt[0],new Os(Kt.x,Kt.y,0))}else if(e.type==="LineString")for(const xt of e.geometry)Vt(xt,new Os(xt[0].x,xt[0].y,0));else if(e.type==="Point")for(const xt of e.geometry)for(const Kt of xt)Vt([Kt],new Os(Kt.x,Kt.y,0))}function Y0(n,e,r,l,h,g,_,v,b,E,M,C,k,L,O){const F=function(dt,et,lt,_t,At,Ft,ee,Lt){const Rt=_t.layout.get("text-rotate").evaluate(Ft,{})*Math.PI/180,Yt=[];for(const Zt of et.positionedLines)for(const Vt of Zt.positionedGlyphs){if(!Vt.rect)continue;const xt=Vt.rect||{};let Kt=h0+1,$t=!0,se=1,He=0;const je=(At||Lt)&&Vt.vertical,Ii=Vt.metrics.advance*Vt.scale/2;if(Lt&&et.verticalizable&&(He=Zt.lineOffset/2-(Vt.imageName?-(Mi-Vt.metrics.width*Vt.scale)/2:(Vt.scale-1)*Mi)),Vt.imageName){const Ie=ee[Vt.imageName];$t=Ie.sdf,se=Ie.pixelRatio,Kt=Pn/se}const Ia=At?[Vt.x+Ii,Vt.y]:[0,0];let Ki=At?[0,0]:[Vt.x+Ii+lt[0],Vt.y+lt[1]-He],ki=[0,0];je&&(ki=Ki,Ki=[0,0]);const vn=Vt.metrics.isDoubleResolution?2:1,xn=(Vt.metrics.left-Kt)*Vt.scale-Ii+Ki[0],bn=(-Vt.metrics.top-Kt)*Vt.scale+Ki[1],fi=xn+xt.w/vn*Vt.scale/se,Ri=bn+xt.h/vn*Vt.scale/se,cn=new tt(xn,bn),Qi=new tt(fi,bn),wn=new tt(xn,Ri),Ji=new tt(fi,Ri);if(je){const Ie=new tt(-Ii,Ii-Xu),$e=-Math.PI/2,ei=Mi/2-Ii,Xn=new tt(5-Xu-ei,-(Vt.imageName?ei:0)),ci=new tt(...ki);cn._rotateAround($e,Ie)._add(Xn)._add(ci),Qi._rotateAround($e,Ie)._add(Xn)._add(ci),wn._rotateAround($e,Ie)._add(Xn)._add(ci),Ji._rotateAround($e,Ie)._add(Xn)._add(ci)}if(Rt){const Ie=Math.sin(Rt),$e=Math.cos(Rt),ei=[$e,-Ie,Ie,$e];cn._matMult(ei),Qi._matMult(ei),wn._matMult(ei),Ji._matMult(ei)}const ua=new tt(0,0),Ln=new tt(0,0);Yt.push({tl:cn,tr:Qi,bl:wn,br:Ji,tex:xt,writingMode:et.writingMode,glyphOffset:Ia,sectionIndex:Vt.sectionIndex,isSDF:$t,pixelOffsetTL:ua,pixelOffsetBR:Ln,minFontScaleX:0,minFontScaleY:0})}return Yt}(0,r,v,h,g,_,l,n.allowVerticalPlacement),G=n.textSizeData;let Y=null;G.kind==="source"?(Y=[lr*h.layout.get("text-size").evaluate(_,{})],Y[0]>Ls&&Ai(`${n.layerIds[0]}: Value for "text-size" is >= ${Yu}. Reduce your "text-size".`)):G.kind==="composite"&&(Y=[lr*L.compositeTextSizes[0].evaluate(_,{},O),lr*L.compositeTextSizes[1].evaluate(_,{},O)],(Y[0]>Ls||Y[1]>Ls)&&Ai(`${n.layerIds[0]}: Value for "text-size" is >= ${Yu}. Reduce your "text-size".`)),n.addSymbols(n.text,F,Y,v,g,_,E,e,b.lineStartIndex,b.lineLength,k,O);for(const dt of M)C[dt]=n.text.placedSymbolArray.length-1;return 4*F.length}function K0(n){for(const e in n)return n[e];return null}function oS(n,e,r,l){const h=n.compareText;if(e in h){const g=h[e];for(let _=g.length-1;_>=0;_--)if(l.dist(g[_])<r)return!0}else h[e]=[];return h[e].push(l),!1}const Q0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Bm{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,l]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=l>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const g=Q0[15&l];if(!g)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(e,2,1),[v]=new Uint32Array(e,4,1);return new Bm(v,_,g,e)}constructor(e,r=64,l=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const g=Q0.indexOf(this.ArrayType),_=2*e*this.ArrayType.BYTES_PER_ELEMENT,v=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-v%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${l}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+_+v+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=r,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Om(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,l,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:_,nodeSize:v}=this,b=[0,g.length-1,0],E=[];for(;b.length;){const M=b.pop()||0,C=b.pop()||0,k=b.pop()||0;if(C-k<=v){for(let G=k;G<=C;G++){const Y=_[2*G],dt=_[2*G+1];Y>=e&&Y<=l&&dt>=r&&dt<=h&&E.push(g[G])}continue}const L=k+C>>1,O=_[2*L],F=_[2*L+1];O>=e&&O<=l&&F>=r&&F<=h&&E.push(g[L]),(M===0?e<=O:r<=F)&&(b.push(k),b.push(L-1),b.push(1-M)),(M===0?l>=O:h>=F)&&(b.push(L+1),b.push(C),b.push(1-M))}return E}within(e,r,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:g,nodeSize:_}=this,v=[0,h.length-1,0],b=[],E=l*l;for(;v.length;){const M=v.pop()||0,C=v.pop()||0,k=v.pop()||0;if(C-k<=_){for(let G=k;G<=C;G++)W0(g[2*G],g[2*G+1],e,r)<=E&&b.push(h[G]);continue}const L=k+C>>1,O=g[2*L],F=g[2*L+1];W0(O,F,e,r)<=E&&b.push(h[L]),(M===0?e-l<=O:r-l<=F)&&(v.push(k),v.push(L-1),v.push(1-M)),(M===0?e+l>=O:r+l>=F)&&(v.push(L+1),v.push(C),v.push(1-M))}return b}}function Om(n,e,r,l,h,g){if(h-l<=r)return;const _=l+h>>1;J0(n,e,_,l,h,g),Om(n,e,r,l,_-1,1-g),Om(n,e,r,_+1,h,1-g)}function J0(n,e,r,l,h,g){for(;h>l;){if(h-l>600){const E=h-l+1,M=r-l+1,C=Math.log(E),k=.5*Math.exp(2*C/3),L=.5*Math.sqrt(C*k*(E-k)/E)*(M-E/2<0?-1:1);J0(n,e,r,Math.max(l,Math.floor(r-M*k/E+L)),Math.min(h,Math.floor(r+(E-M)*k/E+L)),g)}const _=e[2*r+g];let v=l,b=h;for(Ju(n,e,l,r),e[2*h+g]>_&&Ju(n,e,l,h);v<b;){for(Ju(n,e,v,b),v++,b--;e[2*v+g]<_;)v++;for(;e[2*b+g]>_;)b--}e[2*l+g]===_?Ju(n,e,l,b):(b++,Ju(n,e,b,h)),b<=r&&(l=b+1),r<=b&&(h=b-1)}}function Ju(n,e,r,l){Fm(n,r,l),Fm(e,2*r,2*l),Fm(e,2*r+1,2*l+1)}function Fm(n,e,r){const l=n[e];n[e]=n[r],n[r]=l}function W0(n,e,r,l){const h=n-r,g=e-l;return h*h+g*g}var Um;T.bg=void 0,(Um=T.bg||(T.bg={})).create="create",Um.load="load",Um.fullLoad="fullLoad";let rf=null,Wu=[];const Nm=1e3/60,Vm="loadTime",jm="fullLoadTime",lS={mark(n){performance.mark(n)},frame(n){const e=n;rf!=null&&Wu.push(e-rf),rf=e},clearMetrics(){rf=null,Wu=[],performance.clearMeasures(Vm),performance.clearMeasures(jm);for(const n in T.bg)performance.clearMarks(T.bg[n])},getPerformanceMetrics(){performance.measure(Vm,T.bg.create,T.bg.load),performance.measure(jm,T.bg.create,T.bg.fullLoad);const n=performance.getEntriesByName(Vm)[0].duration,e=performance.getEntriesByName(jm)[0].duration,r=Wu.length,l=1/(Wu.reduce((g,_)=>g+_,0)/r/1e3),h=Wu.filter(g=>g>Nm).reduce((g,_)=>g+(_-Nm)/Nm,0);return{loadTime:n,fullLoadTime:e,fps:l,percentDroppedFrames:h/(r+h)*100,totalFrames:r}}};T.$=class extends D{},T.A=Xl,T.B=Kp,T.C=function(n){if(qt==null){const e=n.navigator?n.navigator.userAgent:null;qt=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return qt},T.D=Gt,T.E=ns,T.F=class{constructor(n,e){this.target=n,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new W2(()=>this.process()),this.subscription=function(r,l,h,g){return r.addEventListener(l,h,!1),{unsubscribe:()=>{r.removeEventListener(l,h,!1)}}}(this.target,"message",r=>this.receive(r)),this.globalScope=En(self)?n:window}registerMessageHandler(n,e){this.messageHandlers[n]=e}sendAsync(n,e){return new Promise((r,l)=>{const h=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[h]={resolve:r,reject:l},e&&e.signal.addEventListener("abort",()=>{delete this.resolveRejects[h];const v={id:h,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(v)},{once:!0});const g=[],_=Object.assign(Object.assign({},n),{id:h,sourceMapId:this.mapId,origin:location.origin,data:Ss(n.data,g)});this.target.postMessage(_,{transfer:g})})}receive(n){const e=n.data,r=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[r];const l=this.abortControllers[r];return delete this.abortControllers[r],void(l&&l.abort())}if(En(self)||e.mustQueue)return this.tasks[r]=e,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,e)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),e=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(n,e)}processTask(n,e){return f(this,void 0,void 0,function*(){if(e.type==="<response>"){const h=this.resolveRejects[n];return delete this.resolveRejects[n],h?void(e.error?h.reject(Ts(e.error)):h.resolve(Ts(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=Ts(e.data),l=new AbortController;this.abortControllers[n]=l;try{const h=yield this.messageHandlers[e.type](e.sourceMapId,r,l);this.completeTask(n,null,h)}catch(h){this.completeTask(n,h)}})}completeTask(n,e,r){const l=[];delete this.abortControllers[n];const h={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?Ss(e):null,data:Ss(r,l)};this.target.postMessage(h,{transfer:l})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},T.G=is,T.H=function(){var n=new Xl(16);return Xl!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},T.I=Sm,T.J=function(n,e,r){var l,h,g,_,v,b,E,M,C,k,L,O,F=r[0],G=r[1],Y=r[2];return e===n?(n[12]=e[0]*F+e[4]*G+e[8]*Y+e[12],n[13]=e[1]*F+e[5]*G+e[9]*Y+e[13],n[14]=e[2]*F+e[6]*G+e[10]*Y+e[14],n[15]=e[3]*F+e[7]*G+e[11]*Y+e[15]):(h=e[1],g=e[2],_=e[3],v=e[4],b=e[5],E=e[6],M=e[7],C=e[8],k=e[9],L=e[10],O=e[11],n[0]=l=e[0],n[1]=h,n[2]=g,n[3]=_,n[4]=v,n[5]=b,n[6]=E,n[7]=M,n[8]=C,n[9]=k,n[10]=L,n[11]=O,n[12]=l*F+v*G+C*Y+e[12],n[13]=h*F+b*G+k*Y+e[13],n[14]=g*F+E*G+L*Y+e[14],n[15]=_*F+M*G+O*Y+e[15]),n},T.K=function(n,e,r){var l=r[0],h=r[1],g=r[2];return n[0]=e[0]*l,n[1]=e[1]*l,n[2]=e[2]*l,n[3]=e[3]*l,n[4]=e[4]*h,n[5]=e[5]*h,n[6]=e[6]*h,n[7]=e[7]*h,n[8]=e[8]*g,n[9]=e[9]*g,n[10]=e[10]*g,n[11]=e[11]*g,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},T.L=Ry,T.M=function(n,e){const r={};for(let l=0;l<e.length;l++){const h=e[l];h in n&&(r[h]=n[h])}return r},T.N=Bs,T.O=z0,T.P=tt,T.Q=C0,T.R=la,T.S=ca,T.T=Ol,T.U=st,T.V=nt,T.W=Ue,T.X=wi,T.Y=x,T.Z=Ku,T._=f,T.a=Zi,T.a$=function(n,e){var r=n[0],l=n[1],h=n[2],g=n[3],_=n[4],v=n[5],b=n[6],E=n[7],M=n[8],C=n[9],k=n[10],L=n[11],O=n[12],F=n[13],G=n[14],Y=n[15],dt=e[0],et=e[1],lt=e[2],_t=e[3],At=e[4],Ft=e[5],ee=e[6],Lt=e[7],Rt=e[8],Yt=e[9],Zt=e[10],Vt=e[11],xt=e[12],Kt=e[13],$t=e[14],se=e[15];return Math.abs(r-dt)<=yn*Math.max(1,Math.abs(r),Math.abs(dt))&&Math.abs(l-et)<=yn*Math.max(1,Math.abs(l),Math.abs(et))&&Math.abs(h-lt)<=yn*Math.max(1,Math.abs(h),Math.abs(lt))&&Math.abs(g-_t)<=yn*Math.max(1,Math.abs(g),Math.abs(_t))&&Math.abs(_-At)<=yn*Math.max(1,Math.abs(_),Math.abs(At))&&Math.abs(v-Ft)<=yn*Math.max(1,Math.abs(v),Math.abs(Ft))&&Math.abs(b-ee)<=yn*Math.max(1,Math.abs(b),Math.abs(ee))&&Math.abs(E-Lt)<=yn*Math.max(1,Math.abs(E),Math.abs(Lt))&&Math.abs(M-Rt)<=yn*Math.max(1,Math.abs(M),Math.abs(Rt))&&Math.abs(C-Yt)<=yn*Math.max(1,Math.abs(C),Math.abs(Yt))&&Math.abs(k-Zt)<=yn*Math.max(1,Math.abs(k),Math.abs(Zt))&&Math.abs(L-Vt)<=yn*Math.max(1,Math.abs(L),Math.abs(Vt))&&Math.abs(O-xt)<=yn*Math.max(1,Math.abs(O),Math.abs(xt))&&Math.abs(F-Kt)<=yn*Math.max(1,Math.abs(F),Math.abs(Kt))&&Math.abs(G-$t)<=yn*Math.max(1,Math.abs(G),Math.abs($t))&&Math.abs(Y-se)<=yn*Math.max(1,Math.abs(Y),Math.abs(se))},T.a0=Se,T.a1=Rm,T.a2=Mt,T.a3=n=>{const e=window.document.createElement("video");return e.muted=!0,new Promise(r=>{e.onloadstart=()=>{r(e)};for(const l of n){const h=window.document.createElement("source");br(l)||(e.crossOrigin="Anonymous"),h.src=l,e.appendChild(h)}})},T.a4=function(){return te++},T.a5=Bt,T.a6=Wl,T.a7=gu,T.a8=No,T.a9=L0,T.aA=function(n){if(n.type==="custom")return new J2(n);switch(n.type){case"background":return new Y2(n);case"circle":return new Bw(n);case"fill":return new Ww(n);case"fill-extrusion":return new p2(n);case"heatmap":return new Fw(n);case"hillshade":return new Nw(n);case"line":return new w2(n);case"raster":return new Q2(n);case"symbol":return new Wd(n)}},T.aB=me,T.aC=function(n,e){if(!n)return[{command:"setStyle",args:[e]}];let r=[];try{if(!ke(n.version,e.version))return[{command:"setStyle",args:[e]}];ke(n.center,e.center)||r.push({command:"setCenter",args:[e.center]}),ke(n.zoom,e.zoom)||r.push({command:"setZoom",args:[e.zoom]}),ke(n.bearing,e.bearing)||r.push({command:"setBearing",args:[e.bearing]}),ke(n.pitch,e.pitch)||r.push({command:"setPitch",args:[e.pitch]}),ke(n.sprite,e.sprite)||r.push({command:"setSprite",args:[e.sprite]}),ke(n.glyphs,e.glyphs)||r.push({command:"setGlyphs",args:[e.glyphs]}),ke(n.transition,e.transition)||r.push({command:"setTransition",args:[e.transition]}),ke(n.light,e.light)||r.push({command:"setLight",args:[e.light]}),ke(n.terrain,e.terrain)||r.push({command:"setTerrain",args:[e.terrain]}),ke(n.sky,e.sky)||r.push({command:"setSky",args:[e.sky]}),ke(n.projection,e.projection)||r.push({command:"setProjection",args:[e.projection]});const l={},h=[];(function(_,v,b,E){let M;for(M in v=v||{},_=_||{})Object.prototype.hasOwnProperty.call(_,M)&&(Object.prototype.hasOwnProperty.call(v,M)||er(M,b,E));for(M in v)Object.prototype.hasOwnProperty.call(v,M)&&(Object.prototype.hasOwnProperty.call(_,M)?ke(_[M],v[M])||(_[M].type==="geojson"&&v[M].type==="geojson"&&as(_,v,M)?oi(b,{command:"setGeoJSONSourceData",args:[M,v[M].data]}):qa(M,v,b,E)):mo(M,v,b))})(n.sources,e.sources,h,l);const g=[];n.layers&&n.layers.forEach(_=>{"source"in _&&l[_.source]?r.push({command:"removeLayer",args:[_.id]}):g.push(_)}),r=r.concat(h),function(_,v,b){v=v||[];const E=(_=_||[]).map(go),M=v.map(go),C=_.reduce(_o,{}),k=v.reduce(_o,{}),L=E.slice(),O=Object.create(null);let F,G,Y,dt,et;for(let lt=0,_t=0;lt<E.length;lt++)F=E[lt],Object.prototype.hasOwnProperty.call(k,F)?_t++:(oi(b,{command:"removeLayer",args:[F]}),L.splice(L.indexOf(F,_t),1));for(let lt=0,_t=0;lt<M.length;lt++)F=M[M.length-1-lt],L[L.length-1-lt]!==F&&(Object.prototype.hasOwnProperty.call(C,F)?(oi(b,{command:"removeLayer",args:[F]}),L.splice(L.lastIndexOf(F,L.length-_t),1)):_t++,dt=L[L.length-lt],oi(b,{command:"addLayer",args:[k[F],dt]}),L.splice(L.length-lt,0,F),O[F]=!0);for(let lt=0;lt<M.length;lt++)if(F=M[lt],G=C[F],Y=k[F],!O[F]&&!ke(G,Y))if(ke(G.source,Y.source)&&ke(G["source-layer"],Y["source-layer"])&&ke(G.type,Y.type)){for(et in Un(G.layout,Y.layout,b,F,null,"setLayoutProperty"),Un(G.paint,Y.paint,b,F,null,"setPaintProperty"),ke(G.filter,Y.filter)||oi(b,{command:"setFilter",args:[F,Y.filter]}),ke(G.minzoom,Y.minzoom)&&ke(G.maxzoom,Y.maxzoom)||oi(b,{command:"setLayerZoomRange",args:[F,Y.minzoom,Y.maxzoom]}),G)Object.prototype.hasOwnProperty.call(G,et)&&et!=="layout"&&et!=="paint"&&et!=="filter"&&et!=="metadata"&&et!=="minzoom"&&et!=="maxzoom"&&(et.indexOf("paint.")===0?Un(G[et],Y[et],b,F,et.slice(6),"setPaintProperty"):ke(G[et],Y[et])||oi(b,{command:"setLayerProperty",args:[F,et,Y[et]]}));for(et in Y)Object.prototype.hasOwnProperty.call(Y,et)&&!Object.prototype.hasOwnProperty.call(G,et)&&et!=="layout"&&et!=="paint"&&et!=="filter"&&et!=="metadata"&&et!=="minzoom"&&et!=="maxzoom"&&(et.indexOf("paint.")===0?Un(G[et],Y[et],b,F,et.slice(6),"setPaintProperty"):ke(G[et],Y[et])||oi(b,{command:"setLayerProperty",args:[F,et,Y[et]]}))}else oi(b,{command:"removeLayer",args:[F]}),dt=L[L.lastIndexOf(F)+1],oi(b,{command:"addLayer",args:[Y,dt]})}(g,e.layers,r)}catch(l){console.warn("Unable to compute style diff:",l),r=[{command:"setStyle",args:[e]}]}return r},T.aD=function(n){const e=[],r=n.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},T.aE=function n(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(let l=0;l<e.length;l++)if(!n(e[l],r[l]))return!1;return!0}if(typeof e=="object"&&e!==null&&r!==null){if(typeof r!="object"||Object.keys(e).length!==Object.keys(r).length)return!1;for(const l in e)if(!n(e[l],r[l]))return!1;return!0}return e===r},T.aF=Pe,T.aG=ye,T.aH=class extends Oo{constructor(n,e){super(n,e),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},T.aI=Nd,T.aJ=class extends Oo{constructor(n,e){super(n,e),this.current=zw}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let e=1;e<16;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},T.aK=wy,T.aL=Sy,T.aM=Fe,T.aN=class extends Oo{constructor(n,e){super(n,e),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},T.aO=class extends Oo{constructor(n,e){super(n,e),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},T.aP=function(n,e,r,l,h,g,_){var v=1/(e-r),b=1/(l-h),E=1/(g-_);return n[0]=-2*v,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*b,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*E,n[11]=0,n[12]=(e+r)*v,n[13]=(h+l)*b,n[14]=(_+g)*E,n[15]=1,n},T.aQ=Lw,T.aR=class extends at{},T.aS=E2,T.aT=class extends ft{},T.aU=hm,T.aV=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},T.aW=Fy,T.aX=Xi,T.aY=oa,T.aZ=class extends Ht{},T.a_=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]&&n[4]===e[4]&&n[5]===e[5]&&n[6]===e[6]&&n[7]===e[7]&&n[8]===e[8]&&n[9]===e[9]&&n[10]===e[10]&&n[11]===e[11]&&n[12]===e[12]&&n[13]===e[13]&&n[14]===e[14]&&n[15]===e[15]},T.aa=function(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,l,h,g)=>{const _=h||g;return e[l]=!_||_.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e},T.ab=function(n,e){const r=[];for(const l in n)l in e||r.push(l);return r},T.ac=Ot,T.ad=function(n,e,r){var l=Math.sin(r),h=Math.cos(r),g=e[0],_=e[1],v=e[2],b=e[3],E=e[4],M=e[5],C=e[6],k=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=g*h+E*l,n[1]=_*h+M*l,n[2]=v*h+C*l,n[3]=b*h+k*l,n[4]=E*h-g*l,n[5]=M*h-_*l,n[6]=C*h-v*l,n[7]=k*h-b*l,n},T.ae=function(n){var e=new Xl(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},T.af=Zd,T.ag=function(n,e){let r=0,l=0;if(n.kind==="constant")l=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:h,minZoom:g,maxZoom:_}=n,v=h?Ot(gn.interpolationFactor(h,e,g,_),0,1):0;n.kind==="camera"?l=mn.number(n.minSize,n.maxSize,v):r=v}return{uSizeT:r,uSize:l}},T.ai=function(n,{uSize:e,uSizeT:r},{lowerSize:l,upperSize:h}){return n.kind==="source"?l/lr:n.kind==="composite"?mn.number(l/lr,h/lr,r):e},T.aj=Mm,T.ak=function(n,e,r,l){const h=e.y-n.y,g=e.x-n.x,_=l.y-r.y,v=l.x-r.x,b=_*g-v*h;if(b===0)return null;const E=(v*(n.y-r.y)-_*(n.x-r.x))/b;return new tt(n.x+E*g,n.y+E*h)},T.al=U0,T.am=My,T.an=lm,T.ao=function(n){let e=1/0,r=1/0,l=-1/0,h=-1/0;for(const g of n)e=Math.min(e,g.x),r=Math.min(r,g.y),l=Math.max(l,g.x),h=Math.max(h,g.y);return[e,r,l,h]},T.ap=Mi,T.ar=Em,T.as=function(n,e){var r=e[0],l=e[1],h=e[2],g=e[3],_=e[4],v=e[5],b=e[6],E=e[7],M=e[8],C=e[9],k=e[10],L=e[11],O=e[12],F=e[13],G=e[14],Y=e[15],dt=r*v-l*_,et=r*b-h*_,lt=r*E-g*_,_t=l*b-h*v,At=l*E-g*v,Ft=h*E-g*b,ee=M*F-C*O,Lt=M*G-k*O,Rt=M*Y-L*O,Yt=C*G-k*F,Zt=C*Y-L*F,Vt=k*Y-L*G,xt=dt*Vt-et*Zt+lt*Yt+_t*Rt-At*Lt+Ft*ee;return xt?(n[0]=(v*Vt-b*Zt+E*Yt)*(xt=1/xt),n[1]=(h*Zt-l*Vt-g*Yt)*xt,n[2]=(F*Ft-G*At+Y*_t)*xt,n[3]=(k*At-C*Ft-L*_t)*xt,n[4]=(b*Rt-_*Vt-E*Lt)*xt,n[5]=(r*Vt-h*Rt+g*Lt)*xt,n[6]=(G*lt-O*Ft-Y*et)*xt,n[7]=(M*Ft-k*lt+L*et)*xt,n[8]=(_*Zt-v*Rt+E*ee)*xt,n[9]=(l*Rt-r*Zt-g*ee)*xt,n[10]=(O*At-F*lt+Y*dt)*xt,n[11]=(C*lt-M*At-L*dt)*xt,n[12]=(v*Lt-_*Yt-b*ee)*xt,n[13]=(r*Yt-l*Lt+h*ee)*xt,n[14]=(F*et-O*_t-G*dt)*xt,n[15]=(M*_t-C*et+k*dt)*xt,n):null},T.at=Lm,T.au=Am,T.av=Bm,T.aw=function(){const n={},e=gt.$version;for(const r in gt.$root){const l=gt.$root[r];if(l.required){let h=null;h=r==="version"?e:l.type==="array"?[]:{},h!=null&&(n[r]=h)}}return n},T.ax=Du,T.ay=Wn,T.az=function(n){n=n.slice();const e=Object.create(null);for(let r=0;r<n.length;r++)e[n[r].id]=n[r];for(let r=0;r<n.length;r++)"ref"in n[r]&&(n[r]=po(n[r],e[n[r].ref]));return n},T.b=le,T.b0=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},T.b1=function(n,e,r){return n[0]=e[0]*r[0],n[1]=e[1]*r[1],n[2]=e[2]*r[2],n[3]=e[3]*r[3],n},T.b2=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]*e[3]},T.b3=ne,T.b4=k0,T.b5=D0,T.b6=function(n,e,r,l,h){var g,_=1/Math.tan(e/2);return n[0]=_/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=_,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,h!=null&&h!==1/0?(n[10]=(h+l)*(g=1/(l-h)),n[14]=2*h*l*g):(n[10]=-1,n[14]=-2*l),n},T.b7=function(n,e,r){var l=Math.sin(r),h=Math.cos(r),g=e[4],_=e[5],v=e[6],b=e[7],E=e[8],M=e[9],C=e[10],k=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=g*h+E*l,n[5]=_*h+M*l,n[6]=v*h+C*l,n[7]=b*h+k*l,n[8]=E*h-g*l,n[9]=M*h-_*l,n[10]=C*h-v*l,n[11]=k*h-b*l,n},T.b8=ut,T.b9=bt,T.bA=a0,T.bB=function(n){return n.message===qi},T.bC=gs,T.bD=kn,T.ba=function(n){return n*Math.PI/180},T.bb=function(n,e){const{x:r,y:l}=Ku.fromLngLat(e);return!(n<0||n>25||l<0||l>=1||r<0||r>=1)},T.bc=function(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},T.bd=class extends z{},T.be=Im,T.bf=lS,T.bh=Mn,T.bi=function(n,e){Zi.REGISTERED_PROTOCOLS[n]=e},T.bj=function(n){delete Zi.REGISTERED_PROTOCOLS[n]},T.bk=function(n,e){const r={};for(let h=0;h<n.length;h++){const g=e&&e[n[h].id]||zd(n[h]);e&&(e[n[h].id]=g);let _=r[g];_||(_=r[g]=[]),_.push(n[h])}const l=[];for(const h in r)l.push(r[h]);return l},T.bl=jt,T.bm=P0,T.bn=B0,T.bo=f0,T.bp=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=wi/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const e=n.bucket.layers[0],r=e.layout,l=e._unevaluatedLayout._values,h={layoutIconSize:l["icon-size"].possiblyEvaluate(new Qe(n.bucket.zoom+1),n.canonical),layoutTextSize:l["text-size"].possiblyEvaluate(new Qe(n.bucket.zoom+1),n.canonical),textMaxSize:l["text-size"].possiblyEvaluate(new Qe(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:E,maxZoom:M}=n.bucket.textSizeData;h.compositeTextSizes=[l["text-size"].possiblyEvaluate(new Qe(E),n.canonical),l["text-size"].possiblyEvaluate(new Qe(M),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:E,maxZoom:M}=n.bucket.iconSizeData;h.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new Qe(E),n.canonical),l["icon-size"].possiblyEvaluate(new Qe(M),n.canonical)]}const g=r.get("text-line-height")*Mi,_=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",v=r.get("text-keep-upright"),b=r.get("text-size");for(const E of n.bucket.features){const M=r.get("text-font").evaluate(E,{},n.canonical).join(","),C=b.evaluate(E,{},n.canonical),k=h.layoutTextSize.evaluate(E,{},n.canonical),L=h.layoutIconSize.evaluate(E,{},n.canonical),O={horizontal:{},vertical:void 0},F=E.text;let G,Y=[0,0];if(F){const lt=F.toString(),_t=r.get("text-letter-spacing").evaluate(E,{},n.canonical)*Mi,At=Qp(lt)?_t:0,Ft=r.get("text-anchor").evaluate(E,{},n.canonical),ee=$0(e,E,n.canonical);if(!ee){const Zt=r.get("text-radial-offset").evaluate(E,{},n.canonical);Y=Zt?X0(Ft,[Zt*Mi,Pm]):r.get("text-offset").evaluate(E,{},n.canonical).map(Vt=>Vt*Mi)}let Lt=_?"center":r.get("text-justify").evaluate(E,{},n.canonical);const Rt=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(E,{},n.canonical)*Mi:1/0,Yt=()=>{n.bucket.allowVerticalPlacement&&Iu(lt)&&(O.vertical=Kd(F,n.glyphMap,n.glyphPositions,n.imagePositions,M,Rt,g,Ft,"left",At,Y,T.ah.vertical,!0,k,C))};if(!_&&ee){const Zt=new Set;if(Lt==="auto")for(let xt=0;xt<ee.values.length;xt+=2)Zt.add(Lm(ee.values[xt]));else Zt.add(Lt);let Vt=!1;for(const xt of Zt)if(!O.horizontal[xt])if(Vt)O.horizontal[xt]=O.horizontal[0];else{const Kt=Kd(F,n.glyphMap,n.glyphPositions,n.imagePositions,M,Rt,g,"center",xt,At,Y,T.ah.horizontal,!1,k,C);Kt&&(O.horizontal[xt]=Kt,Vt=Kt.positionedLines.length===1)}Yt()}else{Lt==="auto"&&(Lt=Lm(Ft));const Zt=Kd(F,n.glyphMap,n.glyphPositions,n.imagePositions,M,Rt,g,Ft,Lt,At,Y,T.ah.horizontal,!1,k,C);Zt&&(O.horizontal[Lt]=Zt),Yt(),Iu(lt)&&_&&v&&(O.vertical=Kd(F,n.glyphMap,n.glyphPositions,n.imagePositions,M,Rt,g,Ft,Lt,At,Y,T.ah.vertical,!1,k,C))}}let dt=!1;if(E.icon&&E.icon.name){const lt=n.imageMap[E.icon.name];lt&&(G=Z2(n.imagePositions[E.icon.name],r.get("icon-offset").evaluate(E,{},n.canonical),r.get("icon-anchor").evaluate(E,{},n.canonical)),dt=!!lt.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=dt:n.bucket.sdfIcons!==dt&&Ai("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(lt.pixelRatio!==n.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const et=K0(O.horizontal)||O.vertical;n.bucket.iconsInText=!!et&&et.iconsInText,(et||G)&&sS(n.bucket,E,O,G,n.imageMap,h,k,L,Y,dt,n.canonical)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},T.bq=vm,T.br=gm,T.bs=ym,T.bt=Rs,T.bu=bm,T.bv=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},T.bw=function(n,e,r,l,h){return f(this,void 0,void 0,function*(){if(nt())try{return yield Ue(n,e,r,l,h)}catch{}return function(g,_,v,b,E){const M=g.width,C=g.height;Ge&&Ei||(Ge=new OffscreenCanvas(M,C),Ei=Ge.getContext("2d",{willReadFrequently:!0})),Ge.width=M,Ge.height=C,Ei.drawImage(g,0,0,M,C);const k=Ei.getImageData(_,v,b,E);return Ei.clearRect(0,0,M,C),k.data}(n,e,r,l,h)})},T.bx=R0,T.by=q,T.bz=ct,T.c=wa,T.d=n=>f(void 0,void 0,void 0,function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(e)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),T.e=Nt,T.f=n=>new Promise((e,r)=>{const l=new Image;l.onload=()=>{e(l),URL.revokeObjectURL(l.src),l.onload=null,window.requestAnimationFrame(()=>{l.src=fe})},l.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const h=new Blob([new Uint8Array(n)],{type:"image/png"});l.src=n.byteLength?URL.createObjectURL(h):fe}),T.g=an,T.h=(n,e)=>xr(Nt(n,{type:"json"}),e),T.i=En,T.j=tr,T.k=Wa,T.l=(n,e)=>xr(Nt(n,{type:"arrayBuffer"}),e),T.m=xr,T.n=function(n){return new bm(n).readFields(O2,[])},T.o=Nu,T.p=d0,T.q=m,T.r=Yp,T.s=br,T.t=zu,T.u=Pr,T.v=gt,T.w=Ai,T.x=function([n,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:n*Math.cos(e)*Math.sin(r),y:n*Math.sin(e)*Math.sin(r),z:n*Math.cos(r)}},T.y=mn,T.z=Qe}),y("worker",["./shared"],function(T){class f{constructor(P){this.keyCache={},P&&this.replace(P)}replace(P){this._layerConfigs={},this._layers={},this.update(P,[])}update(P,R){for(const H of P){this._layerConfigs[H.id]=H;const it=this._layers[H.id]=T.aA(H);it._featureFilter=T.a7(it.filter),this.keyCache[H.id]&&delete this.keyCache[H.id]}for(const H of R)delete this.keyCache[H],delete this._layerConfigs[H],delete this._layers[H];this.familiesBySource={};const N=T.bk(Object.values(this._layerConfigs),this.keyCache);for(const H of N){const it=H.map(mt=>this._layers[mt.id]),rt=it[0];if(rt.visibility==="none")continue;const ht=rt.source||"";let J=this.familiesBySource[ht];J||(J=this.familiesBySource[ht]={});const yt=rt.sourceLayer||"_geojsonTileLayer";let St=J[yt];St||(St=J[yt]=[]),St.push(it)}}}class q{constructor(P){const R={},N=[];for(const ht in P){const J=P[ht],yt=R[ht]={};for(const St in J){const mt=J[+St];if(!mt||mt.bitmap.width===0||mt.bitmap.height===0)continue;const zt={x:0,y:0,w:mt.bitmap.width+2,h:mt.bitmap.height+2};N.push(zt),yt[St]={rect:zt,metrics:mt.metrics}}}const{w:H,h:it}=T.p(N),rt=new T.o({width:H||1,height:it||1});for(const ht in P){const J=P[ht];for(const yt in J){const St=J[+yt];if(!St||St.bitmap.width===0||St.bitmap.height===0)continue;const mt=R[ht][yt].rect;T.o.copy(St.bitmap,rt,{x:0,y:0},{x:mt.x+1,y:mt.y+1},St.bitmap)}}this.image=rt,this.positions=R}}T.bl("GlyphAtlas",q);class ct{constructor(P){this.tileID=new T.S(P.tileID.overscaledZ,P.tileID.wrap,P.tileID.canonical.z,P.tileID.canonical.x,P.tileID.canonical.y),this.uid=P.uid,this.zoom=P.zoom,this.pixelRatio=P.pixelRatio,this.tileSize=P.tileSize,this.source=P.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=P.showCollisionBoxes,this.collectResourceTiming=!!P.collectResourceTiming,this.returnDependencies=!!P.returnDependencies,this.promoteId=P.promoteId,this.inFlightDependencies=[]}parse(P,R,N,H){return T._(this,void 0,void 0,function*(){this.status="parsing",this.data=P,this.collisionBoxArray=new T.a5;const it=new T.bm(Object.keys(P.layers).sort()),rt=new T.bn(this.tileID,this.promoteId);rt.bucketLayerIDs=[];const ht={},J={featureIndex:rt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:N},yt=R.familiesBySource[this.source];for(const ge in yt){const Oe=P.layers[ge];if(!Oe)continue;Oe.version===1&&T.w(`Vector tile source "${this.source}" layer "${ge}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ai=it.encode(ge),Di=[];for(let Oi=0;Oi<Oe.length;Oi++){const sn=Oe.feature(Oi),rs=rt.getId(sn,ge);Di.push({feature:sn,id:rs,index:Oi,sourceLayerIndex:ai})}for(const Oi of yt[ge]){const sn=Oi[0];sn.source!==this.source&&T.w(`layer.source = ${sn.source} does not equal this.source = ${this.source}`),sn.minzoom&&this.zoom<Math.floor(sn.minzoom)||sn.maxzoom&&this.zoom>=sn.maxzoom||sn.visibility!=="none"&&(vt(Oi,this.zoom,N),(ht[sn.id]=sn.createBucket({index:rt.bucketLayerIDs.length,layers:Oi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ai,sourceID:this.source})).populate(Di,J,this.tileID.canonical),rt.bucketLayerIDs.push(Oi.map(rs=>rs.id)))}}const St=T.aF(J.glyphDependencies,ge=>Object.keys(ge).map(Number));this.inFlightDependencies.forEach(ge=>ge==null?void 0:ge.abort()),this.inFlightDependencies=[];let mt=Promise.resolve({});if(Object.keys(St).length){const ge=new AbortController;this.inFlightDependencies.push(ge),mt=H.sendAsync({type:"GG",data:{stacks:St,source:this.source,tileID:this.tileID,type:"glyphs"}},ge)}const zt=Object.keys(J.iconDependencies);let Qt=Promise.resolve({});if(zt.length){const ge=new AbortController;this.inFlightDependencies.push(ge),Qt=H.sendAsync({type:"GI",data:{icons:zt,source:this.source,tileID:this.tileID,type:"icons"}},ge)}const Wt=Object.keys(J.patternDependencies);let Ee=Promise.resolve({});if(Wt.length){const ge=new AbortController;this.inFlightDependencies.push(ge),Ee=H.sendAsync({type:"GI",data:{icons:Wt,source:this.source,tileID:this.tileID,type:"patterns"}},ge)}const[ue,Me,xe]=yield Promise.all([mt,Qt,Ee]),xi=new q(ue),li=new T.bo(Me,xe);for(const ge in ht){const Oe=ht[ge];Oe instanceof T.a6?(vt(Oe.layers,this.zoom,N),T.bp({bucket:Oe,glyphMap:ue,glyphPositions:xi.positions,imageMap:Me,imagePositions:li.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Oe.hasPattern&&(Oe instanceof T.bq||Oe instanceof T.br||Oe instanceof T.bs)&&(vt(Oe.layers,this.zoom,N),Oe.addFeatures(J,this.tileID.canonical,li.patternPositions))}return this.status="done",{buckets:Object.values(ht).filter(ge=>!ge.isEmpty()),featureIndex:rt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:xi.image,imageAtlas:li,glyphMap:this.returnDependencies?ue:null,iconMap:this.returnDependencies?Me:null,glyphPositions:this.returnDependencies?xi.positions:null}})}}function vt($,P,R){const N=new T.z(P);for(const H of $)H.recalculate(N,R)}class tt{constructor(P,R,N){this.actor=P,this.layerIndex=R,this.availableImages=N,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(P,R){return T._(this,void 0,void 0,function*(){const N=yield T.l(P.request,R);try{return{vectorTile:new T.bt.VectorTile(new T.bu(N.data)),rawData:N.data,cacheControl:N.cacheControl,expires:N.expires}}catch(H){const it=new Uint8Array(N.data);let rt=`Unable to parse the tile at ${P.request.url}, `;throw rt+=it[0]===31&&it[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${H.message}`,new Error(rt)}})}loadTile(P){return T._(this,void 0,void 0,function*(){const R=P.uid,N=!!(P&&P.request&&P.request.collectResourceTiming)&&new T.bv(P.request),H=new ct(P);this.loading[R]=H;const it=new AbortController;H.abort=it;try{const rt=yield this.loadVectorTile(P,it);if(delete this.loading[R],!rt)return null;const ht=rt.rawData,J={};rt.expires&&(J.expires=rt.expires),rt.cacheControl&&(J.cacheControl=rt.cacheControl);const yt={};if(N){const mt=N.finish();mt&&(yt.resourceTiming=JSON.parse(JSON.stringify(mt)))}H.vectorTile=rt.vectorTile;const St=H.parse(rt.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[R]=H,this.fetching[R]={rawTileData:ht,cacheControl:J,resourceTiming:yt};try{const mt=yield St;return T.e({rawTileData:ht.slice(0)},mt,J,yt)}finally{delete this.fetching[R]}}catch(rt){throw delete this.loading[R],H.status="done",this.loaded[R]=H,rt}})}reloadTile(P){return T._(this,void 0,void 0,function*(){const R=P.uid;if(!this.loaded||!this.loaded[R])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const N=this.loaded[R];if(N.showCollisionBoxes=P.showCollisionBoxes,N.status==="parsing"){const H=yield N.parse(N.vectorTile,this.layerIndex,this.availableImages,this.actor);let it;if(this.fetching[R]){const{rawTileData:rt,cacheControl:ht,resourceTiming:J}=this.fetching[R];delete this.fetching[R],it=T.e({rawTileData:rt.slice(0)},H,ht,J)}else it=H;return it}if(N.status==="done"&&N.vectorTile)return N.parse(N.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(P){return T._(this,void 0,void 0,function*(){const R=this.loading,N=P.uid;R&&R[N]&&R[N].abort&&(R[N].abort.abort(),delete R[N])})}removeTile(P){return T._(this,void 0,void 0,function*(){this.loaded&&this.loaded[P.uid]&&delete this.loaded[P.uid]})}}class V{constructor(){this.loaded={}}loadTile(P){return T._(this,void 0,void 0,function*(){const{uid:R,encoding:N,rawImageData:H,redFactor:it,greenFactor:rt,blueFactor:ht,baseShift:J}=P,yt=H.width+2,St=H.height+2,mt=T.b(H)?new T.R({width:yt,height:St},yield T.bw(H,-1,-1,yt,St)):H,zt=new T.bx(R,mt,N,it,rt,ht,J);return this.loaded=this.loaded||{},this.loaded[R]=zt,zt})}removeTile(P){const R=this.loaded,N=P.uid;R&&R[N]&&delete R[N]}}function pt($,P){if($.length!==0){Jt($[0],P);for(var R=1;R<$.length;R++)Jt($[R],!P)}}function Jt($,P){for(var R=0,N=0,H=0,it=$.length,rt=it-1;H<it;rt=H++){var ht=($[H][0]-$[rt][0])*($[rt][1]+$[H][1]),J=R+ht;N+=Math.abs(R)>=Math.abs(ht)?R-J+ht:ht-J+R,R=J}R+N>=0!=!!P&&$.reverse()}var Xt=T.by(function $(P,R){var N,H=P&&P.type;if(H==="FeatureCollection")for(N=0;N<P.features.length;N++)$(P.features[N],R);else if(H==="GeometryCollection")for(N=0;N<P.geometries.length;N++)$(P.geometries[N],R);else if(H==="Feature")$(P.geometry,R);else if(H==="Polygon")pt(P.coordinates,R);else if(H==="MultiPolygon")for(N=0;N<P.coordinates.length;N++)pt(P.coordinates[N],R);return P});const _e=T.bt.VectorTileFeature.prototype.toGeoJSON;var st={exports:{}},nt=T.bz,ut=T.bt.VectorTileFeature,bt=Ot;function Ot($,P){this.options=P||{},this.features=$,this.length=$.length}function ne($,P){this.id=typeof $.id=="number"?$.id:void 0,this.type=$.type,this.rawGeometry=$.type===1?[$.geometry]:$.geometry,this.properties=$.tags,this.extent=P||4096}Ot.prototype.feature=function($){return new ne(this.features[$],this.options.extent)},ne.prototype.loadGeometry=function(){var $=this.rawGeometry;this.geometry=[];for(var P=0;P<$.length;P++){for(var R=$[P],N=[],H=0;H<R.length;H++)N.push(new nt(R[H][0],R[H][1]));this.geometry.push(N)}return this.geometry},ne.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var $=this.geometry,P=1/0,R=-1/0,N=1/0,H=-1/0,it=0;it<$.length;it++)for(var rt=$[it],ht=0;ht<rt.length;ht++){var J=rt[ht];P=Math.min(P,J.x),R=Math.max(R,J.x),N=Math.min(N,J.y),H=Math.max(H,J.y)}return[P,N,R,H]},ne.prototype.toGeoJSON=ut.prototype.toGeoJSON;var Nt=T.bA,te=bt;function Pe($){var P=new Nt;return function(R,N){for(var H in R.layers)N.writeMessage(3,ye,R.layers[H])}($,P),P.finish()}function ye($,P){var R;P.writeVarintField(15,$.version||1),P.writeStringField(1,$.name||""),P.writeVarintField(5,$.extent||4096);var N={keys:[],values:[],keycache:{},valuecache:{}};for(R=0;R<$.length;R++)N.feature=$.feature(R),P.writeMessage(2,me,N);var H=N.keys;for(R=0;R<H.length;R++)P.writeStringField(3,H[R]);var it=N.values;for(R=0;R<it.length;R++)P.writeMessage(4,qt,it[R])}function me($,P){var R=$.feature;R.id!==void 0&&P.writeVarintField(1,R.id),P.writeMessage(2,An,$),P.writeVarintField(3,R.type),P.writeMessage(4,En,R)}function An($,P){var R=$.feature,N=$.keys,H=$.values,it=$.keycache,rt=$.valuecache;for(var ht in R.properties){var J=R.properties[ht],yt=it[ht];if(J!==null){yt===void 0&&(N.push(ht),it[ht]=yt=N.length-1),P.writeVarint(yt);var St=typeof J;St!=="string"&&St!=="boolean"&&St!=="number"&&(J=JSON.stringify(J));var mt=St+":"+J,zt=rt[mt];zt===void 0&&(H.push(J),rt[mt]=zt=H.length-1),P.writeVarint(zt)}}}function Ai($,P){return(P<<3)+(7&$)}function Bi($){return $<<1^$>>31}function En($,P){for(var R=$.loadGeometry(),N=$.type,H=0,it=0,rt=R.length,ht=0;ht<rt;ht++){var J=R[ht],yt=1;N===1&&(yt=J.length),P.writeVarint(Ai(1,yt));for(var St=N===3?J.length-1:J.length,mt=0;mt<St;mt++){mt===1&&N!==1&&P.writeVarint(Ai(2,St-1));var zt=J[mt].x-H,Qt=J[mt].y-it;P.writeVarint(Bi(zt)),P.writeVarint(Bi(Qt)),H+=zt,it+=Qt}N===3&&P.writeVarint(Ai(7,1))}}function qt($,P){var R=typeof $;R==="string"?P.writeStringField(1,$):R==="boolean"?P.writeBooleanField(7,$):R==="number"&&($%1!=0?P.writeDoubleField(3,$):$<0?P.writeSVarintField(6,$):P.writeVarintField(5,$))}st.exports=Pe,st.exports.fromVectorTileJs=Pe,st.exports.fromGeojsonVt=function($,P){P=P||{};var R={};for(var N in $)R[N]=new te($[N].features,P),R[N].name=N,R[N].version=P.version,R[N].extent=P.extent;return Pe({layers:R})},st.exports.GeoJSONWrapper=te;var le=T.by(st.exports);const fe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:$=>$},Ue=Math.fround||(Ge=new Float32Array(1),$=>(Ge[0]=+$,Ge[0]));var Ge;const Ei=3,qi=5,wa=6;class Zi{constructor(P){this.options=Object.assign(Object.create(fe),P),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(P){const{log:R,minZoom:N,maxZoom:H}=this.options;R&&console.time("total time");const it=`prepare ${P.length} points`;R&&console.time(it),this.points=P;const rt=[];for(let J=0;J<P.length;J++){const yt=P[J];if(!yt.geometry)continue;const[St,mt]=yt.geometry.coordinates,zt=Ue(Mn(St)),Qt=Ue(Wn(mt));rt.push(zt,Qt,1/0,J,-1,1),this.options.reduce&&rt.push(0)}let ht=this.trees[H+1]=this._createTree(rt);R&&console.timeEnd(it);for(let J=H;J>=N;J--){const yt=+Date.now();ht=this.trees[J]=this._createTree(this._cluster(ht,J)),R&&console.log("z%d: %d clusters in %dms",J,ht.numItems,+Date.now()-yt)}return R&&console.timeEnd("total time"),this}getClusters(P,R){let N=((P[0]+180)%360+360)%360-180;const H=Math.max(-90,Math.min(90,P[1]));let it=P[2]===180?180:((P[2]+180)%360+360)%360-180;const rt=Math.max(-90,Math.min(90,P[3]));if(P[2]-P[0]>=360)N=-180,it=180;else if(N>it){const mt=this.getClusters([N,H,180,rt],R),zt=this.getClusters([-180,H,it,rt],R);return mt.concat(zt)}const ht=this.trees[this._limitZoom(R)],J=ht.range(Mn(N),Wn(rt),Mn(it),Wn(H)),yt=ht.data,St=[];for(const mt of J){const zt=this.stride*mt;St.push(yt[zt+qi]>1?an(yt,zt,this.clusterProps):this.points[yt[zt+Ei]])}return St}getChildren(P){const R=this._getOriginId(P),N=this._getOriginZoom(P),H="No cluster with the specified id.",it=this.trees[N];if(!it)throw new Error(H);const rt=it.data;if(R*this.stride>=rt.length)throw new Error(H);const ht=this.options.radius/(this.options.extent*Math.pow(2,N-1)),J=it.within(rt[R*this.stride],rt[R*this.stride+1],ht),yt=[];for(const St of J){const mt=St*this.stride;rt[mt+4]===P&&yt.push(rt[mt+qi]>1?an(rt,mt,this.clusterProps):this.points[rt[mt+Ei]])}if(yt.length===0)throw new Error(H);return yt}getLeaves(P,R,N){const H=[];return this._appendLeaves(H,P,R=R||10,N=N||0,0),H}getTile(P,R,N){const H=this.trees[this._limitZoom(P)],it=Math.pow(2,P),{extent:rt,radius:ht}=this.options,J=ht/rt,yt=(N-J)/it,St=(N+1+J)/it,mt={features:[]};return this._addTileFeatures(H.range((R-J)/it,yt,(R+1+J)/it,St),H.data,R,N,it,mt),R===0&&this._addTileFeatures(H.range(1-J/it,yt,1,St),H.data,it,N,it,mt),R===it-1&&this._addTileFeatures(H.range(0,yt,J/it,St),H.data,-1,N,it,mt),mt.features.length?mt:null}getClusterExpansionZoom(P){let R=this._getOriginZoom(P)-1;for(;R<=this.options.maxZoom;){const N=this.getChildren(P);if(R++,N.length!==1)break;P=N[0].properties.cluster_id}return R}_appendLeaves(P,R,N,H,it){const rt=this.getChildren(R);for(const ht of rt){const J=ht.properties;if(J&&J.cluster?it+J.point_count<=H?it+=J.point_count:it=this._appendLeaves(P,J.cluster_id,N,H,it):it<H?it++:P.push(ht),P.length===N)break}return it}_createTree(P){const R=new T.av(P.length/this.stride|0,this.options.nodeSize,Float32Array);for(let N=0;N<P.length;N+=this.stride)R.add(P[N],P[N+1]);return R.finish(),R.data=P,R}_addTileFeatures(P,R,N,H,it,rt){for(const ht of P){const J=ht*this.stride,yt=R[J+qi]>1;let St,mt,zt;if(yt)St=is(R,J,this.clusterProps),mt=R[J],zt=R[J+1];else{const Ee=this.points[R[J+Ei]];St=Ee.properties;const[ue,Me]=Ee.geometry.coordinates;mt=Mn(ue),zt=Wn(Me)}const Qt={type:1,geometry:[[Math.round(this.options.extent*(mt*it-N)),Math.round(this.options.extent*(zt*it-H))]],tags:St};let Wt;Wt=yt||this.options.generateId?R[J+Ei]:this.points[R[J+Ei]].id,Wt!==void 0&&(Qt.id=Wt),rt.features.push(Qt)}}_limitZoom(P){return Math.max(this.options.minZoom,Math.min(Math.floor(+P),this.options.maxZoom+1))}_cluster(P,R){const{radius:N,extent:H,reduce:it,minPoints:rt}=this.options,ht=N/(H*Math.pow(2,R)),J=P.data,yt=[],St=this.stride;for(let mt=0;mt<J.length;mt+=St){if(J[mt+2]<=R)continue;J[mt+2]=R;const zt=J[mt],Qt=J[mt+1],Wt=P.within(J[mt],J[mt+1],ht),Ee=J[mt+qi];let ue=Ee;for(const Me of Wt){const xe=Me*St;J[xe+2]>R&&(ue+=J[xe+qi])}if(ue>Ee&&ue>=rt){let Me,xe=zt*Ee,xi=Qt*Ee,li=-1;const ge=((mt/St|0)<<5)+(R+1)+this.points.length;for(const Oe of Wt){const ai=Oe*St;if(J[ai+2]<=R)continue;J[ai+2]=R;const Di=J[ai+qi];xe+=J[ai]*Di,xi+=J[ai+1]*Di,J[ai+4]=ge,it&&(Me||(Me=this._map(J,mt,!0),li=this.clusterProps.length,this.clusterProps.push(Me)),it(Me,this._map(J,ai)))}J[mt+4]=ge,yt.push(xe/ue,xi/ue,1/0,ge,-1,ue),it&&yt.push(li)}else{for(let Me=0;Me<St;Me++)yt.push(J[mt+Me]);if(ue>1)for(const Me of Wt){const xe=Me*St;if(!(J[xe+2]<=R)){J[xe+2]=R;for(let xi=0;xi<St;xi++)yt.push(J[xe+xi])}}}}return yt}_getOriginId(P){return P-this.points.length>>5}_getOriginZoom(P){return(P-this.points.length)%32}_map(P,R,N){if(P[R+qi]>1){const rt=this.clusterProps[P[R+wa]];return N?Object.assign({},rt):rt}const H=this.points[P[R+Ei]].properties,it=this.options.map(H);return N&&it===H?Object.assign({},it):it}}function an($,P,R){return{type:"Feature",id:$[P+Ei],properties:is($,P,R),geometry:{type:"Point",coordinates:[(N=$[P],360*(N-.5)),xr($[P+1])]}};var N}function is($,P,R){const N=$[P+qi],H=N>=1e4?`${Math.round(N/1e3)}k`:N>=1e3?Math.round(N/100)/10+"k":N,it=$[P+wa],rt=it===-1?{}:Object.assign({},R[it]);return Object.assign(rt,{cluster:!0,cluster_id:$[P+Ei],point_count:N,point_count_abbreviated:H})}function Mn($){return $/360+.5}function Wn($){const P=Math.sin($*Math.PI/180),R=.5-.25*Math.log((1+P)/(1-P))/Math.PI;return R<0?0:R>1?1:R}function xr($){const P=(180-360*$)*Math.PI/180;return 360*Math.atan(Math.exp(P))/Math.PI-90}function br($,P,R,N){let H=N;const it=P+(R-P>>1);let rt,ht=R-P;const J=$[P],yt=$[P+1],St=$[R],mt=$[R+1];for(let zt=P+3;zt<R;zt+=3){const Qt=fo($[zt],$[zt+1],J,yt,St,mt);if(Qt>H)rt=zt,H=Qt;else if(Qt===H){const Wt=Math.abs(zt-it);Wt<ht&&(rt=zt,ht=Wt)}}H>N&&(rt-P>3&&br($,P,rt,N),$[rt+2]=H,R-rt>3&&br($,rt,R,N))}function fo($,P,R,N,H,it){let rt=H-R,ht=it-N;if(rt!==0||ht!==0){const J=(($-R)*rt+(P-N)*ht)/(rt*rt+ht*ht);J>1?(R=H,N=it):J>0&&(R+=rt*J,N+=ht*J)}return rt=$-R,ht=P-N,rt*rt+ht*ht}function ja($,P,R,N){const H={id:$??null,type:P,geometry:R,tags:N,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(P==="Point"||P==="MultiPoint"||P==="LineString")Wa(H,R);else if(P==="Polygon")Wa(H,R[0]);else if(P==="MultiLineString")for(const it of R)Wa(H,it);else if(P==="MultiPolygon")for(const it of R)Wa(H,it[0]);return H}function Wa($,P){for(let R=0;R<P.length;R+=3)$.minX=Math.min($.minX,P[R]),$.minY=Math.min($.minY,P[R+1]),$.maxX=Math.max($.maxX,P[R]),$.maxY=Math.max($.maxY,P[R+1])}function tr($,P,R,N){if(!P.geometry)return;const H=P.geometry.coordinates;if(H&&H.length===0)return;const it=P.geometry.type,rt=Math.pow(R.tolerance/((1<<R.maxZoom)*R.extent),2);let ht=[],J=P.id;if(R.promoteId?J=P.properties[R.promoteId]:R.generateId&&(J=N||0),it==="Point")ns(H,ht);else if(it==="MultiPoint")for(const yt of H)ns(yt,ht);else if(it==="LineString")gt(H,ht,rt,!1);else if(it==="MultiLineString"){if(R.lineMetrics){for(const yt of H)ht=[],gt(yt,ht,rt,!1),$.push(ja(J,"LineString",ht,P.properties));return}wr(H,ht,rt,!1)}else if(it==="Polygon")wr(H,ht,rt,!0);else{if(it!=="MultiPolygon"){if(it==="GeometryCollection"){for(const yt of P.geometry.geometries)tr($,{id:J,geometry:yt,properties:P.properties},R,N);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const yt of H){const St=[];wr(yt,St,rt,!0),ht.push(St)}}$.push(ja(J,it,ht,P.properties))}function ns($,P){P.push(po($[0]),ke($[1]),0)}function gt($,P,R,N){let H,it,rt=0;for(let J=0;J<$.length;J++){const yt=po($[J][0]),St=ke($[J][1]);P.push(yt,St,0),J>0&&(rt+=N?(H*St-yt*it)/2:Math.sqrt(Math.pow(yt-H,2)+Math.pow(St-it,2))),H=yt,it=St}const ht=P.length-3;P[2]=1,br(P,0,ht,R),P[ht+2]=1,P.size=Math.abs(rt),P.start=0,P.end=P.size}function wr($,P,R,N){for(let H=0;H<$.length;H++){const it=[];gt($[H],it,R,N),P.push(it)}}function po($){return $/360+.5}function ke($){const P=Math.sin($*Math.PI/180),R=.5-.25*Math.log((1+P)/(1-P))/Math.PI;return R<0?0:R>1?1:R}function oi($,P,R,N,H,it,rt,ht){if(N/=P,it>=(R/=P)&&rt<N)return $;if(rt<R||it>=N)return null;const J=[];for(const yt of $){const St=yt.geometry;let mt=yt.type;const zt=H===0?yt.minX:yt.minY,Qt=H===0?yt.maxX:yt.maxY;if(zt>=R&&Qt<N){J.push(yt);continue}if(Qt<R||zt>=N)continue;let Wt=[];if(mt==="Point"||mt==="MultiPoint")mo(St,Wt,R,N,H);else if(mt==="LineString")er(St,Wt,R,N,H,!1,ht.lineMetrics);else if(mt==="MultiLineString")as(St,Wt,R,N,H,!1);else if(mt==="Polygon")as(St,Wt,R,N,H,!0);else if(mt==="MultiPolygon")for(const Ee of St){const ue=[];as(Ee,ue,R,N,H,!0),ue.length&&Wt.push(ue)}if(Wt.length){if(ht.lineMetrics&&mt==="LineString"){for(const Ee of Wt)J.push(ja(yt.id,mt,Ee,yt.tags));continue}mt!=="LineString"&&mt!=="MultiLineString"||(Wt.length===1?(mt="LineString",Wt=Wt[0]):mt="MultiLineString"),mt!=="Point"&&mt!=="MultiPoint"||(mt=Wt.length===3?"Point":"MultiPoint"),J.push(ja(yt.id,mt,Wt,yt.tags))}}return J.length?J:null}function mo($,P,R,N,H){for(let it=0;it<$.length;it+=3){const rt=$[it+H];rt>=R&&rt<=N&&Un(P,$[it],$[it+1],$[it+2])}}function er($,P,R,N,H,it,rt){let ht=qa($);const J=H===0?go:_o;let yt,St,mt=$.start;for(let ue=0;ue<$.length-3;ue+=3){const Me=$[ue],xe=$[ue+1],xi=$[ue+2],li=$[ue+3],ge=$[ue+4],Oe=H===0?Me:xe,ai=H===0?li:ge;let Di=!1;rt&&(yt=Math.sqrt(Math.pow(Me-li,2)+Math.pow(xe-ge,2))),Oe<R?ai>R&&(St=J(ht,Me,xe,li,ge,R),rt&&(ht.start=mt+yt*St)):Oe>N?ai<N&&(St=J(ht,Me,xe,li,ge,N),rt&&(ht.start=mt+yt*St)):Un(ht,Me,xe,xi),ai<R&&Oe>=R&&(St=J(ht,Me,xe,li,ge,R),Di=!0),ai>N&&Oe<=N&&(St=J(ht,Me,xe,li,ge,N),Di=!0),!it&&Di&&(rt&&(ht.end=mt+yt*St),P.push(ht),ht=qa($)),rt&&(mt+=yt)}let zt=$.length-3;const Qt=$[zt],Wt=$[zt+1],Ee=H===0?Qt:Wt;Ee>=R&&Ee<=N&&Un(ht,Qt,Wt,$[zt+2]),zt=ht.length-3,it&&zt>=3&&(ht[zt]!==ht[0]||ht[zt+1]!==ht[1])&&Un(ht,ht[0],ht[1],ht[2]),ht.length&&P.push(ht)}function qa($){const P=[];return P.size=$.size,P.start=$.start,P.end=$.end,P}function as($,P,R,N,H,it){for(const rt of $)er(rt,P,R,N,H,it,!1)}function Un($,P,R,N){$.push(P,R,N)}function go($,P,R,N,H,it){const rt=(it-P)/(N-P);return Un($,it,R+(H-R)*rt,1),rt}function _o($,P,R,N,H,it){const rt=(it-R)/(H-R);return Un($,P+(N-P)*rt,it,1),rt}function Mt($,P){const R=[];for(let N=0;N<$.length;N++){const H=$[N],it=H.type;let rt;if(it==="Point"||it==="MultiPoint"||it==="LineString")rt=Sa(H.geometry,P);else if(it==="MultiLineString"||it==="Polygon"){rt=[];for(const ht of H.geometry)rt.push(Sa(ht,P))}else if(it==="MultiPolygon"){rt=[];for(const ht of H.geometry){const J=[];for(const yt of ht)J.push(Sa(yt,P));rt.push(J)}}R.push(ja(H.id,it,rt,H.tags))}return R}function Sa($,P){const R=[];R.size=$.size,$.start!==void 0&&(R.start=$.start,R.end=$.end);for(let N=0;N<$.length;N+=3)R.push($[N]+P,$[N+1],$[N+2]);return R}function rn($,P){if($.transformed)return $;const R=1<<$.z,N=$.x,H=$.y;for(const it of $.features){const rt=it.geometry,ht=it.type;if(it.geometry=[],ht===1)for(let J=0;J<rt.length;J+=2)it.geometry.push(Ta(rt[J],rt[J+1],P,R,N,H));else for(let J=0;J<rt.length;J++){const yt=[];for(let St=0;St<rt[J].length;St+=2)yt.push(Ta(rt[J][St],rt[J][St+1],P,R,N,H));it.geometry.push(yt)}}return $.transformed=!0,$}function Ta($,P,R,N,H,it){return[Math.round(R*($*N-H)),Math.round(R*(P*N-it))]}function ir($,P,R,N,H){const it=P===H.maxZoom?0:H.tolerance/((1<<P)*H.extent),rt={features:[],numPoints:0,numSimplified:0,numFeatures:$.length,source:null,x:R,y:N,z:P,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ht of $)It(rt,ht,it,H);return rt}function It($,P,R,N){const H=P.geometry,it=P.type,rt=[];if($.minX=Math.min($.minX,P.minX),$.minY=Math.min($.minY,P.minY),$.maxX=Math.max($.maxX,P.maxX),$.maxY=Math.max($.maxY,P.maxY),it==="Point"||it==="MultiPoint")for(let ht=0;ht<H.length;ht+=3)rt.push(H[ht],H[ht+1]),$.numPoints++,$.numSimplified++;else if(it==="LineString")pe(rt,H,$,R,!1,!1);else if(it==="MultiLineString"||it==="Polygon")for(let ht=0;ht<H.length;ht++)pe(rt,H[ht],$,R,it==="Polygon",ht===0);else if(it==="MultiPolygon")for(let ht=0;ht<H.length;ht++){const J=H[ht];for(let yt=0;yt<J.length;yt++)pe(rt,J[yt],$,R,!0,yt===0)}if(rt.length){let ht=P.tags||null;if(it==="LineString"&&N.lineMetrics){ht={};for(const yt in P.tags)ht[yt]=P.tags[yt];ht.mapbox_clip_start=H.start/H.size,ht.mapbox_clip_end=H.end/H.size}const J={geometry:rt,type:it==="Polygon"||it==="MultiPolygon"?3:it==="LineString"||it==="MultiLineString"?2:1,tags:ht};P.id!==null&&(J.id=P.id),$.features.push(J)}}function pe($,P,R,N,H,it){const rt=N*N;if(N>0&&P.size<(H?rt:N))return void(R.numPoints+=P.length/3);const ht=[];for(let J=0;J<P.length;J+=3)(N===0||P[J+2]>rt)&&(R.numSimplified++,ht.push(P[J],P[J+1])),R.numPoints++;H&&function(J,yt){let St=0;for(let mt=0,zt=J.length,Qt=zt-2;mt<zt;Qt=mt,mt+=2)St+=(J[mt]-J[Qt])*(J[mt+1]+J[Qt+1]);if(St>0===yt)for(let mt=0,zt=J.length;mt<zt/2;mt+=2){const Qt=J[mt],Wt=J[mt+1];J[mt]=J[zt-2-mt],J[mt+1]=J[zt-1-mt],J[zt-2-mt]=Qt,J[zt-1-mt]=Wt}}(ht,it),$.push(ht)}const ae={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class pn{constructor(P,R){const N=(R=this.options=function(it,rt){for(const ht in rt)it[ht]=rt[ht];return it}(Object.create(ae),R)).debug;if(N&&console.time("preprocess data"),R.maxZoom<0||R.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(R.promoteId&&R.generateId)throw new Error("promoteId and generateId cannot be used together.");let H=function(it,rt){const ht=[];if(it.type==="FeatureCollection")for(let J=0;J<it.features.length;J++)tr(ht,it.features[J],rt,J);else tr(ht,it.type==="Feature"?it:{geometry:it},rt);return ht}(P,R);this.tiles={},this.tileCoords=[],N&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",R.indexMaxZoom,R.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),H=function(it,rt){const ht=rt.buffer/rt.extent;let J=it;const yt=oi(it,1,-1-ht,ht,0,-1,2,rt),St=oi(it,1,1-ht,2+ht,0,-1,2,rt);return(yt||St)&&(J=oi(it,1,-ht,1+ht,0,-1,2,rt)||[],yt&&(J=Mt(yt,1).concat(J)),St&&(J=J.concat(Mt(St,-1)))),J}(H,R),H.length&&this.splitTile(H,0,0,0),N&&(H.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(P,R,N,H,it,rt,ht){const J=[P,R,N,H],yt=this.options,St=yt.debug;for(;J.length;){H=J.pop(),N=J.pop(),R=J.pop(),P=J.pop();const mt=1<<R,zt=ta(R,N,H);let Qt=this.tiles[zt];if(!Qt&&(St>1&&console.time("creation"),Qt=this.tiles[zt]=ir(P,R,N,H,yt),this.tileCoords.push({z:R,x:N,y:H}),St)){St>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",R,N,H,Qt.numFeatures,Qt.numPoints,Qt.numSimplified),console.timeEnd("creation"));const Di=`z${R}`;this.stats[Di]=(this.stats[Di]||0)+1,this.total++}if(Qt.source=P,it==null){if(R===yt.indexMaxZoom||Qt.numPoints<=yt.indexMaxPoints)continue}else{if(R===yt.maxZoom||R===it)continue;if(it!=null){const Di=it-R;if(N!==rt>>Di||H!==ht>>Di)continue}}if(Qt.source=null,P.length===0)continue;St>1&&console.time("clipping");const Wt=.5*yt.buffer/yt.extent,Ee=.5-Wt,ue=.5+Wt,Me=1+Wt;let xe=null,xi=null,li=null,ge=null,Oe=oi(P,mt,N-Wt,N+ue,0,Qt.minX,Qt.maxX,yt),ai=oi(P,mt,N+Ee,N+Me,0,Qt.minX,Qt.maxX,yt);P=null,Oe&&(xe=oi(Oe,mt,H-Wt,H+ue,1,Qt.minY,Qt.maxY,yt),xi=oi(Oe,mt,H+Ee,H+Me,1,Qt.minY,Qt.maxY,yt),Oe=null),ai&&(li=oi(ai,mt,H-Wt,H+ue,1,Qt.minY,Qt.maxY,yt),ge=oi(ai,mt,H+Ee,H+Me,1,Qt.minY,Qt.maxY,yt),ai=null),St>1&&console.timeEnd("clipping"),J.push(xe||[],R+1,2*N,2*H),J.push(xi||[],R+1,2*N,2*H+1),J.push(li||[],R+1,2*N+1,2*H),J.push(ge||[],R+1,2*N+1,2*H+1)}}getTile(P,R,N){P=+P,R=+R,N=+N;const H=this.options,{extent:it,debug:rt}=H;if(P<0||P>24)return null;const ht=1<<P,J=ta(P,R=R+ht&ht-1,N);if(this.tiles[J])return rn(this.tiles[J],it);rt>1&&console.log("drilling down to z%d-%d-%d",P,R,N);let yt,St=P,mt=R,zt=N;for(;!yt&&St>0;)St--,mt>>=1,zt>>=1,yt=this.tiles[ta(St,mt,zt)];return yt&&yt.source?(rt>1&&(console.log("found parent tile z%d-%d-%d",St,mt,zt),console.time("drilling down")),this.splitTile(yt.source,St,mt,zt,P,R,N),rt>1&&console.timeEnd("drilling down"),this.tiles[J]?rn(this.tiles[J],it):null):null}}function ta($,P,R){return 32*((1<<$)*R+P)+$}function ce($,P){return P?$.properties[P]:$.id}function Aa($,P){if($==null)return!0;if($.type==="Feature")return ce($,P)!=null;if($.type==="FeatureCollection"){const R=new Set;for(const N of $.features){const H=ce(N,P);if(H==null||R.has(H))return!1;R.add(H)}return!0}return!1}function Za($,P){const R=new Map;if($!=null)if($.type==="Feature")R.set(ce($,P),$);else for(const N of $.features)R.set(ce(N,P),N);return R}class nr extends tt{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(P,R){return T._(this,void 0,void 0,function*(){const N=P.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const H=this._geoJSONIndex.getTile(N.z,N.x,N.y);if(!H)return null;const it=new class{constructor(ht){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=T.X,this.length=ht.length,this._features=ht}feature(ht){return new class{constructor(J){this._feature=J,this.extent=T.X,this.type=J.type,this.properties=J.tags,"id"in J&&!isNaN(J.id)&&(this.id=parseInt(J.id,10))}loadGeometry(){if(this._feature.type===1){const J=[];for(const yt of this._feature.geometry)J.push([new T.P(yt[0],yt[1])]);return J}{const J=[];for(const yt of this._feature.geometry){const St=[];for(const mt of yt)St.push(new T.P(mt[0],mt[1]));J.push(St)}return J}}toGeoJSON(J,yt,St){return _e.call(this,J,yt,St)}}(this._features[ht])}}(H.features);let rt=le(it);return rt.byteOffset===0&&rt.byteLength===rt.buffer.byteLength||(rt=new Uint8Array(rt)),{vectorTile:it,rawData:rt.buffer}})}loadData(P){return T._(this,void 0,void 0,function*(){var R;(R=this._pendingRequest)===null||R===void 0||R.abort();const N=!!(P&&P.request&&P.request.collectResourceTiming)&&new T.bv(P.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(P,this._pendingRequest),this._geoJSONIndex=P.cluster?new Zi(function({superclusterOptions:rt,clusterProperties:ht}){if(!ht||!rt)return rt;const J={},yt={},St={accumulated:null,zoom:0},mt={properties:null},zt=Object.keys(ht);for(const Qt of zt){const[Wt,Ee]=ht[Qt],ue=T.bC(Ee),Me=T.bC(typeof Wt=="string"?[Wt,["accumulated"],["get",Qt]]:Wt);J[Qt]=ue.value,yt[Qt]=Me.value}return rt.map=Qt=>{mt.properties=Qt;const Wt={};for(const Ee of zt)Wt[Ee]=J[Ee].evaluate(St,mt);return Wt},rt.reduce=(Qt,Wt)=>{mt.properties=Wt;for(const Ee of zt)St.accumulated=Qt[Ee],Qt[Ee]=yt[Ee].evaluate(St,mt)},rt}(P)).load((yield this._pendingData).features):(H=yield this._pendingData,new pn(H,P.geojsonVtOptions)),this.loaded={};const it={};if(N){const rt=N.finish();rt&&(it.resourceTiming={},it.resourceTiming[P.source]=JSON.parse(JSON.stringify(rt)))}return it}catch(it){if(delete this._pendingRequest,T.bB(it))return{abandoned:!0};throw it}var H})}getData(){return T._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(P){const R=this.loaded;return R&&R[P.uid]?super.reloadTile(P):this.loadTile(P)}loadAndProcessGeoJSON(P,R){return T._(this,void 0,void 0,function*(){let N=yield this.loadGeoJSON(P,R);if(delete this._pendingRequest,typeof N!="object")throw new Error(`Input data given to '${P.source}' is not a valid GeoJSON object.`);if(Xt(N,!0),P.filter){const H=T.bC(P.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(H.result==="error")throw new Error(H.value.map(rt=>`${rt.key}: ${rt.message}`).join(", "));N={type:"FeatureCollection",features:N.features.filter(rt=>H.value.evaluate({zoom:0},rt))}}return N})}loadGeoJSON(P,R){return T._(this,void 0,void 0,function*(){const{promoteId:N}=P;if(P.request){const H=yield T.h(P.request,R);return this._dataUpdateable=Aa(H.data,N)?Za(H.data,N):void 0,H.data}if(typeof P.data=="string")try{const H=JSON.parse(P.data);return this._dataUpdateable=Aa(H,N)?Za(H,N):void 0,H}catch{throw new Error(`Input data given to '${P.source}' is not a valid GeoJSON object.`)}if(!P.dataDiff)throw new Error(`Input data given to '${P.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${P.source}`);return function(H,it,rt){var ht,J,yt,St;if(it.removeAll&&H.clear(),it.remove)for(const mt of it.remove)H.delete(mt);if(it.add)for(const mt of it.add){const zt=ce(mt,rt);zt!=null&&H.set(zt,mt)}if(it.update)for(const mt of it.update){let zt=H.get(mt.id);if(zt==null)continue;const Qt=!mt.removeAllProperties&&(((ht=mt.removeProperties)===null||ht===void 0?void 0:ht.length)>0||((J=mt.addOrUpdateProperties)===null||J===void 0?void 0:J.length)>0);if((mt.newGeometry||mt.removeAllProperties||Qt)&&(zt=Object.assign({},zt),H.set(mt.id,zt),Qt&&(zt.properties=Object.assign({},zt.properties))),mt.newGeometry&&(zt.geometry=mt.newGeometry),mt.removeAllProperties)zt.properties={};else if(((yt=mt.removeProperties)===null||yt===void 0?void 0:yt.length)>0)for(const Wt of mt.removeProperties)Object.prototype.hasOwnProperty.call(zt.properties,Wt)&&delete zt.properties[Wt];if(((St=mt.addOrUpdateProperties)===null||St===void 0?void 0:St.length)>0)for(const{key:Wt,value:Ee}of mt.addOrUpdateProperties)zt.properties[Wt]=Ee}}(this._dataUpdateable,P.dataDiff,N),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(P){return T._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(P){return this._geoJSONIndex.getClusterExpansionZoom(P.clusterId)}getClusterChildren(P){return this._geoJSONIndex.getChildren(P.clusterId)}getClusterLeaves(P){return this._geoJSONIndex.getLeaves(P.clusterId,P.limit,P.offset)}}class Ea{constructor(P){this.self=P,this.actor=new T.F(P),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(R,N)=>{if(this.externalWorkerSourceTypes[R])throw new Error(`Worker source with name "${R}" already registered.`);this.externalWorkerSourceTypes[R]=N},this.self.addProtocol=T.bi,this.self.removeProtocol=T.bj,this.self.registerRTLTextPlugin=R=>{if(T.bD.isParsed())throw new Error("RTL text plugin already registered.");T.bD.setMethods(R)},this.actor.registerMessageHandler("LDT",(R,N)=>this._getDEMWorkerSource(R,N.source).loadTile(N)),this.actor.registerMessageHandler("RDT",(R,N)=>T._(this,void 0,void 0,function*(){this._getDEMWorkerSource(R,N.source).removeTile(N)})),this.actor.registerMessageHandler("GCEZ",(R,N)=>T._(this,void 0,void 0,function*(){return this._getWorkerSource(R,N.type,N.source).getClusterExpansionZoom(N)})),this.actor.registerMessageHandler("GCC",(R,N)=>T._(this,void 0,void 0,function*(){return this._getWorkerSource(R,N.type,N.source).getClusterChildren(N)})),this.actor.registerMessageHandler("GCL",(R,N)=>T._(this,void 0,void 0,function*(){return this._getWorkerSource(R,N.type,N.source).getClusterLeaves(N)})),this.actor.registerMessageHandler("LD",(R,N)=>this._getWorkerSource(R,N.type,N.source).loadData(N)),this.actor.registerMessageHandler("GD",(R,N)=>this._getWorkerSource(R,N.type,N.source).getData()),this.actor.registerMessageHandler("LT",(R,N)=>this._getWorkerSource(R,N.type,N.source).loadTile(N)),this.actor.registerMessageHandler("RT",(R,N)=>this._getWorkerSource(R,N.type,N.source).reloadTile(N)),this.actor.registerMessageHandler("AT",(R,N)=>this._getWorkerSource(R,N.type,N.source).abortTile(N)),this.actor.registerMessageHandler("RMT",(R,N)=>this._getWorkerSource(R,N.type,N.source).removeTile(N)),this.actor.registerMessageHandler("RS",(R,N)=>T._(this,void 0,void 0,function*(){if(!this.workerSources[R]||!this.workerSources[R][N.type]||!this.workerSources[R][N.type][N.source])return;const H=this.workerSources[R][N.type][N.source];delete this.workerSources[R][N.type][N.source],H.removeSource!==void 0&&H.removeSource(N)})),this.actor.registerMessageHandler("RM",R=>T._(this,void 0,void 0,function*(){delete this.layerIndexes[R],delete this.availableImages[R],delete this.workerSources[R],delete this.demWorkerSources[R]})),this.actor.registerMessageHandler("SR",(R,N)=>T._(this,void 0,void 0,function*(){this.referrer=N})),this.actor.registerMessageHandler("SRPS",(R,N)=>this._syncRTLPluginState(R,N)),this.actor.registerMessageHandler("IS",(R,N)=>T._(this,void 0,void 0,function*(){this.self.importScripts(N)})),this.actor.registerMessageHandler("SI",(R,N)=>this._setImages(R,N)),this.actor.registerMessageHandler("UL",(R,N)=>T._(this,void 0,void 0,function*(){this._getLayerIndex(R).update(N.layers,N.removedIds)})),this.actor.registerMessageHandler("SL",(R,N)=>T._(this,void 0,void 0,function*(){this._getLayerIndex(R).replace(N)}))}_setImages(P,R){return T._(this,void 0,void 0,function*(){this.availableImages[P]=R;for(const N in this.workerSources[P]){const H=this.workerSources[P][N];for(const it in H)H[it].availableImages=R}})}_syncRTLPluginState(P,R){return T._(this,void 0,void 0,function*(){if(T.bD.isParsed())return T.bD.getState();if(R.pluginStatus!=="loading")return T.bD.setState(R),R;const N=R.pluginURL;if(this.self.importScripts(N),T.bD.isParsed()){const H={pluginStatus:"loaded",pluginURL:N};return T.bD.setState(H),H}throw T.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${N}`)})}_getAvailableImages(P){let R=this.availableImages[P];return R||(R=[]),R}_getLayerIndex(P){let R=this.layerIndexes[P];return R||(R=this.layerIndexes[P]=new f),R}_getWorkerSource(P,R,N){if(this.workerSources[P]||(this.workerSources[P]={}),this.workerSources[P][R]||(this.workerSources[P][R]={}),!this.workerSources[P][R][N]){const H={sendAsync:(it,rt)=>(it.targetMapId=P,this.actor.sendAsync(it,rt))};switch(R){case"vector":this.workerSources[P][R][N]=new tt(H,this._getLayerIndex(P),this._getAvailableImages(P));break;case"geojson":this.workerSources[P][R][N]=new nr(H,this._getLayerIndex(P),this._getAvailableImages(P));break;default:this.workerSources[P][R][N]=new this.externalWorkerSourceTypes[R](H,this._getLayerIndex(P),this._getAvailableImages(P))}}return this.workerSources[P][R][N]}_getDEMWorkerSource(P,R){return this.demWorkerSources[P]||(this.demWorkerSources[P]={}),this.demWorkerSources[P][R]||(this.demWorkerSources[P][R]=new V),this.demWorkerSources[P][R]}}return T.i(self)&&(self.worker=new Ea(self)),Ea}),y("index",["exports","./shared"],function(T,f){var q="4.7.1";let ct,vt;const tt={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:m=>new Promise((t,s)=>{const c=requestAnimationFrame(t);m.signal.addEventListener("abort",()=>{cancelAnimationFrame(c),s(f.c())})}),getImageData(m,t=0){return this.getImageCanvasContext(m).getImageData(-t,-t,m.width+2*t,m.height+2*t)},getImageCanvasContext(m){const t=window.document.createElement("canvas"),s=t.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return t.width=m.width,t.height=m.height,s.drawImage(m,0,0,m.width,m.height),s},resolveURL:m=>(ct||(ct=document.createElement("a")),ct.href=m,ct.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(vt==null&&(vt=matchMedia("(prefers-reduced-motion: reduce)")),vt.matches)}};class V{static testProp(t){if(!V.docStyle)return t[0];for(let s=0;s<t.length;s++)if(t[s]in V.docStyle)return t[s];return t[0]}static create(t,s,c){const u=window.document.createElement(t);return s!==void 0&&(u.className=s),c&&c.appendChild(u),u}static createNS(t,s){return window.document.createElementNS(t,s)}static disableDrag(){V.docStyle&&V.selectProp&&(V.userSelect=V.docStyle[V.selectProp],V.docStyle[V.selectProp]="none")}static enableDrag(){V.docStyle&&V.selectProp&&(V.docStyle[V.selectProp]=V.userSelect)}static setTransform(t,s){t.style[V.transformProp]=s}static addEventListener(t,s,c,u={}){t.addEventListener(s,c,"passive"in u?u:u.capture)}static removeEventListener(t,s,c,u={}){t.removeEventListener(s,c,"passive"in u?u:u.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",V.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",V.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",V.suppressClickInternal,!0)},0)}static getScale(t){const s=t.getBoundingClientRect();return{x:s.width/t.offsetWidth||1,y:s.height/t.offsetHeight||1,boundingClientRect:s}}static getPoint(t,s,c){const u=s.boundingClientRect;return new f.P((c.clientX-u.left)/s.x-t.clientLeft,(c.clientY-u.top)/s.y-t.clientTop)}static mousePos(t,s){const c=V.getScale(t);return V.getPoint(t,c,s)}static touchPos(t,s){const c=[],u=V.getScale(t);for(let p=0;p<s.length;p++)c.push(V.getPoint(t,u,s[p]));return c}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}V.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,V.selectProp=V.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),V.transformProp=V.testProp(["transform","WebkitTransform"]);const pt={supported:!1,testSupport:function(m){!_e&&Xt&&(st?nt(m):Jt=m)}};let Jt,Xt,_e=!1,st=!1;function nt(m){const t=m.createTexture();m.bindTexture(m.TEXTURE_2D,t);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,Xt),m.isContextLost())return;pt.supported=!0}catch{}m.deleteTexture(t),_e=!0}var ut;typeof document<"u"&&(Xt=document.createElement("img"),Xt.onload=()=>{Jt&&nt(Jt),Jt=null,st=!0},Xt.onerror=()=>{_e=!0,Jt=null},Xt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(m){let t,s,c,u;m.resetRequestQueue=()=>{t=[],s=0,c=0,u={}},m.addThrottleControl=A=>{const z=c++;return u[z]=A,z},m.removeThrottleControl=A=>{delete u[A],x()},m.getImage=(A,z,D=!0)=>new Promise((I,B)=>{pt.supported&&(A.headers||(A.headers={}),A.headers.accept="image/webp,*/*"),f.e(A,{type:"image"}),t.push({abortController:z,requestParameters:A,supportImageRefresh:D,state:"queued",onError:U=>{B(U)},onSuccess:U=>{I(U)}}),x()});const p=A=>f._(this,void 0,void 0,function*(){A.state="running";const{requestParameters:z,supportImageRefresh:D,onError:I,onSuccess:B,abortController:U}=A,j=D===!1&&!f.i(self)&&!f.g(z.url)&&(!z.headers||Object.keys(z.headers).reduce((Q,W)=>Q&&W==="accept",!0));s++;const X=j?S(z,U):f.m(z,U);try{const Q=yield X;delete A.abortController,A.state="completed",Q.data instanceof HTMLImageElement||f.b(Q.data)?B(Q):Q.data&&B({data:yield(K=Q.data,typeof createImageBitmap=="function"?f.d(K):f.f(K)),cacheControl:Q.cacheControl,expires:Q.expires})}catch(Q){delete A.abortController,I(Q)}finally{s--,x()}var K}),x=()=>{const A=(()=>{for(const z of Object.keys(u))if(u[z]())return!0;return!1})()?f.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:f.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let z=s;z<A&&t.length>0;z++){const D=t.shift();D.abortController.signal.aborted?z--:p(D)}},S=(A,z)=>new Promise((D,I)=>{const B=new Image,U=A.url,j=A.credentials;j&&j==="include"?B.crossOrigin="use-credentials":(j&&j==="same-origin"||!f.s(U))&&(B.crossOrigin="anonymous"),z.signal.addEventListener("abort",()=>{B.src="",I(f.c())}),B.fetchPriority="high",B.onload=()=>{B.onerror=B.onload=null,D({data:B})},B.onerror=()=>{B.onerror=B.onload=null,z.signal.aborted||I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},B.src=U})}(ut||(ut={})),ut.resetRequestQueue();class bt{constructor(t){this._transformRequestFn=t}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function Ot(m){var t=new f.A(3);return t[0]=m[0],t[1]=m[1],t[2]=m[2],t}var ne,Nt=function(m,t,s){return m[0]=t[0]-s[0],m[1]=t[1]-s[1],m[2]=t[2]-s[2],m};ne=new f.A(3),f.A!=Float32Array&&(ne[0]=0,ne[1]=0,ne[2]=0);var te=function(m){var t=m[0],s=m[1];return t*t+s*s};function Pe(m){const t=[];if(typeof m=="string")t.push({id:"default",url:m});else if(m&&m.length>0){const s=[];for(const{id:c,url:u}of m){const p=`${c}${u}`;s.indexOf(p)===-1&&(s.push(p),t.push({id:c,url:u}))}}return t}function ye(m,t,s){const c=m.split("?");return c[0]+=`${t}${s}`,c.join("?")}(function(){var m=new f.A(2);f.A!=Float32Array&&(m[0]=0,m[1]=0)})();class me{constructor(t,s,c,u){this.context=t,this.format=c,this.texture=t.gl.createTexture(),this.update(s,u)}update(t,s,c){const{width:u,height:p}=t,x=!(this.size&&this.size[0]===u&&this.size[1]===p||c),{context:S}=this,{gl:A}=S;if(this.useMipmap=!!(s&&s.useMipmap),A.bindTexture(A.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!s||s.premultiply!==!1)),x)this.size=[u,p],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||f.b(t)?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,t):A.texImage2D(A.TEXTURE_2D,0,this.format,u,p,0,this.format,A.UNSIGNED_BYTE,t.data);else{const{x:z,y:D}=c||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||f.b(t)?A.texSubImage2D(A.TEXTURE_2D,0,z,D,A.RGBA,A.UNSIGNED_BYTE,t):A.texSubImage2D(A.TEXTURE_2D,0,z,D,u,p,A.RGBA,A.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&A.generateMipmap(A.TEXTURE_2D)}bind(t,s,c){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),c!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=p.LINEAR),t!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,t),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,c||t),this.filter=t),s!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,s),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function An(m){const{userImage:t}=m;return!!(t&&t.render&&t.render())&&(m.data.replace(new Uint8Array(t.data.buffer)),!0)}class Ai extends f.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new f.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:s,promiseResolve:c}of this.requestors)c(this._getImagesForIds(s));this.requestors=[]}}getImage(t){const s=this.images[t];if(s&&!s.data&&s.spriteData){const c=s.spriteData;s.data=new f.R({width:c.width,height:c.height},c.context.getImageData(c.x,c.y,c.width,c.height).data),s.spriteData=null}return s}addImage(t,s){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,s)&&(this.images[t]=s)}_validate(t,s){let c=!0;const u=s.data||s.spriteData;return this._validateStretch(s.stretchX,u&&u.width)||(this.fire(new f.j(new Error(`Image "${t}" has invalid "stretchX" value`))),c=!1),this._validateStretch(s.stretchY,u&&u.height)||(this.fire(new f.j(new Error(`Image "${t}" has invalid "stretchY" value`))),c=!1),this._validateContent(s.content,s)||(this.fire(new f.j(new Error(`Image "${t}" has invalid "content" value`))),c=!1),c}_validateStretch(t,s){if(!t)return!0;let c=0;for(const u of t){if(u[0]<c||u[1]<u[0]||s<u[1])return!1;c=u[1]}return!0}_validateContent(t,s){if(!t)return!0;if(t.length!==4)return!1;const c=s.spriteData,u=c&&c.width||s.data.width,p=c&&c.height||s.data.height;return!(t[0]<0||u<t[0]||t[1]<0||p<t[1]||t[2]<0||u<t[2]||t[3]<0||p<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,s,c=!0){const u=this.getImage(t);if(c&&(u.data.width!==s.data.width||u.data.height!==s.data.height))throw new Error(`size mismatch between old image (${u.data.width}x${u.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=u.version+1,this.images[t]=s,this.updatedImages[t]=!0}removeImage(t){const s=this.images[t];delete this.images[t],delete this.patterns[t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((s,c)=>{let u=!0;if(!this.isLoaded())for(const p of t)this.images[p]||(u=!1);this.isLoaded()||u?s(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:s})})}_getImagesForIds(t){const s={};for(const c of t){let u=this.getImage(c);u||(this.fire(new f.k("styleimagemissing",{id:c})),u=this.getImage(c)),u?s[c]={data:u.data.clone(),pixelRatio:u.pixelRatio,sdf:u.sdf,version:u.version,stretchX:u.stretchX,stretchY:u.stretchY,content:u.content,textFitWidth:u.textFitWidth,textFitHeight:u.textFitHeight,hasRenderCallback:!!(u.userImage&&u.userImage.render)}:f.w(`Image "${c}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return s}getPixelSize(){const{width:t,height:s}=this.atlasImage;return{width:t,height:s}}getPattern(t){const s=this.patterns[t],c=this.getImage(t);if(!c)return null;if(s&&s.position.version===c.version)return s.position;if(s)s.position.version=c.version;else{const u={w:c.data.width+2,h:c.data.height+2,x:0,y:0},p=new f.I(u,c);this.patterns[t]={bin:u,position:p}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const s=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new me(t,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const p in this.patterns)t.push(this.patterns[p].bin);const{w:s,h:c}=f.p(t),u=this.atlasImage;u.resize({width:s||1,height:c||1});for(const p in this.patterns){const{bin:x}=this.patterns[p],S=x.x+1,A=x.y+1,z=this.getImage(p).data,D=z.width,I=z.height;f.R.copy(z,u,{x:0,y:0},{x:S,y:A},{width:D,height:I}),f.R.copy(z,u,{x:0,y:I-1},{x:S,y:A-1},{width:D,height:1}),f.R.copy(z,u,{x:0,y:0},{x:S,y:A+I},{width:D,height:1}),f.R.copy(z,u,{x:D-1,y:0},{x:S-1,y:A},{width:1,height:I}),f.R.copy(z,u,{x:0,y:0},{x:S+D,y:A},{width:1,height:I})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const s of t){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const c=this.getImage(s);c||f.w(`Image with ID: "${s}" was not found`),An(c)&&this.updateImage(s,c)}}}const Bi=1e20;function En(m,t,s,c,u,p,x,S,A){for(let z=t;z<t+c;z++)qt(m,s*p+z,p,u,x,S,A);for(let z=s;z<s+u;z++)qt(m,z*p+t,1,c,x,S,A)}function qt(m,t,s,c,u,p,x){p[0]=0,x[0]=-Bi,x[1]=Bi,u[0]=m[t];for(let S=1,A=0,z=0;S<c;S++){u[S]=m[t+S*s];const D=S*S;do{const I=p[A];z=(u[S]-u[I]+D-I*I)/(S-I)/2}while(z<=x[A]&&--A>-1);A++,p[A]=S,x[A]=z,x[A+1]=Bi}for(let S=0,A=0;S<c;S++){for(;x[A+1]<S;)A++;const z=p[A],D=S-z;m[t+S*s]=u[z]+D*D}}class le{constructor(t,s){this.requestManager=t,this.localIdeographFontFamily=s,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return f._(this,void 0,void 0,function*(){const s=[];for(const p in t)for(const x of t[p])s.push(this._getAndCacheGlyphsPromise(p,x));const c=yield Promise.all(s),u={};for(const{stack:p,id:x,glyph:S}of c)u[p]||(u[p]={}),u[p][x]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics};return u})}_getAndCacheGlyphsPromise(t,s){return f._(this,void 0,void 0,function*(){let c=this.entries[t];c||(c=this.entries[t]={glyphs:{},requests:{},ranges:{}});let u=c.glyphs[s];if(u!==void 0)return{stack:t,id:s,glyph:u};if(u=this._tinySDF(c,t,s),u)return c.glyphs[s]=u,{stack:t,id:s,glyph:u};const p=Math.floor(s/256);if(256*p>65535)throw new Error("glyphs > 65535 not supported");if(c.ranges[p])return{stack:t,id:s,glyph:u};if(!this.url)throw new Error("glyphsUrl is not set");if(!c.requests[p]){const S=le.loadGlyphRange(t,p,this.url,this.requestManager);c.requests[p]=S}const x=yield c.requests[p];for(const S in x)this._doesCharSupportLocalGlyph(+S)||(c.glyphs[+S]=x[+S]);return c.ranges[p]=!0,{stack:t,id:s,glyph:x[s]||null}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(t))}_tinySDF(t,s,c){const u=this.localIdeographFontFamily;if(!u||!this._doesCharSupportLocalGlyph(c))return;let p=t.tinySDF;if(!p){let S="400";/bold/i.test(s)?S="900":/medium/i.test(s)?S="500":/light/i.test(s)&&(S="200"),p=t.tinySDF=new le.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:u,fontWeight:S})}const x=p.draw(String.fromCharCode(c));return{id:c,bitmap:new f.o({width:x.width||60,height:x.height||60},x.data),metrics:{width:x.glyphWidth/2||24,height:x.glyphHeight/2||24,left:x.glyphLeft/2+.5||0,top:x.glyphTop/2-27.5||-8,advance:x.glyphAdvance/2||24,isDoubleResolution:!0}}}}le.loadGlyphRange=function(m,t,s,c){return f._(this,void 0,void 0,function*(){const u=256*t,p=u+255,x=c.transformRequest(s.replace("{fontstack}",m).replace("{range}",`${u}-${p}`),"Glyphs"),S=yield f.l(x,new AbortController);if(!S||!S.data)throw new Error(`Could not load glyph range. range: ${t}, ${u}-${p}`);const A={};for(const z of f.n(S.data))A[z.id]=z;return A})},le.TinySDF=class{constructor({fontSize:m=24,buffer:t=3,radius:s=8,cutoff:c=.25,fontFamily:u="sans-serif",fontWeight:p="normal",fontStyle:x="normal"}={}){this.buffer=t,this.cutoff=c,this.radius=s;const S=this.size=m+4*t,A=this._createCanvas(S),z=this.ctx=A.getContext("2d",{willReadFrequently:!0});z.font=`${x} ${p} ${m}px ${u}`,z.textBaseline="alphabetic",z.textAlign="left",z.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(m){const t=document.createElement("canvas");return t.width=t.height=m,t}draw(m){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:c,actualBoundingBoxLeft:u,actualBoundingBoxRight:p}=this.ctx.measureText(m),x=Math.ceil(s),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-u))),A=Math.min(this.size-this.buffer,x+Math.ceil(c)),z=S+2*this.buffer,D=A+2*this.buffer,I=Math.max(z*D,0),B=new Uint8ClampedArray(I),U={data:B,width:z,height:D,glyphWidth:S,glyphHeight:A,glyphTop:x,glyphLeft:0,glyphAdvance:t};if(S===0||A===0)return U;const{ctx:j,buffer:X,gridInner:K,gridOuter:Q}=this;j.clearRect(X,X,S,A),j.fillText(m,X,X+x);const W=j.getImageData(X,X,S,A);Q.fill(Bi,0,I),K.fill(0,0,I);for(let Z=0;Z<A;Z++)for(let at=0;at<S;at++){const ot=W.data[4*(Z*S+at)+3]/255;if(ot===0)continue;const ft=(Z+X)*z+at+X;if(ot===1)Q[ft]=0,K[ft]=Bi;else{const wt=.5-ot;Q[ft]=wt>0?wt*wt:0,K[ft]=wt<0?wt*wt:0}}En(Q,0,0,z,D,z,this.f,this.v,this.z),En(K,X,X,S,A,z,this.f,this.v,this.z);for(let Z=0;Z<I;Z++){const at=Math.sqrt(Q[Z])-Math.sqrt(K[Z]);B[Z]=Math.round(255-255*(at/this.radius+this.cutoff))}return U}};class fe{constructor(){this.specification=f.v.light.position}possiblyEvaluate(t,s){return f.x(t.expression.evaluate(s))}interpolate(t,s,c){return{x:f.y.number(t.x,s.x,c),y:f.y.number(t.y,s.y,c),z:f.y.number(t.z,s.z,c)}}}let Ue;class Ge extends f.E{constructor(t){super(),Ue=Ue||new f.q({anchor:new f.D(f.v.light.anchor),position:new fe,color:new f.D(f.v.light.color),intensity:new f.D(f.v.light.intensity)}),this._transitionable=new f.T(Ue),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s={}){if(!this._validate(f.r,t,s))for(const c in t){const u=t[c];c.endsWith("-transition")?this._transitionable.setTransition(c.slice(0,-11),u):this._transitionable.setValue(c,u)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,c){return(!c||c.validate!==!1)&&f.t(this,t.call(f.u,{value:s,style:{glyphs:!0,sprite:!0},styleSpec:f.v}))}}const Ei=new f.q({"sky-color":new f.D(f.v.sky["sky-color"]),"horizon-color":new f.D(f.v.sky["horizon-color"]),"fog-color":new f.D(f.v.sky["fog-color"]),"fog-ground-blend":new f.D(f.v.sky["fog-ground-blend"]),"horizon-fog-blend":new f.D(f.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new f.D(f.v.sky["sky-horizon-blend"]),"atmosphere-blend":new f.D(f.v.sky["atmosphere-blend"])});class qi extends f.E{constructor(t){super(),this._transitionable=new f.T(Ei),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new f.z(0))}setSky(t,s={}){if(!this._validate(f.B,t,s)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const c in t){const u=t[c];c.endsWith("-transition")?this._transitionable.setTransition(c.slice(0,-11),u):this._transitionable.setValue(c,u)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,c={}){return(c==null?void 0:c.validate)!==!1&&f.t(this,t.call(f.u,f.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:f.v})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class wa{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,s){const c=t.join(",")+String(s);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(t,s)),this.dashEntry[c]}getDashRanges(t,s,c){const u=[];let p=t.length%2==1?-t[t.length-1]*c:0,x=t[0]*c,S=!0;u.push({left:p,right:x,isDash:S,zeroLength:t[0]===0});let A=t[0];for(let z=1;z<t.length;z++){S=!S;const D=t[z];p=A*c,A+=D,x=A*c,u.push({left:p,right:x,isDash:S,zeroLength:D===0})}return u}addRoundDash(t,s,c){const u=s/2;for(let p=-c;p<=c;p++){const x=this.width*(this.nextRow+c+p);let S=0,A=t[S];for(let z=0;z<this.width;z++){z/A.right>1&&(A=t[++S]);const D=Math.abs(z-A.left),I=Math.abs(z-A.right),B=Math.min(D,I);let U;const j=p/c*(u+1);if(A.isDash){const X=u-Math.abs(j);U=Math.sqrt(B*B+X*X)}else U=u-Math.sqrt(B*B+j*j);this.data[x+z]=Math.max(0,Math.min(255,U+128))}}}addRegularDash(t){for(let S=t.length-1;S>=0;--S){const A=t[S],z=t[S+1];A.zeroLength?t.splice(S,1):z&&z.isDash===A.isDash&&(z.left=A.left,t.splice(S,1))}const s=t[0],c=t[t.length-1];s.isDash===c.isDash&&(s.left=c.left-this.width,c.right=s.right+this.width);const u=this.width*this.nextRow;let p=0,x=t[p];for(let S=0;S<this.width;S++){S/x.right>1&&(x=t[++p]);const A=Math.abs(S-x.left),z=Math.abs(S-x.right),D=Math.min(A,z);this.data[u+S]=Math.max(0,Math.min(255,(x.isDash?D:-D)+128))}}addDash(t,s){const c=s?7:0,u=2*c+1;if(this.nextRow+u>this.height)return f.w("LineAtlas out of space"),null;let p=0;for(let S=0;S<t.length;S++)p+=t[S];if(p!==0){const S=this.width/p,A=this.getDashRanges(t,this.width,S);s?this.addRoundDash(A,S,c):this.addRegularDash(A)}const x={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:p};return this.nextRow+=u,this.dirty=!0,x}bind(t){const s=t.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}const Zi="maplibre_preloaded_worker_pool";class an{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<an.workerCount;)this.workers.push(new Worker(f.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Zi]}numActive(){return Object.keys(this.active).length}}const is=Math.floor(tt.hardwareConcurrency/2);let Mn,Wn;function xr(){return Mn||(Mn=new an),Mn}an.workerCount=f.C(globalThis)?Math.max(Math.min(is,3),1):1;class br{constructor(t,s){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=s;const c=this.workerPool.acquire(s);for(let u=0;u<c.length;u++){const p=new f.F(c[u],s);p.name=`Worker ${u}`,this.actors.push(p)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,s){const c=[];for(const u of this.actors)c.push(u.sendAsync({type:t,data:s}));return Promise.all(c)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(s=>{s.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,s){for(const c of this.actors)c.registerMessageHandler(t,s)}}function fo(){return Wn||(Wn=new br(xr(),f.G),Wn.registerMessageHandler("GR",(m,t,s)=>f.m(t,s))),Wn}function ja(m,t){const s=f.H();return f.J(s,s,[1,1,0]),f.K(s,s,[.5*m.width,.5*m.height,1]),f.L(s,s,m.calculatePosMatrix(t.toUnwrapped()))}function Wa(m,t,s,c,u,p){const x=function(I,B,U){if(I)for(const j of I){const X=B[j];if(X&&X.source===U&&X.type==="fill-extrusion")return!0}else for(const j in B){const X=B[j];if(X.source===U&&X.type==="fill-extrusion")return!0}return!1}(u&&u.layers,t,m.id),S=p.maxPitchScaleFactor(),A=m.tilesIn(c,S,x);A.sort(tr);const z=[];for(const I of A)z.push({wrappedTileID:I.tileID.wrapped().key,queryResults:I.tile.queryRenderedFeatures(t,s,m._state,I.queryGeometry,I.cameraQueryGeometry,I.scale,u,p,S,ja(m.transform,I.tileID))});const D=function(I){const B={},U={};for(const j of I){const X=j.queryResults,K=j.wrappedTileID,Q=U[K]=U[K]||{};for(const W in X){const Z=X[W],at=Q[W]=Q[W]||{},ot=B[W]=B[W]||[];for(const ft of Z)at[ft.featureIndex]||(at[ft.featureIndex]=!0,ot.push(ft))}}return B}(z);for(const I in D)D[I].forEach(B=>{const U=B.feature,j=m.getFeatureState(U.layer["source-layer"],U.id);U.source=U.layer.source,U.layer["source-layer"]&&(U.sourceLayer=U.layer["source-layer"]),U.state=j});return D}function tr(m,t){const s=m.tileID,c=t.tileID;return s.overscaledZ-c.overscaledZ||s.canonical.y-c.canonical.y||s.wrap-c.wrap||s.canonical.x-c.canonical.x}function ns(m,t,s){return f._(this,void 0,void 0,function*(){let c=m;if(m.url?c=(yield f.h(t.transformRequest(m.url,"Source"),s)).data:yield tt.frameAsync(s),!c)return null;const u=f.M(f.e(c,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in c&&c.vector_layers&&(u.vectorLayerIds=c.vector_layers.map(p=>p.id)),u})}class gt{constructor(t,s){t&&(s?this.setSouthWest(t).setNorthEast(s):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof f.N?new f.N(t.lng,t.lat):f.N.convert(t),this}setSouthWest(t){return this._sw=t instanceof f.N?new f.N(t.lng,t.lat):f.N.convert(t),this}extend(t){const s=this._sw,c=this._ne;let u,p;if(t instanceof f.N)u=t,p=t;else{if(!(t instanceof gt))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(gt.convert(t)):this.extend(f.N.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(f.N.convert(t)):this;if(u=t._sw,p=t._ne,!u||!p)return this}return s||c?(s.lng=Math.min(u.lng,s.lng),s.lat=Math.min(u.lat,s.lat),c.lng=Math.max(p.lng,c.lng),c.lat=Math.max(p.lat,c.lat)):(this._sw=new f.N(u.lng,u.lat),this._ne=new f.N(p.lng,p.lat)),this}getCenter(){return new f.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new f.N(this.getWest(),this.getNorth())}getSouthEast(){return new f.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:s,lat:c}=f.N.convert(t);let u=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&u}static convert(t){return t instanceof gt?t:t&&new gt(t)}static fromLngLat(t,s=0){const c=360*s/40075017,u=c/Math.cos(Math.PI/180*t.lat);return new gt(new f.N(t.lng-u,t.lat-c),new f.N(t.lng+u,t.lat+c))}adjustAntiMeridian(){const t=new f.N(this._sw.lng,this._sw.lat),s=new f.N(this._ne.lng,this._ne.lat);return new gt(t,t.lng>s.lng?new f.N(s.lng+360,s.lat):s)}}class wr{constructor(t,s,c){this.bounds=gt.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=c||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),c=Math.floor(f.O(this.bounds.getWest())*s),u=Math.floor(f.Q(this.bounds.getNorth())*s),p=Math.ceil(f.O(this.bounds.getEast())*s),x=Math.ceil(f.Q(this.bounds.getSouth())*s);return t.x>=c&&t.x<p&&t.y>=u&&t.y<x}}class po extends f.E{constructor(t,s,c,u){if(super(),this.id=t,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,f.e(this,f.M(s,["url","scheme","tileSize","promoteId"])),this._options=f.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u)}load(){return f._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new f.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield ns(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(f.e(this,t),t.bounds&&(this.tileBounds=new wr(t.bounds,this.minzoom,this.maxzoom)),this.fire(new f.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new f.j(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return f.e({},this._options)}loadTile(t){return f._(this,void 0,void 0,function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c={request:this.map._requestManager.transformRequest(s,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};c.request.collectResourceTiming=this._collectResourceTiming;let u="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise((p,x)=>{t.reloadPromise={resolve:p,reject:x}})}else t.actor=this.dispatcher.getActor(),u="LT";t.abortController=new AbortController;try{const p=yield t.actor.sendAsync({type:u,data:c},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,p)}catch(p){if(delete t.abortController,t.aborted)return;if(p&&p.status!==404)throw p;this._afterTileLoadWorkerResponse(t,null)}})}_afterTileLoadWorkerResponse(t,s){if(s&&s.resourceTiming&&(t.resourceTiming=s.resourceTiming),s&&this.map._refreshExpiredTiles&&t.setExpiryData(s),t.loadVectorData(s,this.map.painter),t.reloadPromise){const c=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(c.resolve).catch(c.reject)}}abortTile(t){return f._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return f._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ke extends f.E{constructor(t,s,c,u){super(),this.id=t,this.dispatcher=c,this.setEventedParent(u),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=f.e({type:"raster"},s),f.e(this,f.M(s,["url","scheme","tileSize"]))}load(){return f._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new f.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield ns(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,t&&(f.e(this,t),t.bounds&&(this.tileBounds=new wr(t.bounds,this.minzoom,this.maxzoom)),this.fire(new f.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new f.j(t))}})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return f.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return f._(this,void 0,void 0,function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const c=yield ut.getImage(this.map._requestManager.transformRequest(s,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(c&&c.data){this.map._refreshExpiredTiles&&c.cacheControl&&c.expires&&t.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const u=this.map.painter.context,p=u.gl,x=c.data;t.texture=this.map.painter.getTileTexture(x.width),t.texture?t.texture.update(x,{useMipmap:!0}):(t.texture=new me(u,x,p.RGBA,{useMipmap:!0}),t.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(c){if(delete t.abortController,t.aborted)t.state="unloaded";else if(c)throw t.state="errored",c}})}abortTile(t){return f._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return f._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class oi extends ke{constructor(t,s,c,u){super(t,s,c,u),this.type="raster-dem",this.maxzoom=22,this._options=f.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(t){return f._(this,void 0,void 0,function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c=this.map._requestManager.transformRequest(s,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const u=yield ut.getImage(c,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(u&&u.data){const p=u.data;this.map._refreshExpiredTiles&&u.cacheControl&&u.expires&&t.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const x=f.b(p)&&f.U()?p:yield this.readImageNow(p),S={type:this.type,uid:t.uid,source:this.id,rawImageData:x,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const A=yield t.actor.sendAsync({type:"LDT",data:S});t.dem=A,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(u){if(delete t.abortController,t.aborted)t.state="unloaded";else if(u)throw t.state="errored",u}})}readImageNow(t){return f._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&f.V()){const s=t.width+2,c=t.height+2;try{return new f.R({width:s,height:c},yield f.W(t,-1,-1,s,c))}catch{}}return tt.getImageData(t,1)})}_getNeighboringTiles(t){const s=t.canonical,c=Math.pow(2,s.z),u=(s.x-1+c)%c,p=s.x===0?t.wrap-1:t.wrap,x=(s.x+1+c)%c,S=s.x+1===c?t.wrap+1:t.wrap,A={};return A[new f.S(t.overscaledZ,p,s.z,u,s.y).key]={backfilled:!1},A[new f.S(t.overscaledZ,S,s.z,x,s.y).key]={backfilled:!1},s.y>0&&(A[new f.S(t.overscaledZ,p,s.z,u,s.y-1).key]={backfilled:!1},A[new f.S(t.overscaledZ,t.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},A[new f.S(t.overscaledZ,S,s.z,x,s.y-1).key]={backfilled:!1}),s.y+1<c&&(A[new f.S(t.overscaledZ,p,s.z,u,s.y+1).key]={backfilled:!1},A[new f.S(t.overscaledZ,t.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},A[new f.S(t.overscaledZ,S,s.z,x,s.y+1).key]={backfilled:!1}),A}unloadTile(t){return f._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))})}}class mo extends f.E{constructor(t,s,c,u){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=c.getActor(),this.setEventedParent(u),this._data=s.data,this._options=f.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const p=f.X/this.tileSize;s.clusterMaxZoom!==void 0&&this.maxzoom<=s.clusterMaxZoom&&f.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${s.clusterMaxZoom}".`),this.workerOptions=f.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*p,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*p,extent:f.X,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:f.X,radius:(s.clusterRadius||50)*p,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return f._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}getData(){return f._(this,void 0,void 0,function*(){const t=f.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})})}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,s,c){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:s,offset:c}})}_updateWorkerData(t){return f._(this,void 0,void 0,function*(){const s=f.e({type:this.type},this.workerOptions);t?s.dataDiff=t:typeof this._data=="string"?(s.request=this.map._requestManager.transformRequest(tt.resolveURL(this._data),"Source"),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new f.k("dataloading",{dataType:"source"}));try{const c=yield this.actor.sendAsync({type:"LD",data:s});if(this._pendingLoads--,this._removed||c.abandoned)return void this.fire(new f.k("dataabort",{dataType:"source"}));let u=null;c.resourceTiming&&c.resourceTiming[this.id]&&(u=c.resourceTiming[this.id].slice(0));const p={dataType:"source"};this._collectResourceTiming&&u&&u.length>0&&f.e(p,{resourceTiming:u}),this.fire(new f.k("data",Object.assign(Object.assign({},p),{sourceDataType:"metadata"}))),this.fire(new f.k("data",Object.assign(Object.assign({},p),{sourceDataType:"content"})))}catch(c){if(this._pendingLoads--,this._removed)return void this.fire(new f.k("dataabort",{dataType:"source"}));this.fire(new f.j(c))}})}loaded(){return this._pendingLoads===0}loadTile(t){return f._(this,void 0,void 0,function*(){const s=t.actor?"RT":"LT";t.actor=this.actor;const c={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.abortController=new AbortController;const u=yield this.actor.sendAsync({type:s,data:c},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(u,this.map.painter,s==="RT")})}abortTile(t){return f._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return f._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return f.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var er=f.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class qa extends f.E{constructor(t,s,c,u){super(),this.id=t,this.dispatcher=c,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(u),this.options=s}load(t){return f._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new f.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const s=yield ut.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,s&&s.data&&(this.image=s.data,t&&(this.coordinates=t),this._finishLoading())}catch(s){this._request=null,this._loaded=!0,this.fire(new f.j(s))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new f.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const s=t.map(f.Z.fromLngLat);this.tileID=function(u){let p=1/0,x=1/0,S=-1/0,A=-1/0;for(const B of u)p=Math.min(p,B.x),x=Math.min(x,B.y),S=Math.max(S,B.x),A=Math.max(A,B.y);const z=Math.max(S-p,A-x),D=Math.max(0,Math.floor(-Math.log(z)/Math.LN2)),I=Math.pow(2,D);return new f.a1(D,Math.floor((p+S)/2*I),Math.floor((x+A)/2*I))}(s),this.minzoom=this.maxzoom=this.tileID.z;const c=s.map(u=>this.tileID.getTilePoint(u)._round());return this._boundsArray=new f.$,this._boundsArray.emplaceBack(c[0].x,c[0].y,0,0),this._boundsArray.emplaceBack(c[1].x,c[1].y,f.X,0),this._boundsArray.emplaceBack(c[3].x,c[3].y,0,f.X),this._boundsArray.emplaceBack(c[2].x,c[2].y,f.X,f.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new f.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,s=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,er.members)),this.boundsSegments||(this.boundsSegments=f.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new me(t,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let c=!1;for(const u in this.tiles){const p=this.tiles[u];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,c=!0)}c&&this.fire(new f.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return f._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class as extends qa{constructor(t,s,c,u){super(t,s,c,u),this.roundZoom=!0,this.type="video",this.options=s}load(){return f._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const s of t.urls)this.urls.push(this.map._requestManager.transformRequest(s,"Source").url);try{const s=yield f.a3(this.urls);if(this._loaded=!0,!s)return;this.video=s,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(s){this.fire(new f.j(s))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const s=this.video.seekable;t<s.start(0)||t>s.end(0)?this.fire(new f.j(new f.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,s=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,er.members)),this.boundsSegments||(this.boundsSegments=f.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new me(t,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let c=!1;for(const u in this.tiles){const p=this.tiles[u];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,c=!0)}c&&this.fire(new f.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Un extends qa{constructor(t,s,c,u){super(t,s,c,u),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(x=>typeof x!="number"))||this.fire(new f.j(new f.a2(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new f.j(new f.a2(`sources.${t}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new f.j(new f.a2(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new f.j(new f.a2(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new f.j(new f.a2(`sources.${t}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){return f._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new f.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,c=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,er.members)),this.boundsSegments||(this.boundsSegments=f.a0.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new me(s,this.canvas,c.RGBA,{premultiply:!0});let u=!1;for(const p in this.tiles){const x=this.tiles[p];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,u=!0)}u&&this.fire(new f.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const go={},_o=m=>{switch(m){case"geojson":return mo;case"image":return qa;case"raster":return ke;case"raster-dem":return oi;case"vector":return po;case"video":return as;case"canvas":return Un}return go[m]},Mt="RTLPluginLoaded";class Sa extends f.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=fo()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch(s=>{throw this.status="error",s})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return f._(this,arguments,void 0,function*(s,c=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=tt.resolveURL(s),!this.url)throw new Error(`requested url ${s} is invalid`);if(this.status==="unavailable"){if(!c)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return f._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new f.k(Mt))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let rn=null;function Ta(){return rn||(rn=new Sa),rn}class ir{constructor(t,s){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=f.a4(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const s=t+this.timeAdded;s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,s,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(u,p){const x={};if(!p)return x;for(const S of u){const A=S.layerIds.map(z=>p.getLayer(z)).filter(Boolean);if(A.length!==0){S.layers=A,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(z=>A.filter(D=>D.id===z)[0]));for(const z of A)x[z.id]=S}}return x}(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const p=this.buckets[u];if(p instanceof f.a6){if(this.hasSymbolBuckets=!0,!c)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const p=this.buckets[u];if(p instanceof f.a6&&p.hasRTLText){this.hasRTLText=!0,Ta().lazyLoad();break}}this.queryPadding=0;for(const u in this.buckets){const p=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(u).queryRadius(p))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new f.a5}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const c in this.buckets){const u=this.buckets[c];u.uploadPending()&&u.upload(t)}const s=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new me(t,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new me(t,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,s,c,u,p,x,S,A,z,D){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:u,cameraQueryGeometry:p,scale:x,tileSize:this.tileSize,pixelPosMatrix:D,transform:A,params:S,queryPadding:this.queryPadding*z},t,s,c):{}}querySourceFeatures(t,s){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const u=c.loadVTLayers(),p=s&&s.sourceLayer?s.sourceLayer:"",x=u._geojsonTileLayer||u[p];if(!x)return;const S=f.a7(s&&s.filter),{z:A,x:z,y:D}=this.tileID.canonical,I={z:A,x:z,y:D};for(let B=0;B<x.length;B++){const U=x.feature(B);if(S.needGeometry){const K=f.a8(U,!0);if(!S.filter(new f.z(this.tileID.overscaledZ),K,this.tileID.canonical))continue}else if(!S.filter(new f.z(this.tileID.overscaledZ),U))continue;const j=c.getId(U,p),X=new f.a9(U,A,z,D,j);X.tile=I,t.push(X)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const c=f.aa(t.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const c=Date.now();let u=!1;if(this.expirationTime>c)u=!1;else if(s)if(this.expirationTime<s)u=!0;else{const p=this.expirationTime-s;p?this.expirationTime=c+Math.max(p,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const c=this.latestFeatureIndex.loadVTLayers();for(const u in this.buckets){if(!s.style.hasLayer(u))continue;const p=this.buckets[u],x=p.layers[0].sourceLayer||"_geojsonTileLayer",S=c[x],A=t[x];if(!S||!A||Object.keys(A).length===0)continue;p.update(A,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});const z=s&&s.style&&s.style.getLayer(u);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<tt.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=tt.now()+t}setDependencies(t,s){const c={};for(const u of s)c[u]=!0;this.dependencies[t]=c}hasDependency(t,s){for(const c of t){const u=this.dependencies[c];if(u){for(const p of s)if(u[p])return!0}}return!1}}class It{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,c){const u=t.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const p={value:s,timeout:void 0};if(c!==void 0&&(p.timeout=setTimeout(()=>{this.remove(t,p)},c)),this.data[u].push(p),this.order.push(u),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const c=t.wrapped().key,u=s===void 0?0:this.data[c].indexOf(s),p=this.data[c][u];return this.data[c].splice(u,1),p.timeout&&clearTimeout(p.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(p.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const c in this.data)for(const u of this.data[c])t(u.value)||s.push(u);for(const c of s)this.remove(c.value.tileID,c)}}class pe{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,c){const u=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][u]=this.stateChanges[t][u]||{},f.e(this.stateChanges[t][u],c),this.deletedStates[t]===null){this.deletedStates[t]={};for(const p in this.state[t])p!==u&&(this.deletedStates[t][p]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][u]===null){this.deletedStates[t][u]={};for(const p in this.state[t][u])c[p]||(this.deletedStates[t][u][p]=null)}else for(const p in c)this.deletedStates[t]&&this.deletedStates[t][u]&&this.deletedStates[t][u][p]===null&&delete this.deletedStates[t][u][p]}removeFeatureState(t,s,c){if(this.deletedStates[t]===null)return;const u=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},c&&s!==void 0)this.deletedStates[t][u]!==null&&(this.deletedStates[t][u]=this.deletedStates[t][u]||{},this.deletedStates[t][u][c]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][u])for(c in this.deletedStates[t][u]={},this.stateChanges[t][u])this.deletedStates[t][u][c]=null;else this.deletedStates[t][u]=null;else this.deletedStates[t]=null}getState(t,s){const c=String(s),u=f.e({},(this.state[t]||{})[c],(this.stateChanges[t]||{})[c]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const p=this.deletedStates[t][s];if(p===null)return{};for(const x in p)delete u[x]}return u}initializeTileState(t,s){t.setFeatureState(this.state,s)}coalesceChanges(t,s){const c={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const p={};for(const x in this.stateChanges[u])this.state[u][x]||(this.state[u][x]={}),f.e(this.state[u][x],this.stateChanges[u][x]),p[x]=this.state[u][x];c[u]=p}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const p={};if(this.deletedStates[u]===null)for(const x in this.state[u])p[x]={},this.state[u][x]={};else for(const x in this.deletedStates[u]){if(this.deletedStates[u][x]===null)this.state[u][x]={};else for(const S of Object.keys(this.deletedStates[u][x]))delete this.state[u][x][S];p[x]=this.state[u][x]}c[u]=c[u]||{},f.e(c[u],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const u in t)t[u].setFeatureState(c,s)}}class ae extends f.E{constructor(t,s,c){super(),this.id=t,this.dispatcher=c,this.on("data",u=>this._dataHandler(u)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((u,p,x,S)=>{const A=new(_o(p.type))(u,p,x,S);if(A.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${A.id}`);return A})(t,s,c,this),this._tiles={},this._cache=new It(0,u=>this._unloadTile(u)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new pe,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const s=this._tiles[t];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,s,c){return f._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,s,c)}catch(u){t.state="errored",u.status!==404?this._source.fire(new f.j(u,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new f.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const c=this._tiles[s];c.upload(t),c.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(pn).map(t=>t.key)}getRenderableIds(t){const s=[];for(const c in this._tiles)this._isIdRenderable(c,t)&&s.push(this._tiles[c]);return t?s.sort((c,u)=>{const p=c.tileID,x=u.tileID,S=new f.P(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),A=new f.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-x.overscaledZ||A.y-S.y||A.x-S.x}).map(c=>c.tileID.key):s.map(c=>c.tileID).sort(pn).map(c=>c.key)}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,s){return f._(this,void 0,void 0,function*(){const c=this._tiles[t];c&&(c.state!=="loading"&&(c.state=s),yield this._loadTile(c,t,s))})}_tileLoaded(t,s,c){t.timeAdded=tt.now(),c==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new f.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const s=this.getRenderableIds();for(let u=0;u<s.length;u++){const p=s[u];if(t.neighboringTiles&&t.neighboringTiles[p]){const x=this.getTileByID(p);c(t,x),c(x,t)}}function c(u,p){u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0;let x=p.tileID.canonical.x-u.tileID.canonical.x;const S=p.tileID.canonical.y-u.tileID.canonical.y,A=Math.pow(2,u.tileID.canonical.z),z=p.tileID.key;x===0&&S===0||Math.abs(S)>1||(Math.abs(x)>1&&(Math.abs(x+A)===1?x+=A:Math.abs(x-A)===1&&(x-=A)),p.dem&&u.dem&&(u.dem.backfillBorder(p.dem,x,S),u.neighboringTiles&&u.neighboringTiles[z]&&(u.neighboringTiles[z].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,c,u){for(const p in this._tiles){let x=this._tiles[p];if(u[p]||!x.hasData()||x.tileID.overscaledZ<=s||x.tileID.overscaledZ>c)continue;let S=x.tileID;for(;x&&x.tileID.overscaledZ>s+1;){const z=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[z.key],x&&x.hasData()&&(S=z)}let A=S;for(;A.overscaledZ>s;)if(A=A.scaledTo(A.overscaledZ-1),t[A.key]){u[S.key]=S;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const c=this._loadedParentTiles[t.key];return c&&c.tileID.overscaledZ>=s?c:null}for(let c=t.overscaledZ-1;c>=s;c--){const u=t.scaledTo(c),p=this._getLoadedTile(u);if(p)return p}}findLoadedSibling(t){return this._getLoadedTile(t)}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const s=Math.ceil(t.width/this._source.tileSize)+1,c=Math.ceil(t.height/this._source.tileSize)+1,u=Math.floor(s*c*(this._maxTileCacheZoomLevels===null?f.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),p=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(p)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const c={};for(const u in this._tiles){const p=this._tiles[u];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+s),c[p.tileID.key]=p}this._tiles=c;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(u,this._tiles[u])}}_updateCoveredAndRetainedTiles(t,s,c,u,p,x){const S={},A={},z=Object.keys(t),D=tt.now();for(const I of z){const B=t[I],U=this._tiles[I];if(!U||U.fadeEndTime!==0&&U.fadeEndTime<=D)continue;const j=this.findLoadedParent(B,s),X=this.findLoadedSibling(B),K=j||X||null;K&&(this._addTile(K.tileID),S[K.tileID.key]=K.tileID),A[I]=B}this._retainLoadedChildren(A,u,c,t);for(const I in S)t[I]||(this._coveredTiles[I]=!0,t[I]=S[I]);if(x){const I={},B={};for(const U of p)this._tiles[U.key].hasData()?I[U.key]=U:B[U.key]=U;for(const U in B){const j=B[U].children(this._source.maxzoom);this._tiles[j[0].key]&&this._tiles[j[1].key]&&this._tiles[j[2].key]&&this._tiles[j[3].key]&&(I[j[0].key]=t[j[0].key]=j[0],I[j[1].key]=t[j[1].key]=j[1],I[j[2].key]=t[j[2].key]=j[2],I[j[3].key]=t[j[3].key]=j[3],delete B[U])}for(const U in B){const j=B[U],X=this.findLoadedParent(j,this._source.minzoom),K=this.findLoadedSibling(j),Q=X||K||null;if(Q){I[Q.tileID.key]=t[Q.tileID.key]=Q.tileID;for(const W in I)I[W].isChildOf(Q.tileID)&&delete I[W]}}for(const U in this._tiles)I[U]||(this._coveredTiles[U]=!0)}}update(t,s){if(!this._sourceLoaded||this._paused)return;let c;this.transform=t,this.terrain=s,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(D=>new f.S(D.canonical.z,D.wrap,D.canonical.z,D.canonical.x,D.canonical.y)):(c=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(c=c.filter(D=>this._source.hasTile(D)))):c=[];const u=t.coveringZoomLevel(this._source),p=Math.max(u-ae.maxOverzooming,this._source.minzoom),x=Math.max(u+ae.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const D={};for(const I of c)if(I.canonical.z>this._source.minzoom){const B=I.scaledTo(I.canonical.z-1);D[B.key]=B;const U=I.scaledTo(Math.max(this._source.minzoom,Math.min(I.canonical.z,5)));D[U.key]=U}c=c.concat(Object.values(D))}const S=c.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,S&&this.fire(new f.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const A=this._updateRetainedTiles(c,u);ta(this._source.type)&&this._updateCoveredAndRetainedTiles(A,p,x,u,c,s);for(const D in A)this._tiles[D].clearFadeHold();const z=f.ab(this._tiles,A);for(const D of z){const I=this._tiles[D];I.hasSymbolBuckets&&!I.holdingForFade()?I.setHoldDuration(this.map._fadeDuration):I.hasSymbolBuckets&&!I.symbolFadeFinished()||this._removeTile(D)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,s){var c;const u={},p={},x=Math.max(s-ae.maxOverzooming,this._source.minzoom),S=Math.max(s+ae.maxUnderzooming,this._source.minzoom),A={};for(const z of t){const D=this._addTile(z);u[z.key]=z,D.hasData()||s<this._source.maxzoom&&(A[z.key]=z)}this._retainLoadedChildren(A,s,S,u);for(const z of t){let D=this._tiles[z.key];if(D.hasData())continue;if(s+1>this._source.maxzoom){const B=z.children(this._source.maxzoom)[0],U=this.getTile(B);if(U&&U.hasData()){u[B.key]=B;continue}}else{const B=z.children(this._source.maxzoom);if(u[B[0].key]&&u[B[1].key]&&u[B[2].key]&&u[B[3].key])continue}let I=D.wasRequested();for(let B=z.overscaledZ-1;B>=x;--B){const U=z.scaledTo(B);if(p[U.key])break;if(p[U.key]=!0,D=this.getTile(U),!D&&I&&(D=this._addTile(U)),D){const j=D.hasData();if((j||!(!((c=this.map)===null||c===void 0)&&c.cancelPendingTileRequestsWhileZooming)||I)&&(u[U.key]=U),I=D.wasRequested(),j)break}}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let c,u=this._tiles[t].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){c=this._loadedParentTiles[u.key];break}s.push(u.key);const p=u.scaledTo(u.overscaledZ-1);if(c=this._getLoadedTile(p),c)break;u=p}for(const p of s)this._loadedParentTiles[p]=c}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const t in this._tiles){const s=this._tiles[t].tileID,c=this._getLoadedTile(s);this._loadedSiblingTiles[s.key]=c}}_addTile(t){let s=this._tiles[t.key];if(s)return s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const c=s;return s||(s=new ir(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(s,t.key,s.state)),s.uses++,this._tiles[t.key]=s,c||this._source.fire(new f.k("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const c=s.getExpiryTimeout();c&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},c))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}_dataHandler(t){const s=t.sourceDataType;t.dataType==="source"&&s==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&t.dataType==="source"&&s==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,s,c){const u=[],p=this.transform;if(!p)return u;const x=c?p.getCameraQueryGeometry(t):t,S=t.map(j=>p.pointCoordinate(j,this.terrain)),A=x.map(j=>p.pointCoordinate(j,this.terrain)),z=this.getIds();let D=1/0,I=1/0,B=-1/0,U=-1/0;for(const j of A)D=Math.min(D,j.x),I=Math.min(I,j.y),B=Math.max(B,j.x),U=Math.max(U,j.y);for(let j=0;j<z.length;j++){const X=this._tiles[z[j]];if(X.holdingForFade())continue;const K=X.tileID,Q=Math.pow(2,p.zoom-X.tileID.overscaledZ),W=s*X.queryPadding*f.X/X.tileSize/Q,Z=[K.getTilePoint(new f.Z(D,I)),K.getTilePoint(new f.Z(B,U))];if(Z[0].x-W<f.X&&Z[0].y-W<f.X&&Z[1].x+W>=0&&Z[1].y+W>=0){const at=S.map(ft=>K.getTilePoint(ft)),ot=A.map(ft=>K.getTilePoint(ft));u.push({tile:X,tileID:K,queryGeometry:at,cameraQueryGeometry:ot,scale:Q})}}return u}getVisibleCoordinates(t){const s=this.getRenderableIds(t).map(c=>this._tiles[c].tileID);for(const c of s)c.posMatrix=this.transform.calculatePosMatrix(c.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(ta(this._source.type)){const t=tt.now();for(const s in this._tiles)if(this._tiles[s].fadeEndTime>=t)return!0}return!1}setFeatureState(t,s,c){this._state.updateState(t=t||"_geojsonTileLayer",s,c)}removeFeatureState(t,s,c){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,c)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,c){const u=this._tiles[t];u&&u.setDependencies(s,c)}reloadTilesForDependencies(t,s){for(const c in this._tiles)this._tiles[c].hasDependency(t,s)&&this._reloadTile(c,"reloading");this._cache.filter(c=>!c.hasDependency(t,s))}}function pn(m,t){const s=Math.abs(2*m.wrap)-+(m.wrap<0),c=Math.abs(2*t.wrap)-+(t.wrap<0);return m.overscaledZ-t.overscaledZ||c-s||t.canonical.y-m.canonical.y||t.canonical.x-m.canonical.x}function ta(m){return m==="raster"||m==="image"||m==="video"}ae.maxOverzooming=10,ae.maxUnderzooming=3;class ce{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=f.ac(t,0,1);let s=1,c=this._distances[s];const u=t*this.paddedLength+this.padding;for(;c<u&&s<this._distances.length;)c=this._distances[++s];const p=s-1,x=this._distances[p],S=c-x,A=S>0?(u-x)/S:0;return this.points[p].mult(1-A).add(this.points[s].mult(A))}}function Aa(m,t){let s=!0;return m==="always"||m!=="never"&&t!=="never"||(s=!1),s}class Za{constructor(t,s,c){const u=this.boxCells=[],p=this.circleCells=[];this.xCellCount=Math.ceil(t/c),this.yCellCount=Math.ceil(s/c);for(let x=0;x<this.xCellCount*this.yCellCount;x++)u.push([]),p.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,c,u,p){this._forEachCell(s,c,u,p,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(u),this.bboxes.push(p)}insertCircle(t,s,c,u){this._forEachCell(s-u,c-u,s+u,c+u,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(c),this.circles.push(u)}_insertBoxCell(t,s,c,u,p,x){this.boxCells[p].push(x)}_insertCircleCell(t,s,c,u,p,x){this.circleCells[p].push(x)}_query(t,s,c,u,p,x,S){if(c<0||t>this.width||u<0||s>this.height)return[];const A=[];if(t<=0&&s<=0&&this.width<=c&&this.height<=u){if(p)return[{key:null,x1:t,y1:s,x2:c,y2:u}];for(let z=0;z<this.boxKeys.length;z++)A.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const D=this.circles[3*z],I=this.circles[3*z+1],B=this.circles[3*z+2];A.push({key:this.circleKeys[z],x1:D-B,y1:I-B,x2:D+B,y2:I+B})}}else this._forEachCell(t,s,c,u,this._queryCell,A,{hitTest:p,overlapMode:x,seenUids:{box:{},circle:{}}},S);return A}query(t,s,c,u){return this._query(t,s,c,u,!1,null)}hitTest(t,s,c,u,p,x){return this._query(t,s,c,u,!0,p,x).length>0}hitTestCircle(t,s,c,u,p){const x=t-c,S=t+c,A=s-c,z=s+c;if(S<0||x>this.width||z<0||A>this.height)return!1;const D=[];return this._forEachCell(x,A,S,z,this._queryCellCircle,D,{hitTest:!0,overlapMode:u,circle:{x:t,y:s,radius:c},seenUids:{box:{},circle:{}}},p),D.length>0}_queryCell(t,s,c,u,p,x,S,A){const{seenUids:z,hitTest:D,overlapMode:I}=S,B=this.boxCells[p];if(B!==null){const j=this.bboxes;for(const X of B)if(!z.box[X]){z.box[X]=!0;const K=4*X,Q=this.boxKeys[X];if(t<=j[K+2]&&s<=j[K+3]&&c>=j[K+0]&&u>=j[K+1]&&(!A||A(Q))&&(!D||!Aa(I,Q.overlapMode))&&(x.push({key:Q,x1:j[K],y1:j[K+1],x2:j[K+2],y2:j[K+3]}),D))return!0}}const U=this.circleCells[p];if(U!==null){const j=this.circles;for(const X of U)if(!z.circle[X]){z.circle[X]=!0;const K=3*X,Q=this.circleKeys[X];if(this._circleAndRectCollide(j[K],j[K+1],j[K+2],t,s,c,u)&&(!A||A(Q))&&(!D||!Aa(I,Q.overlapMode))){const W=j[K],Z=j[K+1],at=j[K+2];if(x.push({key:Q,x1:W-at,y1:Z-at,x2:W+at,y2:Z+at}),D)return!0}}}return!1}_queryCellCircle(t,s,c,u,p,x,S,A){const{circle:z,seenUids:D,overlapMode:I}=S,B=this.boxCells[p];if(B!==null){const j=this.bboxes;for(const X of B)if(!D.box[X]){D.box[X]=!0;const K=4*X,Q=this.boxKeys[X];if(this._circleAndRectCollide(z.x,z.y,z.radius,j[K+0],j[K+1],j[K+2],j[K+3])&&(!A||A(Q))&&!Aa(I,Q.overlapMode))return x.push(!0),!0}}const U=this.circleCells[p];if(U!==null){const j=this.circles;for(const X of U)if(!D.circle[X]){D.circle[X]=!0;const K=3*X,Q=this.circleKeys[X];if(this._circlesCollide(j[K],j[K+1],j[K+2],z.x,z.y,z.radius)&&(!A||A(Q))&&!Aa(I,Q.overlapMode))return x.push(!0),!0}}}_forEachCell(t,s,c,u,p,x,S,A){const z=this._convertToXCellCoord(t),D=this._convertToYCellCoord(s),I=this._convertToXCellCoord(c),B=this._convertToYCellCoord(u);for(let U=z;U<=I;U++)for(let j=D;j<=B;j++)if(p.call(this,t,s,c,u,this.xCellCount*j+U,x,S,A))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,c,u,p,x){const S=u-t,A=p-s,z=c+x;return z*z>S*S+A*A}_circleAndRectCollide(t,s,c,u,p,x,S){const A=(x-u)/2,z=Math.abs(t-(u+A));if(z>A+c)return!1;const D=(S-p)/2,I=Math.abs(s-(p+D));if(I>D+c)return!1;if(z<=A||I<=D)return!0;const B=z-A,U=I-D;return B*B+U*U<=c*c}}function nr(m,t,s,c,u){const p=f.H();return t?(f.K(p,p,[1/u,1/u,1]),s||f.ad(p,p,c.angle)):f.L(p,c.labelPlaneMatrix,m),p}function Ea(m,t,s,c,u){if(t){const p=f.ae(m);return f.K(p,p,[u,u,1]),s||f.ad(p,p,-c.angle),p}return c.glCoordMatrix}function $(m,t,s,c){let u;c?(u=[m,t,c(m,t),1],f.af(u,u,s)):(u=[m,t,0,1],Ee(u,u,s));const p=u[3];return{point:new f.P(u[0]/p,u[1]/p),signedDistanceFromCamera:p,isOccluded:!1}}function P(m,t){return .5+m/t*.5}function R(m,t){return m.x>=-t[0]&&m.x<=t[0]&&m.y>=-t[1]&&m.y<=t[1]}function N(m,t,s,c,u,p,x,S,A,z,D,I,B,U,j){const X=c?m.textSizeData:m.iconSizeData,K=f.ag(X,s.transform.zoom),Q=[256/s.width*2+1,256/s.height*2+1],W=c?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;W.clear();const Z=m.lineVertexArray,at=c?m.text.placedSymbolArray:m.icon.placedSymbolArray,ot=s.transform.width/s.transform.height;let ft=!1;for(let wt=0;wt<at.length;wt++){const Et=at.get(wt);if(Et.hidden||Et.writingMode===f.ah.vertical&&!ft){Wt(Et.numGlyphs,W);continue}ft=!1;const Pt=$(Et.anchorX,Et.anchorY,t,j);if(!R(Pt.point,Q)){Wt(Et.numGlyphs,W);continue}const Ut=P(s.transform.cameraToCenterDistance,Pt.signedDistanceFromCamera),Dt=f.ai(X,K,Et),Ct=x?Dt/Ut:Dt*Ut,Ht={getElevation:j,labelPlaneMatrix:u,lineVertexArray:Z,pitchWithMap:x,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:z,tileAnchorPoint:new f.P(Et.anchorX,Et.anchorY),unwrappedTileID:D,width:I,height:B,translation:U},oe=rt(Ht,Et,Ct,!1,S,t,p,m.glyphOffsetArray,W,ot,A);ft=oe.useVertical,(oe.notEnoughRoom||ft||oe.needsFlipping&&rt(Ht,Et,Ct,!0,S,t,p,m.glyphOffsetArray,W,ot,A).notEnoughRoom)&&Wt(Et.numGlyphs,W)}c?m.text.dynamicLayoutVertexBuffer.updateData(W):m.icon.dynamicLayoutVertexBuffer.updateData(W)}function H(m,t,s,c,u,p,x,S){const A=p.glyphStartIndex+p.numGlyphs,z=p.lineStartIndex,D=p.lineStartIndex+p.lineLength,I=t.getoffsetX(p.glyphStartIndex),B=t.getoffsetX(A-1),U=zt(m*I,s,c,u,p.segment,z,D,S,x);if(!U)return null;const j=zt(m*B,s,c,u,p.segment,z,D,S,x);return j?S.projectionCache.anyProjectionOccluded?null:{first:U,last:j}:null}function it(m,t,s,c){return m===f.ah.horizontal&&Math.abs(s.y-t.y)>Math.abs(s.x-t.x)*c?{useVertical:!0}:(m===f.ah.vertical?t.y<s.y:t.x>s.x)?{needsFlipping:!0}:null}function rt(m,t,s,c,u,p,x,S,A,z,D){const I=s/24,B=t.lineOffsetX*I,U=t.lineOffsetY*I;let j;if(t.numGlyphs>1){const X=t.glyphStartIndex+t.numGlyphs,K=t.lineStartIndex,Q=t.lineStartIndex+t.lineLength,W=H(I,S,B,U,c,t,D,m);if(!W)return{notEnoughRoom:!0};const Z=$(W.first.point.x,W.first.point.y,x,m.getElevation).point,at=$(W.last.point.x,W.last.point.y,x,m.getElevation).point;if(u&&!c){const ot=it(t.writingMode,Z,at,z);if(ot)return ot}j=[W.first];for(let ot=t.glyphStartIndex+1;ot<X-1;ot++)j.push(zt(I*S.getoffsetX(ot),B,U,c,t.segment,K,Q,m,D));j.push(W.last)}else{if(u&&!c){const K=$(m.tileAnchorPoint.x,m.tileAnchorPoint.y,p,m.getElevation).point,Q=t.lineStartIndex+t.segment+1,W=new f.P(m.lineVertexArray.getx(Q),m.lineVertexArray.gety(Q)),Z=$(W.x,W.y,p,m.getElevation),at=Z.signedDistanceFromCamera>0?Z.point:function(ft,wt,Et,Pt,Ut,Dt){return ht(ft,wt,Et,1,Ut,Dt)}(m.tileAnchorPoint,W,K,0,p,m),ot=it(t.writingMode,K,at,z);if(ot)return ot}const X=zt(I*S.getoffsetX(t.glyphStartIndex),B,U,c,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,m,D);if(!X||m.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};j=[X]}for(const X of j)f.aj(A,X.point,X.angle);return{}}function ht(m,t,s,c,u,p){const x=m.add(m.sub(t)._unit()),S=u!==void 0?$(x.x,x.y,u,p.getElevation).point:yt(x.x,x.y,p).point,A=s.sub(S);return s.add(A._mult(c/A.mag()))}function J(m,t,s){const c=t.projectionCache;if(c.projections[m])return c.projections[m];const u=new f.P(t.lineVertexArray.getx(m),t.lineVertexArray.gety(m)),p=yt(u.x,u.y,t);if(p.signedDistanceFromCamera>0)return c.projections[m]=p.point,c.anyProjectionOccluded=c.anyProjectionOccluded||p.isOccluded,p.point;const x=m-s.direction;return function(S,A,z,D,I){return ht(S,A,z,D,void 0,I)}(s.distanceFromAnchor===0?t.tileAnchorPoint:new f.P(t.lineVertexArray.getx(x),t.lineVertexArray.gety(x)),u,s.previousVertex,s.absOffsetX-s.distanceFromAnchor+1,t)}function yt(m,t,s){const c=m+s.translation[0],u=t+s.translation[1];let p;return!s.pitchWithMap&&s.projection.useSpecialProjectionForSymbols?(p=s.projection.projectTileCoordinates(c,u,s.unwrappedTileID,s.getElevation),p.point.x=(.5*p.point.x+.5)*s.width,p.point.y=(.5*-p.point.y+.5)*s.height):(p=$(c,u,s.labelPlaneMatrix,s.getElevation),p.isOccluded=!1),p}function St(m,t,s){return m._unit()._perp()._mult(t*s)}function mt(m,t,s,c,u,p,x,S,A){if(S.projectionCache.offsets[m])return S.projectionCache.offsets[m];const z=s.add(t);if(m+A.direction<c||m+A.direction>=u)return S.projectionCache.offsets[m]=z,z;const D=J(m+A.direction,S,A),I=St(D.sub(s),x,A.direction),B=s.add(I),U=D.add(I);return S.projectionCache.offsets[m]=f.ak(p,z,B,U)||z,S.projectionCache.offsets[m]}function zt(m,t,s,c,u,p,x,S,A){const z=c?m-t:m+t;let D=z>0?1:-1,I=0;c&&(D*=-1,I=Math.PI),D<0&&(I+=Math.PI);let B,U=D>0?p+u:p+u+1;S.projectionCache.cachedAnchorPoint?B=S.projectionCache.cachedAnchorPoint:(B=yt(S.tileAnchorPoint.x,S.tileAnchorPoint.y,S).point,S.projectionCache.cachedAnchorPoint=B);let j,X,K=B,Q=B,W=0,Z=0;const at=Math.abs(z),ot=[];let ft;for(;W+Z<=at;){if(U+=D,U<p||U>=x)return null;W+=Z,Q=K,X=j;const Pt={absOffsetX:at,direction:D,distanceFromAnchor:W,previousVertex:Q};if(K=J(U,S,Pt),s===0)ot.push(Q),ft=K.sub(Q);else{let Ut;const Dt=K.sub(Q);Ut=Dt.mag()===0?St(J(U+D,S,Pt).sub(K),s,D):St(Dt,s,D),X||(X=Q.add(Ut)),j=mt(U,Ut,K,p,x,X,s,S,Pt),ot.push(X),ft=j.sub(X)}Z=ft.mag()}const wt=ft._mult((at-W)/Z)._add(X||Q),Et=I+Math.atan2(K.y-Q.y,K.x-Q.x);return ot.push(wt),{point:wt,angle:A?Et:0,path:ot}}const Qt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Wt(m,t){for(let s=0;s<m;s++){const c=t.length;t.resize(c+4),t.float32.set(Qt,3*c)}}function Ee(m,t,s){const c=t[0],u=t[1];return m[0]=s[0]*c+s[4]*u+s[12],m[1]=s[1]*c+s[5]*u+s[13],m[3]=s[3]*c+s[7]*u+s[15],m}const ue=100;class Me{constructor(t,s,c=new Za(t.width+200,t.height+200,25),u=new Za(t.width+200,t.height+200,25)){this.transform=t,this.mapProjection=s,this.grid=c,this.ignoredGrid=u,this.pitchFactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+ue,this.screenBottomBoundary=t.height+ue,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,s,c,u,p,x,S,A,z,D,I){const B=t.anchorPointX+A[0],U=t.anchorPointY+A[1],j=this.projectAndGetPerspectiveRatio(u,B,U,p,D),X=c*j.perspectiveRatio;let K;if(x||S)K=this._projectCollisionBox(t,X,u,p,x,S,A,j,D,I);else{const ot=j.point.x+(I?I.x*X:0),ft=j.point.y+(I?I.y*X:0);K={allPointsOccluded:!1,box:[ot+t.x1*X,ft+t.y1*X,ot+t.x2*X,ft+t.y2*X]}}const[Q,W,Z,at]=K.box;return this.mapProjection.useSpecialProjectionForSymbols&&(x?K.allPointsOccluded:this.mapProjection.isOccluded(B,U,p))||j.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(Q,W,Z,at)||s!=="always"&&this.grid.hitTest(Q,W,Z,at,s,z)?{box:[Q,W,Z,at],placeable:!1,offscreen:!1}:{box:[Q,W,Z,at],placeable:!0,offscreen:this.isOffscreen(Q,W,Z,at)}}placeCollisionCircles(t,s,c,u,p,x,S,A,z,D,I,B,U,j,X,K){const Q=[],W=new f.P(s.anchorX,s.anchorY),Z=this.getPerspectiveRatio(x,W.x,W.y,S,K),at=(I?p/Z:p*Z)/f.ap,ot={getElevation:K,labelPlaneMatrix:A,lineVertexArray:c,pitchWithMap:I,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:W,unwrappedTileID:S,width:this.transform.width,height:this.transform.height,translation:X},ft=H(at,u,s.lineOffsetX*at,s.lineOffsetY*at,!1,s,!1,ot);let wt=!1,Et=!1,Pt=!0;if(ft){const Ut=.5*U*Z+j,Dt=new f.P(-100,-100),Ct=new f.P(this.screenRightBoundary,this.screenBottomBoundary),Ht=new ce,oe=ft.first,kt=ft.last;let Bt=[];for(let de=oe.path.length-1;de>=1;de--)Bt.push(oe.path[de]);for(let de=1;de<kt.path.length;de++)Bt.push(kt.path[de]);const re=2.5*Ut;if(z){const de=this.projectPathToScreenSpace(Bt,ot,z);Bt=de.some(be=>be.signedDistanceFromCamera<=0)?[]:de.map(be=>be.point)}let Je=[];if(Bt.length>0){const de=Bt[0].clone(),be=Bt[0].clone();for(let We=1;We<Bt.length;We++)de.x=Math.min(de.x,Bt[We].x),de.y=Math.min(de.y,Bt[We].y),be.x=Math.max(be.x,Bt[We].x),be.y=Math.max(be.y,Bt[We].y);Je=de.x>=Dt.x&&be.x<=Ct.x&&de.y>=Dt.y&&be.y<=Ct.y?[Bt]:be.x<Dt.x||de.x>Ct.x||be.y<Dt.y||de.y>Ct.y?[]:f.al([Bt],Dt.x,Dt.y,Ct.x,Ct.y)}for(const de of Je){Ht.reset(de,.25*Ut);let be=0;be=Ht.length<=.5*Ut?1:Math.ceil(Ht.paddedLength/re)+1;for(let We=0;We<be;We++){const Hi=We/Math.max(be-1,1),sa=Ht.lerp(Hi),ti=sa.x+ue,_n=sa.y+ue;Q.push(ti,_n,Ut,0);const on=ti-Ut,Xi=_n-Ut,ln=ti+Ut,Da=_n+Ut;if(Pt=Pt&&this.isOffscreen(on,Xi,ln,Da),Et=Et||this.isInsideGrid(on,Xi,ln,Da),t!=="always"&&this.grid.hitTestCircle(ti,_n,Ut,t,B)&&(wt=!0,!D))return{circles:[],offscreen:!1,collisionDetected:wt}}}}return{circles:!D&&wt||!Et||Z<this.perspectiveRatioCutoff?[]:Q,offscreen:Pt,collisionDetected:wt}}projectPathToScreenSpace(t,s,c){return t.map(u=>$(u.x,u.y,c,s.getElevation))}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let c=1/0,u=1/0,p=-1/0,x=-1/0;for(const D of t){const I=new f.P(D.x+ue,D.y+ue);c=Math.min(c,I.x),u=Math.min(u,I.y),p=Math.max(p,I.x),x=Math.max(x,I.y),s.push(I)}const S=this.grid.query(c,u,p,x).concat(this.ignoredGrid.query(c,u,p,x)),A={},z={};for(const D of S){const I=D.key;if(A[I.bucketInstanceId]===void 0&&(A[I.bucketInstanceId]={}),A[I.bucketInstanceId][I.featureIndex])continue;const B=[new f.P(D.x1,D.y1),new f.P(D.x2,D.y1),new f.P(D.x2,D.y2),new f.P(D.x1,D.y2)];f.am(s,B)&&(A[I.bucketInstanceId][I.featureIndex]=!0,z[I.bucketInstanceId]===void 0&&(z[I.bucketInstanceId]=[]),z[I.bucketInstanceId].push(I.featureIndex))}return z}insertCollisionBox(t,s,c,u,p,x){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:p,collisionGroupID:x,overlapMode:s},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,c,u,p,x){const S=c?this.ignoredGrid:this.grid,A={bucketInstanceId:u,featureIndex:p,collisionGroupID:x,overlapMode:s};for(let z=0;z<t.length;z+=4)S.insertCircle(A,t[z],t[z+1],t[z+2])}projectAndGetPerspectiveRatio(t,s,c,u,p){let x;p?(x=[s,c,p(s,c),1],f.af(x,x,t)):(x=[s,c,0,1],Ee(x,x,t));const S=x[3];return{point:new f.P((x[0]/S+1)/2*this.transform.width+ue,(-x[1]/S+1)/2*this.transform.height+ue),perspectiveRatio:.5+this.transform.cameraToCenterDistance/S*.5,isOccluded:!1,signedDistanceFromCamera:S}}getPerspectiveRatio(t,s,c,u,p){const x=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(s,c,u,p):$(s,c,t,p);return .5+this.transform.cameraToCenterDistance/x.signedDistanceFromCamera*.5}isOffscreen(t,s,c,u){return c<ue||t>=this.screenRightBoundary||u<ue||s>this.screenBottomBoundary}isInsideGrid(t,s,c,u){return c>=0&&t<this.gridRightBoundary&&u>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=f.an([]);return f.J(t,t,[-100,-100,0]),t}_projectCollisionBox(t,s,c,u,p,x,S,A,z,D){let I=new f.P(1,0),B=new f.P(0,1);const U=new f.P(t.anchorPointX+S[0],t.anchorPointY+S[1]);if(x&&!p){const Pt=this.projectAndGetPerspectiveRatio(c,U.x+1,U.y,u,z).point.sub(A.point).unit(),Ut=Math.atan(Pt.y/Pt.x)+(Pt.x<0?Math.PI:0),Dt=Math.sin(Ut),Ct=Math.cos(Ut);I=new f.P(Ct,Dt),B=new f.P(-Dt,Ct)}else if(!x&&p){const Pt=-this.transform.angle,Ut=Math.sin(Pt),Dt=Math.cos(Pt);I=new f.P(Dt,Ut),B=new f.P(-Ut,Dt)}let j=A.point,X=s;if(p){j=U;const Pt=this.transform.zoom-Math.floor(this.transform.zoom);X=Math.pow(2,-Pt),X*=this.mapProjection.getPitchedTextCorrection(this.transform,U,u),D||(X*=f.ac(.5+A.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}D&&(j=j.add(I.mult(D.x*X)).add(B.mult(D.y*X)));const K=t.x1*X,Q=t.x2*X,W=(K+Q)/2,Z=t.y1*X,at=t.y2*X,ot=(Z+at)/2,ft=[{offsetX:K,offsetY:Z},{offsetX:W,offsetY:Z},{offsetX:Q,offsetY:Z},{offsetX:Q,offsetY:ot},{offsetX:Q,offsetY:at},{offsetX:W,offsetY:at},{offsetX:K,offsetY:at},{offsetX:K,offsetY:ot}];let wt=[];for(const{offsetX:Pt,offsetY:Ut}of ft)wt.push(new f.P(j.x+I.x*Pt+B.x*Ut,j.y+I.y*Pt+B.y*Ut));let Et=!1;if(p){const Pt=wt.map(Ut=>this.projectAndGetPerspectiveRatio(c,Ut.x,Ut.y,u,z));Et=Pt.some(Ut=>!Ut.isOccluded),wt=Pt.map(Ut=>Ut.point)}else Et=!0;return{box:f.ao(wt),allPointsOccluded:!Et}}}function xe(m,t,s){return t*(f.X/(m.tileSize*Math.pow(2,s-m.tileID.overscaledZ)))}class xi{constructor(t,s,c,u){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):u&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class li{constructor(t,s,c,u,p){this.text=new xi(t?t.text:null,s,c,p),this.icon=new xi(t?t.icon:null,s,u,p)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ge{constructor(t,s,c){this.text=t,this.icon=s,this.skipFade=c}}class Oe{constructor(){this.invProjMatrix=f.H(),this.viewportMatrix=f.H(),this.circles=[]}}class ai{constructor(t,s,c,u,p){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=c,this.bucketIndex=u,this.tileID=p}}class Di{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:c=>c.collisionGroupID===s}}return this.collisionGroups[t]}}function Oi(m,t,s,c,u){const{horizontalAlign:p,verticalAlign:x}=f.au(m);return new f.P(-(p-.5)*t+c[0]*u,-(x-.5)*s+c[1]*u)}class sn{constructor(t,s,c,u,p,x){this.transform=t.clone(),this.terrain=c,this.collisionIndex=new Me(this.transform,s),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Di(p),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const s=this.terrain;return s?(c,u)=>s.getElevation(t,c,u):null}getBucketParts(t,s,c,u){const p=c.getBucket(s),x=c.latestFeatureIndex;if(!p||!x||s.id!==p.layerIds[0])return;const S=c.collisionBoxArray,A=p.layers[0].layout,z=p.layers[0].paint,D=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),I=c.tileSize/f.X,B=c.tileID.toUnwrapped(),U=this.transform.calculatePosMatrix(B),j=A.get("text-pitch-alignment")==="map",X=A.get("text-rotation-alignment")==="map",K=xe(c,1,this.transform.zoom),Q=this.collisionIndex.mapProjection.translatePosition(this.transform,c,z.get("text-translate"),z.get("text-translate-anchor")),W=this.collisionIndex.mapProjection.translatePosition(this.transform,c,z.get("icon-translate"),z.get("icon-translate-anchor")),Z=nr(U,j,X,this.transform,K);let at=null;if(j){const ft=Ea(U,j,X,this.transform,K);at=f.L([],this.transform.labelPlaneMatrix,ft)}this.retainedQueryData[p.bucketInstanceId]=new ai(p.bucketInstanceId,x,p.sourceLayerIndex,p.index,c.tileID);const ot={bucket:p,layout:A,translationText:Q,translationIcon:W,posMatrix:U,unwrappedTileID:B,textLabelPlaneMatrix:Z,labelToScreenMatrix:at,scale:D,textPixelRatio:I,holdingForFade:c.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:f.ag(p.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(p.sourceID)};if(u)for(const ft of p.sortKeyRanges){const{sortKey:wt,symbolInstanceStart:Et,symbolInstanceEnd:Pt}=ft;t.push({sortKey:wt,symbolInstanceStart:Et,symbolInstanceEnd:Pt,parameters:ot})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:p.symbolInstances.length,parameters:ot})}attemptAnchorPlacement(t,s,c,u,p,x,S,A,z,D,I,B,U,j,X,K,Q,W,Z){const at=f.aq[t.textAnchor],ot=[t.textOffset0,t.textOffset1],ft=Oi(at,c,u,ot,p),wt=this.collisionIndex.placeCollisionBox(s,B,A,z,D,S,x,K,I.predicate,Z,ft);if((!W||this.collisionIndex.placeCollisionBox(W,B,A,z,D,S,x,Q,I.predicate,Z,ft).placeable)&&wt.placeable){let Et;if(this.prevPlacement&&this.prevPlacement.variableOffsets[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID].text&&(Et=this.prevPlacement.variableOffsets[U.crossTileID].anchor),U.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[U.crossTileID]={textOffset:ot,width:c,height:u,anchor:at,textBoxScale:p,prevAnchor:Et},this.markUsedJustification(j,at,U,X),j.allowVerticalPlacement&&(this.markUsedOrientation(j,X,U),this.placedOrientations[U.crossTileID]=X),{shift:ft,placedGlyphBoxes:wt}}}placeLayerBucketPart(t,s,c){const{bucket:u,layout:p,translationText:x,translationIcon:S,posMatrix:A,unwrappedTileID:z,textLabelPlaneMatrix:D,labelToScreenMatrix:I,textPixelRatio:B,holdingForFade:U,collisionBoxArray:j,partiallyEvaluatedTextSize:X,collisionGroup:K}=t.parameters,Q=p.get("text-optional"),W=p.get("icon-optional"),Z=f.ar(p,"text-overlap","text-allow-overlap"),at=Z==="always",ot=f.ar(p,"icon-overlap","icon-allow-overlap"),ft=ot==="always",wt=p.get("text-rotation-alignment")==="map",Et=p.get("text-pitch-alignment")==="map",Pt=p.get("icon-text-fit")!=="none",Ut=p.get("symbol-z-order")==="viewport-y",Dt=at&&(ft||!u.hasIconData()||W),Ct=ft&&(at||!u.hasTextData()||Q);!u.collisionArrays&&j&&u.deserializeCollisionBoxes(j);const Ht=this._getTerrainElevationFunc(this.retainedQueryData[u.bucketInstanceId].tileID),oe=(kt,Bt,re)=>{var Je,de;if(s[kt.crossTileID])return;if(U)return void(this.placements[kt.crossTileID]=new ge(!1,!1,!1));let be=!1,We=!1,Hi=!0,sa=null,ti={box:null,placeable:!1,offscreen:null},_n={box:null,placeable:!1,offscreen:null},on=null,Xi=null,ln=null,Da=0,Ms=0,Nl=0;Bt.textFeatureIndex?Da=Bt.textFeatureIndex:kt.useRuntimeCollisionCircles&&(Da=kt.featureIndex),Bt.verticalTextFeatureIndex&&(Ms=Bt.verticalTextFeatureIndex);const zs=Bt.textBox;if(zs){const Gn=Fi=>{let $i=f.ah.horizontal;if(u.allowVerticalPlacement&&!Fi&&this.prevPlacement){const Rn=this.prevPlacement.placedOrientations[kt.crossTileID];Rn&&(this.placedOrientations[kt.crossTileID]=Rn,$i=Rn,this.markUsedOrientation(u,$i,kt))}return $i},Hn=(Fi,$i)=>{if(u.allowVerticalPlacement&&kt.numVerticalGlyphVertices>0&&Bt.verticalTextBox){for(const Rn of u.writingModes)if(Rn===f.ah.vertical?(ti=$i(),_n=ti):ti=Fi(),ti&&ti.placeable)break}else ti=Fi()},sr=kt.textAnchorOffsetStartIndex,oa=kt.textAnchorOffsetEndIndex;if(oa===sr){const Fi=($i,Rn)=>{const Se=this.collisionIndex.placeCollisionBox($i,Z,B,A,z,Et,wt,x,K.predicate,Ht);return Se&&Se.placeable&&(this.markUsedOrientation(u,Rn,kt),this.placedOrientations[kt.crossTileID]=Rn),Se};Hn(()=>Fi(zs,f.ah.horizontal),()=>{const $i=Bt.verticalTextBox;return u.allowVerticalPlacement&&kt.numVerticalGlyphVertices>0&&$i?Fi($i,f.ah.vertical):{box:null,offscreen:null}}),Gn(ti&&ti.placeable)}else{let Fi=f.aq[(de=(Je=this.prevPlacement)===null||Je===void 0?void 0:Je.variableOffsets[kt.crossTileID])===null||de===void 0?void 0:de.anchor];const $i=(Se,Lr,Cs)=>{const Ds=Se.x2-Se.x1,Od=Se.y2-Se.y1,im=kt.textBoxScale,Fd=Pt&&ot==="never"?Lr:null;let or=null,Ud=Z==="never"?1:2,jl="never";Fi&&Ud++;for(let Bo=0;Bo<Ud;Bo++){for(let ql=sr;ql<oa;ql++){const Zl=u.textAnchorOffsets.get(ql);if(Fi&&Zl.textAnchor!==Fi)continue;const Is=this.attemptAnchorPlacement(Zl,Se,Ds,Od,im,wt,Et,B,A,z,K,jl,kt,u,Cs,x,S,Fd,Ht);if(Is&&(or=Is.placedGlyphBoxes,or&&or.placeable))return be=!0,sa=Is.shift,or}Fi?Fi=null:jl=Z}return c&&!or&&(or={box:this.collisionIndex.placeCollisionBox(zs,"always",B,A,z,Et,wt,x,K.predicate,Ht,new f.P(0,0)).box,offscreen:!1,placeable:!1}),or};Hn(()=>$i(zs,Bt.iconBox,f.ah.horizontal),()=>{const Se=Bt.verticalTextBox;return u.allowVerticalPlacement&&(!ti||!ti.placeable)&&kt.numVerticalGlyphVertices>0&&Se?$i(Se,Bt.verticalIconBox,f.ah.vertical):{box:null,occluded:!0,offscreen:null}}),ti&&(be=ti.placeable,Hi=ti.offscreen);const Rn=Gn(ti&&ti.placeable);if(!be&&this.prevPlacement){const Se=this.prevPlacement.variableOffsets[kt.crossTileID];Se&&(this.variableOffsets[kt.crossTileID]=Se,this.markUsedJustification(u,Se.anchor,kt,Rn))}}}if(on=ti,be=on&&on.placeable,Hi=on&&on.offscreen,kt.useRuntimeCollisionCircles){const Gn=u.text.placedSymbolArray.get(kt.centerJustifiedTextSymbolIndex),Hn=f.ai(u.textSizeData,X,Gn),sr=p.get("text-padding");Xi=this.collisionIndex.placeCollisionCircles(Z,Gn,u.lineVertexArray,u.glyphOffsetArray,Hn,A,z,D,I,c,Et,K.predicate,kt.collisionCircleDiameter,sr,x,Ht),Xi.circles.length&&Xi.collisionDetected&&!c&&f.w("Collisions detected, but collision boxes are not shown"),be=at||Xi.circles.length>0&&!Xi.collisionDetected,Hi=Hi&&Xi.offscreen}if(Bt.iconFeatureIndex&&(Nl=Bt.iconFeatureIndex),Bt.iconBox){const Gn=Hn=>this.collisionIndex.placeCollisionBox(Hn,ot,B,A,z,Et,wt,S,K.predicate,Ht,Pt&&sa?sa:void 0);_n&&_n.placeable&&Bt.verticalIconBox?(ln=Gn(Bt.verticalIconBox),We=ln.placeable):(ln=Gn(Bt.iconBox),We=ln.placeable),Hi=Hi&&ln.offscreen}const Zn=Q||kt.numHorizontalGlyphVertices===0&&kt.numVerticalGlyphVertices===0,Vl=W||kt.numIconVertices===0;Zn||Vl?Vl?Zn||(We=We&&be):be=We&&be:We=be=We&&be;const Bu=We&&ln.placeable;if(be&&on.placeable&&this.collisionIndex.insertCollisionBox(on.box,Z,p.get("text-ignore-placement"),u.bucketInstanceId,_n&&_n.placeable&&Ms?Ms:Da,K.ID),Bu&&this.collisionIndex.insertCollisionBox(ln.box,ot,p.get("icon-ignore-placement"),u.bucketInstanceId,Nl,K.ID),Xi&&be&&this.collisionIndex.insertCollisionCircles(Xi.circles,Z,p.get("text-ignore-placement"),u.bucketInstanceId,Da,K.ID),c&&this.storeCollisionData(u.bucketInstanceId,re,Bt,on,ln,Xi),kt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(u.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[kt.crossTileID]=new ge(be||Dt,We||Ct,Hi||u.justReloaded),s[kt.crossTileID]=!0};if(Ut){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const kt=u.getSortedSymbolIndexes(this.transform.angle);for(let Bt=kt.length-1;Bt>=0;--Bt){const re=kt[Bt];oe(u.symbolInstances.get(re),u.collisionArrays[re],re)}}else for(let kt=t.symbolInstanceStart;kt<t.symbolInstanceEnd;kt++)oe(u.symbolInstances.get(kt),u.collisionArrays[kt],kt);if(c&&u.bucketInstanceId in this.collisionCircleArrays){const kt=this.collisionCircleArrays[u.bucketInstanceId];f.as(kt.invProjMatrix,A),kt.viewportMatrix=this.collisionIndex.getViewportMatrix()}u.justReloaded=!1}storeCollisionData(t,s,c,u,p,x){if(c.textBox||c.iconBox){let S,A;this.collisionBoxArrays.has(t)?S=this.collisionBoxArrays.get(t):(S=new Map,this.collisionBoxArrays.set(t,S)),S.has(s)?A=S.get(s):(A={text:null,icon:null},S.set(s,A)),c.textBox&&(A.text=u.box),c.iconBox&&(A.icon=p.box)}if(x){let S=this.collisionCircleArrays[t];S===void 0&&(S=this.collisionCircleArrays[t]=new Oe);for(let A=0;A<x.circles.length;A+=4)S.circles.push(x.circles[A+0]),S.circles.push(x.circles[A+1]),S.circles.push(x.circles[A+2]),S.circles.push(x.collisionDetected?1:0)}}markUsedJustification(t,s,c,u){let p;p=u===f.ah.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[f.at(s)];const x=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];for(const S of x)S>=0&&(t.text.placedSymbolArray.get(S).crossTileID=p>=0&&S!==p?0:c.crossTileID)}markUsedOrientation(t,s,c){const u=s===f.ah.horizontal||s===f.ah.horizontalOnly?s:0,p=s===f.ah.vertical?s:0,x=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];for(const S of x)t.text.placedSymbolArray.get(S).placedOrientation=u;c.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=p)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let c=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const u=s?s.symbolFadeChange(t):1,p=s?s.opacities:{},x=s?s.variableOffsets:{},S=s?s.placedOrientations:{};for(const A in this.placements){const z=this.placements[A],D=p[A];D?(this.opacities[A]=new li(D,u,z.text,z.icon),c=c||z.text!==D.text.placed||z.icon!==D.icon.placed):(this.opacities[A]=new li(null,u,z.text,z.icon,z.skipFade),c=c||z.text||z.icon)}for(const A in p){const z=p[A];if(!this.opacities[A]){const D=new li(z,u,!1,!1);D.isHidden()||(this.opacities[A]=D,c=c||z.text.placed||z.icon.placed)}}for(const A in x)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=x[A]);for(const A in S)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=S[A]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");c?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s){const c={};for(const u of s){const p=u.getBucket(t);p&&u.latestFeatureIndex&&t.id===p.layerIds[0]&&this.updateBucketOpacities(p,u.tileID,c,u.collisionBoxArray)}}updateBucketOpacities(t,s,c,u){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const p=t.layers[0],x=p.layout,S=new li(null,0,!1,!1,!0),A=x.get("text-allow-overlap"),z=x.get("icon-allow-overlap"),D=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),I=x.get("text-rotation-alignment")==="map",B=x.get("text-pitch-alignment")==="map",U=x.get("icon-text-fit")!=="none",j=new li(null,0,A&&(z||!t.hasIconData()||x.get("icon-optional")),z&&(A||!t.hasTextData()||x.get("text-optional")),!0);!t.collisionArrays&&u&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(u);const X=(Q,W,Z)=>{for(let at=0;at<W/4;at++)Q.opacityVertexArray.emplaceBack(Z);Q.hasVisibleVertices=Q.hasVisibleVertices||Z!==ss},K=this.collisionBoxArrays.get(t.bucketInstanceId);for(let Q=0;Q<t.symbolInstances.length;Q++){const W=t.symbolInstances.get(Q),{numHorizontalGlyphVertices:Z,numVerticalGlyphVertices:at,crossTileID:ot}=W;let ft=this.opacities[ot];c[ot]?ft=S:ft||(ft=j,this.opacities[ot]=ft),c[ot]=!0;const wt=W.numIconVertices>0,Et=this.placedOrientations[W.crossTileID],Pt=Et===f.ah.vertical,Ut=Et===f.ah.horizontal||Et===f.ah.horizontalOnly;if(Z>0||at>0){const Ct=Dn(ft.text);X(t.text,Z,Pt?ss:Ct),X(t.text,at,Ut?ss:Ct);const Ht=ft.text.isHidden();[W.rightJustifiedTextSymbolIndex,W.centerJustifiedTextSymbolIndex,W.leftJustifiedTextSymbolIndex].forEach(Bt=>{Bt>=0&&(t.text.placedSymbolArray.get(Bt).hidden=Ht||Pt?1:0)}),W.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(W.verticalPlacedTextSymbolIndex).hidden=Ht||Ut?1:0);const oe=this.variableOffsets[W.crossTileID];oe&&this.markUsedJustification(t,oe.anchor,W,Et);const kt=this.placedOrientations[W.crossTileID];kt&&(this.markUsedJustification(t,"left",W,kt),this.markUsedOrientation(t,kt,W))}if(wt){const Ct=Dn(ft.icon),Ht=!(U&&W.verticalPlacedIconSymbolIndex&&Pt);W.placedIconSymbolIndex>=0&&(X(t.icon,W.numIconVertices,Ht?Ct:ss),t.icon.placedSymbolArray.get(W.placedIconSymbolIndex).hidden=ft.icon.isHidden()),W.verticalPlacedIconSymbolIndex>=0&&(X(t.icon,W.numVerticalIconVertices,Ht?ss:Ct),t.icon.placedSymbolArray.get(W.verticalPlacedIconSymbolIndex).hidden=ft.icon.isHidden())}const Dt=K&&K.has(Q)?K.get(Q):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ct=t.collisionArrays[Q];if(Ct){let Ht=new f.P(0,0);if(Ct.textBox||Ct.verticalTextBox){let oe=!0;if(D){const kt=this.variableOffsets[ot];kt?(Ht=Oi(kt.anchor,kt.width,kt.height,kt.textOffset,kt.textBoxScale),I&&Ht._rotate(B?this.transform.angle:-this.transform.angle)):oe=!1}if(Ct.textBox||Ct.verticalTextBox){let kt;Ct.textBox&&(kt=Pt),Ct.verticalTextBox&&(kt=Ut),rs(t.textCollisionBox.collisionVertexArray,ft.text.placed,!oe||kt,Dt.text,Ht.x,Ht.y)}}if(Ct.iconBox||Ct.verticalIconBox){const oe=!!(!Ut&&Ct.verticalIconBox);let kt;Ct.iconBox&&(kt=oe),Ct.verticalIconBox&&(kt=!oe),rs(t.iconCollisionBox.collisionVertexArray,ft.icon.placed,kt,Dt.icon,U?Ht.x:0,U?Ht.y:0)}}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const Q=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=Q.invProjMatrix,t.placementViewportMatrix=Q.viewportMatrix,t.collisionCircleArray=Q.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const c=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*c>t}setStale(){this.stale=!0}}function rs(m,t,s,c,u,p){c&&c.length!==0||(c=[0,0,0,0]);const x=c[0]-ue,S=c[1]-ue,A=c[2]-ue,z=c[3]-ue;m.emplaceBack(t?1:0,s?1:0,u||0,p||0,x,S),m.emplaceBack(t?1:0,s?1:0,u||0,p||0,A,S),m.emplaceBack(t?1:0,s?1:0,u||0,p||0,A,z),m.emplaceBack(t?1:0,s?1:0,u||0,p||0,x,z)}const Fe=Math.pow(2,25),Xc=Math.pow(2,24),$c=Math.pow(2,17),zn=Math.pow(2,16),Cn=Math.pow(2,9),Dp=Math.pow(2,8),Nn=Math.pow(2,1);function Dn(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const t=m.placed?1:0,s=Math.floor(127*m.opacity);return s*Fe+t*Xc+s*$c+t*zn+s*Cn+t*Dp+s*Nn+t}const ss=0;function Sr(){return{isOccluded:(m,t,s)=>!1,getPitchedTextCorrection:(m,t,s)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(m,t,s,c){throw new Error("Not implemented.")},translatePosition:(m,t,s,c)=>function(u,p,x,S,A=!1){if(!x[0]&&!x[1])return[0,0];const z=A?S==="map"?u.angle:0:S==="viewport"?-u.angle:0;if(z){const D=Math.sin(z),I=Math.cos(z);x=[x[0]*I-x[1]*D,x[0]*D+x[1]*I]}return[A?x[0]:xe(p,x[0],u.zoom),A?x[1]:xe(p,x[1],u.zoom)]}(m,t,s,c),getCircleRadiusCorrection:m=>1}}class bi{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,s,c,u,p){const x=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(x,u,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,p())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((S,A)=>S.sortKey-A.sortKey));this._currentPartIndex<x.length;)if(s.placeLayerBucketPart(x[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,p())return!0;return!1}}class yo{constructor(t,s,c,u,p,x,S,A){this.placement=new sn(t,Sr(),s,x,S,A),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(t,s,c){const u=tt.now(),p=()=>!this._forceFullPlacement&&tt.now()-u>2;for(;this._currentPlacementIndex>=0;){const x=s[t[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=S)&&(!x.maxzoom||x.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new bi(x)),this._inProgressLayer.continuePlacement(c[x.source],this.placement,this._showCollisionBoxes,x,p))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const ea=512/f.X/2;class _i{constructor(t,s,c){this.tileID=t,this.bucketInstanceId=c,this._symbolsByKey={};const u=new Map;for(let p=0;p<s.length;p++){const x=s.get(p),S=x.key,A=u.get(S);A?A.push(x):u.set(S,[x])}for(const[p,x]of u){const S={positions:x.map(A=>({x:Math.floor(A.anchorX*ea),y:Math.floor(A.anchorY*ea)})),crossTileIDs:x.map(A=>A.crossTileID)};if(S.positions.length>128){const A=new f.av(S.positions.length,16,Uint16Array);for(const{x:z,y:D}of S.positions)A.add(z,D);A.finish(),delete S.positions,S.index=A}this._symbolsByKey[p]=S}}getScaledCoordinates(t,s){const{x:c,y:u,z:p}=this.tileID.canonical,{x,y:S,z:A}=s.canonical,z=ea/Math.pow(2,A-p),D=(S*f.X+t.anchorY)*z,I=u*f.X*ea;return{x:Math.floor((x*f.X+t.anchorX)*z-c*f.X*ea),y:Math.floor(D-I)}}findMatches(t,s,c){const u=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let p=0;p<t.length;p++){const x=t.get(p);if(x.crossTileID)continue;const S=this._symbolsByKey[x.key];if(!S)continue;const A=this.getScaledCoordinates(x,s);if(S.index){const z=S.index.range(A.x-u,A.y-u,A.x+u,A.y+u).sort();for(const D of z){const I=S.crossTileIDs[D];if(!c[I]){c[I]=!0,x.crossTileID=I;break}}}else if(S.positions)for(let z=0;z<S.positions.length;z++){const D=S.positions[z],I=S.crossTileIDs[z];if(Math.abs(D.x-A.x)<=u&&Math.abs(D.y-A.y)<=u&&!c[I]){c[I]=!0,x.crossTileID=I;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class cl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ia{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const c in this.indexes){const u=this.indexes[c],p={};for(const x in u){const S=u[x];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+s),p[S.tileID.key]=S}this.indexes[c]=p}this.lng=t}addBucket(t,s,c){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let p=0;p<s.symbolInstances.length;p++)s.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const u=this.usedCrossTileIDs[t.overscaledZ];for(const p in this.indexes){const x=this.indexes[p];if(Number(p)>t.overscaledZ)for(const S in x){const A=x[S];A.tileID.isChildOf(t)&&A.findMatches(s.symbolInstances,t,u)}else{const S=x[t.scaledTo(Number(p)).key];S&&S.findMatches(s.symbolInstances,t,u)}}for(let p=0;p<s.symbolInstances.length;p++){const x=s.symbolInstances.get(p);x.crossTileID||(x.crossTileID=c.generate(),u[x.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new _i(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const c of s.getCrossTileIDsLists())for(const u of c)delete this.usedCrossTileIDs[t][u]}removeStaleBuckets(t){let s=!1;for(const c in this.indexes){const u=this.indexes[c];for(const p in u)t[u[p].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,u[p]),delete u[p],s=!0)}return s}}class Yc{constructor(){this.layerIndexes={},this.crossTileIDs=new cl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,c){let u=this.layerIndexes[t.id];u===void 0&&(u=this.layerIndexes[t.id]=new ia);let p=!1;const x={};u.handleWrapJump(c);for(const S of s){const A=S.getBucket(t);A&&t.id===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(S.tileID,A,this.crossTileIDs)&&(p=!0),x[A.bucketInstanceId]=!0)}return u.removeStaleBuckets(x)&&(p=!0),p}pruneUnusedLayers(t){const s={};t.forEach(c=>{s[c]=!0});for(const c in this.layerIndexes)s[c]||delete this.layerIndexes[c]}}const na=(m,t)=>f.t(m,t&&t.filter(s=>s.identifier!=="source.canvas")),Ip=f.aw();class ul extends f.E{constructor(t,s={}){super(),this._rtlPluginLoaded=()=>{for(const c in this.sourceCaches){const u=this.sourceCaches[c].getSource().type;u!=="vector"&&u!=="geojson"||this.sourceCaches[c].reload()}},this.map=t,this.dispatcher=new br(xr(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",(c,u)=>this.getGlyphs(c,u)),this.dispatcher.registerMessageHandler("GI",(c,u)=>this.getImages(c,u)),this.imageManager=new Ai,this.imageManager.setEventedParent(this),this.glyphManager=new le(t._requestManager,s.localIdeographFontFamily),this.lineAtlas=new wa(256,512),this.crossTileSymbolIndex=new Yc,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new f.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",f.ay()),Ta().on(Mt,this._rtlPluginLoaded),this.on("data",c=>{if(c.dataType!=="source"||c.sourceDataType!=="metadata")return;const u=this.sourceCaches[c.sourceId];if(!u)return;const p=u.getSource();if(p&&p.vectorLayerIds)for(const x in this._layers){const S=this._layers[x];S.source===p.id&&this._validateLayer(S)}})}loadURL(t,s={},c){this.fire(new f.k("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const u=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const p=this._loadStyleRequest;f.h(u,this._loadStyleRequest).then(x=>{this._loadStyleRequest=null,this._load(x.data,s,c)}).catch(x=>{this._loadStyleRequest=null,x&&!p.signal.aborted&&this.fire(new f.j(x))})}loadJSON(t,s={},c){this.fire(new f.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,tt.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,s.validate=s.validate!==!1,this._load(t,s,c)}).catch(()=>{})}loadEmpty(){this.fire(new f.k("dataloading",{dataType:"style"})),this._load(Ip,{validate:!1})}_load(t,s,c){var u;const p=s.transformStyle?s.transformStyle(c,t):t;if(!s.validate||!na(this,f.u(p))){this._loaded=!0,this.stylesheet=p;for(const x in p.sources)this.addSource(x,p.sources[x],{validate:!1});p.sprite?this._loadSprite(p.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(p.glyphs),this._createLayers(),this.light=new Ge(this.stylesheet.light),this.sky=new qi(this.stylesheet.sky),this.map.setTerrain((u=this.stylesheet.terrain)!==null&&u!==void 0?u:null),this.fire(new f.k("data",{dataType:"style"})),this.fire(new f.k("style.load"))}}_createLayers(){const t=f.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",t),this._order=t.map(s=>s.id),this._layers={},this._serializedLayers=null;for(const s of t){const c=f.aA(s);c.setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=c}}_loadSprite(t,s=!1,c=void 0){let u;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(p,x,S,A){return f._(this,void 0,void 0,function*(){const z=Pe(p),D=S>1?"@2x":"",I={},B={};for(const{id:U,url:j}of z){const X=x.transformRequest(ye(j,D,".json"),"SpriteJSON");I[U]=f.h(X,A);const K=x.transformRequest(ye(j,D,".png"),"SpriteImage");B[U]=ut.getImage(K,A)}return yield Promise.all([...Object.values(I),...Object.values(B)]),function(U,j){return f._(this,void 0,void 0,function*(){const X={};for(const K in U){X[K]={};const Q=tt.getImageCanvasContext((yield j[K]).data),W=(yield U[K]).data;for(const Z in W){const{width:at,height:ot,x:ft,y:wt,sdf:Et,pixelRatio:Pt,stretchX:Ut,stretchY:Dt,content:Ct,textFitWidth:Ht,textFitHeight:oe}=W[Z];X[K][Z]={data:null,pixelRatio:Pt,sdf:Et,stretchX:Ut,stretchY:Dt,content:Ct,textFitWidth:Ht,textFitHeight:oe,spriteData:{width:at,height:ot,x:ft,y:wt,context:Q}}}}return X})}(I,B)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(p=>{if(this._spriteRequest=null,p)for(const x in p){this._spritesImagesIds[x]=[];const S=this._spritesImagesIds[x]?this._spritesImagesIds[x].filter(A=>!(A in p)):[];for(const A of S)this.imageManager.removeImage(A),this._changedImages[A]=!0;for(const A in p[x]){const z=x==="default"?A:`${x}:${A}`;this._spritesImagesIds[x].push(z),z in this.imageManager.images?this.imageManager.updateImage(z,p[x][A],!1):this.imageManager.addImage(z,p[x][A]),s&&(this._changedImages[z]=!0)}}}).catch(p=>{this._spriteRequest=null,u=p,this.fire(new f.j(u))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new f.k("data",{dataType:"style"})),c&&c(u)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new f.k("data",{dataType:"style"}))}_validateLayer(t){const s=this.sourceCaches[t.source];if(!s)return;const c=t.sourceLayer;if(!c)return;const u=s.getSource();(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(c)===-1)&&this.fire(new f.j(new Error(`Source layer "${c}" does not exist on source "${u.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,s=!1){const c=this._serializedAllLayers();if(!t||t.length===0)return Object.values(s?f.aB(c):c);const u=[];for(const p of t)if(c[p]){const x=s?f.aB(c[p]):c[p];u.push(x)}return u}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const s=Object.keys(this._layers);for(const c of s){const u=this._layers[c];u.type!=="custom"&&(t[c]=u.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const s=this._changed;if(s){const u=Object.keys(this._updatedLayers),p=Object.keys(this._removedLayers);(u.length||p.length)&&this._updateWorkerLayers(u,p);for(const x in this._updatedSources){const S=this._updatedSources[x];if(S==="reload")this._reloadSource(x);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(x)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const x in this._updatedPaintProps)this._layers[x].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const c={};for(const u in this.sourceCaches){const p=this.sourceCaches[u];c[u]=p.used,p.used=!1}for(const u of this._order){const p=this._layers[u];p.recalculate(t,this._availableImages),!p.isHidden(t.zoom)&&p.source&&(this.sourceCaches[p.source].used=!0)}for(const u in c){const p=this.sourceCaches[u];!!c[u]!=!!p.used&&p.fire(new f.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:u}))}this.light.recalculate(t),this.sky.recalculate(t),this.z=t.zoom,s&&this.fire(new f.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,s){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,s={}){var c;this._checkLoaded();const u=this.serialize();if(t=s.transformStyle?s.transformStyle(u,t):t,((c=s.validate)===null||c===void 0||c)&&na(this,f.u(t)))return!1;(t=f.aB(t)).layers=f.az(t.layers);const p=f.aC(u,t),x=this._getOperationsToPerform(p);if(x.unimplemented.length>0)throw new Error(`Unimplemented: ${x.unimplemented.join(", ")}.`);if(x.operations.length===0)return!1;for(const S of x.operations)S();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const s=[],c=[];for(const u of t)switch(u.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":s.push(()=>this.addLayer.apply(this,u.args));break;case"removeLayer":s.push(()=>this.removeLayer.apply(this,u.args));break;case"setPaintProperty":s.push(()=>this.setPaintProperty.apply(this,u.args));break;case"setLayoutProperty":s.push(()=>this.setLayoutProperty.apply(this,u.args));break;case"setFilter":s.push(()=>this.setFilter.apply(this,u.args));break;case"addSource":s.push(()=>this.addSource.apply(this,u.args));break;case"removeSource":s.push(()=>this.removeSource.apply(this,u.args));break;case"setLayerZoomRange":s.push(()=>this.setLayerZoomRange.apply(this,u.args));break;case"setLight":s.push(()=>this.setLight.apply(this,u.args));break;case"setGeoJSONSourceData":s.push(()=>this.setGeoJSONSourceData.apply(this,u.args));break;case"setGlyphs":s.push(()=>this.setGlyphs.apply(this,u.args));break;case"setSprite":s.push(()=>this.setSprite.apply(this,u.args));break;case"setSky":s.push(()=>this.setSky.apply(this,u.args));break;case"setTerrain":s.push(()=>this.map.setTerrain.apply(this,u.args));break;case"setTransition":s.push(()=>{});break;default:c.push(u.command)}return{operations:s,unimplemented:c}}addImage(t,s){if(this.getImage(t))return this.fire(new f.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,s),this._afterImageUpdated(t)}updateImage(t,s){this.imageManager.updateImage(t,s)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new f.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new f.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,s,c={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(f.u.source,`sources.${t}`,s,null,c))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const u=this.sourceCaches[t]=new ae(t,s,this.dispatcher);u.style=this,u.setEventedParent(this,()=>({isSourceLoaded:u.loaded(),source:u.serialize(),sourceId:t})),u.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const c in this._layers)if(this._layers[c].source===t)return this.fire(new f.j(new Error(`Source "${t}" cannot be removed while layer "${c}" is using it.`)));const s=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],s.fire(new f.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,s){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const c=this.sourceCaches[t].getSource();if(c.type!=="geojson")throw new Error(`geojsonSource.type is ${c.type}, which is !== 'geojson`);c.setData(s),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,s,c={}){this._checkLoaded();const u=t.id;if(this.getLayer(u))return void this.fire(new f.j(new Error(`Layer "${u}" already exists on this map.`)));let p;if(t.type==="custom"){if(na(this,f.aD(t)))return;p=f.aA(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(u,t.source),t=f.aB(t),t=f.e(t,{source:u})),this._validate(f.u.layer,`layers.${u}`,t,{arrayIndex:-1},c))return;p=f.aA(t),this._validateLayer(p),p.setEventedParent(this,{layer:{id:u}})}const x=s?this._order.indexOf(s):this._order.length;if(s&&x===-1)this.fire(new f.j(new Error(`Cannot add layer "${u}" before non-existing layer "${s}".`)));else{if(this._order.splice(x,0,u),this._layerOrderChanged=!0,this._layers[u]=p,this._removedLayers[u]&&p.source&&p.type!=="custom"){const S=this._removedLayers[u];delete this._removedLayers[u],S.type!==p.type?this._updatedSources[p.source]="clear":(this._updatedSources[p.source]="reload",this.sourceCaches[p.source].pause())}this._updateLayer(p),p.onAdd&&p.onAdd(this.map)}}moveLayer(t,s){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new f.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===s)return;const c=this._order.indexOf(t);this._order.splice(c,1);const u=s?this._order.indexOf(s):this._order.length;s&&u===-1?this.fire(new f.j(new Error(`Cannot move layer "${t}" before non-existing layer "${s}".`))):(this._order.splice(u,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const s=this._layers[t];if(!s)return void this.fire(new f.j(new Error(`Cannot remove non-existing layer "${t}".`)));s.setEventedParent(null);const c=this._order.indexOf(t);this._order.splice(c,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=s,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],s.onRemove&&s.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,s,c){this._checkLoaded();const u=this.getLayer(t);u?u.minzoom===s&&u.maxzoom===c||(s!=null&&(u.minzoom=s),c!=null&&(u.maxzoom=c),this._updateLayer(u)):this.fire(new f.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,s,c={}){this._checkLoaded();const u=this.getLayer(t);if(u){if(!f.aE(u.filter,s))return s==null?(u.filter=void 0,void this._updateLayer(u)):void(this._validate(f.u.filter,`layers.${u.id}.filter`,s,null,c)||(u.filter=f.aB(s),this._updateLayer(u)))}else this.fire(new f.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return f.aB(this.getLayer(t).filter)}setLayoutProperty(t,s,c,u={}){this._checkLoaded();const p=this.getLayer(t);p?f.aE(p.getLayoutProperty(s),c)||(p.setLayoutProperty(s,c,u),this._updateLayer(p)):this.fire(new f.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,s){const c=this.getLayer(t);if(c)return c.getLayoutProperty(s);this.fire(new f.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,s,c,u={}){this._checkLoaded();const p=this.getLayer(t);p?f.aE(p.getPaintProperty(s),c)||(p.setPaintProperty(s,c,u)&&this._updateLayer(p),this._changed=!0,this._updatedPaintProps[t]=!0,this._serializedLayers=null):this.fire(new f.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,s){return this.getLayer(t).getPaintProperty(s)}setFeatureState(t,s){this._checkLoaded();const c=t.source,u=t.sourceLayer,p=this.sourceCaches[c];if(p===void 0)return void this.fire(new f.j(new Error(`The source '${c}' does not exist in the map's style.`)));const x=p.getSource().type;x==="geojson"&&u?this.fire(new f.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):x!=="vector"||u?(t.id===void 0&&this.fire(new f.j(new Error("The feature id parameter must be provided."))),p.setFeatureState(u,t.id,s)):this.fire(new f.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,s){this._checkLoaded();const c=t.source,u=this.sourceCaches[c];if(u===void 0)return void this.fire(new f.j(new Error(`The source '${c}' does not exist in the map's style.`)));const p=u.getSource().type,x=p==="vector"?t.sourceLayer:void 0;p!=="vector"||x?s&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new f.j(new Error("A feature id is required to remove its specific state property."))):u.removeFeatureState(x,t.id,s):this.fire(new f.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const s=t.source,c=t.sourceLayer,u=this.sourceCaches[s];if(u!==void 0)return u.getSource().type!=="vector"||c?(t.id===void 0&&this.fire(new f.j(new Error("The feature id parameter must be provided."))),u.getFeatureState(c,t.id)):void this.fire(new f.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new f.j(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return f.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=f.aF(this.sourceCaches,p=>p.serialize()),s=this._serializeByIds(this._order,!0),c=this.map.getTerrain()||void 0,u=this.stylesheet;return f.aG({version:u.version,name:u.name,metadata:u.metadata,light:u.light,sky:u.sky,center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,sprite:u.sprite,glyphs:u.glyphs,transition:u.transition,sources:t,layers:s,terrain:c},p=>p!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const s=x=>this._layers[x].type==="fill-extrusion",c={},u=[];for(let x=this._order.length-1;x>=0;x--){const S=this._order[x];if(s(S)){c[S]=x;for(const A of t){const z=A[S];if(z)for(const D of z)u.push(D)}}}u.sort((x,S)=>S.intersectionZ-x.intersectionZ);const p=[];for(let x=this._order.length-1;x>=0;x--){const S=this._order[x];if(s(S))for(let A=u.length-1;A>=0;A--){const z=u[A].feature;if(c[z.layer.id]<x)break;p.push(z),u.pop()}else for(const A of t){const z=A[S];if(z)for(const D of z)p.push(D.feature)}}return p}queryRenderedFeatures(t,s,c){s&&s.filter&&this._validate(f.u.filter,"queryRenderedFeatures.filter",s.filter,null,s);const u={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new f.j(new Error("parameters.layers must be an Array."))),[];for(const S of s.layers){const A=this._layers[S];if(!A)return this.fire(new f.j(new Error(`The layer '${S}' does not exist in the map's style and cannot be queried for features.`))),[];u[A.source]=!0}}const p=[];s.availableImages=this._availableImages;const x=this._serializedAllLayers();for(const S in this.sourceCaches)s.layers&&!u[S]||p.push(Wa(this.sourceCaches[S],this._layers,x,t,s,c));return this.placement&&p.push(function(S,A,z,D,I,B,U){const j={},X=B.queryRenderedSymbols(D),K=[];for(const Q of Object.keys(X).map(Number))K.push(U[Q]);K.sort(tr);for(const Q of K){const W=Q.featureIndex.lookupSymbolFeatures(X[Q.bucketInstanceId],A,Q.bucketIndex,Q.sourceLayerIndex,I.filter,I.layers,I.availableImages,S);for(const Z in W){const at=j[Z]=j[Z]||[],ot=W[Z];ot.sort((ft,wt)=>{const Et=Q.featureSortOrder;if(Et){const Pt=Et.indexOf(ft.featureIndex);return Et.indexOf(wt.featureIndex)-Pt}return wt.featureIndex-ft.featureIndex});for(const ft of ot)at.push(ft)}}for(const Q in j)j[Q].forEach(W=>{const Z=W.feature,at=z[S[Q].source].getFeatureState(Z.layer["source-layer"],Z.id);Z.source=Z.layer.source,Z.layer["source-layer"]&&(Z.sourceLayer=Z.layer["source-layer"]),Z.state=at});return j}(this._layers,x,this.sourceCaches,t,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(p)}querySourceFeatures(t,s){s&&s.filter&&this._validate(f.u.filter,"querySourceFeatures.filter",s.filter,null,s);const c=this.sourceCaches[t];return c?function(u,p){const x=u.getRenderableIds().map(z=>u.getTileByID(z)),S=[],A={};for(let z=0;z<x.length;z++){const D=x[z],I=D.tileID.canonical.key;A[I]||(A[I]=!0,D.querySourceFeatures(S,p))}return S}(c,s):[]}getLight(){return this.light.getLight()}setLight(t,s={}){this._checkLoaded();const c=this.light.getLight();let u=!1;for(const x in t)if(!f.aE(t[x],c[x])){u=!0;break}if(!u)return;const p={now:tt.now(),transition:f.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,s),this.light.updateTransitions(p)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,s={}){const c=this.getSky();let u=!1;if(!t&&!c)return;if(t&&!c)u=!0;else if(!t&&c)u=!0;else for(const x in t)if(!f.aE(t[x],c[x])){u=!0;break}if(!u)return;const p={now:tt.now(),transition:f.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,s),this.sky.updateTransitions(p)}_validate(t,s,c,u,p={}){return(!p||p.validate!==!1)&&na(this,t.call(f.u,f.e({key:s,style:this.serialize(),value:c,styleSpec:f.v},u)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ta().off(Mt,this._rtlPluginLoaded);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const c=this.sourceCaches[s];c.setEventedParent(null),c.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const s in this.sourceCaches)this.sourceCaches[s].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,s,c,u,p=!1){let x=!1,S=!1;const A={};for(const z of this._order){const D=this._layers[z];if(D.type!=="symbol")continue;if(!A[D.source]){const B=this.sourceCaches[D.source];A[D.source]=B.getRenderableIds(!0).map(U=>B.getTileByID(U)).sort((U,j)=>j.tileID.overscaledZ-U.tileID.overscaledZ||(U.tileID.isLessThan(j.tileID)?-1:1))}const I=this.crossTileSymbolIndex.addLayer(D,A[D.source],t.center.lng);x=x||I}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((p=p||this._layerOrderChanged||c===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(tt.now(),t.zoom))&&(this.pauseablePlacement=new yo(t,this.map.terrain,this._order,p,s,c,u,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(tt.now()),S=!0),x&&this.pauseablePlacement.placement.setStale()),S||x)for(const z of this._order){const D=this._layers[z];D.type==="symbol"&&this.placement.updateLayerOpacities(D,A[D.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(tt.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,s){return f._(this,void 0,void 0,function*(){const c=yield this.imageManager.getImages(s.icons);this._updateTilesForChangedImages();const u=this.sourceCaches[s.source];return u&&u.setDependencies(s.tileID.key,s.type,s.icons),c})}getGlyphs(t,s){return f._(this,void 0,void 0,function*(){const c=yield this.glyphManager.getGlyphs(s.stacks),u=this.sourceCaches[s.source];return u&&u.setDependencies(s.tileID.key,s.type,[""]),c})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,s={}){this._checkLoaded(),t&&this._validate(f.u.glyphs,"glyphs",t,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,s,c={},u){this._checkLoaded();const p=[{id:t,url:s}],x=[...Pe(this.stylesheet.sprite),...p];this._validate(f.u.sprite,"sprite",x,null,c)||(this.stylesheet.sprite=x,this._loadSprite(p,!0,u))}removeSprite(t){this._checkLoaded();const s=Pe(this.stylesheet.sprite);if(s.find(c=>c.id===t)){if(this._spritesImagesIds[t])for(const c of this._spritesImagesIds[t])this.imageManager.removeImage(c),this._changedImages[c]=!0;s.splice(s.findIndex(c=>c.id===t),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new f.k("data",{dataType:"style"}))}else this.fire(new f.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return Pe(this.stylesheet.sprite)}setSprite(t,s={},c){this._checkLoaded(),t&&this._validate(f.u.sprite,"sprite",t,null,s)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,c):(this._unloadSprite(),c&&c(null)))}}var Tr=f.Y([{name:"a_pos",type:"Int16",components:2}]);const ar={prelude:Re(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Re(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Re(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Re(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Re("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Re(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:Re(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Re("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Re("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Re("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Re(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Re(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Re(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Re(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Re(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Re(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Re(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Re(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Re(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Re(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Re(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Re(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Re(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Re(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Re(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Re(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Re("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Re("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Re("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:Re("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Re(m,t){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,c=t.match(/attribute ([\w]+) ([\w]+)/g),u=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),p=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=p?p.concat(u):u,S={};return{fragmentSource:m=m.replace(s,(A,z,D,I,B)=>(S[B]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${B}
varying ${D} ${I} ${B};
#else
uniform ${D} ${I} u_${B};
#endif
`:`
#ifdef HAS_UNIFORM_u_${B}
    ${D} ${I} ${B} = u_${B};
#endif
`)),vertexSource:t=t.replace(s,(A,z,D,I,B)=>{const U=I==="float"?"vec2":"vec4",j=B.match(/color/)?"color":U;return S[B]?z==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
attribute ${D} ${U} a_${B};
varying ${D} ${I} ${B};
#else
uniform ${D} ${I} u_${B};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = a_${B};
#else
    ${D} ${I} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = unpack_mix_${j}(a_${B}, u_${B}_t);
#else
    ${D} ${I} ${B} = u_${B};
#endif
`:z==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
attribute ${D} ${U} a_${B};
#else
uniform ${D} ${I} u_${B};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${D} ${I} ${B} = a_${B};
#else
    ${D} ${I} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${D} ${I} ${B} = unpack_mix_${j}(a_${B}, u_${B}_t);
#else
    ${D} ${I} ${B} = u_${B};
#endif
`}),staticAttributes:c,staticUniforms:x}}class Kc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,s,c,u,p,x,S,A,z){this.context=t;let D=this.boundPaintVertexBuffers.length!==u.length;for(let I=0;!D&&I<u.length;I++)this.boundPaintVertexBuffers[I]!==u[I]&&(D=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==c||D||this.boundIndexBuffer!==p||this.boundVertexOffset!==x||this.boundDynamicVertexBuffer!==S||this.boundDynamicVertexBuffer2!==A||this.boundDynamicVertexBuffer3!==z?this.freshBind(s,c,u,p,x,S,A,z):(t.bindVertexArray.set(this.vao),S&&S.bind(),p&&p.dynamicDraw&&p.bind(),A&&A.bind(),z&&z.bind())}freshBind(t,s,c,u,p,x,S,A){const z=t.numAttributes,D=this.context,I=D.gl;this.vao&&this.destroy(),this.vao=D.createVertexArray(),D.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=u,this.boundVertexOffset=p,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=A,s.enableAttributes(I,t);for(const B of c)B.enableAttributes(I,t);x&&x.enableAttributes(I,t),S&&S.enableAttributes(I,t),A&&A.enableAttributes(I,t),s.bind(),s.setVertexAttribPointers(I,t,p);for(const B of c)B.bind(),B.setVertexAttribPointers(I,t,p);x&&(x.bind(),x.setVertexAttribPointers(I,t,p)),u&&u.bind(),S&&(S.bind(),S.setVertexAttribPointers(I,t,p)),A&&(A.bind(),A.setVertexAttribPointers(I,t,p)),D.currentNumAttributes=z}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Qc=(m,t,s,c,u)=>({u_matrix:m,u_texture:0,u_ele_delta:t,u_fog_matrix:s,u_fog_color:c?c.properties.get("fog-color"):f.aM.white,u_fog_ground_blend:c?c.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:c?c.calculateFogBlendOpacity(u):0,u_horizon_color:c?c.properties.get("horizon-color"):f.aM.white,u_horizon_fog_blend:c?c.properties.get("horizon-fog-blend"):1});function os(m){const t=[];for(let s=0;s<m.length;s++){if(m[s]===null)continue;const c=m[s].split(" ");t.push(c.pop())}return t}class Jc{constructor(t,s,c,u,p,x){const S=t.gl;this.program=S.createProgram();const A=os(s.staticAttributes),z=c?c.getBinderAttributes():[],D=A.concat(z),I=ar.prelude.staticUniforms?os(ar.prelude.staticUniforms):[],B=s.staticUniforms?os(s.staticUniforms):[],U=c?c.getBinderUniforms():[],j=I.concat(B).concat(U),X=[];for(const ft of j)X.indexOf(ft)<0&&X.push(ft);const K=c?c.defines():[];p&&K.push("#define OVERDRAW_INSPECTOR;"),x&&K.push("#define TERRAIN3D;");const Q=K.concat(ar.prelude.fragmentSource,s.fragmentSource).join(`
`),W=K.concat(ar.prelude.vertexSource,s.vertexSource).join(`
`),Z=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);if(S.shaderSource(Z,Q),S.compileShader(Z),!S.getShaderParameter(Z,S.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${S.getShaderInfoLog(Z)}`);S.attachShader(this.program,Z);const at=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);if(S.shaderSource(at,W),S.compileShader(at),!S.getShaderParameter(at,S.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${S.getShaderInfoLog(at)}`);S.attachShader(this.program,at),this.attributes={};const ot={};this.numAttributes=D.length;for(let ft=0;ft<this.numAttributes;ft++)D[ft]&&(S.bindAttribLocation(this.program,ft,D[ft]),this.attributes[D[ft]]=ft);if(S.linkProgram(this.program),!S.getProgramParameter(this.program,S.LINK_STATUS))throw new Error(`Program failed to link: ${S.getProgramInfoLog(this.program)}`);S.deleteShader(at),S.deleteShader(Z);for(let ft=0;ft<X.length;ft++){const wt=X[ft];if(wt&&!ot[wt]){const Et=S.getUniformLocation(this.program,wt);Et&&(ot[wt]=Et)}}this.fixedUniforms=u(t,ot),this.terrainUniforms=((ft,wt)=>({u_depth:new f.aH(ft,wt.u_depth),u_terrain:new f.aH(ft,wt.u_terrain),u_terrain_dim:new f.aI(ft,wt.u_terrain_dim),u_terrain_matrix:new f.aJ(ft,wt.u_terrain_matrix),u_terrain_unpack:new f.aK(ft,wt.u_terrain_unpack),u_terrain_exaggeration:new f.aI(ft,wt.u_terrain_exaggeration)}))(t,ot),this.binderUniforms=c?c.getUniforms(t,ot):[]}draw(t,s,c,u,p,x,S,A,z,D,I,B,U,j,X,K,Q,W){const Z=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(c),t.setStencilMode(u),t.setColorMode(p),t.setCullFace(x),A){t.activeTexture.set(Z.TEXTURE2),Z.bindTexture(Z.TEXTURE_2D,A.depthTexture),t.activeTexture.set(Z.TEXTURE3),Z.bindTexture(Z.TEXTURE_2D,A.texture);for(const ot in this.terrainUniforms)this.terrainUniforms[ot].set(A[ot])}for(const ot in this.fixedUniforms)this.fixedUniforms[ot].set(S[ot]);X&&X.setUniforms(t,this.binderUniforms,U,{zoom:j});let at=0;switch(s){case Z.LINES:at=2;break;case Z.TRIANGLES:at=3;break;case Z.LINE_STRIP:at=1}for(const ot of B.get()){const ft=ot.vaos||(ot.vaos={});(ft[z]||(ft[z]=new Kc)).bind(t,this,D,X?X.getPaintVertexBuffers():[],I,ot.vertexOffset,K,Q,W),Z.drawElements(s,ot.primitiveLength*at,Z.UNSIGNED_SHORT,ot.primitiveOffset*at*2)}}}function hl(m,t,s){const c=1/xe(s,1,t.transform.tileZoom),u=Math.pow(2,s.tileID.overscaledZ),p=s.tileSize*Math.pow(2,t.transform.tileZoom)/u,x=p*(s.tileID.canonical.x+s.tileID.wrap*u),S=p*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[c,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[x>>16,S>>16],u_pixel_coord_lower:[65535&x,65535&S]}}const vo=(m,t,s,c)=>{const u=t.style.light,p=u.properties.get("position"),x=[p.x,p.y,p.z],S=function(){var z=new f.A(9);return f.A!=Float32Array&&(z[1]=0,z[2]=0,z[3]=0,z[5]=0,z[6]=0,z[7]=0),z[0]=1,z[4]=1,z[8]=1,z}();u.properties.get("anchor")==="viewport"&&function(z,D){var I=Math.sin(D),B=Math.cos(D);z[0]=B,z[1]=I,z[2]=0,z[3]=-I,z[4]=B,z[5]=0,z[6]=0,z[7]=0,z[8]=1}(S,-t.transform.angle),function(z,D,I){var B=D[0],U=D[1],j=D[2];z[0]=B*I[0]+U*I[3]+j*I[6],z[1]=B*I[1]+U*I[4]+j*I[7],z[2]=B*I[2]+U*I[5]+j*I[8]}(x,x,S);const A=u.properties.get("color");return{u_matrix:m,u_lightpos:x,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[A.r,A.g,A.b],u_vertical_gradient:+s,u_opacity:c}},dl=(m,t,s,c,u,p,x)=>f.e(vo(m,t,s,c),hl(p,t,x),{u_height_factor:-Math.pow(2,u.overscaledZ)/x.tileSize/8}),ls=m=>({u_matrix:m}),ad=(m,t,s,c)=>f.e(ls(m),hl(s,t,c)),kp=(m,t)=>({u_matrix:m,u_world:t}),rd=(m,t,s,c,u)=>f.e(ad(m,t,s,c),{u_world:u}),Rp=(m,t,s,c)=>{const u=m.transform;let p,x;if(c.paint.get("circle-pitch-alignment")==="map"){const S=xe(s,1,u.zoom);p=!0,x=[S,S]}else p=!1,x=u.pixelsToGLUnits;return{u_camera_to_center_distance:u.cameraToCenterDistance,u_scale_with_map:+(c.paint.get("circle-pitch-scale")==="map"),u_matrix:m.translatePosMatrix(t.posMatrix,s,c.paint.get("circle-translate"),c.paint.get("circle-translate-anchor")),u_pitch_with_map:+p,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:x}},Ar=(m,t,s)=>({u_matrix:m,u_inv_matrix:t,u_camera_to_center_distance:s.cameraToCenterDistance,u_viewport_size:[s.width,s.height]}),xo=(m,t,s=1)=>({u_matrix:m,u_color:t,u_overlay:0,u_overlay_scale:s}),mn=m=>({u_matrix:m}),gn=(m,t,s,c)=>({u_matrix:m,u_extrude_scale:xe(t,1,s),u_intensity:c}),fl=(m,t,s,c)=>{const u=f.H();f.aP(u,0,m.width,m.height,0,0,1);const p=m.context.gl;return{u_matrix:u,u_world:[p.drawingBufferWidth,p.drawingBufferHeight],u_image:s,u_color_ramp:c,u_opacity:t.paint.get("heatmap-opacity")}};function pl(m,t){const s=Math.pow(2,t.canonical.z),c=t.canonical.y;return[new f.Z(0,c/s).toLngLat().lat,new f.Z(0,(c+1)/s).toLngLat().lat]}const ml=(m,t,s,c)=>{const u=m.transform;return{u_matrix:ld(m,t,s,c),u_ratio:1/xe(t,1,u.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},sd=(m,t,s,c,u)=>f.e(ml(m,t,s,u),{u_image:0,u_image_height:c}),cs=(m,t,s,c,u)=>{const p=m.transform,x=od(t,p);return{u_matrix:ld(m,t,s,u),u_texsize:t.imageAtlasTexture.size,u_ratio:1/xe(t,1,p.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[x,c.fromScale,c.toScale],u_fade:c.t,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Pp=(m,t,s,c,u,p)=>{const x=m.lineAtlas,S=od(t,m.transform),A=s.layout.get("line-cap")==="round",z=x.getDash(c.from,A),D=x.getDash(c.to,A),I=z.width*u.fromScale,B=D.width*u.toScale;return f.e(ml(m,t,s,p),{u_patternscale_a:[S/I,-z.height/2],u_patternscale_b:[S/B,-D.height/2],u_sdfgamma:x.width/(256*Math.min(I,B)*m.pixelRatio)/2,u_image:0,u_tex_y_a:z.y,u_tex_y_b:D.y,u_mix:u.t})};function od(m,t){return 1/xe(m,1,t.tileZoom)}function ld(m,t,s,c){return m.translatePosMatrix(c?c.posMatrix:t.tileID.posMatrix,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const Lp=(m,t,s,c,u)=>{return{u_matrix:m,u_tl_parent:t,u_scale_parent:s,u_buffer_scale:1,u_fade_t:c.mix,u_opacity:c.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(x=u.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(p=u.paint.get("raster-contrast"),p>0?1/(1-p):1+p),u_spin_weights:Bp(u.paint.get("raster-hue-rotate"))};var p,x};function Bp(m){m*=Math.PI/180;const t=Math.sin(m),s=Math.cos(m);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const cd=(m,t,s,c,u,p,x,S,A,z,D,I,B,U)=>{const j=x.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:j.cameraToCenterDistance,u_pitch:j.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:j.width/j.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:A,u_coord_matrix:z,u_is_text:+I,u_pitch_with_map:+c,u_is_along_line:u,u_is_variable_anchor:p,u_texsize:B,u_texture:0,u_translation:D,u_pitched_scale:U}},bo=(m,t,s,c,u,p,x,S,A,z,D,I,B,U,j)=>{const X=x.transform;return f.e(cd(m,t,s,c,u,p,x,S,A,z,D,I,B,j),{u_gamma_scale:c?Math.cos(X._pitch)*X.cameraToCenterDistance:1,u_device_pixel_ratio:x.pixelRatio,u_is_halo:+U})},Wc=(m,t,s,c,u,p,x,S,A,z,D,I,B,U)=>f.e(bo(m,t,s,c,u,p,x,S,A,z,D,!0,I,!0,U),{u_texsize_icon:B,u_texture_icon:1}),gl=(m,t,s)=>({u_matrix:m,u_opacity:t,u_color:s}),tu=(m,t,s,c,u,p)=>f.e(function(x,S,A,z){const D=A.imageManager.getPattern(x.from.toString()),I=A.imageManager.getPattern(x.to.toString()),{width:B,height:U}=A.imageManager.getPixelSize(),j=Math.pow(2,z.tileID.overscaledZ),X=z.tileSize*Math.pow(2,A.transform.tileZoom)/j,K=X*(z.tileID.canonical.x+z.tileID.wrap*j),Q=X*z.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:D.tl,u_pattern_br_a:D.br,u_pattern_tl_b:I.tl,u_pattern_br_b:I.br,u_texsize:[B,U],u_mix:S.t,u_pattern_size_a:D.displaySize,u_pattern_size_b:I.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/xe(z,1,A.transform.tileZoom),u_pixel_coord_upper:[K>>16,Q>>16],u_pixel_coord_lower:[65535&K,65535&Q]}}(c,p,s,u),{u_matrix:m,u_opacity:t}),eu={fillExtrusion:(m,t)=>({u_matrix:new f.aJ(m,t.u_matrix),u_lightpos:new f.aN(m,t.u_lightpos),u_lightintensity:new f.aI(m,t.u_lightintensity),u_lightcolor:new f.aN(m,t.u_lightcolor),u_vertical_gradient:new f.aI(m,t.u_vertical_gradient),u_opacity:new f.aI(m,t.u_opacity)}),fillExtrusionPattern:(m,t)=>({u_matrix:new f.aJ(m,t.u_matrix),u_lightpos:new f.aN(m,t.u_lightpos),u_lightintensity:new f.aI(m,t.u_lightintensity),u_lightcolor:new f.aN(m,t.u_lightcolor),u_vertical_gradient:new f.aI(m,t.u_vertical_gradient),u_height_factor:new f.aI(m,t.u_height_factor),u_image:new f.aH(m,t.u_image),u_texsize:new f.aO(m,t.u_texsize),u_pixel_coord_upper:new f.aO(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new f.aO(m,t.u_pixel_coord_lower),u_scale:new f.aN(m,t.u_scale),u_fade:new f.aI(m,t.u_fade),u_opacity:new f.aI(m,t.u_opacity)}),fill:(m,t)=>({u_matrix:new f.aJ(m,t.u_matrix)}),fillPattern:(m,t)=>({u_matrix:new f.aJ(m,t.u_matrix),u_image:new f.aH(m,t.u_image),u_texsize:new f.aO(m,t.u_texsize),u_pixel_coord_upper:new f.aO(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new f.aO(m,t.u_pixel_coord_lower),u_scale:new f.aN(m,t.u_scale),u_fade:new f.aI(m,t.u_fade)}),fillOutline:(m,t)=>({u_matrix:new f.aJ(m,t.u_matrix),u_world:new f.aO(m,t.u_world)}),fillOutlinePattern:(m,t)=>({u_matrix:new f.aJ(m,t.u_matrix),u_world:new f.aO(m,t.u_world),u_image:new f.aH(m,t.u_image),u_texsize:new f.aO(m,t.u_texsize),u_pixel_coord_upper:new f.aO(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new f.aO(m,t.u_pixel_coord_lower),u_scale:new f.aN(m,t.u_scale),u_fade:new f.aI(m,t.u_fade)}),circle:(m,t)=>({u_camera_to_center_distance:new f.aI(m,t.u_camera_to_center_distance),u_scale_with_map:new f.aH(m,t.u_scale_with_map),u_pitch_with_map:new f.aH(m,t.u_pitch_with_map),u_extrude_scale:new f.aO(m,t.u_extrude_scale),u_device_pixel_ratio:new f.aI(m,t.u_device_pixel_ratio),u_matrix:new f.aJ(m,t.u_matrix)}),collisionBox:(m,t)=>({u_matrix:new f.aJ(m,t.u_matrix),u_pixel_extrude_scale:new f.aO(m,t.u_pixel_extrude_scale)}),collisionCircle:(m,t)=>({u_matrix:new f.aJ(m,t.u_matrix),u_inv_matrix:new f.aJ(m,t.u_inv_matrix),u_camera_to_center_distance:new f.aI(m,t.u_camera_to_center_distance),u_viewport_size:new f.aO(m,t.u_viewport_size)}),debug:(m,t)=>({u_color:new f.aL(m,t.u_color),u_matrix:new f.aJ(m,t.u_matrix),u_overlay:new f.aH(m,t.u_overlay),u_overlay_scale:new f.aI(m,t.u_overlay_scale)}),clippingMask:(m,t)=>({u_matrix:new f.aJ(m,t.u_matrix)}),heatmap:(m,t)=>({u_extrude_scale:new f.aI(m,t.u_extrude_scale),u_intensity:new f.aI(m,t.u_intensity),u_matrix:new f.aJ(m,t.u_matrix)}),heatmapTexture:(m,t)=>({u_matrix:new f.aJ(m,t.u_matrix),u_world:new f.aO(m,t.u_world),u_image:new f.aH(m,t.u_image),u_color_ramp:new f.aH(m,t.u_color_ramp),u_opacity:new f.aI(m,t.u_opacity)}),hillshade:(m,t)=>({u_matrix:new f.aJ(m,t.u_matrix),u_image:new f.aH(m,t.u_image),u_latrange:new f.aO(m,t.u_latrange),u_light:new f.aO(m,t.u_light),u_shadow:new f.aL(m,t.u_shadow),u_highlight:new f.aL(m,t.u_highlight),u_accent:new f.aL(m,t.u_accent)}),hillshadePrepare:(m,t)=>({u_matrix:new f.aJ(m,t.u_matrix),u_image:new f.aH(m,t.u_image),u_dimension:new f.aO(m,t.u_dimension),u_zoom:new f.aI(m,t.u_zoom),u_unpack:new f.aK(m,t.u_unpack)}),line:(m,t)=>({u_matrix:new f.aJ(m,t.u_matrix),u_ratio:new f.aI(m,t.u_ratio),u_device_pixel_ratio:new f.aI(m,t.u_device_pixel_ratio),u_units_to_pixels:new f.aO(m,t.u_units_to_pixels)}),lineGradient:(m,t)=>({u_matrix:new f.aJ(m,t.u_matrix),u_ratio:new f.aI(m,t.u_ratio),u_device_pixel_ratio:new f.aI(m,t.u_device_pixel_ratio),u_units_to_pixels:new f.aO(m,t.u_units_to_pixels),u_image:new f.aH(m,t.u_image),u_image_height:new f.aI(m,t.u_image_height)}),linePattern:(m,t)=>({u_matrix:new f.aJ(m,t.u_matrix),u_texsize:new f.aO(m,t.u_texsize),u_ratio:new f.aI(m,t.u_ratio),u_device_pixel_ratio:new f.aI(m,t.u_device_pixel_ratio),u_image:new f.aH(m,t.u_image),u_units_to_pixels:new f.aO(m,t.u_units_to_pixels),u_scale:new f.aN(m,t.u_scale),u_fade:new f.aI(m,t.u_fade)}),lineSDF:(m,t)=>({u_matrix:new f.aJ(m,t.u_matrix),u_ratio:new f.aI(m,t.u_ratio),u_device_pixel_ratio:new f.aI(m,t.u_device_pixel_ratio),u_units_to_pixels:new f.aO(m,t.u_units_to_pixels),u_patternscale_a:new f.aO(m,t.u_patternscale_a),u_patternscale_b:new f.aO(m,t.u_patternscale_b),u_sdfgamma:new f.aI(m,t.u_sdfgamma),u_image:new f.aH(m,t.u_image),u_tex_y_a:new f.aI(m,t.u_tex_y_a),u_tex_y_b:new f.aI(m,t.u_tex_y_b),u_mix:new f.aI(m,t.u_mix)}),raster:(m,t)=>({u_matrix:new f.aJ(m,t.u_matrix),u_tl_parent:new f.aO(m,t.u_tl_parent),u_scale_parent:new f.aI(m,t.u_scale_parent),u_buffer_scale:new f.aI(m,t.u_buffer_scale),u_fade_t:new f.aI(m,t.u_fade_t),u_opacity:new f.aI(m,t.u_opacity),u_image0:new f.aH(m,t.u_image0),u_image1:new f.aH(m,t.u_image1),u_brightness_low:new f.aI(m,t.u_brightness_low),u_brightness_high:new f.aI(m,t.u_brightness_high),u_saturation_factor:new f.aI(m,t.u_saturation_factor),u_contrast_factor:new f.aI(m,t.u_contrast_factor),u_spin_weights:new f.aN(m,t.u_spin_weights)}),symbolIcon:(m,t)=>({u_is_size_zoom_constant:new f.aH(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new f.aH(m,t.u_is_size_feature_constant),u_size_t:new f.aI(m,t.u_size_t),u_size:new f.aI(m,t.u_size),u_camera_to_center_distance:new f.aI(m,t.u_camera_to_center_distance),u_pitch:new f.aI(m,t.u_pitch),u_rotate_symbol:new f.aH(m,t.u_rotate_symbol),u_aspect_ratio:new f.aI(m,t.u_aspect_ratio),u_fade_change:new f.aI(m,t.u_fade_change),u_matrix:new f.aJ(m,t.u_matrix),u_label_plane_matrix:new f.aJ(m,t.u_label_plane_matrix),u_coord_matrix:new f.aJ(m,t.u_coord_matrix),u_is_text:new f.aH(m,t.u_is_text),u_pitch_with_map:new f.aH(m,t.u_pitch_with_map),u_is_along_line:new f.aH(m,t.u_is_along_line),u_is_variable_anchor:new f.aH(m,t.u_is_variable_anchor),u_texsize:new f.aO(m,t.u_texsize),u_texture:new f.aH(m,t.u_texture),u_translation:new f.aO(m,t.u_translation),u_pitched_scale:new f.aI(m,t.u_pitched_scale)}),symbolSDF:(m,t)=>({u_is_size_zoom_constant:new f.aH(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new f.aH(m,t.u_is_size_feature_constant),u_size_t:new f.aI(m,t.u_size_t),u_size:new f.aI(m,t.u_size),u_camera_to_center_distance:new f.aI(m,t.u_camera_to_center_distance),u_pitch:new f.aI(m,t.u_pitch),u_rotate_symbol:new f.aH(m,t.u_rotate_symbol),u_aspect_ratio:new f.aI(m,t.u_aspect_ratio),u_fade_change:new f.aI(m,t.u_fade_change),u_matrix:new f.aJ(m,t.u_matrix),u_label_plane_matrix:new f.aJ(m,t.u_label_plane_matrix),u_coord_matrix:new f.aJ(m,t.u_coord_matrix),u_is_text:new f.aH(m,t.u_is_text),u_pitch_with_map:new f.aH(m,t.u_pitch_with_map),u_is_along_line:new f.aH(m,t.u_is_along_line),u_is_variable_anchor:new f.aH(m,t.u_is_variable_anchor),u_texsize:new f.aO(m,t.u_texsize),u_texture:new f.aH(m,t.u_texture),u_gamma_scale:new f.aI(m,t.u_gamma_scale),u_device_pixel_ratio:new f.aI(m,t.u_device_pixel_ratio),u_is_halo:new f.aH(m,t.u_is_halo),u_translation:new f.aO(m,t.u_translation),u_pitched_scale:new f.aI(m,t.u_pitched_scale)}),symbolTextAndIcon:(m,t)=>({u_is_size_zoom_constant:new f.aH(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new f.aH(m,t.u_is_size_feature_constant),u_size_t:new f.aI(m,t.u_size_t),u_size:new f.aI(m,t.u_size),u_camera_to_center_distance:new f.aI(m,t.u_camera_to_center_distance),u_pitch:new f.aI(m,t.u_pitch),u_rotate_symbol:new f.aH(m,t.u_rotate_symbol),u_aspect_ratio:new f.aI(m,t.u_aspect_ratio),u_fade_change:new f.aI(m,t.u_fade_change),u_matrix:new f.aJ(m,t.u_matrix),u_label_plane_matrix:new f.aJ(m,t.u_label_plane_matrix),u_coord_matrix:new f.aJ(m,t.u_coord_matrix),u_is_text:new f.aH(m,t.u_is_text),u_pitch_with_map:new f.aH(m,t.u_pitch_with_map),u_is_along_line:new f.aH(m,t.u_is_along_line),u_is_variable_anchor:new f.aH(m,t.u_is_variable_anchor),u_texsize:new f.aO(m,t.u_texsize),u_texsize_icon:new f.aO(m,t.u_texsize_icon),u_texture:new f.aH(m,t.u_texture),u_texture_icon:new f.aH(m,t.u_texture_icon),u_gamma_scale:new f.aI(m,t.u_gamma_scale),u_device_pixel_ratio:new f.aI(m,t.u_device_pixel_ratio),u_is_halo:new f.aH(m,t.u_is_halo),u_translation:new f.aO(m,t.u_translation),u_pitched_scale:new f.aI(m,t.u_pitched_scale)}),background:(m,t)=>({u_matrix:new f.aJ(m,t.u_matrix),u_opacity:new f.aI(m,t.u_opacity),u_color:new f.aL(m,t.u_color)}),backgroundPattern:(m,t)=>({u_matrix:new f.aJ(m,t.u_matrix),u_opacity:new f.aI(m,t.u_opacity),u_image:new f.aH(m,t.u_image),u_pattern_tl_a:new f.aO(m,t.u_pattern_tl_a),u_pattern_br_a:new f.aO(m,t.u_pattern_br_a),u_pattern_tl_b:new f.aO(m,t.u_pattern_tl_b),u_pattern_br_b:new f.aO(m,t.u_pattern_br_b),u_texsize:new f.aO(m,t.u_texsize),u_mix:new f.aI(m,t.u_mix),u_pattern_size_a:new f.aO(m,t.u_pattern_size_a),u_pattern_size_b:new f.aO(m,t.u_pattern_size_b),u_scale_a:new f.aI(m,t.u_scale_a),u_scale_b:new f.aI(m,t.u_scale_b),u_pixel_coord_upper:new f.aO(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new f.aO(m,t.u_pixel_coord_lower),u_tile_units_to_pixels:new f.aI(m,t.u_tile_units_to_pixels)}),terrain:(m,t)=>({u_matrix:new f.aJ(m,t.u_matrix),u_texture:new f.aH(m,t.u_texture),u_ele_delta:new f.aI(m,t.u_ele_delta),u_fog_matrix:new f.aJ(m,t.u_fog_matrix),u_fog_color:new f.aL(m,t.u_fog_color),u_fog_ground_blend:new f.aI(m,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new f.aI(m,t.u_fog_ground_blend_opacity),u_horizon_color:new f.aL(m,t.u_horizon_color),u_horizon_fog_blend:new f.aI(m,t.u_horizon_fog_blend)}),terrainDepth:(m,t)=>({u_matrix:new f.aJ(m,t.u_matrix),u_ele_delta:new f.aI(m,t.u_ele_delta)}),terrainCoords:(m,t)=>({u_matrix:new f.aJ(m,t.u_matrix),u_texture:new f.aH(m,t.u_texture),u_terrain_coords_id:new f.aI(m,t.u_terrain_coords_id),u_ele_delta:new f.aI(m,t.u_ele_delta)}),sky:(m,t)=>({u_sky_color:new f.aL(m,t.u_sky_color),u_horizon_color:new f.aL(m,t.u_horizon_color),u_horizon:new f.aI(m,t.u_horizon),u_sky_horizon_blend:new f.aI(m,t.u_sky_horizon_blend)})};class Ma{constructor(t,s,c){this.context=t;const u=t.gl;this.buffer=u.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Op={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class iu{constructor(t,s,c,u){this.length=s.length,this.attributes=c,this.itemSize=s.bytesPerElement,this.dynamicDraw=u,this.context=t;const p=t.gl;this.buffer=p.createBuffer(),t.bindVertexBuffer.set(this.buffer),p.bufferData(p.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let c=0;c<this.attributes.length;c++){const u=s.attributes[this.attributes[c].name];u!==void 0&&t.enableVertexAttribArray(u)}}setVertexAttribPointers(t,s,c){for(let u=0;u<this.attributes.length;u++){const p=this.attributes[u],x=s.attributes[p.name];x!==void 0&&t.vertexAttribPointer(x,p.components,t[Op[p.type]],!1,this.itemSize,p.offset+this.itemSize*(c||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Er=new WeakMap;function rr(m){var t;if(Er.has(m))return Er.get(m);{const s=(t=m.getParameter(m.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Er.set(m,s),s}}class Le{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class _l extends Le{getDefault(){return f.aM.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Fp extends Le{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class us extends Le{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Up extends Le{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ud extends Le{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Np extends Le{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class hd extends Le{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class nu extends Le{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class dd extends Le{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class fd extends Le{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class pd extends Le{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class md extends Le{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Mr extends Le{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class gd extends Le{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Vp extends Le{getDefault(){return f.aM.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class _d extends Le{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class wo extends Le{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class jp extends Le{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class yl extends Le{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class qp extends Le{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Zp extends Le{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class yd extends Le{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class vd extends Le{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class xd extends Le{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class au extends Le{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class bd extends Le{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class vl extends Le{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ga extends Le{getDefault(){return null}set(t){var s;if(t===this.current&&!this.dirty)return;const c=this.gl;rr(c)?c.bindVertexArray(t):(s=c.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class ru extends Le{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class su extends Le{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class ou extends Le{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class xl extends Le{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class lu extends xl{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class zr extends xl{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class cu extends xl{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Gp{constructor(t,s,c,u,p){this.context=t,this.width=s,this.height=c;const x=t.gl,S=this.framebuffer=x.createFramebuffer();if(this.colorAttachment=new lu(t,S),u)this.depthAttachment=p?new cu(t,S):new zr(t,S);else if(p)throw new Error("Stencil cannot be set without depth");if(x.checkFramebufferStatus(x.FRAMEBUFFER)!==x.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,s=this.colorAttachment.get();if(s&&t.deleteTexture(s),this.depthAttachment){const c=this.depthAttachment.get();c&&t.deleteRenderbuffer(c)}t.deleteFramebuffer(this.framebuffer)}}class hi{constructor(t,s,c){this.blendFunction=t,this.blendColor=s,this.mask=c}}hi.Replace=[1,0],hi.disabled=new hi(hi.Replace,f.aM.transparent,[!1,!1,!1,!1]),hi.unblended=new hi(hi.Replace,f.aM.transparent,[!0,!0,!0,!0]),hi.alphaBlended=new hi([1,771],f.aM.transparent,[!0,!0,!0,!0]);class Hp{constructor(t){var s,c;if(this.gl=t,this.clearColor=new _l(this),this.clearDepth=new Fp(this),this.clearStencil=new us(this),this.colorMask=new Up(this),this.depthMask=new ud(this),this.stencilMask=new Np(this),this.stencilFunc=new hd(this),this.stencilOp=new nu(this),this.stencilTest=new dd(this),this.depthRange=new fd(this),this.depthTest=new pd(this),this.depthFunc=new md(this),this.blend=new Mr(this),this.blendFunc=new gd(this),this.blendColor=new Vp(this),this.blendEquation=new _d(this),this.cullFace=new wo(this),this.cullFaceSide=new jp(this),this.frontFace=new yl(this),this.program=new qp(this),this.activeTexture=new Zp(this),this.viewport=new yd(this),this.bindFramebuffer=new vd(this),this.bindRenderbuffer=new xd(this),this.bindTexture=new au(this),this.bindVertexBuffer=new bd(this),this.bindElementBuffer=new vl(this),this.bindVertexArray=new Ga(this),this.pixelStoreUnpack=new ru(this),this.pixelStoreUnpackPremultiplyAlpha=new su(this),this.pixelStoreUnpackFlipY=new ou(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),rr(t)){this.HALF_FLOAT=t.HALF_FLOAT;const u=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=t.RGBA16F)!==null&&s!==void 0?s:u==null?void 0:u.RGBA16F_EXT,this.RGB16F=(c=t.RGB16F)!==null&&c!==void 0?c:u==null?void 0:u.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const u=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=u==null?void 0:u.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s){return new Ma(this,t,s)}createVertexBuffer(t,s,c){return new iu(this,t,s,c)}createRenderbuffer(t,s,c){const u=this.gl,p=u.createRenderbuffer();return this.bindRenderbuffer.set(p),u.renderbufferStorage(u.RENDERBUFFER,t,s,c),this.bindRenderbuffer.set(null),p}createFramebuffer(t,s,c,u){return new Gp(this,t,s,c,u)}clear({color:t,depth:s,stencil:c}){const u=this.gl;let p=0;t&&(p|=u.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(p|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),c!==void 0&&(p|=u.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),u.clear(p)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){f.aE(t.blendFunction,hi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return rr(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var s;return rr(this.gl)?this.gl.deleteVertexArray(t):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class ve{constructor(t,s,c){this.func=t,this.mask=s,this.range=c}}ve.ReadOnly=!1,ve.ReadWrite=!0,ve.disabled=new ve(519,ve.ReadOnly,[0,1]);const bl=7680;class Xe{constructor(t,s,c,u,p,x){this.test=t,this.ref=s,this.mask=c,this.fail=u,this.depthFail=p,this.pass=x}}Xe.disabled=new Xe({func:519,mask:0},0,0,bl,bl,bl);class Ne{constructor(t,s,c){this.enable=t,this.mode=s,this.frontFace=c}}let Cr;function So(m,t,s,c,u){const p=m.context,x=p.gl,S=m.useProgram("collisionBox"),A=[];let z=0,D=0;for(let Q=0;Q<c.length;Q++){const W=c[Q],Z=t.getTile(W).getBucket(s);if(!Z)continue;const at=u?Z.textCollisionBox:Z.iconCollisionBox,ot=Z.collisionCircleArray;if(ot.length>0){const ft=f.H();f.aQ(ft,Z.placementInvProjMatrix,m.transform.glCoordMatrix),f.aQ(ft,ft,Z.placementViewportMatrix),A.push({circleArray:ot,circleOffset:D,transform:W.posMatrix,invTransform:ft,coord:W}),z+=ot.length/4,D=z}at&&S.draw(p,x.LINES,ve.disabled,Xe.disabled,m.colorModeForRenderPass(),Ne.disabled,{u_matrix:W.posMatrix,u_pixel_extrude_scale:[1/(I=m.transform).width,1/I.height]},m.style.map.terrain&&m.style.map.terrain.getTerrainData(W),s.id,at.layoutVertexBuffer,at.indexBuffer,at.segments,null,m.transform.zoom,null,null,at.collisionVertexBuffer)}var I;if(!u||!A.length)return;const B=m.useProgram("collisionCircle"),U=new f.aR;U.resize(4*z),U._trim();let j=0;for(const Q of A)for(let W=0;W<Q.circleArray.length/4;W++){const Z=4*W,at=Q.circleArray[Z+0],ot=Q.circleArray[Z+1],ft=Q.circleArray[Z+2],wt=Q.circleArray[Z+3];U.emplace(j++,at,ot,ft,wt,0),U.emplace(j++,at,ot,ft,wt,1),U.emplace(j++,at,ot,ft,wt,2),U.emplace(j++,at,ot,ft,wt,3)}(!Cr||Cr.length<2*z)&&(Cr=function(Q){const W=2*Q,Z=new f.aT;Z.resize(W),Z._trim();for(let at=0;at<W;at++){const ot=6*at;Z.uint16[ot+0]=4*at+0,Z.uint16[ot+1]=4*at+1,Z.uint16[ot+2]=4*at+2,Z.uint16[ot+3]=4*at+2,Z.uint16[ot+4]=4*at+3,Z.uint16[ot+5]=4*at+0}return Z}(z));const X=p.createIndexBuffer(Cr,!0),K=p.createVertexBuffer(U,f.aS.members,!0);for(const Q of A){const W=Ar(Q.transform,Q.invTransform,m.transform);B.draw(p,x.TRIANGLES,ve.disabled,Xe.disabled,m.colorModeForRenderPass(),Ne.disabled,W,m.style.map.terrain&&m.style.map.terrain.getTerrainData(Q.coord),s.id,K,X,f.a0.simpleSegment(0,2*Q.circleOffset,Q.circleArray.length,Q.circleArray.length/2),null,m.transform.zoom,null,null,null)}K.destroy(),X.destroy()}Ne.disabled=new Ne(!1,1029,2305),Ne.backCCW=new Ne(!0,1029,2305);const To=f.an(new Float32Array(16));function uu(m,t,s,c,u,p){const{horizontalAlign:x,verticalAlign:S}=f.au(m);return new f.P((-(x-.5)*t/u+c[0])*p,(-(S-.5)*s/u+c[1])*p)}function Dr(m,t,s,c,u,p){const x=t.tileAnchorPoint.add(new f.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let S=c.mult(p);s||(S=S.rotate(-u));const A=x.add(S);return $(A.x,A.y,t.labelPlaneMatrix,t.getElevation).point}if(s){const S=yt(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(m),A=Math.atan(S.y/S.x)+(S.x<0?Math.PI:0);return m.add(c.rotate(A))}return m.add(c)}function hs(m,t,s,c,u,p,x,S,A,z,D,I,B,U){const j=m.text.placedSymbolArray,X=m.text.dynamicLayoutVertexArray,K=m.icon.dynamicLayoutVertexArray,Q={};X.clear();for(let W=0;W<j.length;W++){const Z=j.get(W),at=Z.hidden||!Z.crossTileID||m.allowVerticalPlacement&&!Z.placedOrientation?null:c[Z.crossTileID];if(at){const ot=new f.P(Z.anchorX,Z.anchorY),ft={getElevation:U,width:u.width,height:u.height,labelPlaneMatrix:p,lineVertexArray:null,pitchWithMap:s,projection:D,projectionCache:null,tileAnchorPoint:ot,translation:I,unwrappedTileID:B},wt=s?$(ot.x,ot.y,x,U):yt(ot.x,ot.y,ft),Et=P(u.cameraToCenterDistance,wt.signedDistanceFromCamera);let Pt=f.ai(m.textSizeData,A,Z)*Et/f.ap;s&&(Pt*=m.tilePixelRatio/S);const{width:Ut,height:Dt,anchor:Ct,textOffset:Ht,textBoxScale:oe}=at,kt=uu(Ct,Ut,Dt,Ht,oe,Pt),Bt=D.getPitchedTextCorrection(u,ot.add(new f.P(I[0],I[1])),B),re=Dr(wt.point,ft,t,kt,u.angle,Bt),Je=m.allowVerticalPlacement&&Z.placedOrientation===f.ah.vertical?Math.PI/2:0;for(let de=0;de<Z.numGlyphs;de++)f.aj(X,re,Je);z&&Z.associatedIconIndex>=0&&(Q[Z.associatedIconIndex]={shiftedAnchor:re,angle:Je})}else Wt(Z.numGlyphs,X)}if(z){K.clear();const W=m.icon.placedSymbolArray;for(let Z=0;Z<W.length;Z++){const at=W.get(Z);if(at.hidden)Wt(at.numGlyphs,K);else{const ot=Q[Z];if(ot)for(let ft=0;ft<at.numGlyphs;ft++)f.aj(K,ot.shiftedAnchor,ot.angle);else Wt(at.numGlyphs,K)}}m.icon.dynamicLayoutVertexBuffer.updateData(K)}m.text.dynamicLayoutVertexBuffer.updateData(X)}function Vn(m,t,s){return s.iconsInText&&t?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function hu(m,t,s,c,u,p,x,S,A,z,D,I){const B=m.context,U=B.gl,j=m.transform,X=Sr(),K=S==="map",Q=A==="map",W=S!=="viewport"&&s.layout.get("symbol-placement")!=="point",Z=K&&!Q&&!W,at=!Q&&W,ot=!s.layout.get("symbol-sort-key").isConstant();let ft=!1;const wt=m.depthModeForSublayer(0,ve.ReadOnly),Et=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Pt=[],Ut=X.getCircleRadiusCorrection(j);for(const Dt of c){const Ct=t.getTile(Dt),Ht=Ct.getBucket(s);if(!Ht)continue;const oe=u?Ht.text:Ht.icon;if(!oe||!oe.segments.get().length||!oe.hasVisibleVertices)continue;const kt=oe.programConfigurations.get(s.id),Bt=u||Ht.sdfIcons,re=u?Ht.textSizeData:Ht.iconSizeData,Je=Q||j.pitch!==0,de=m.useProgram(Vn(Bt,u,Ht),kt),be=f.ag(re,j.zoom),We=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Dt);let Hi,sa,ti,_n,on=[0,0],Xi=null;if(u)sa=Ct.glyphAtlasTexture,ti=U.LINEAR,Hi=Ct.glyphAtlasTexture.size,Ht.iconsInText&&(on=Ct.imageAtlasTexture.size,Xi=Ct.imageAtlasTexture,_n=Je||m.options.rotating||m.options.zooming||re.kind==="composite"||re.kind==="camera"?U.LINEAR:U.NEAREST);else{const Se=s.layout.get("icon-size").constantOr(0)!==1||Ht.iconsNeedLinear;sa=Ct.imageAtlasTexture,ti=Bt||m.options.rotating||m.options.zooming||Se||Je?U.LINEAR:U.NEAREST,Hi=Ct.imageAtlasTexture.size}const ln=xe(Ct,1,m.transform.zoom),Da=at?Dt.posMatrix:To,Ms=nr(Da,Q,K,m.transform,ln),Nl=Ea(Da,Q,K,m.transform,ln),zs=Ea(Dt.posMatrix,Q,K,m.transform,ln),Zn=X.translatePosition(m.transform,Ct,p,x),Vl=Et&&Ht.hasTextData(),Bu=s.layout.get("icon-text-fit")!=="none"&&Vl&&Ht.hasIconData();if(W){const Se=m.style.map.terrain?(Cs,Ds)=>m.style.map.terrain.getElevation(Dt,Cs,Ds):null,Lr=s.layout.get("text-rotation-alignment")==="map";N(Ht,Dt.posMatrix,m,u,Ms,zs,Q,z,Lr,X,Dt.toUnwrapped(),j.width,j.height,Zn,Se)}const Gn=Dt.posMatrix,Hn=u&&Et||Bu,sr=W||Hn?To:Ms,oa=Nl,Fi=Bt&&s.paint.get(u?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let $i;$i=Bt?Ht.iconsInText?Wc(re.kind,be,Z,Q,W,Hn,m,Gn,sr,oa,Zn,Hi,on,Ut):bo(re.kind,be,Z,Q,W,Hn,m,Gn,sr,oa,Zn,u,Hi,!0,Ut):cd(re.kind,be,Z,Q,W,Hn,m,Gn,sr,oa,Zn,u,Hi,Ut);const Rn={program:de,buffers:oe,uniformValues:$i,atlasTexture:sa,atlasTextureIcon:Xi,atlasInterpolation:ti,atlasInterpolationIcon:_n,isSDF:Bt,hasHalo:Fi};if(ot&&Ht.canOverlap){ft=!0;const Se=oe.segments.get();for(const Lr of Se)Pt.push({segments:new f.a0([Lr]),sortKey:Lr.sortKey,state:Rn,terrainData:We})}else Pt.push({segments:oe.segments,sortKey:0,state:Rn,terrainData:We})}ft&&Pt.sort((Dt,Ct)=>Dt.sortKey-Ct.sortKey);for(const Dt of Pt){const Ct=Dt.state;if(B.activeTexture.set(U.TEXTURE0),Ct.atlasTexture.bind(Ct.atlasInterpolation,U.CLAMP_TO_EDGE),Ct.atlasTextureIcon&&(B.activeTexture.set(U.TEXTURE1),Ct.atlasTextureIcon&&Ct.atlasTextureIcon.bind(Ct.atlasInterpolationIcon,U.CLAMP_TO_EDGE)),Ct.isSDF){const Ht=Ct.uniformValues;Ct.hasHalo&&(Ht.u_is_halo=1,du(Ct.buffers,Dt.segments,s,m,Ct.program,wt,D,I,Ht,Dt.terrainData)),Ht.u_is_halo=0}du(Ct.buffers,Dt.segments,s,m,Ct.program,wt,D,I,Ct.uniformValues,Dt.terrainData)}}function du(m,t,s,c,u,p,x,S,A,z){const D=c.context;u.draw(D,D.gl.TRIANGLES,p,x,S,Ne.disabled,A,z,s.id,m.layoutVertexBuffer,m.indexBuffer,t,s.paint,c.transform.zoom,m.programConfigurations.get(s.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function fu(m,t,s,c){const u=m.context,p=u.gl,x=Xe.disabled,S=new hi([p.ONE,p.ONE],f.aM.transparent,[!0,!0,!0,!0]),A=t.getBucket(s);if(!A)return;const z=c.key;let D=s.heatmapFbos.get(z);D||(D=Ao(u,t.tileSize,t.tileSize),s.heatmapFbos.set(z,D)),u.bindFramebuffer.set(D.framebuffer),u.viewport.set([0,0,t.tileSize,t.tileSize]),u.clear({color:f.aM.transparent});const I=A.programConfigurations.get(s.id),B=m.useProgram("heatmap",I),U=m.style.map.terrain.getTerrainData(c);B.draw(u,p.TRIANGLES,ve.disabled,x,S,Ne.disabled,gn(c.posMatrix,t,m.transform.zoom,s.paint.get("heatmap-intensity")),U,s.id,A.layoutVertexBuffer,A.indexBuffer,A.segments,s.paint,m.transform.zoom,I)}function Ir(m,t,s){const c=m.context,u=c.gl;c.setColorMode(m.colorModeForRenderPass());const p=Eo(c,t),x=s.key,S=t.heatmapFbos.get(x);S&&(c.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,S.colorAttachment.get()),c.activeTexture.set(u.TEXTURE1),p.bind(u.LINEAR,u.CLAMP_TO_EDGE),m.useProgram("heatmapTexture").draw(c,u.TRIANGLES,ve.disabled,Xe.disabled,m.colorModeForRenderPass(),Ne.disabled,fl(m,t,0,1),null,t.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,t.paint,m.transform.zoom),S.destroy(),t.heatmapFbos.delete(x))}function Ao(m,t,s){var c,u;const p=m.gl,x=p.createTexture();p.bindTexture(p.TEXTURE_2D,x),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR);const S=(c=m.HALF_FLOAT)!==null&&c!==void 0?c:p.UNSIGNED_BYTE,A=(u=m.RGBA16F)!==null&&u!==void 0?u:p.RGBA;p.texImage2D(p.TEXTURE_2D,0,A,t,s,0,p.RGBA,S,null);const z=m.createFramebuffer(t,s,!1,!1);return z.colorAttachment.set(x),z}function Eo(m,t){return t.colorRampTexture||(t.colorRampTexture=new me(m,t.colorRamp,m.gl.RGBA)),t.colorRampTexture}function ds(m,t,s,c,u){if(!s||!c||!c.imageAtlas)return;const p=c.imageAtlas.patternPositions;let x=p[s.to.toString()],S=p[s.from.toString()];if(!x&&S&&(x=S),!S&&x&&(S=x),!x||!S){const A=u.getPaintProperty(t);x=p[A],S=p[A]}x&&S&&m.setConstantPatternPositions(x,S)}function Mo(m,t,s,c,u,p,x){const S=m.context.gl,A="fill-pattern",z=s.paint.get(A),D=z&&z.constantOr(1),I=s.getCrossfadeParameters();let B,U,j,X,K;x?(U=D&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=S.LINES):(U=D?"fillPattern":"fill",B=S.TRIANGLES);const Q=z.constantOr(null);for(const W of c){const Z=t.getTile(W);if(D&&!Z.patternsLoaded())continue;const at=Z.getBucket(s);if(!at)continue;const ot=at.programConfigurations.get(s.id),ft=m.useProgram(U,ot),wt=m.style.map.terrain&&m.style.map.terrain.getTerrainData(W);D&&(m.context.activeTexture.set(S.TEXTURE0),Z.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),ot.updatePaintBuffers(I)),ds(ot,A,Q,Z,s);const Et=wt?W:null,Pt=m.translatePosMatrix(Et?Et.posMatrix:W.posMatrix,Z,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(x){X=at.indexBuffer2,K=at.segments2;const Ut=[S.drawingBufferWidth,S.drawingBufferHeight];j=U==="fillOutlinePattern"&&D?rd(Pt,m,I,Z,Ut):kp(Pt,Ut)}else X=at.indexBuffer,K=at.segments,j=D?ad(Pt,m,I,Z):ls(Pt);ft.draw(m.context,B,u,m.stencilModeForClipping(W),p,Ne.disabled,j,wt,s.id,at.layoutVertexBuffer,X,K,s.paint,m.transform.zoom,ot)}}function wl(m,t,s,c,u,p,x){const S=m.context,A=S.gl,z="fill-extrusion-pattern",D=s.paint.get(z),I=D.constantOr(1),B=s.getCrossfadeParameters(),U=s.paint.get("fill-extrusion-opacity"),j=D.constantOr(null);for(const X of c){const K=t.getTile(X),Q=K.getBucket(s);if(!Q)continue;const W=m.style.map.terrain&&m.style.map.terrain.getTerrainData(X),Z=Q.programConfigurations.get(s.id),at=m.useProgram(I?"fillExtrusionPattern":"fillExtrusion",Z);I&&(m.context.activeTexture.set(A.TEXTURE0),K.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),Z.updatePaintBuffers(B)),ds(Z,z,j,K,s);const ot=m.translatePosMatrix(X.posMatrix,K,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),ft=s.paint.get("fill-extrusion-vertical-gradient"),wt=I?dl(ot,m,ft,U,X,B,K):vo(ot,m,ft,U);at.draw(S,S.gl.TRIANGLES,u,p,x,Ne.backCCW,wt,W,s.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,s.paint,m.transform.zoom,Z,m.style.map.terrain&&Q.centroidVertexBuffer)}}function fs(m,t,s,c,u,p,x){const S=m.context,A=S.gl,z=s.fbo;if(!z)return;const D=m.useProgram("hillshade"),I=m.style.map.terrain&&m.style.map.terrain.getTerrainData(t);S.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,z.colorAttachment.get()),D.draw(S,A.TRIANGLES,u,p,x,Ne.disabled,((B,U,j,X)=>{const K=j.paint.get("hillshade-shadow-color"),Q=j.paint.get("hillshade-highlight-color"),W=j.paint.get("hillshade-accent-color");let Z=j.paint.get("hillshade-illumination-direction")*(Math.PI/180);j.paint.get("hillshade-illumination-anchor")==="viewport"&&(Z-=B.transform.angle);const at=!B.options.moving;return{u_matrix:X?X.posMatrix:B.transform.calculatePosMatrix(U.tileID.toUnwrapped(),at),u_image:0,u_latrange:pl(0,U.tileID),u_light:[j.paint.get("hillshade-exaggeration"),Z],u_shadow:K,u_highlight:Q,u_accent:W}})(m,s,c,I?t:null),I,c.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}function ps(m,t,s,c,u,p){const x=m.context,S=x.gl,A=t.dem;if(A&&A.data){const z=A.dim,D=A.stride,I=A.getPixels();if(x.activeTexture.set(S.TEXTURE1),x.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||m.getTileTexture(D),t.demTexture){const U=t.demTexture;U.update(I,{premultiply:!1}),U.bind(S.NEAREST,S.CLAMP_TO_EDGE)}else t.demTexture=new me(x,I,S.RGBA,{premultiply:!1}),t.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);x.activeTexture.set(S.TEXTURE0);let B=t.fbo;if(!B){const U=new me(x,{width:z,height:z,data:null},S.RGBA);U.bind(S.LINEAR,S.CLAMP_TO_EDGE),B=t.fbo=x.createFramebuffer(z,z,!0,!1),B.colorAttachment.set(U.texture)}x.bindFramebuffer.set(B.framebuffer),x.viewport.set([0,0,z,z]),m.useProgram("hillshadePrepare").draw(x,S.TRIANGLES,c,u,p,Ne.disabled,((U,j)=>{const X=j.stride,K=f.H();return f.aP(K,0,f.X,-f.X,0,0,1),f.J(K,K,[0,-f.X,0]),{u_matrix:K,u_image:1,u_dimension:[X,X],u_zoom:U.overscaledZ,u_unpack:j.getUnpackVector()}})(t.tileID,A),null,s.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function wd(m,t,s,c,u,p){const x=c.paint.get("raster-fade-duration");if(!p&&x>0){const S=tt.now(),A=(S-m.timeAdded)/x,z=t?(S-t.timeAdded)/x:-1,D=s.getSource(),I=u.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),B=!t||Math.abs(t.tileID.overscaledZ-I)>Math.abs(m.tileID.overscaledZ-I),U=B&&m.refreshedUponExpiration?1:f.ac(B?A:1-z,0,1);return m.refreshedUponExpiration&&A>=1&&(m.refreshedUponExpiration=!1),t?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}const pu=new f.aM(1,0,0,1),De=new f.aM(0,1,0,1),Sl=new f.aM(0,0,1,1),Xp=new f.aM(1,0,1,1),Sd=new f.aM(0,1,1,1);function ms(m,t,s,c){Tl(m,0,t+s/2,m.transform.width,s,c)}function Td(m,t,s,c){Tl(m,t-s/2,0,s,m.transform.height,c)}function Tl(m,t,s,c,u,p){const x=m.context,S=x.gl;S.enable(S.SCISSOR_TEST),S.scissor(t*m.pixelRatio,s*m.pixelRatio,c*m.pixelRatio,u*m.pixelRatio),x.clear({color:p}),S.disable(S.SCISSOR_TEST)}function Ad(m,t,s){const c=m.context,u=c.gl,p=s.posMatrix,x=m.useProgram("debug"),S=ve.disabled,A=Xe.disabled,z=m.colorModeForRenderPass(),D="$debug",I=m.style.map.terrain&&m.style.map.terrain.getTerrainData(s);c.activeTexture.set(u.TEXTURE0);const B=t.getTileByID(s.key).latestRawTileData,U=Math.floor((B&&B.byteLength||0)/1024),j=t.getTile(s).tileSize,X=512/Math.min(j,512)*(s.overscaledZ/m.transform.zoom)*.5;let K=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(K+=` => ${s.overscaledZ}`),function(Q,W){Q.initDebugOverlayCanvas();const Z=Q.debugOverlayCanvas,at=Q.context.gl,ot=Q.debugOverlayCanvas.getContext("2d");ot.clearRect(0,0,Z.width,Z.height),ot.shadowColor="white",ot.shadowBlur=2,ot.lineWidth=1.5,ot.strokeStyle="white",ot.textBaseline="top",ot.font="bold 36px Open Sans, sans-serif",ot.fillText(W,5,5),ot.strokeText(W,5,5),Q.debugOverlayTexture.update(Z),Q.debugOverlayTexture.bind(at.LINEAR,at.CLAMP_TO_EDGE)}(m,`${K} ${U}kB`),x.draw(c,u.TRIANGLES,S,A,hi.alphaBlended,Ne.disabled,xo(p,f.aM.transparent,X),null,D,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),x.draw(c,u.LINE_STRIP,S,A,z,Ne.disabled,xo(p,f.aM.red),I,D,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function Ed(m,t,s){const c=m.context,u=c.gl,p=m.colorModeForRenderPass(),x=new ve(u.LEQUAL,ve.ReadWrite,m.depthRangeFor3D),S=m.useProgram("terrain"),A=t.getTerrainMesh();c.bindFramebuffer.set(null),c.viewport.set([0,0,m.width,m.height]);for(const z of s){const D=m.renderToTexture.getTexture(z),I=t.getTerrainData(z.tileID);c.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,D.texture);const B=m.transform.calculatePosMatrix(z.tileID.toUnwrapped()),U=t.getMeshFrameDelta(m.transform.zoom),j=m.transform.calculateFogMatrix(z.tileID.toUnwrapped()),X=Qc(B,U,j,m.style.sky,m.transform.pitch);S.draw(c,u.TRIANGLES,x,Xe.disabled,p,Ne.backCCW,X,I,"terrain",A.vertexBuffer,A.indexBuffer,A.segments)}}class Al{constructor(t,s,c){this.vertexBuffer=t,this.indexBuffer=s,this.segments=c}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class El{constructor(t,s){this.context=new Hp(t),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:f.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ae.maxUnderzooming+ae.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Yc}resize(t,s,c){if(this.width=Math.floor(t*c),this.height=Math.floor(s*c),this.pixelRatio=c,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style._order)this.style._layers[u].resize()}setup(){const t=this.context,s=new f.aX;s.emplaceBack(0,0),s.emplaceBack(f.X,0),s.emplaceBack(0,f.X),s.emplaceBack(f.X,f.X),this.tileExtentBuffer=t.createVertexBuffer(s,Tr.members),this.tileExtentSegments=f.a0.simpleSegment(0,0,4,2);const c=new f.aX;c.emplaceBack(0,0),c.emplaceBack(f.X,0),c.emplaceBack(0,f.X),c.emplaceBack(f.X,f.X),this.debugBuffer=t.createVertexBuffer(c,Tr.members),this.debugSegments=f.a0.simpleSegment(0,0,4,5);const u=new f.$;u.emplaceBack(0,0,0,0),u.emplaceBack(f.X,0,f.X,0),u.emplaceBack(0,f.X,0,f.X),u.emplaceBack(f.X,f.X,f.X,f.X),this.rasterBoundsBuffer=t.createVertexBuffer(u,er.members),this.rasterBoundsSegments=f.a0.simpleSegment(0,0,4,2);const p=new f.aX;p.emplaceBack(0,0),p.emplaceBack(1,0),p.emplaceBack(0,1),p.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(p,Tr.members),this.viewportSegments=f.a0.simpleSegment(0,0,4,2);const x=new f.aZ;x.emplaceBack(0),x.emplaceBack(1),x.emplaceBack(3),x.emplaceBack(2),x.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(x);const S=new f.aY;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(S);const A=this.context.gl;this.stencilClearMode=new Xe({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO)}clearStencil(){const t=this.context,s=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const c=f.H();f.aP(c,0,this.width,this.height,0,0,1),f.K(c,c,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,s.TRIANGLES,ve.disabled,this.stencilClearMode,hi.disabled,Ne.disabled,mn(c),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,s){if(this.currentStencilSource===t.source||!t.isTileClipped()||!s||!s.length)return;this.currentStencilSource=t.source;const c=this.context,u=c.gl;this.nextStencilID+s.length>256&&this.clearStencil(),c.setColorMode(hi.disabled),c.setDepthMode(ve.disabled);const p=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const x of s){const S=this._tileClippingMaskIDs[x.key]=this.nextStencilID++,A=this.style.map.terrain&&this.style.map.terrain.getTerrainData(x);p.draw(c,u.TRIANGLES,ve.disabled,new Xe({func:u.ALWAYS,mask:0},S,255,u.KEEP,u.KEEP,u.REPLACE),hi.disabled,Ne.disabled,mn(x.posMatrix),A,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new Xe({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){const s=this.context.gl;return new Xe({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,c=t.sort((x,S)=>S.overscaledZ-x.overscaledZ),u=c[c.length-1].overscaledZ,p=c[0].overscaledZ-u+1;if(p>1){this.currentStencilSource=void 0,this.nextStencilID+p>256&&this.clearStencil();const x={};for(let S=0;S<p;S++)x[S+u]=new Xe({func:s.GEQUAL,mask:255},S+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=p,[x,c]}return[{[u]:Xe.disabled},c]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new hi([t.CONSTANT_COLOR,t.ONE],new f.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?hi.unblended:hi.alphaBlended}depthModeForSublayer(t,s,c){if(!this.opaquePassEnabledForLayer())return ve.disabled;const u=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new ve(c||this.context.gl.LEQUAL,s,[u,u])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,s){this.style=t,this.options=s,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(tt.now()),this.imageManager.beginFrame();const c=this.style._order,u=this.style.sourceCaches,p={},x={},S={};for(const A in u){const z=u[A];z.used&&z.prepare(this.context),p[A]=z.getVisibleCoordinates(),x[A]=p[A].slice().reverse(),S[A]=z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<c.length;A++)if(this.style._layers[c[A]].is3D()){this.opaquePassCutoff=A;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const A of c){const z=this.style._layers[A];if(!z.hasOffscreenPass()||z.isHidden(this.transform.zoom))continue;const D=x[z.source];(z.type==="custom"||D.length)&&this.renderLayer(this,u[z.source],z,D)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?f.aM.black:f.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(A,z){const D=A.context,I=D.gl,B=((Q,W,Z)=>({u_sky_color:Q.properties.get("sky-color"),u_horizon_color:Q.properties.get("horizon-color"),u_horizon:(W.height/2+W.getHorizon())*Z,u_sky_horizon_blend:Q.properties.get("sky-horizon-blend")*W.height/2*Z}))(z,A.style.map.transform,A.pixelRatio),U=new ve(I.LEQUAL,ve.ReadWrite,[0,1]),j=Xe.disabled,X=A.colorModeForRenderPass(),K=A.useProgram("sky");if(!z.mesh){const Q=new f.aX;Q.emplaceBack(-1,-1),Q.emplaceBack(1,-1),Q.emplaceBack(1,1),Q.emplaceBack(-1,1);const W=new f.aY;W.emplaceBack(0,1,2),W.emplaceBack(0,2,3),z.mesh=new Al(D.createVertexBuffer(Q,Tr.members),D.createIndexBuffer(W),f.a0.simpleSegment(0,0,Q.length,W.length))}K.draw(D,I.TRIANGLES,U,j,X,Ne.disabled,B,void 0,"sky",z.mesh.vertexBuffer,z.mesh.indexBuffer,z.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=c.length-1;this.currentLayer>=0;this.currentLayer--){const A=this.style._layers[c[this.currentLayer]],z=u[A.source],D=p[A.source];this._renderTileClippingMasks(A,D),this.renderLayer(this,z,A,D)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<c.length;this.currentLayer++){const A=this.style._layers[c[this.currentLayer]],z=u[A.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(A))continue;const D=(A.type==="symbol"?S:x)[A.source];this._renderTileClippingMasks(A,p[A.source]),this.renderLayer(this,z,A,D)}if(this.options.showTileBoundaries){const A=function(z,D){let I=null;const B=Object.values(z._layers).flatMap(K=>K.source&&!K.isHidden(D)?[z.sourceCaches[K.source]]:[]),U=B.filter(K=>K.getSource().type==="vector"),j=B.filter(K=>K.getSource().type!=="vector"),X=K=>{(!I||I.getSource().maxzoom<K.getSource().maxzoom)&&(I=K)};return U.forEach(K=>X(K)),I||j.forEach(K=>X(K)),I}(this.style,this.transform.zoom);A&&function(z,D,I){for(let B=0;B<I.length;B++)Ad(z,D,I[B])}(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(A){const z=A.transform.padding;ms(A,A.transform.height-(z.top||0),3,pu),ms(A,z.bottom||0,3,De),Td(A,z.left||0,3,Sl),Td(A,A.transform.width-(z.right||0),3,Xp);const D=A.transform.centerPoint;(function(I,B,U,j){Tl(I,B-1,U-10,2,20,j),Tl(I,B-10,U-1,20,2,j)})(A,D.x,A.transform.height-D.y,Sd)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const s=this.terrainFacilitator.matrix,c=this.transform.modelViewProjectionMatrix;let u=this.terrainFacilitator.dirty;u||(u=t?!f.a_(s,c):!f.a$(s,c)),u||(u=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),u&&(f.b0(s,c),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(p,x){const S=p.context,A=S.gl,z=hi.unblended,D=new ve(A.LEQUAL,ve.ReadWrite,[0,1]),I=x.getTerrainMesh(),B=x.sourceCache.getRenderableTiles(),U=p.useProgram("terrainDepth");S.bindFramebuffer.set(x.getFramebuffer("depth").framebuffer),S.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),S.clear({color:f.aM.transparent,depth:1});for(const j of B){const X=x.getTerrainData(j.tileID),K={u_matrix:p.transform.calculatePosMatrix(j.tileID.toUnwrapped()),u_ele_delta:x.getMeshFrameDelta(p.transform.zoom)};U.draw(S,A.TRIANGLES,D,Xe.disabled,z,Ne.backCCW,K,X,"terrain",I.vertexBuffer,I.indexBuffer,I.segments)}S.bindFramebuffer.set(null),S.viewport.set([0,0,p.width,p.height])}(this,this.style.map.terrain),function(p,x){const S=p.context,A=S.gl,z=hi.unblended,D=new ve(A.LEQUAL,ve.ReadWrite,[0,1]),I=x.getTerrainMesh(),B=x.getCoordsTexture(),U=x.sourceCache.getRenderableTiles(),j=p.useProgram("terrainCoords");S.bindFramebuffer.set(x.getFramebuffer("coords").framebuffer),S.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),S.clear({color:f.aM.transparent,depth:1}),x.coordsIndex=[];for(const X of U){const K=x.getTerrainData(X.tileID);S.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,B.texture);const Q={u_matrix:p.transform.calculatePosMatrix(X.tileID.toUnwrapped()),u_terrain_coords_id:(255-x.coordsIndex.length)/255,u_texture:0,u_ele_delta:x.getMeshFrameDelta(p.transform.zoom)};j.draw(S,A.TRIANGLES,D,Xe.disabled,z,Ne.backCCW,Q,K,"terrain",I.vertexBuffer,I.indexBuffer,I.segments),x.coordsIndex.push(X.tileID.key)}S.bindFramebuffer.set(null),S.viewport.set([0,0,p.width,p.height])}(this,this.style.map.terrain))}renderLayer(t,s,c,u){if(!c.isHidden(this.transform.zoom)&&(c.type==="background"||c.type==="custom"||(u||[]).length))switch(this.id=c.id,c.type){case"symbol":(function(p,x,S,A,z){if(p.renderPass!=="translucent")return;const D=Xe.disabled,I=p.colorModeForRenderPass();(S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(B,U,j,X,K,Q,W,Z,at){const ot=U.transform,ft=Sr(),wt=K==="map",Et=Q==="map";for(const Pt of B){const Ut=X.getTile(Pt),Dt=Ut.getBucket(j);if(!Dt||!Dt.text||!Dt.text.segments.get().length)continue;const Ct=f.ag(Dt.textSizeData,ot.zoom),Ht=xe(Ut,1,U.transform.zoom),oe=nr(Pt.posMatrix,Et,wt,U.transform,Ht),kt=j.layout.get("icon-text-fit")!=="none"&&Dt.hasIconData();if(Ct){const Bt=Math.pow(2,ot.zoom-Ut.tileID.overscaledZ),re=U.style.map.terrain?(de,be)=>U.style.map.terrain.getElevation(Pt,de,be):null,Je=ft.translatePosition(ot,Ut,W,Z);hs(Dt,wt,Et,at,ot,oe,Pt.posMatrix,Bt,Ct,kt,ft,Je,Pt.toUnwrapped(),re)}}}(A,p,S,x,S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),z),S.paint.get("icon-opacity").constantOr(1)!==0&&hu(p,x,S,A,!1,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),S.layout.get("icon-rotation-alignment"),S.layout.get("icon-pitch-alignment"),S.layout.get("icon-keep-upright"),D,I),S.paint.get("text-opacity").constantOr(1)!==0&&hu(p,x,S,A,!0,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.layout.get("text-keep-upright"),D,I),x.map.showCollisionBoxes&&(So(p,x,S,A,!0),So(p,x,S,A,!1))})(t,s,c,u,this.style.placement.variableOffsets);break;case"circle":(function(p,x,S,A){if(p.renderPass!=="translucent")return;const z=S.paint.get("circle-opacity"),D=S.paint.get("circle-stroke-width"),I=S.paint.get("circle-stroke-opacity"),B=!S.layout.get("circle-sort-key").isConstant();if(z.constantOr(1)===0&&(D.constantOr(1)===0||I.constantOr(1)===0))return;const U=p.context,j=U.gl,X=p.depthModeForSublayer(0,ve.ReadOnly),K=Xe.disabled,Q=p.colorModeForRenderPass(),W=[];for(let Z=0;Z<A.length;Z++){const at=A[Z],ot=x.getTile(at),ft=ot.getBucket(S);if(!ft)continue;const wt=ft.programConfigurations.get(S.id),Et=p.useProgram("circle",wt),Pt=ft.layoutVertexBuffer,Ut=ft.indexBuffer,Dt=p.style.map.terrain&&p.style.map.terrain.getTerrainData(at),Ct={programConfiguration:wt,program:Et,layoutVertexBuffer:Pt,indexBuffer:Ut,uniformValues:Rp(p,at,ot,S),terrainData:Dt};if(B){const Ht=ft.segments.get();for(const oe of Ht)W.push({segments:new f.a0([oe]),sortKey:oe.sortKey,state:Ct})}else W.push({segments:ft.segments,sortKey:0,state:Ct})}B&&W.sort((Z,at)=>Z.sortKey-at.sortKey);for(const Z of W){const{programConfiguration:at,program:ot,layoutVertexBuffer:ft,indexBuffer:wt,uniformValues:Et,terrainData:Pt}=Z.state;ot.draw(U,j.TRIANGLES,X,K,Q,Ne.disabled,Et,Pt,S.id,ft,wt,Z.segments,S.paint,p.transform.zoom,at)}})(t,s,c,u);break;case"heatmap":(function(p,x,S,A){if(S.paint.get("heatmap-opacity")===0)return;const z=p.context;if(p.style.map.terrain){for(const D of A){const I=x.getTile(D);x.hasRenderableParent(D)||(p.renderPass==="offscreen"?fu(p,I,S,D):p.renderPass==="translucent"&&Ir(p,S,D))}z.viewport.set([0,0,p.width,p.height])}else p.renderPass==="offscreen"?function(D,I,B,U){const j=D.context,X=j.gl,K=Xe.disabled,Q=new hi([X.ONE,X.ONE],f.aM.transparent,[!0,!0,!0,!0]);(function(W,Z,at){const ot=W.gl;W.activeTexture.set(ot.TEXTURE1),W.viewport.set([0,0,Z.width/4,Z.height/4]);let ft=at.heatmapFbos.get(f.aU);ft?(ot.bindTexture(ot.TEXTURE_2D,ft.colorAttachment.get()),W.bindFramebuffer.set(ft.framebuffer)):(ft=Ao(W,Z.width/4,Z.height/4),at.heatmapFbos.set(f.aU,ft))})(j,D,B),j.clear({color:f.aM.transparent});for(let W=0;W<U.length;W++){const Z=U[W];if(I.hasRenderableParent(Z))continue;const at=I.getTile(Z),ot=at.getBucket(B);if(!ot)continue;const ft=ot.programConfigurations.get(B.id),wt=D.useProgram("heatmap",ft),{zoom:Et}=D.transform;wt.draw(j,X.TRIANGLES,ve.disabled,K,Q,Ne.disabled,gn(Z.posMatrix,at,Et,B.paint.get("heatmap-intensity")),null,B.id,ot.layoutVertexBuffer,ot.indexBuffer,ot.segments,B.paint,D.transform.zoom,ft)}j.viewport.set([0,0,D.width,D.height])}(p,x,S,A):p.renderPass==="translucent"&&function(D,I){const B=D.context,U=B.gl;B.setColorMode(D.colorModeForRenderPass());const j=I.heatmapFbos.get(f.aU);j&&(B.activeTexture.set(U.TEXTURE0),U.bindTexture(U.TEXTURE_2D,j.colorAttachment.get()),B.activeTexture.set(U.TEXTURE1),Eo(B,I).bind(U.LINEAR,U.CLAMP_TO_EDGE),D.useProgram("heatmapTexture").draw(B,U.TRIANGLES,ve.disabled,Xe.disabled,D.colorModeForRenderPass(),Ne.disabled,fl(D,I,0,1),null,I.id,D.viewportBuffer,D.quadTriangleIndexBuffer,D.viewportSegments,I.paint,D.transform.zoom))}(p,S)})(t,s,c,u);break;case"line":(function(p,x,S,A){if(p.renderPass!=="translucent")return;const z=S.paint.get("line-opacity"),D=S.paint.get("line-width");if(z.constantOr(1)===0||D.constantOr(1)===0)return;const I=p.depthModeForSublayer(0,ve.ReadOnly),B=p.colorModeForRenderPass(),U=S.paint.get("line-dasharray"),j=S.paint.get("line-pattern"),X=j.constantOr(1),K=S.paint.get("line-gradient"),Q=S.getCrossfadeParameters(),W=X?"linePattern":U?"lineSDF":K?"lineGradient":"line",Z=p.context,at=Z.gl;let ot=!0;for(const ft of A){const wt=x.getTile(ft);if(X&&!wt.patternsLoaded())continue;const Et=wt.getBucket(S);if(!Et)continue;const Pt=Et.programConfigurations.get(S.id),Ut=p.context.program.get(),Dt=p.useProgram(W,Pt),Ct=ot||Dt.program!==Ut,Ht=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ft),oe=j.constantOr(null);if(oe&&wt.imageAtlas){const re=wt.imageAtlas,Je=re.patternPositions[oe.to.toString()],de=re.patternPositions[oe.from.toString()];Je&&de&&Pt.setConstantPatternPositions(Je,de)}const kt=Ht?ft:null,Bt=X?cs(p,wt,S,Q,kt):U?Pp(p,wt,S,U,Q,kt):K?sd(p,wt,S,Et.lineClipsArray.length,kt):ml(p,wt,S,kt);if(X)Z.activeTexture.set(at.TEXTURE0),wt.imageAtlasTexture.bind(at.LINEAR,at.CLAMP_TO_EDGE),Pt.updatePaintBuffers(Q);else if(U&&(Ct||p.lineAtlas.dirty))Z.activeTexture.set(at.TEXTURE0),p.lineAtlas.bind(Z);else if(K){const re=Et.gradients[S.id];let Je=re.texture;if(S.gradientVersion!==re.version){let de=256;if(S.stepInterpolant){const be=x.getSource().maxzoom,We=ft.canonical.z===be?Math.ceil(1<<p.transform.maxZoom-ft.canonical.z):1;de=f.ac(f.aV(Et.maxLineLength/f.X*1024*We),256,Z.maxTextureSize)}re.gradient=f.aW({expression:S.gradientExpression(),evaluationKey:"lineProgress",resolution:de,image:re.gradient||void 0,clips:Et.lineClipsArray}),re.texture?re.texture.update(re.gradient):re.texture=new me(Z,re.gradient,at.RGBA),re.version=S.gradientVersion,Je=re.texture}Z.activeTexture.set(at.TEXTURE0),Je.bind(S.stepInterpolant?at.NEAREST:at.LINEAR,at.CLAMP_TO_EDGE)}Dt.draw(Z,at.TRIANGLES,I,p.stencilModeForClipping(ft),B,Ne.disabled,Bt,Ht,S.id,Et.layoutVertexBuffer,Et.indexBuffer,Et.segments,S.paint,p.transform.zoom,Pt,Et.layoutVertexBuffer2),ot=!1}})(t,s,c,u);break;case"fill":(function(p,x,S,A){const z=S.paint.get("fill-color"),D=S.paint.get("fill-opacity");if(D.constantOr(1)===0)return;const I=p.colorModeForRenderPass(),B=S.paint.get("fill-pattern"),U=p.opaquePassEnabledForLayer()&&!B.constantOr(1)&&z.constantOr(f.aM.transparent).a===1&&D.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===U){const j=p.depthModeForSublayer(1,p.renderPass==="opaque"?ve.ReadWrite:ve.ReadOnly);Mo(p,x,S,A,j,I,!1)}if(p.renderPass==="translucent"&&S.paint.get("fill-antialias")){const j=p.depthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,ve.ReadOnly);Mo(p,x,S,A,j,I,!0)}})(t,s,c,u);break;case"fill-extrusion":(function(p,x,S,A){const z=S.paint.get("fill-extrusion-opacity");if(z!==0&&p.renderPass==="translucent"){const D=new ve(p.context.gl.LEQUAL,ve.ReadWrite,p.depthRangeFor3D);if(z!==1||S.paint.get("fill-extrusion-pattern").constantOr(1))wl(p,x,S,A,D,Xe.disabled,hi.disabled),wl(p,x,S,A,D,p.stencilModeFor3D(),p.colorModeForRenderPass());else{const I=p.colorModeForRenderPass();wl(p,x,S,A,D,Xe.disabled,I)}}})(t,s,c,u);break;case"hillshade":(function(p,x,S,A){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent")return;const z=p.context,D=p.depthModeForSublayer(0,ve.ReadOnly),I=p.colorModeForRenderPass(),[B,U]=p.renderPass==="translucent"?p.stencilConfigForOverlap(A):[{},A];for(const j of U){const X=x.getTile(j);X.needsHillshadePrepare!==void 0&&X.needsHillshadePrepare&&p.renderPass==="offscreen"?ps(p,X,S,D,Xe.disabled,I):p.renderPass==="translucent"&&fs(p,j,X,S,D,B[j.overscaledZ],I)}z.viewport.set([0,0,p.width,p.height])})(t,s,c,u);break;case"raster":(function(p,x,S,A){if(p.renderPass!=="translucent"||S.paint.get("raster-opacity")===0||!A.length)return;const z=p.context,D=z.gl,I=x.getSource(),B=p.useProgram("raster"),U=p.colorModeForRenderPass(),[j,X]=I instanceof qa?[{},A]:p.stencilConfigForOverlap(A),K=X[X.length-1].overscaledZ,Q=!p.options.moving;for(const W of X){const Z=p.depthModeForSublayer(W.overscaledZ-K,S.paint.get("raster-opacity")===1?ve.ReadWrite:ve.ReadOnly,D.LESS),at=x.getTile(W);at.registerFadeDuration(S.paint.get("raster-fade-duration"));const ot=x.findLoadedParent(W,0),ft=x.findLoadedSibling(W),wt=wd(at,ot||ft||null,x,S,p.transform,p.style.map.terrain);let Et,Pt;const Ut=S.paint.get("raster-resampling")==="nearest"?D.NEAREST:D.LINEAR;z.activeTexture.set(D.TEXTURE0),at.texture.bind(Ut,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),z.activeTexture.set(D.TEXTURE1),ot?(ot.texture.bind(Ut,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),Et=Math.pow(2,ot.tileID.overscaledZ-at.tileID.overscaledZ),Pt=[at.tileID.canonical.x*Et%1,at.tileID.canonical.y*Et%1]):at.texture.bind(Ut,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),at.texture.useMipmap&&z.extTextureFilterAnisotropic&&p.transform.pitch>20&&D.texParameterf(D.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax);const Dt=p.style.map.terrain&&p.style.map.terrain.getTerrainData(W),Ct=Dt?W:null,Ht=Ct?Ct.posMatrix:p.transform.calculatePosMatrix(W.toUnwrapped(),Q),oe=Lp(Ht,Pt||[0,0],Et||1,wt,S);I instanceof qa?B.draw(z,D.TRIANGLES,Z,Xe.disabled,U,Ne.disabled,oe,Dt,S.id,I.boundsBuffer,p.quadTriangleIndexBuffer,I.boundsSegments):B.draw(z,D.TRIANGLES,Z,j[W.overscaledZ],U,Ne.disabled,oe,Dt,S.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}})(t,s,c,u);break;case"background":(function(p,x,S,A){const z=S.paint.get("background-color"),D=S.paint.get("background-opacity");if(D===0)return;const I=p.context,B=I.gl,U=p.transform,j=U.tileSize,X=S.paint.get("background-pattern");if(p.isPatternMissing(X))return;const K=!X&&z.a===1&&D===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==K)return;const Q=Xe.disabled,W=p.depthModeForSublayer(0,K==="opaque"?ve.ReadWrite:ve.ReadOnly),Z=p.colorModeForRenderPass(),at=p.useProgram(X?"backgroundPattern":"background"),ot=A||U.coveringTiles({tileSize:j,terrain:p.style.map.terrain});X&&(I.activeTexture.set(B.TEXTURE0),p.imageManager.bind(p.context));const ft=S.getCrossfadeParameters();for(const wt of ot){const Et=A?wt.posMatrix:p.transform.calculatePosMatrix(wt.toUnwrapped()),Pt=X?tu(Et,D,p,X,{tileID:wt,tileSize:j},ft):gl(Et,D,z),Ut=p.style.map.terrain&&p.style.map.terrain.getTerrainData(wt);at.draw(I,B.TRIANGLES,W,Q,Z,Ne.disabled,Pt,Ut,S.id,p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}})(t,0,c,u);break;case"custom":(function(p,x,S){const A=p.context,z=S.implementation;if(p.renderPass==="offscreen"){const D=z.prerender;D&&(p.setCustomLayerDefaults(),A.setColorMode(p.colorModeForRenderPass()),D.call(z,A.gl,p.transform.customLayerMatrix()),A.setDirty(),p.setBaseState())}else if(p.renderPass==="translucent"){p.setCustomLayerDefaults(),A.setColorMode(p.colorModeForRenderPass()),A.setStencilMode(Xe.disabled);const D=z.renderingMode==="3d"?new ve(p.context.gl.LEQUAL,ve.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,ve.ReadOnly);A.setDepthMode(D),z.render(A.gl,p.transform.customLayerMatrix(),{farZ:p.transform.farZ,nearZ:p.transform.nearZ,fov:p.transform._fov,modelViewProjectionMatrix:p.transform.modelViewProjectionMatrix,projectionMatrix:p.transform.projectionMatrix}),A.setDirty(),p.setBaseState(),A.bindFramebuffer.set(null)}})(t,0,c)}}translatePosMatrix(t,s,c,u,p){if(!c[0]&&!c[1])return t;const x=p?u==="map"?this.transform.angle:0:u==="viewport"?-this.transform.angle:0;if(x){const z=Math.sin(x),D=Math.cos(x);c=[c[0]*D-c[1]*z,c[0]*z+c[1]*D]}const S=[p?c[0]:xe(s,c[0],this.transform.zoom),p?c[1]:xe(s,c[1],this.transform.zoom),0],A=new Float32Array(16);return f.J(A,t,S),A}saveTileTexture(t){const s=this._tileTextures[t.size[0]];s?s.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const s=this.imageManager.getPattern(t.from.toString()),c=this.imageManager.getPattern(t.to.toString());return!s||!c}useProgram(t,s){this.cache=this.cache||{};const c=t+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[c]||(this.cache[c]=new Jc(this.context,ar[t],s,eu[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[c]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new me(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:s}=this.context.gl;return this.width!==t||this.height!==s}}class gs{constructor(t,s){this.points=t,this.planes=s}static fromInvProjectionMatrix(t,s,c){const u=Math.pow(2,c),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const A=1/(S=f.af([],S,t))[3]/s*u;return f.b1(S,S,[A,A,1/S[3],A])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const A=function(B,U){var j=U[0],X=U[1],K=U[2],Q=j*j+X*X+K*K;return Q>0&&(Q=1/Math.sqrt(Q)),B[0]=U[0]*Q,B[1]=U[1]*Q,B[2]=U[2]*Q,B}([],function(B,U,j){var X=U[0],K=U[1],Q=U[2],W=j[0],Z=j[1],at=j[2];return B[0]=K*at-Q*Z,B[1]=Q*W-X*at,B[2]=X*Z-K*W,B}([],Nt([],p[S[0]],p[S[1]]),Nt([],p[S[2]],p[S[1]]))),z=-((D=A)[0]*(I=p[S[1]])[0]+D[1]*I[1]+D[2]*I[2]);var D,I;return A.concat(z)});return new gs(p,x)}}class _s{constructor(t,s){this.min=t,this.max=s,this.center=function(c,u,p){return c[0]=.5*u[0],c[1]=.5*u[1],c[2]=.5*u[2],c}([],function(c,u,p){return c[0]=u[0]+p[0],c[1]=u[1]+p[1],c[2]=u[2]+p[2],c}([],this.min,this.max))}quadrant(t){const s=[t%2==0,t<2],c=Ot(this.min),u=Ot(this.max);for(let p=0;p<s.length;p++)c[p]=s[p]?this.min[p]:this.center[p],u[p]=s[p]?this.center[p]:this.max[p];return u[2]=this.max[2],new _s(c,u)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let c=!0;for(let u=0;u<t.planes.length;u++){const p=t.planes[u];let x=0;for(let S=0;S<s.length;S++)f.b2(p,s[S])>=0&&x++;if(x===0)return 0;x!==s.length&&(c=!1)}if(c)return 2;for(let u=0;u<3;u++){let p=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let S=0;S<t.points.length;S++){const A=t.points[S][u]-this.min[u];p=Math.min(p,A),x=Math.max(x,A)}if(x<0||p>this.max[u]-this.min[u])return 0}return 1}}class ys{constructor(t=0,s=0,c=0,u=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(c)||c<0||isNaN(u)||u<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=c,this.right=u}interpolate(t,s,c){return s.top!=null&&t.top!=null&&(this.top=f.y.number(t.top,s.top,c)),s.bottom!=null&&t.bottom!=null&&(this.bottom=f.y.number(t.bottom,s.bottom,c)),s.left!=null&&t.left!=null&&(this.left=f.y.number(t.left,s.left,c)),s.right!=null&&t.right!=null&&(this.right=f.y.number(t.right,s.right,c)),this}getCenter(t,s){const c=f.ac((this.left+t-this.right)/2,0,t),u=f.ac((this.top+s-this.bottom)/2,0,s);return new f.P(c,u)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ys(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const mu=85.051129;class vs{constructor(t,s,c,u,p){this.tileSize=512,this._renderWorldCopies=p===void 0||!!p,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=c??0,this._maxPitch=u??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new f.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ys,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const t=new vs(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.lngRange=t.lngRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this.minElevationForCurrentTile=t.minElevationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new f.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const s=-f.b3(t,-180,180)*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=function(){var c=new f.A(4);return f.A!=Float32Array&&(c[1]=0,c[2]=0),c[0]=1,c[3]=1,c}(),function(c,u,p){var x=u[0],S=u[1],A=u[2],z=u[3],D=Math.sin(p),I=Math.cos(p);c[0]=x*I+A*D,c[1]=S*I+z*D,c[2]=x*-D+A*I,c[3]=S*-D+z*I}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=f.ac(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.tileZoom=Math.max(0,Math.floor(s)),this.scale=this.zoomScale(s),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,c){this._unmodified=!1,this._edgeInsets.interpolate(t,s,c),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new f.b4(0,t)];if(this._renderWorldCopies){const c=this.pointCoordinate(new f.P(0,0)),u=this.pointCoordinate(new f.P(this.width,0)),p=this.pointCoordinate(new f.P(this.width,this.height)),x=this.pointCoordinate(new f.P(0,this.height)),S=Math.floor(Math.min(c.x,u.x,p.x,x.x)),A=Math.floor(Math.max(c.x,u.x,p.x,x.x)),z=1;for(let D=S-z;D<=A+z;D++)D!==0&&s.push(new f.b4(D,t))}return s}coveringTiles(t){var s,c;let u=this.coveringZoomLevel(t);const p=u;if(t.minzoom!==void 0&&u<t.minzoom)return[];t.maxzoom!==void 0&&u>t.maxzoom&&(u=t.maxzoom);const x=this.pointCoordinate(this.getCameraPoint()),S=f.Z.fromLngLat(this.center),A=Math.pow(2,u),z=[A*x.x,A*x.y,0],D=[A*S.x,A*S.y,0],I=gs.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,u);let B=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(B=u);const U=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,j=Z=>({aabb:new _s([Z*A,0,0],[(Z+1)*A,A,0]),zoom:0,x:0,y:0,wrap:Z,fullyVisible:!1}),X=[],K=[],Q=u,W=t.reparseOverscaled?p:u;if(this._renderWorldCopies)for(let Z=1;Z<=3;Z++)X.push(j(-Z)),X.push(j(Z));for(X.push(j(0));X.length>0;){const Z=X.pop(),at=Z.x,ot=Z.y;let ft=Z.fullyVisible;if(!ft){const Dt=Z.aabb.intersects(I);if(Dt===0)continue;ft=Dt===2}const wt=t.terrain?z:D,Et=Z.aabb.distanceX(wt),Pt=Z.aabb.distanceY(wt),Ut=Math.max(Math.abs(Et),Math.abs(Pt));if(Z.zoom===Q||Ut>U+(1<<Q-Z.zoom)-2&&Z.zoom>=B){const Dt=Q-Z.zoom,Ct=z[0]-.5-(at<<Dt),Ht=z[1]-.5-(ot<<Dt);K.push({tileID:new f.S(Z.zoom===Q?W:Z.zoom,Z.wrap,Z.zoom,at,ot),distanceSq:te([D[0]-.5-at,D[1]-.5-ot]),tileDistanceToCamera:Math.sqrt(Ct*Ct+Ht*Ht)})}else for(let Dt=0;Dt<4;Dt++){const Ct=(at<<1)+Dt%2,Ht=(ot<<1)+(Dt>>1),oe=Z.zoom+1;let kt=Z.aabb.quadrant(Dt);if(t.terrain){const Bt=new f.S(oe,Z.wrap,oe,Ct,Ht),re=t.terrain.getMinMaxElevation(Bt),Je=(s=re.minElevation)!==null&&s!==void 0?s:this.elevation,de=(c=re.maxElevation)!==null&&c!==void 0?c:this.elevation;kt=new _s([kt.min[0],kt.min[1],Je],[kt.max[0],kt.max[1],de])}X.push({aabb:kt,zoom:oe,x:Ct,y:Ht,wrap:Z.wrap,fullyVisible:ft})}}return K.sort((Z,at)=>Z.distanceSq-at.distanceSq).map(Z=>Z.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const s=f.ac(t.lat,-85.051129,mu);return new f.P(f.O(t.lng)*this.worldSize,f.Q(s)*this.worldSize)}unproject(t){return new f.Z(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const s=this.elevation,c=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,u=this.pointLocation(this.centerPoint,t),p=t.getElevationForLngLatZoom(u,this.tileZoom);if(!(this.elevation-p))return;const x=c+s-p,S=Math.cos(this._pitch)*this.cameraToCenterDistance/x/f.b5(1,u.lat),A=this.scaleZoom(S/this.tileSize);this._elevation=p,this._center=u,this.zoom=A}setLocationAtPoint(t,s){const c=this.pointCoordinate(s),u=this.pointCoordinate(this.centerPoint),p=this.locationCoordinate(t),x=new f.Z(p.x-(c.x-u.x),p.y-(c.y-u.y));this.center=this.coordinateLocation(x),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,s){return s?this.coordinatePoint(this.locationCoordinate(t),s.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,s){return this.coordinateLocation(this.pointCoordinate(t,s))}locationCoordinate(t){return f.Z.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,s){if(s){const B=s.pointCoordinate(t);if(B!=null)return B}const c=[t.x,t.y,0,1],u=[t.x,t.y,1,1];f.af(c,c,this.pixelMatrixInverse),f.af(u,u,this.pixelMatrixInverse);const p=c[3],x=u[3],S=c[1]/p,A=u[1]/x,z=c[2]/p,D=u[2]/x,I=z===D?0:(0-z)/(D-z);return new f.Z(f.y.number(c[0]/p,u[0]/x,I)/this.worldSize,f.y.number(S,A,I)/this.worldSize)}coordinatePoint(t,s=0,c=this.pixelMatrix){const u=[t.x*this.worldSize,t.y*this.worldSize,s,1];return f.af(u,u,c),new f.P(u[0]/u[3],u[1]/u[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new gt().extend(this.pointLocation(new f.P(0,t))).extend(this.pointLocation(new f.P(this.width,t))).extend(this.pointLocation(new f.P(this.width,this.height))).extend(this.pointLocation(new f.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new gt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,mu])}calculateTileMatrix(t){const s=t.canonical,c=this.worldSize/this.zoomScale(s.z),u=s.x+Math.pow(2,s.z)*t.wrap,p=f.an(new Float64Array(16));return f.J(p,p,[u*c,s.y*c,0]),f.K(p,p,[c/f.X,c/f.X,1]),p}calculatePosMatrix(t,s=!1){const c=t.key,u=s?this._alignedPosMatrixCache:this._posMatrixCache;if(u[c])return u[c];const p=this.calculateTileMatrix(t);return f.L(p,s?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,p),u[c]=new Float32Array(p),u[c]}calculateFogMatrix(t){const s=t.key,c=this._fogMatrixCache;if(c[s])return c[s];const u=this.calculateTileMatrix(t);return f.L(u,this.fogMatrix,u),c[s]=new Float32Array(u),c[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(t,s){s=f.ac(+s,this.minZoom,this.maxZoom);const c={center:new f.N(t.lng,t.lat),zoom:s};let u=this.lngRange;if(!this._renderWorldCopies&&u===null){const Z=179.9999999999;u=[-Z,Z]}const p=this.tileSize*this.zoomScale(c.zoom);let x=0,S=p,A=0,z=p,D=0,I=0;const{x:B,y:U}=this.size;if(this.latRange){const Z=this.latRange;x=f.Q(Z[1])*p,S=f.Q(Z[0])*p,S-x<U&&(D=U/(S-x))}u&&(A=f.b3(f.O(u[0])*p,0,p),z=f.b3(f.O(u[1])*p,0,p),z<A&&(z+=p),z-A<B&&(I=B/(z-A)));const{x:j,y:X}=this.project.call({worldSize:p},t);let K,Q;const W=Math.max(I||0,D||0);if(W){const Z=new f.P(I?(z+A)/2:j,D?(S+x)/2:X);return c.center=this.unproject.call({worldSize:p},Z).wrap(),c.zoom+=this.scaleZoom(W),c}if(this.latRange){const Z=U/2;X-Z<x&&(Q=x+Z),X+Z>S&&(Q=S-Z)}if(u){const Z=(A+z)/2;let at=j;this._renderWorldCopies&&(at=f.b3(j,Z-p/2,Z+p/2));const ot=B/2;at-ot<A&&(K=A+ot),at+ot>z&&(K=z-ot)}if(K!==void 0||Q!==void 0){const Z=new f.P(K??j,Q??X);c.center=this.unproject.call({worldSize:p},Z).wrap()}return c}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:s,zoom:c}=this.getConstrained(this.center,this.zoom);this.center=s,this.zoom=c,this._unmodified=t,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,s=this.point.x,c=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=f.b5(1,this.center.lat)*this.worldSize;let u=f.an(new Float64Array(16));f.K(u,u,[this.width/2,-this.height/2,1]),f.J(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=f.an(new Float64Array(16)),f.K(u,u,[1,-1,1]),f.J(u,u,[-1,-1,0]),f.K(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u;const p=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),x=Math.min(this.elevation,this.minElevationForCurrentTile),S=p-x*this._pixelPerMeter/Math.cos(this._pitch),A=x<0?S:p,z=Math.PI/2+this._pitch,D=this._fov*(.5+t.y/this.height),I=Math.sin(D)*A/Math.sin(f.ac(Math.PI-z-D,.01,Math.PI-.01)),B=this.getHorizon(),U=2*Math.atan(B/this.cameraToCenterDistance)*(.5+t.y/(2*B)),j=Math.sin(U)*A/Math.sin(f.ac(Math.PI-z-U,.01,Math.PI-.01)),X=Math.min(I,j);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*X+A),this.nearZ=this.height/50,u=new Float64Array(16),f.b6(u,this._fov,this.width/this.height,this.nearZ,this.farZ),u[8]=2*-t.x/this.width,u[9]=2*t.y/this.height,this.projectionMatrix=f.ae(u),f.K(u,u,[1,-1,1]),f.J(u,u,[0,0,-this.cameraToCenterDistance]),f.b7(u,u,this._pitch),f.ad(u,u,this.angle),f.J(u,u,[-s,-c,0]),this.mercatorMatrix=f.K([],u,[this.worldSize,this.worldSize,this.worldSize]),f.K(u,u,[1,1,this._pixelPerMeter]),this.pixelMatrix=f.L(new Float64Array(16),this.labelPlaneMatrix,u),f.J(u,u,[0,0,-this.elevation]),this.modelViewProjectionMatrix=u,this.invModelViewProjectionMatrix=f.as([],u),this.fogMatrix=new Float64Array(16),f.b6(this.fogMatrix,this._fov,this.width/this.height,p,this.farZ),this.fogMatrix[8]=2*-t.x/this.width,this.fogMatrix[9]=2*t.y/this.height,f.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),f.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),f.b7(this.fogMatrix,this.fogMatrix,this._pitch),f.ad(this.fogMatrix,this.fogMatrix,this.angle),f.J(this.fogMatrix,this.fogMatrix,[-s,-c,0]),f.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),f.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=f.L(new Float64Array(16),this.labelPlaneMatrix,u);const K=this.width%2/2,Q=this.height%2/2,W=Math.cos(this.angle),Z=Math.sin(this.angle),at=s-Math.round(s)+W*K+Z*Q,ot=c-Math.round(c)+W*Q+Z*K,ft=new Float64Array(u);if(f.J(ft,ft,[at>.5?at-1:at,ot>.5?ot-1:ot,0]),this.alignedModelViewProjectionMatrix=ft,u=f.as(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");this.pixelMatrixInverse=u,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new f.P(0,0)),s=[t.x*this.worldSize,t.y*this.worldSize,0,1];return f.af(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new f.P(0,t))}getCameraQueryGeometry(t){const s=this.getCameraPoint();if(t.length===1)return[t[0],s];{let c=s.x,u=s.y,p=s.x,x=s.y;for(const S of t)c=Math.min(c,S.x),u=Math.min(u,S.y),p=Math.max(p,S.x),x=Math.max(x,S.y);return[new f.P(c,u),new f.P(p,u),new f.P(p,x),new f.P(c,x),new f.P(c,u)]}}lngLatToCameraDepth(t,s){const c=this.locationCoordinate(t),u=[c.x*this.worldSize,c.y*this.worldSize,s,1];return f.af(u,u,this.modelViewProjectionMatrix),u[2]/u[3]}}function zo(m,t){let s,c=!1,u=null,p=null;const x=()=>{u=null,c&&(m.apply(p,s),u=setTimeout(x,t),c=!1)};return(...S)=>(c=!0,p=this,s=S,u||x(),u)}class Ml{constructor(t){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let c;return s.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(c=u)}),(c&&c[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(s.length>=3&&!s.some(c=>isNaN(c))){const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:c,pitch:+(s[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,s)},this._removeHash=()=>{const s=this._getCurrentHash();if(s.length===0)return;const c=s.join("/");let u=c;u.split("&").length>0&&(u=u.split("&")[0]),this._hashName&&(u=`${this._hashName}=${c}`);let p=window.location.hash.replace(u,"");p.startsWith("#&")?p=p.slice(0,1)+p.slice(2):p==="#"&&(p="");let x=window.location.href.replace(/(#.+)?$/,p);x=x.replace("&&","&"),window.history.replaceState(window.history.state,null,x)},this._updateHash=zo(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const s=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,u=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,u),x=Math.round(s.lng*p)/p,S=Math.round(s.lat*p)/p,A=this._map.getBearing(),z=this._map.getPitch();let D="";if(D+=t?`/${x}/${S}/${c}`:`${c}/${S}/${x}`,(A||z)&&(D+="/"+Math.round(10*A)/10),z&&(D+=`/${Math.round(z)}`),this._hashName){const I=this._hashName;let B=!1;const U=window.location.hash.slice(1).split("&").map(j=>{const X=j.split("=")[0];return X===I?(B=!0,`${X}=${D}`):j}).filter(j=>j);return B||U.push(`${I}=${D}`),`#${U.join("&")}`}return`#${D}`}}const zl={linearity:.3,easing:f.b8(0,0,.3,1)},gu=f.e({deceleration:2500,maxSpeed:1400},zl),$p=f.e({deceleration:20,maxSpeed:1400},zl),Md=f.e({deceleration:1e3,maxSpeed:360},zl),Cl=f.e({deceleration:1e3,maxSpeed:90},zl);class _u{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:tt.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=tt.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new f.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:p}of this._inertiaBuffer)s.zoom+=p.zoomDelta||0,s.bearing+=p.bearingDelta||0,s.pitch+=p.pitchDelta||0,p.panDelta&&s.pan._add(p.panDelta),p.around&&(s.around=p.around),p.pinchAround&&(s.pinchAround=p.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,u={};if(s.pan.mag()){const p=Do(s.pan.mag(),c,f.e({},gu,t||{}));u.offset=s.pan.mult(p.amount/s.pan.mag()),u.center=this._map.transform.center,Co(u,p)}if(s.zoom){const p=Do(s.zoom,c,$p);u.zoom=this._map.transform.zoom+p.amount,Co(u,p)}if(s.bearing){const p=Do(s.bearing,c,Md);u.bearing=this._map.transform.bearing+f.ac(p.amount,-179,179),Co(u,p)}if(s.pitch){const p=Do(s.pitch,c,Cl);u.pitch=this._map.transform.pitch+p.amount,Co(u,p)}if(u.zoom||u.bearing){const p=s.pinchAround===void 0?s.around:s.pinchAround;u.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),f.e(u,{noMoveStart:!0})}}function Co(m,t){(!m.duration||m.duration<t.duration)&&(m.duration=t.duration,m.easing=t.easing)}function Do(m,t,s){const{maxSpeed:c,linearity:u,deceleration:p}=s,x=f.ac(m*u/(t/1e3),-c,c),S=Math.abs(x)/(p*u);return{easing:s.easing,duration:1e3*S,amount:x*(S/2)}}class Gi extends f.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,c,u={}){const p=V.mousePos(s.getCanvas(),c),x=s.unproject(p);super(t,f.e({point:p,lngLat:x,originalEvent:c},u)),this._defaultPrevented=!1,this.target=s}}class kr extends f.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,c){const u=t==="touchend"?c.changedTouches:c.touches,p=V.touchPos(s.getCanvasContainer(),u),x=p.map(A=>s.unproject(A)),S=p.reduce((A,z,D,I)=>A.add(z.div(I.length)),new f.P(0,0));super(t,{points:p,point:S,lngLats:x,lngLat:s.unproject(S),originalEvent:c}),this._defaultPrevented=!1}}class zd extends f.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,c){super(t,{originalEvent:c}),this._defaultPrevented=!1}}class Cd{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new zd(t.type,this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new Gi(t.type,this._map,t))}mouseup(t){this._map.fire(new Gi(t.type,this._map,t))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new Gi(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Gi(t.type,this._map,t))}mouseover(t){this._map.fire(new Gi(t.type,this._map,t))}mouseout(t){this._map.fire(new Gi(t.type,this._map,t))}touchstart(t){return this._firePreventable(new kr(t.type,this._map,t))}touchmove(t){this._map.fire(new kr(t.type,this._map,t))}touchend(t){this._map.fire(new kr(t.type,this._map,t))}touchcancel(t){this._map.fire(new kr(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class di{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Gi(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Gi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Gi(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class aa{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(f.P.convert(t),this._map.terrain)}}class In{constructor(t,s){this._map=t,this._tr=new aa(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(V.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const c=s;if(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)return;const u=this._startPos;this._lastPos=c,this._box||(this._box=V.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const p=Math.min(u.x,c.x),x=Math.max(u.x,c.x),S=Math.min(u.y,c.y),A=Math.max(u.y,c.y);V.setTransform(this._box,`translate(${p}px,${S}px)`),this._box.style.width=x-p+"px",this._box.style.height=A-S+"px"}mouseupWindow(t,s){if(!this._active||t.button!==0)return;const c=this._startPos,u=s;if(this.reset(),V.suppressClick(),c.x!==u.x||c.y!==u.y)return this._map.fire(new f.k("boxzoomend",{originalEvent:t})),{cameraAnimation:p=>p.fitScreenCoordinates(c,u,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(V.remove(this._box),this._box=null),V.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new f.k(t,{originalEvent:s}))}}function Io(m,t){if(m.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${t.length}`);const s={};for(let c=0;c<m.length;c++)s[m[c].identifier]=t[c];return s}class yu{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,s,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),c.length===this.numTouches&&(this.centroid=function(u){const p=new f.P(0,0);for(const x of u)p._add(x);return p.div(u.length)}(s),this.touches=Io(c,s)))}touchmove(t,s,c){if(this.aborted||!this.centroid)return;const u=Io(c,s);for(const p in this.touches){const x=u[p];(!x||x.dist(this.touches[p])>30)&&(this.aborted=!0)}}touchend(t,s,c){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const u=!this.aborted&&this.centroid;if(this.reset(),u)return u}}}class Dl{constructor(t){this.singleTap=new yu(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,s,c){this.singleTap.touchstart(t,s,c)}touchmove(t,s,c){this.singleTap.touchmove(t,s,c)}touchend(t,s,c){const u=this.singleTap.touchend(t,s,c);if(u){const p=t.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(u)<30;if(p&&x||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=u,this.count===this.numTaps)return this.reset(),u}}}class xs{constructor(t){this._tr=new aa(t),this._zoomIn=new Dl({numTouches:1,numTaps:2}),this._zoomOut=new Dl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,c){this._zoomIn.touchstart(t,s,c),this._zoomOut.touchstart(t,s,c)}touchmove(t,s,c){this._zoomIn.touchmove(t,s,c),this._zoomOut.touchmove(t,s,c)}touchend(t,s,c){const u=this._zoomIn.touchend(t,s,c),p=this._zoomOut.touchend(t,s,c),x=this._tr;return u?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:x.zoom+1,around:x.unproject(u)},{originalEvent:t})}):p?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:x.zoom-1,around:x.unproject(p)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ha{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const s=this._moveFunction(...t);if(s.bearingDelta||s.pitchDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(t,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=s.length?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,s){if(!this.isEnabled())return;const c=this._lastPoint;if(!c)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const u=s.length?s[0]:s;return!this._moved&&u.dist(c)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=u,this._move(c,u))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&V.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const vu={0:1,2:2};class Il{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const s=V.mouseButton(t);this._eventButton=s}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(s,c){const u=vu[c];return s.buttons===void 0||(s.buttons&u)!==u}(t,this._eventButton)}isValidEndEvent(t){return V.mouseButton(t)===this._eventButton}}class xu{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const kl=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=t=>{t.preventDefault()}},bu=({enable:m,clickTolerance:t,bearingDegreesPerPixelMoved:s=.8})=>{const c=new Il({checkCorrectEvent:u=>V.mouseButton(u)===0&&u.ctrlKey||V.mouseButton(u)===2});return new Ha({clickTolerance:t,move:(u,p)=>({bearingDelta:(p.x-u.x)*s}),moveStateManager:c,enable:m,assignEvents:kl})},wu=({enable:m,clickTolerance:t,pitchDegreesPerPixelMoved:s=-.5})=>{const c=new Il({checkCorrectEvent:u=>V.mouseButton(u)===0&&u.ctrlKey||V.mouseButton(u)===2});return new Ha({clickTolerance:t,move:(u,p)=>({pitchDelta:(p.y-u.y)*s}),moveStateManager:c,enable:m,assignEvents:kl})};class Rr{constructor(t,s){this._clickTolerance=t.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new f.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,s,c){return this._calculateTransform(t,s,c)}touchmove(t,s,c){if(this._active){if(!this._shouldBePrevented(c.length))return t.preventDefault(),this._calculateTransform(t,s,c);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,s,c){this._calculateTransform(t,s,c),this._active&&this._shouldBePrevented(c.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,c){c.length>0&&(this._active=!0);const u=Io(c,s),p=new f.P(0,0),x=new f.P(0,0);let S=0;for(const z in u){const D=u[z],I=this._touches[z];I&&(p._add(D),x._add(D.sub(I)),S++,u[z]=D)}if(this._touches=u,this._shouldBePrevented(S)||!x.mag())return;const A=x.div(S);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:p.div(S),panDelta:A}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,s,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,c){if(!this._firstTwoTouches)return;t.preventDefault();const[u,p]=this._firstTwoTouches,x=ko(c,s,u),S=ko(c,s,p);if(!x||!S)return;const A=this._aroundCenter?null:x.add(S).div(2);return this._move([x,S],A,t)}touchend(t,s,c){if(!this._firstTwoTouches)return;const[u,p]=this._firstTwoTouches,x=ko(c,s,u),S=ko(c,s,p);x&&S||(this._active&&V.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ko(m,t,s){for(let c=0;c<m.length;c++)if(m[c].identifier===s)return t[c]}function Su(m,t){return Math.log(m/t)/Math.LN2}class Tu extends Rl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const c=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Su(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Su(this._distance,c),pinchAround:s}}}function Au(m,t){return 180*m.angleWith(t)/Math.PI}class Eu extends Rl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s,c){const u=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Au(this._vector,u),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,c=Au(t,this._startVector);return Math.abs(c)<s}}function Pl(m){return Math.abs(m.y)>Math.abs(m.x)}class bs extends Rl{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,s,c){super.touchstart(t,s,c),this._currentTouchCount=c.length}_start(t){this._lastPoints=t,Pl(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,c){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const u=t[0].sub(this._lastPoints[0]),p=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(u,p,c.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(u.y+p.y)/2*-.5}):void 0}gestureBeginsVertically(t,s,c){if(this._valid!==void 0)return this._valid;const u=t.mag()>=2,p=s.mag()>=2;if(!u&&!p)return;if(!u||!p)return this._firstMove===void 0&&(this._firstMove=c),c-this._firstMove<100&&void 0;const x=t.y>0==s.y>0;return Pl(t)&&Pl(s)&&x}}const Dd={panStep:100,bearingStep:15,pitchStep:10};class jn{constructor(t){this._tr=new aa(t);const s=Dd;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,c=0,u=0,p=0,x=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?c=-1:(t.preventDefault(),p=-1);break;case 39:t.shiftKey?c=1:(t.preventDefault(),p=1);break;case 38:t.shiftKey?u=1:(t.preventDefault(),x=-1);break;case 40:t.shiftKey?u=-1:(t.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(c=0,u=0),{cameraAnimation:S=>{const A=this._tr;S.easeTo({duration:300,easeId:"keyboardHandler",easing:za,zoom:s?Math.round(A.zoom)+s*(t.shiftKey?2:1):A.zoom,bearing:A.bearing+c*this._bearingStep,pitch:A.pitch+u*this._pitchStep,offset:[-p*this._panStep,-x*this._panStep],center:A.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function za(m){return m*(2-m)}const Mu=4.000244140625;class ra{constructor(t,s){this._onTimeout=c=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},this._map=t,this._tr=new aa(t),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const c=tt.now(),u=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,s!==0&&s%Mu==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":u>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(u*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=V.mousePos(this._map.getCanvas(),t),c=this._tr;this._around=s.y>c.transform.height/2-c.transform.getHorizon()?f.N.convert(this._aroundCenter?c.center:c.unproject(s)):f.N.convert(c.center),this._aroundPoint=c.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const A=this._type==="wheel"&&Math.abs(this._delta)>Mu?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&z!==0&&(z=1/z);const D=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(D*z))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,c=this._startZoom,u=this._easing;let p,x=!1;const S=tt.now()-this._lastWheelEventTime;if(this._type==="wheel"&&c&&u&&S){const A=Math.min(S/200,1),z=u(A);p=f.y.number(c,s,z),A<1?this._frameId||(this._frameId=!0):x=!0}else p=s,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!x,zoomDelta:p-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=f.b9;if(this._prevEase){const c=this._prevEase,u=(tt.now()-c.start)/c.duration,p=c.easing(u+.01)-c.easing(u),x=.27/Math.sqrt(p*p+1e-4)*.01,S=Math.sqrt(.0729-x*x);s=f.b8(x,S,.25,1)}return this._prevEase={start:tt.now(),duration:t,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Pr{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Yp{constructor(t){this._tr=new aa(t),this.reset()}reset(){this._active=!1}dblclick(t,s){return t.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Kp{constructor(){this._tap=new Dl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,s,c){if(!this._swipePoint)if(this._tapTime){const u=s[0],p=t.timeStamp-this._tapTime<500,x=this._tapPoint.dist(u)<30;p&&x?c.length>0&&(this._swipePoint=u,this._swipeTouch=c[0].identifier):this.reset()}else this._tap.touchstart(t,s,c)}touchmove(t,s,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const u=s[0],p=u.y-this._swipePoint.y;return this._swipePoint=u,t.preventDefault(),this._active=!0,{zoomDelta:p/128}}}else this._tap.touchmove(t,s,c)}touchend(t,s,c){if(this._tapTime)this._swipePoint&&c.length===0&&this.reset();else{const u=this._tap.touchend(t,s,c);u&&(this._tapTime=t.timeStamp,this._tapPoint=u)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Id{constructor(t,s,c){this._el=t,this._mousePan=s,this._touchPan=c}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class kd{constructor(t,s,c){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class zu{constructor(t,s,c,u){this._el=t,this._touchZoom=s,this._touchRotate=c,this._tapDragZoom=u,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ws{constructor(t,s){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=s,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=V.create("div","maplibregl-cooperative-gesture-screen",t);let s=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(s=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const c=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),u=document.createElement("div");u.className="maplibregl-desktop-message",u.textContent=s,this._container.appendChild(u);const p=document.createElement("div");p.className="maplibregl-mobile-message",p.textContent=c,this._container.appendChild(p),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(V.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,s){this._enabled&&(this._map.fire(new f.k("cooperativegestureprevented",{gestureType:t,originalEvent:s})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const qn=m=>m.zoom||m.drag||m.pitch||m.rotate;class jt extends f.k{}function Ll(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Cu{constructor(t,s){this.handleWindowEvent=u=>{this.handleEvent(u,`${u.type}Window`)},this.handleEvent=(u,p)=>{if(u.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const x=u.type==="renderFrame"?void 0:u,S={needsRenderFrame:!1},A={},z={},D=u.touches,I=D?this._getMapTouches(D):void 0,B=I?V.touchPos(this._map.getCanvas(),I):V.mousePos(this._map.getCanvas(),u);for(const{handlerName:X,handler:K,allowed:Q}of this._handlers){if(!K.isEnabled())continue;let W;this._blockedByActive(z,Q,X)?K.reset():K[p||u.type]&&(W=K[p||u.type](u,B,I),this.mergeHandlerResult(S,A,W,X,x),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||K.isActive())&&(z[X]=K)}const U={};for(const X in this._previousActiveHandlers)z[X]||(U[X]=x);this._previousActiveHandlers=z,(Object.keys(U).length||Ll(S))&&(this._changes.push([S,A,U]),this._triggerRenderFrame()),(Object.keys(z).length||Ll(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=S;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new _u(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[u,p,x]of this._listeners)V.addEventListener(u,p,u===document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(const[t,s,c]of this._listeners)V.removeEventListener(t,s,t===document?this.handleWindowEvent:this.handleEvent,c)}_addDefaultHandlers(t){const s=this._map,c=s.getCanvasContainer();this._add("mapEvent",new Cd(s,t));const u=s.boxZoom=new In(s,t);this._add("boxZoom",u),t.interactive&&t.boxZoom&&u.enable();const p=s.cooperativeGestures=new ws(s,t.cooperativeGestures);this._add("cooperativeGestures",p),t.cooperativeGestures&&p.enable();const x=new xs(s),S=new Yp(s);s.doubleClickZoom=new Pr(S,x),this._add("tapZoom",x),this._add("clickZoom",S),t.interactive&&t.doubleClickZoom&&s.doubleClickZoom.enable();const A=new Kp;this._add("tapDragZoom",A);const z=s.touchPitch=new bs(s);this._add("touchPitch",z),t.interactive&&t.touchPitch&&s.touchPitch.enable(t.touchPitch);const D=bu(t),I=wu(t);s.dragRotate=new kd(t,D,I),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",I,["mouseRotate"]),t.interactive&&t.dragRotate&&s.dragRotate.enable();const B=(({enable:W,clickTolerance:Z})=>{const at=new Il({checkCorrectEvent:ot=>V.mouseButton(ot)===0&&!ot.ctrlKey});return new Ha({clickTolerance:Z,move:(ot,ft)=>({around:ft,panDelta:ft.sub(ot)}),activateOnStart:!0,moveStateManager:at,enable:W,assignEvents:kl})})(t),U=new Rr(t,s);s.dragPan=new Id(c,B,U),this._add("mousePan",B),this._add("touchPan",U,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&s.dragPan.enable(t.dragPan);const j=new Eu,X=new Tu;s.touchZoomRotate=new zu(c,X,j,A),this._add("touchRotate",j,["touchPan","touchZoom"]),this._add("touchZoom",X,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&s.touchZoomRotate.enable(t.touchZoomRotate);const K=s.scrollZoom=new ra(s,()=>this._triggerRenderFrame());this._add("scrollZoom",K,["mousePan"]),t.interactive&&t.scrollZoom&&s.scrollZoom.enable(t.scrollZoom);const Q=s.keyboard=new jn(s);this._add("keyboard",Q),t.interactive&&t.keyboard&&s.keyboard.enable(),this._add("blockableMapEvent",new di(s))}_add(t,s,c){this._handlers.push({handlerName:t,handler:s,allowed:c}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!qn(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,s,c){for(const u in t)if(u!==c&&(!s||s.indexOf(u)<0))return!0;return!1}_getMapTouches(t){const s=[];for(const c of t)this._el.contains(c.target)&&s.push(c);return s}mergeHandlerResult(t,s,c,u,p){if(!c)return;f.e(t,c);const x={handlerName:u,originalEvent:c.originalEvent||p};c.zoomDelta!==void 0&&(s.zoom=x),c.panDelta!==void 0&&(s.drag=x),c.pitchDelta!==void 0&&(s.pitch=x),c.bearingDelta!==void 0&&(s.rotate=x)}_applyChanges(){const t={},s={},c={};for(const[u,p,x]of this._changes)u.panDelta&&(t.panDelta=(t.panDelta||new f.P(0,0))._add(u.panDelta)),u.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+u.zoomDelta),u.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+u.bearingDelta),u.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+u.pitchDelta),u.around!==void 0&&(t.around=u.around),u.pinchAround!==void 0&&(t.pinchAround=u.pinchAround),u.noInertia&&(t.noInertia=u.noInertia),f.e(s,p),f.e(c,x);this._updateMapTransform(t,s,c),this._changes=[]}_updateMapTransform(t,s,c){const u=this._map,p=u._getTransformForUpdate(),x=u.terrain;if(!(Ll(t)||x&&this._terrainMovement))return this._fireEvents(s,c,!0);let{panDelta:S,zoomDelta:A,bearingDelta:z,pitchDelta:D,around:I,pinchAround:B}=t;B!==void 0&&(I=B),u._stop(!0),I=I||u.transform.centerPoint;const U=p.pointLocation(S?I.sub(S):I);z&&(p.bearing+=z),D&&(p.pitch+=D),A&&(p.zoom+=A),x?this._terrainMovement||!s.drag&&!s.zoom?s.drag&&this._terrainMovement?p.center=p.pointLocation(p.centerPoint.sub(S)):p.setLocationAtPoint(U,I):(this._terrainMovement=!0,this._map._elevationFreeze=!0,p.setLocationAtPoint(U,I)):p.setLocationAtPoint(U,I),u._applyUpdatedTransform(p),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,c,!0)}_fireEvents(t,s,c){const u=qn(this._eventsInProgress),p=qn(t),x={};for(const I in t){const{originalEvent:B}=t[I];this._eventsInProgress[I]||(x[`${I}start`]=B),this._eventsInProgress[I]=t[I]}!u&&p&&this._fireEvent("movestart",p.originalEvent);for(const I in x)this._fireEvent(I,x[I]);p&&this._fireEvent("move",p.originalEvent);for(const I in t){const{originalEvent:B}=t[I];this._fireEvent(I,B)}const S={};let A;for(const I in this._eventsInProgress){const{handlerName:B,originalEvent:U}=this._eventsInProgress[I];this._handlersById[B].isActive()||(delete this._eventsInProgress[I],A=s[B]||U,S[`${I}end`]=A)}for(const I in S)this._fireEvent(I,S[I]);const z=qn(this._eventsInProgress),D=(u||p)&&!z;if(D&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const I=this._map._getTransformForUpdate();I.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(I)}if(c&&D){this._updatingCamera=!0;const I=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=U=>U!==0&&-this._bearingSnap<U&&U<this._bearingSnap;!I||!I.essential&&tt.prefersReducedMotion?(this._map.fire(new f.k("moveend",{originalEvent:A})),B(this._map.getBearing())&&this._map.resetNorth()):(B(I.bearing||this._map.getBearing())&&(I.bearing=0),I.freezeElevation=!0,this._map.easeTo(I,{originalEvent:A})),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new f.k(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new jt("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Rd extends f.E{constructor(t,s){super(),this._renderFrameCallback=()=>{const c=Math.min((tt.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new f.N(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,c){return t=f.P.convert(t).mult(-1),this.panTo(this.transform.center,f.e({offset:t},s),c)}panTo(t,s,c){return this.easeTo(f.e({center:t},s),c)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,c){return this.easeTo(f.e({zoom:t},s),c)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,c){return this.easeTo(f.e({bearing:t},s),c)}resetNorth(t,s){return this.rotateTo(0,f.e({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(f.e({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=gt.convert(t).adjustAntiMeridian();const c=s&&s.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),c,s)}_cameraForBoxAndBearing(t,s,c,u){const p={top:0,bottom:0,right:0,left:0};if(typeof(u=f.e({padding:p,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=="number"){const Dt=u.padding;u.padding={top:Dt,bottom:Dt,right:Dt,left:Dt}}u.padding=f.e(p,u.padding);const x=this.transform,S=x.padding,A=new gt(t,s),z=x.project(A.getNorthWest()),D=x.project(A.getNorthEast()),I=x.project(A.getSouthEast()),B=x.project(A.getSouthWest()),U=f.ba(-c),j=z.rotate(U),X=D.rotate(U),K=I.rotate(U),Q=B.rotate(U),W=new f.P(Math.max(j.x,X.x,Q.x,K.x),Math.max(j.y,X.y,Q.y,K.y)),Z=new f.P(Math.min(j.x,X.x,Q.x,K.x),Math.min(j.y,X.y,Q.y,K.y)),at=W.sub(Z),ot=(x.width-(S.left+S.right+u.padding.left+u.padding.right))/at.x,ft=(x.height-(S.top+S.bottom+u.padding.top+u.padding.bottom))/at.y;if(ft<0||ot<0)return void f.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const wt=Math.min(x.scaleZoom(x.scale*Math.min(ot,ft)),u.maxZoom),Et=f.P.convert(u.offset),Pt=new f.P((u.padding.left-u.padding.right)/2,(u.padding.top-u.padding.bottom)/2).rotate(f.ba(c)),Ut=Et.add(Pt).mult(x.scale/x.zoomScale(wt));return{center:x.unproject(z.add(I).div(2).sub(Ut)),zoom:wt,bearing:c}}fitBounds(t,s,c){return this._fitInternal(this.cameraForBounds(t,s),s,c)}fitScreenCoordinates(t,s,c,u,p){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(f.P.convert(t)),this.transform.pointLocation(f.P.convert(s)),c,u),u,p)}_fitInternal(t,s,c){return t?(delete(s=f.e(t,s)).padding,s.linear?this.easeTo(s,c):this.flyTo(s,c)):this}jumpTo(t,s){this.stop();const c=this._getTransformForUpdate();let u=!1,p=!1,x=!1;return"zoom"in t&&c.zoom!==+t.zoom&&(u=!0,c.zoom=+t.zoom),t.center!==void 0&&(c.center=f.N.convert(t.center)),"bearing"in t&&c.bearing!==+t.bearing&&(p=!0,c.bearing=+t.bearing),"pitch"in t&&c.pitch!==+t.pitch&&(x=!0,c.pitch=+t.pitch),t.padding==null||c.isPaddingEqual(t.padding)||(c.padding=t.padding),this._applyUpdatedTransform(c),this.fire(new f.k("movestart",s)).fire(new f.k("move",s)),u&&this.fire(new f.k("zoomstart",s)).fire(new f.k("zoom",s)).fire(new f.k("zoomend",s)),p&&this.fire(new f.k("rotatestart",s)).fire(new f.k("rotate",s)).fire(new f.k("rotateend",s)),x&&this.fire(new f.k("pitchstart",s)).fire(new f.k("pitch",s)).fire(new f.k("pitchend",s)),this.fire(new f.k("moveend",s))}calculateCameraOptionsFromTo(t,s,c,u=0){const p=f.Z.fromLngLat(t,s),x=f.Z.fromLngLat(c,u),S=x.x-p.x,A=x.y-p.y,z=x.z-p.z,D=Math.hypot(S,A,z);if(D===0)throw new Error("Can't calculate camera options with same From and To");const I=Math.hypot(S,A),B=this.transform.scaleZoom(this.transform.cameraToCenterDistance/D/this.transform.tileSize),U=180*Math.atan2(S,-A)/Math.PI;let j=180*Math.acos(I/D)/Math.PI;return j=z<0?90-j:90+j,{center:x.toLngLat(),zoom:B,pitch:j,bearing:U}}easeTo(t,s){var c;this._stop(!1,t.easeId),((t=f.e({offset:[0,0],duration:500,easing:f.b9},t)).animate===!1||!t.essential&&tt.prefersReducedMotion)&&(t.duration=0);const u=this._getTransformForUpdate(),p=u.zoom,x=u.bearing,S=u.pitch,A=u.padding,z="bearing"in t?this._normalizeBearing(t.bearing,x):x,D="pitch"in t?+t.pitch:S,I="padding"in t?t.padding:u.padding,B=f.P.convert(t.offset);let U=u.centerPoint.add(B);const j=u.pointLocation(U),{center:X,zoom:K}=u.getConstrained(f.N.convert(t.center||j),(c=t.zoom)!==null&&c!==void 0?c:p);this._normalizeCenter(X,u);const Q=u.project(j),W=u.project(X).sub(Q),Z=u.zoomScale(K-p);let at,ot;t.around&&(at=f.N.convert(t.around),ot=u.locationPoint(at));const ft={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||K!==p,this._rotating=this._rotating||x!==z,this._pitching=this._pitching||D!==S,this._padding=!u.isPaddingEqual(I),this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,ft),this.terrain&&this._prepareElevation(X),this._ease(wt=>{if(this._zooming&&(u.zoom=f.y.number(p,K,wt)),this._rotating&&(u.bearing=f.y.number(x,z,wt)),this._pitching&&(u.pitch=f.y.number(S,D,wt)),this._padding&&(u.interpolatePadding(A,I,wt),U=u.centerPoint.add(B)),this.terrain&&!t.freezeElevation&&this._updateElevation(wt),at)u.setLocationAtPoint(at,ot);else{const Et=u.zoomScale(u.zoom-p),Pt=K>p?Math.min(2,Z):Math.max(.5,Z),Ut=Math.pow(Pt,1-wt),Dt=u.unproject(Q.add(W.mult(wt*Ut)).mult(Et));u.setLocationAtPoint(u.renderWorldCopies?Dt.wrap():Dt,U)}this._applyUpdatedTransform(u),this._fireMoveEvents(s)},wt=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(s,wt)},t),this}_prepareEase(t,s,c={}){this._moving=!0,s||c.moving||this.fire(new f.k("movestart",t)),this._zooming&&!c.zooming&&this.fire(new f.k("zoomstart",t)),this._rotating&&!c.rotating&&this.fire(new f.k("rotatestart",t)),this._pitching&&!c.pitching&&this.fire(new f.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&s!==this._elevationTarget){const c=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(c-(s-(c*t+this._elevationStart))/(1-t)),this._elevationTarget=s}this.transform.elevation=f.y.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){const s=t.getCameraPosition(),c=this.terrain.getElevationForLngLatZoom(s.lngLat,t.zoom);if(s.altitude<c){const u=this.calculateCameraOptionsFromTo(s.lngLat,c,t.center,t.elevation);return{pitch:u.pitch,zoom:u.zoom}}return{}}_applyUpdatedTransform(t){const s=[];if(this.terrain&&s.push(u=>this._elevateCameraIfInsideTerrain(u)),this.transformCameraUpdate&&s.push(u=>this.transformCameraUpdate(u)),!s.length)return;const c=t.clone();for(const u of s){const p=c.clone(),{center:x,zoom:S,pitch:A,bearing:z,elevation:D}=u(p);x&&(p.center=x),S!==void 0&&(p.zoom=S),A!==void 0&&(p.pitch=A),z!==void 0&&(p.bearing=z),D!==void 0&&(p.elevation=D),c.apply(p)}this.transform.apply(c)}_fireMoveEvents(t){this.fire(new f.k("move",t)),this._zooming&&this.fire(new f.k("zoom",t)),this._rotating&&this.fire(new f.k("rotate",t)),this._pitching&&this.fire(new f.k("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const c=this._zooming,u=this._rotating,p=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,c&&this.fire(new f.k("zoomend",t)),u&&this.fire(new f.k("rotateend",t)),p&&this.fire(new f.k("pitchend",t)),this.fire(new f.k("moveend",t))}flyTo(t,s){var c;if(!t.essential&&tt.prefersReducedMotion){const Bt=f.M(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Bt,s)}this.stop(),t=f.e({offset:[0,0],speed:1.2,curve:1.42,easing:f.b9},t);const u=this._getTransformForUpdate(),p=u.zoom,x=u.bearing,S=u.pitch,A=u.padding,z="bearing"in t?this._normalizeBearing(t.bearing,x):x,D="pitch"in t?+t.pitch:S,I="padding"in t?t.padding:u.padding,B=f.P.convert(t.offset);let U=u.centerPoint.add(B);const j=u.pointLocation(U),{center:X,zoom:K}=u.getConstrained(f.N.convert(t.center||j),(c=t.zoom)!==null&&c!==void 0?c:p);this._normalizeCenter(X,u);const Q=u.zoomScale(K-p),W=u.project(j),Z=u.project(X).sub(W);let at=t.curve;const ot=Math.max(u.width,u.height),ft=ot/Q,wt=Z.mag();if("minZoom"in t){const Bt=f.ac(Math.min(t.minZoom,p,K),u.minZoom,u.maxZoom),re=ot/u.zoomScale(Bt-p);at=Math.sqrt(re/wt*2)}const Et=at*at;function Pt(Bt){const re=(ft*ft-ot*ot+(Bt?-1:1)*Et*Et*wt*wt)/(2*(Bt?ft:ot)*Et*wt);return Math.log(Math.sqrt(re*re+1)-re)}function Ut(Bt){return(Math.exp(Bt)-Math.exp(-Bt))/2}function Dt(Bt){return(Math.exp(Bt)+Math.exp(-Bt))/2}const Ct=Pt(!1);let Ht=function(Bt){return Dt(Ct)/Dt(Ct+at*Bt)},oe=function(Bt){return ot*((Dt(Ct)*(Ut(re=Ct+at*Bt)/Dt(re))-Ut(Ct))/Et)/wt;var re},kt=(Pt(!0)-Ct)/at;if(Math.abs(wt)<1e-6||!isFinite(kt)){if(Math.abs(ot-ft)<1e-6)return this.easeTo(t,s);const Bt=ft<ot?-1:1;kt=Math.abs(Math.log(ft/ot))/at,oe=()=>0,Ht=re=>Math.exp(Bt*at*re)}return t.duration="duration"in t?+t.duration:1e3*kt/("screenSpeed"in t?+t.screenSpeed/at:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=x!==z,this._pitching=D!==S,this._padding=!u.isPaddingEqual(I),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(X),this._ease(Bt=>{const re=Bt*kt,Je=1/Ht(re);u.zoom=Bt===1?K:p+u.scaleZoom(Je),this._rotating&&(u.bearing=f.y.number(x,z,Bt)),this._pitching&&(u.pitch=f.y.number(S,D,Bt)),this._padding&&(u.interpolatePadding(A,I,Bt),U=u.centerPoint.add(B)),this.terrain&&!t.freezeElevation&&this._updateElevation(Bt);const de=Bt===1?X:u.unproject(W.add(Z.mult(oe(re))).mult(Je));u.setLocationAtPoint(u.renderWorldCopies?de.wrap():de,U),this._applyUpdatedTransform(u),this._fireMoveEvents(s)},()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(s)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,s){var c;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const u=this._onEaseEnd;delete this._onEaseEnd,u.call(this,s)}return t||(c=this.handlers)===null||c===void 0||c.stop(!1),this}_ease(t,s,c){c.animate===!1||c.duration===0?(t(1),s()):(this._easeStart=tt.now(),this._easeOptions=c,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,s){t=f.b3(t,-180,180);const c=Math.abs(t-s);return Math.abs(t-360-s)<c&&(t-=360),Math.abs(t+360-s)<c&&(t+=360),t}_normalizeCenter(t,s){if(!s.renderWorldCopies||s.lngRange)return;const c=t.lng-s.center.lng;t.lng+=c>180?-360:c<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(f.N.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}const Ss={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Ts{constructor(t=Ss){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=V.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=V.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=V.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){V.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,s){const c=this._map._getUIString(`AttributionControl.${s}`);t.title=c,t.setAttribute("aria-label",c)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(u=>typeof u!="string"?"":u)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}const s=this._map.style.sourceCaches;for(const u in s){const p=s[u];if(p.used||p.usedForTerrain){const x=p.getSource();x.attribution&&t.indexOf(x.attribution)<0&&t.push(x.attribution)}}t=t.filter(u=>String(u).trim()),t.sort((u,p)=>u.length-p.length),t=t.filter((u,p)=>{for(let x=p+1;x<t.length;x++)if(t[x].indexOf(u)>=0)return!1;return!0});const c=t.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,t.length?(this._innerContainer.innerHTML=c,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Du{constructor(t={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const c=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&c.classList.add("maplibregl-compact"):c.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=V.create("div","maplibregl-ctrl");const s=V.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){V.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class we{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,c=s?this._queue.concat(s):this._queue;for(const u of c)if(u.id===t)return void(u.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const c of s)if(!c.cancelled&&(c.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Iu=f.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Qp extends f.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,s){this.sourceCache.update(t,s),this._renderableTilesKeys=[];const c={};for(const u of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))c[u.key]=!0,this._renderableTilesKeys.push(u.key),this._tiles[u.key]||(u.posMatrix=new Float64Array(16),f.aP(u.posMatrix,0,f.X,0,f.X,0,1),this._tiles[u.key]=new ir(u,this.tileSize));for(const u in this._tiles)c[u]||delete this._tiles[u]}freeRtt(t){for(const s in this._tiles){const c=this._tiles[s];(!t||c.tileID.equals(t)||c.tileID.isChildOf(t)||t.isChildOf(c.tileID))&&(c.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const s={};for(const c of this._renderableTilesKeys){const u=this._tiles[c].tileID;if(u.canonical.equals(t.canonical)){const p=t.clone();p.posMatrix=new Float64Array(16),f.aP(p.posMatrix,0,f.X,0,f.X,0,1),s[c]=p}else if(u.canonical.isChildOf(t.canonical)){const p=t.clone();p.posMatrix=new Float64Array(16);const x=u.canonical.z-t.canonical.z,S=u.canonical.x-(u.canonical.x>>x<<x),A=u.canonical.y-(u.canonical.y>>x<<x),z=f.X>>x;f.aP(p.posMatrix,0,z,0,z,0,1),f.J(p.posMatrix,p.posMatrix,[-S*z,-A*z,0]),s[c]=p}else if(t.canonical.isChildOf(u.canonical)){const p=t.clone();p.posMatrix=new Float64Array(16);const x=t.canonical.z-u.canonical.z,S=t.canonical.x-(t.canonical.x>>x<<x),A=t.canonical.y-(t.canonical.y>>x<<x),z=f.X>>x;f.aP(p.posMatrix,0,f.X,0,f.X,0,1),f.J(p.posMatrix,p.posMatrix,[S*z,A*z,0]),f.K(p.posMatrix,p.posMatrix,[1/2**x,1/2**x,0]),s[c]=p}}return s}getSourceTile(t,s){const c=this.sourceCache._source;let u=t.overscaledZ-this.deltaZoom;if(u>c.maxzoom&&(u=c.maxzoom),u<c.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(u).key);let p=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!p||!p.dem)&&s)for(;u>=c.minzoom&&(!p||!p.dem);)p=this.sourceCache.getTileByID(t.scaledTo(u--).key);return p}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(s=>s.timeAdded>=t)}}class ku{constructor(t,s,c){this.painter=t,this.sourceCache=new Qp(s),this.options=c,this.exaggeration=typeof c.exaggeration=="number"?c.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,s,c,u=f.X){var p;if(!(s>=0&&s<u&&c>=0&&c<u))return 0;const x=this.getTerrainData(t),S=(p=x.tile)===null||p===void 0?void 0:p.dem;if(!S)return 0;const A=function(j,X,K){var Q=X[0],W=X[1];return j[0]=K[0]*Q+K[4]*W+K[12],j[1]=K[1]*Q+K[5]*W+K[13],j}([],[s/u*f.X,c/u*f.X],x.u_terrain_matrix),z=[A[0]*S.dim,A[1]*S.dim],D=Math.floor(z[0]),I=Math.floor(z[1]),B=z[0]-D,U=z[1]-I;return S.get(D,I)*(1-B)*(1-U)+S.get(D+1,I)*B*(1-U)+S.get(D,I+1)*(1-B)*U+S.get(D+1,I+1)*B*U}getElevationForLngLatZoom(t,s){if(!f.bb(s,t.wrap()))return 0;const{tileID:c,mercatorX:u,mercatorY:p}=this._getOverscaledTileIDFromLngLatZoom(t,s);return this.getElevation(c,u%f.X,p%f.X,f.X)}getElevation(t,s,c,u=f.X){return this.getDEMElevation(t,s,c,u)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const u=this.painter.context,p=new f.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new me(u,p,u.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new me(u,new f.R({width:1,height:1}),u.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=f.an([])}const s=this.sourceCache.getSourceTile(t,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const u=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new me(u,s.dem.getPixels(),u.gl.RGBA,{premultiply:!1}),s.demTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const c=s&&s+s.tileID.key+t.key;if(c&&!this._demMatrixCache[c]){const u=this.sourceCache.sourceCache._source.maxzoom;let p=t.canonical.z-s.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=u?p=t.canonical.z-u:f.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const x=t.canonical.x-(t.canonical.x>>p<<p),S=t.canonical.y-(t.canonical.y>>p<<p),A=f.bc(new Float64Array(16),[1/(f.X<<p),1/(f.X<<p),0]);f.J(A,A,[x*f.X,S*f.X,0]),this._demMatrixCache[t.key]={matrix:A,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:c?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(t){const s=this.painter,c=s.width/devicePixelRatio,u=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===c&&this._fbo.height===u||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new me(s.context,{width:c,height:u,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new me(s.context,{width:c,height:u,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(c,u,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,c,u))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let p=0,x=0;p<this._coordsTextureSize;p++)for(let S=0;S<this._coordsTextureSize;S++,x+=4)s[x+0]=255&S,s[x+1]=255&p,s[x+2]=S>>8<<4|p>>8,s[x+3]=0;const c=new f.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),u=new me(t,c,t.gl.RGBA,{premultiply:!1});return u.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=u,u}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const s=new Uint8Array(4),c=this.painter.context,u=c.gl,p=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),x=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),S=Math.round(this.painter.height/devicePixelRatio);c.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),u.readPixels(p,S-x-1,1,1,u.RGBA,u.UNSIGNED_BYTE,s),c.bindFramebuffer.set(null);const A=s[0]+(s[2]>>4<<8),z=s[1]+((15&s[2])<<8),D=this.coordsIndex[255-s[3]],I=D&&this.sourceCache.getTileByID(D);if(!I)return null;const B=this._coordsTextureSize,U=(1<<I.tileID.canonical.z)*B;return new f.Z((I.tileID.canonical.x*B+A)/U+I.tileID.wrap,(I.tileID.canonical.y*B+z)/U,this.getElevation(I.tileID,A,z,B))}depthAtPoint(t){const s=new Uint8Array(4),c=this.painter.context,u=c.gl;return c.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),u.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,u.RGBA,u.UNSIGNED_BYTE,s),c.bindFramebuffer.set(null),(s[0]/16777216+s[1]/65536+s[2]/256+s[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,s=new f.bd,c=new f.aY,u=this.meshSize,p=f.X/u,x=u*u;for(let I=0;I<=u;I++)for(let B=0;B<=u;B++)s.emplaceBack(B*p,I*p,0);for(let I=0;I<x;I+=u+1)for(let B=0;B<u;B++)c.emplaceBack(B+I,u+B+I+1,u+B+I+2),c.emplaceBack(B+I,u+B+I+2,B+I+1);const S=s.length,A=S+2*(u+1);for(const I of[0,1])for(let B=0;B<=u;B++)for(const U of[0,1])s.emplaceBack(B*p,I*f.X,U);for(let I=0;I<2*u;I+=2)c.emplaceBack(A+I,A+I+1,A+I+3),c.emplaceBack(A+I,A+I+3,A+I+2),c.emplaceBack(S+I,S+I+3,S+I+1),c.emplaceBack(S+I,S+I+2,S+I+3);const z=s.length,D=z+2*(u+1);for(const I of[0,1])for(let B=0;B<=u;B++)for(const U of[0,1])s.emplaceBack(I*f.X,B*p,U);for(let I=0;I<2*u;I+=2)c.emplaceBack(z+I,z+I+1,z+I+3),c.emplaceBack(z+I,z+I+3,z+I+2),c.emplaceBack(D+I,D+I+3,D+I+1),c.emplaceBack(D+I,D+I+2,D+I+3);return this._mesh=new Al(t.createVertexBuffer(s,Iu.members),t.createIndexBuffer(c),f.a0.simpleSegment(0,0,s.length,c.length)),this._mesh}getMeshFrameDelta(t){return 2*Math.PI*f.be/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,s){var c;const{tileID:u}=this._getOverscaledTileIDFromLngLatZoom(t,s);return(c=this.getMinMaxElevation(u).minElevation)!==null&&c!==void 0?c:0}getMinMaxElevation(t){const s=this.getTerrainData(t).tile,c={minElevation:null,maxElevation:null};return s&&s.dem&&(c.minElevation=s.dem.min*this.exaggeration,c.maxElevation=s.dem.max*this.exaggeration),c}_getOverscaledTileIDFromLngLatZoom(t,s){const c=f.Z.fromLngLat(t.wrap()),u=(1<<s)*f.X,p=c.x*u,x=c.y*u,S=Math.floor(p/f.X),A=Math.floor(x/f.X);return{tileID:new f.S(s,0,s,S,A),mercatorX:p,mercatorY:x}}}class Jp{constructor(t,s,c){this._context=t,this._size=s,this._tileSize=c,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),c=new me(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return c.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(c.texture),{id:t,fbo:s,texture:c,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(s=>t.id!==s),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const As={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Pd{constructor(t,s){this.painter=t,this.terrain=s,this.pool=new Jp(t.context,30,s.sourceCache.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(c=>!t._layers[c].isHidden(s)),this._coordsDescendingInv={};for(const c in t.sourceCaches){this._coordsDescendingInv[c]={};const u=t.sourceCaches[c].getVisibleCoordinates();for(const p of u){const x=this.terrain.sourceCache.getTerrainCoords(p);for(const S in x)this._coordsDescendingInv[c][S]||(this._coordsDescendingInv[c][S]=[]),this._coordsDescendingInv[c][S].push(x[S])}}this._coordsDescendingInvStr={};for(const c of t._order){const u=t._layers[c],p=u.source;if(As[u.type]&&!this._coordsDescendingInvStr[p]){this._coordsDescendingInvStr[p]={};for(const x in this._coordsDescendingInv[p])this._coordsDescendingInvStr[p][x]=this._coordsDescendingInv[p][x].map(S=>S.key).sort().join()}}for(const c of this._renderableTiles)for(const u in this._coordsDescendingInvStr){const p=this._coordsDescendingInvStr[u][c.tileID.key];p&&p!==c.rttCoords[u]&&(c.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const s=t.type,c=this.painter,u=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(As[s]&&(this._prevType&&As[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(t.id),!u))return!0;if(As[this._prevType]||As[s]&&u){this._prevType=s;const p=this._stacks.length-1,x=this._stacks[p]||[];for(const S of this._renderableTiles){if(this.pool.isFull()&&(Ed(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(S),S.rtt[p]){const z=this.pool.getObjectForId(S.rtt[p].id);if(z.stamp===S.rtt[p].stamp){this.pool.useObject(z);continue}}const A=this.pool.getOrCreateFreeObject();this.pool.useObject(A),this.pool.stampObject(A),S.rtt[p]={id:A.id,stamp:A.stamp},c.context.bindFramebuffer.set(A.fbo.framebuffer),c.context.clear({color:f.aM.transparent,stencil:0}),c.currentStencilSource=void 0;for(let z=0;z<x.length;z++){const D=c.style._layers[x[z]],I=D.source?this._coordsDescendingInv[D.source][S.tileID.key]:[S.tileID];c.context.viewport.set([0,0,A.fbo.width,A.fbo.height]),c._renderTileClippingMasks(D,I),c.renderLayer(c,c.style.sourceCaches[D.source],D,I),D.source&&(S.rttCoords[D.source]=this._coordsDescendingInvStr[D.source][S.tileID.key])}}return Ed(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),As[s]}return!1}}const Ru={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ld=q,Wp={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Ss,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:f.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Pu=m=>{m.touchstart=m.dragStart,m.touchmoveWindow=m.dragMove,m.touchend=m.dragEnd},tm={showCompass:!0,showZoom:!0,visualizePitch:!1};class em{constructor(t,s,c=!1){this.mousedown=x=>{this.startMouse(f.e({},x,{ctrlKey:!0,preventDefault:()=>x.preventDefault()}),V.mousePos(this.element,x)),V.addEventListener(window,"mousemove",this.mousemove),V.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=x=>{this.moveMouse(x,V.mousePos(this.element,x))},this.mouseup=x=>{this.mouseRotate.dragEnd(x),this.mousePitch&&this.mousePitch.dragEnd(x),this.offTemp()},this.touchstart=x=>{x.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=V.touchPos(this.element,x.targetTouches)[0],this.startTouch(x,this._startPos),V.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.addEventListener(window,"touchend",this.touchend))},this.touchmove=x=>{x.targetTouches.length!==1?this.reset():(this._lastPos=V.touchPos(this.element,x.targetTouches)[0],this.moveTouch(x,this._lastPos))},this.touchend=x=>{x.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const u=t.dragRotate._mouseRotate.getClickTolerance(),p=t.dragRotate._mousePitch.getClickTolerance();this.element=s,this.mouseRotate=bu({clickTolerance:u,enable:!0}),this.touchRotate=(({enable:x,clickTolerance:S,bearingDegreesPerPixelMoved:A=.8})=>{const z=new xu;return new Ha({clickTolerance:S,move:(D,I)=>({bearingDelta:(I.x-D.x)*A}),moveStateManager:z,enable:x,assignEvents:Pu})})({clickTolerance:u,enable:!0}),this.map=t,c&&(this.mousePitch=wu({clickTolerance:p,enable:!0}),this.touchPitch=(({enable:x,clickTolerance:S,pitchDegreesPerPixelMoved:A=-.5})=>{const z=new xu;return new Ha({clickTolerance:S,move:(D,I)=>({pitchDelta:(I.y-D.y)*A}),moveStateManager:z,enable:x,assignEvents:Pu})})({clickTolerance:p,enable:!0})),V.addEventListener(s,"mousedown",this.mousedown),V.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),V.addEventListener(s,"touchcancel",this.reset)}startMouse(t,s){this.mouseRotate.dragStart(t,s),this.mousePitch&&this.mousePitch.dragStart(t,s),V.disableDrag()}startTouch(t,s){this.touchRotate.dragStart(t,s),this.touchPitch&&this.touchPitch.dragStart(t,s),V.disableDrag()}moveMouse(t,s){const c=this.map,{bearingDelta:u}=this.mouseRotate.dragMove(t,s)||{};if(u&&c.setBearing(c.getBearing()+u),this.mousePitch){const{pitchDelta:p}=this.mousePitch.dragMove(t,s)||{};p&&c.setPitch(c.getPitch()+p)}}moveTouch(t,s){const c=this.map,{bearingDelta:u}=this.touchRotate.dragMove(t,s)||{};if(u&&c.setBearing(c.getBearing()+u),this.touchPitch){const{pitchDelta:p}=this.touchPitch.dragMove(t,s)||{};p&&c.setPitch(c.getPitch()+p)}}off(){const t=this.element;V.removeEventListener(t,"mousedown",this.mousedown),V.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),V.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.removeEventListener(window,"touchend",this.touchend),V.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){V.enableDrag(),V.removeEventListener(window,"mousemove",this.mousemove),V.removeEventListener(window,"mouseup",this.mouseup),V.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.removeEventListener(window,"touchend",this.touchend)}}let kn;function Qe(m,t,s){const c=new f.N(m.lng,m.lat);if(m=new f.N(m.lng,m.lat),t){const u=new f.N(m.lng-360,m.lat),p=new f.N(m.lng+360,m.lat),x=s.locationPoint(m).distSqr(t);s.locationPoint(u).distSqr(t)<x?m=u:s.locationPoint(p).distSqr(t)<x&&(m=p)}for(;Math.abs(m.lng-s.center.lng)>180;){const u=s.locationPoint(m);if(u.x>=0&&u.y>=0&&u.x<=s.width&&u.y<=s.height)break;m.lng>s.center.lng?m.lng-=360:m.lng+=360}return m.lng!==c.lng&&s.locationPoint(m).y>s.height/2-s.getHorizon()?m:c}const Es={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Bl(m,t,s){const c=m.classList;for(const u in Es)c.remove(`maplibregl-${s}-anchor-${u}`);c.add(`maplibregl-${s}-anchor-${t}`)}class Ol extends f.E{constructor(t){if(super(),this._onKeyPress=s=>{const c=s.code,u=s.charCode||s.keyCode;c!=="Space"&&c!=="Enter"&&u!==32&&u!==13||this.togglePopup()},this._onMapClick=s=>{const c=s.originalEvent.target,u=this._element;this._popup&&(c===u||u.contains(c))&&this.togglePopup()},this._update=s=>{var c;if(!this._map)return;const u=this._map.loaded()&&!this._map.isMoving();((s==null?void 0:s.type)==="terrain"||(s==null?void 0:s.type)==="render"&&!u)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Qe(this._lngLat,this._flatPos,this._map.transform):(c=this._lngLat)===null||c===void 0?void 0:c.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let x="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?x="rotateX(0deg)":this._pitchAlignment==="map"&&(x=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||s&&s.type!=="moveend"||(this._pos=this._pos.round()),V.setTransform(this._element,`${Es[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${x} ${p}`),tt.frameAsync(new AbortController).then(()=>{this._updateOpacity(s&&s.type==="moveend")}).catch(()=>{})},this._onMove=s=>{if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new f.k("dragstart"))),this.fire(new f.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new f.k("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(t==null?void 0:t.opacity,t==null?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=f.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=V.create("div");const s=V.createNS("http://www.w3.org/2000/svg","svg"),c=41,u=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${c}px`),s.setAttributeNS(null,"width",`${u}px`),s.setAttributeNS(null,"viewBox",`0 0 ${u} ${c}`);const p=V.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"stroke","none"),p.setAttributeNS(null,"stroke-width","1"),p.setAttributeNS(null,"fill","none"),p.setAttributeNS(null,"fill-rule","evenodd");const x=V.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"fill-rule","nonzero");const S=V.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");const A=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Q of A){const W=V.createNS("http://www.w3.org/2000/svg","ellipse");W.setAttributeNS(null,"opacity","0.04"),W.setAttributeNS(null,"cx","10.5"),W.setAttributeNS(null,"cy","5.80029008"),W.setAttributeNS(null,"rx",Q.rx),W.setAttributeNS(null,"ry",Q.ry),S.appendChild(W)}const z=V.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill",this._color);const D=V.createNS("http://www.w3.org/2000/svg","path");D.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),z.appendChild(D);const I=V.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"opacity","0.25"),I.setAttributeNS(null,"fill","#000000");const B=V.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),I.appendChild(B);const U=V.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(6.0, 7.0)"),U.setAttributeNS(null,"fill","#FFFFFF");const j=V.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(8.0, 8.0)");const X=V.createNS("http://www.w3.org/2000/svg","circle");X.setAttributeNS(null,"fill","#000000"),X.setAttributeNS(null,"opacity","0.25"),X.setAttributeNS(null,"cx","5.5"),X.setAttributeNS(null,"cy","5.5"),X.setAttributeNS(null,"r","5.4999962");const K=V.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#FFFFFF"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962"),j.appendChild(X),j.appendChild(K),x.appendChild(S),x.appendChild(z),x.appendChild(I),x.appendChild(U),x.appendChild(j),s.appendChild(x),s.setAttributeNS(null,"height",c*this._scale+"px"),s.setAttributeNS(null,"width",u*this._scale+"px"),this._element.appendChild(s),this._offset=f.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",s=>{s.preventDefault()}),this._element.addEventListener("mousedown",s=>{s.preventDefault()}),Bl(this._element,this._anchor,"marker"),t&&t.className)for(const s of t.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),V.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=f.N.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const u=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(38.1-13.5+u)],"bottom-right":[-u,-1*(38.1-13.5+u)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var s,c;if(!(!((s=this._map)===null||s===void 0)&&s.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const u=this._map,p=u.terrain.depthAtPoint(this._pos),x=u.terrain.getElevationForLngLatZoom(this._lngLat,u.transform.tileZoom);if(u.transform.lngLatToCameraDepth(this._lngLat,x)-p<.006)return void(this._element.style.opacity=this._opacity);const S=-this._offset.y/u.transform._pixelPerMeter,A=Math.sin(u.getPitch()*Math.PI/180)*S,z=u.terrain.depthAtPoint(new f.P(this._pos.x,this._pos.y-this._offset.y)),D=u.transform.lngLatToCameraDepth(this._lngLat,x+A)-z>.006;!((c=this._popup)===null||c===void 0)&&c.isOpen()&&D&&this._popup.remove(),this._element.style.opacity=D?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=f.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,s){return t===void 0&&s===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),s!==void 0&&(this._opacityWhenCovered=s),this._map&&this._updateOpacity(!0),this}}const Bd={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ro=0,Po=!1;const Ca={maxWidth:100,unit:"metric"};function Lo(m,t,s){const c=s&&s.maxWidth||100,u=m._container.clientHeight/2,p=m.unproject([0,u]),x=m.unproject([c,u]),S=p.distanceTo(x);if(s&&s.unit==="imperial"){const A=3.2808*S;A>5280?Gt(t,c,A/5280,m._getUIString("ScaleControl.Miles")):Gt(t,c,A,m._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?Gt(t,c,S/1852,m._getUIString("ScaleControl.NauticalMiles")):S>=1e3?Gt(t,c,S/1e3,m._getUIString("ScaleControl.Kilometers")):Gt(t,c,S,m._getUIString("ScaleControl.Meters"))}function Gt(m,t,s,c){const u=function(p){const x=Math.pow(10,`${Math.floor(p)}`.length-1);let S=p/x;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(A){const z=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*z)/z}(S),x*S}(s);m.style.width=t*(u/s)+"px",m.innerHTML=`${u}&nbsp;${c}`}const ie={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Fl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ul(m){if(m){if(typeof m=="number"){const t=Math.round(Math.abs(m)/Math.SQRT2);return{center:new f.P(0,0),top:new f.P(0,m),"top-left":new f.P(t,t),"top-right":new f.P(-t,t),bottom:new f.P(0,-m),"bottom-left":new f.P(t,-t),"bottom-right":new f.P(-t,-t),left:new f.P(m,0),right:new f.P(-m,0)}}if(m instanceof f.P||Array.isArray(m)){const t=f.P.convert(m);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:f.P.convert(m.center||[0,0]),top:f.P.convert(m.top||[0,0]),"top-left":f.P.convert(m["top-left"]||[0,0]),"top-right":f.P.convert(m["top-right"]||[0,0]),bottom:f.P.convert(m.bottom||[0,0]),"bottom-left":f.P.convert(m["bottom-left"]||[0,0]),"bottom-right":f.P.convert(m["bottom-right"]||[0,0]),left:f.P.convert(m.left||[0,0]),right:f.P.convert(m.right||[0,0])}}return Ul(new f.P(0,0))}const Lu=q;T.AJAXError=f.bh,T.Evented=f.E,T.LngLat=f.N,T.MercatorCoordinate=f.Z,T.Point=f.P,T.addProtocol=f.bi,T.config=f.a,T.removeProtocol=f.bj,T.AttributionControl=Ts,T.BoxZoomHandler=In,T.CanvasSource=Un,T.CooperativeGesturesHandler=ws,T.DoubleClickZoomHandler=Pr,T.DragPanHandler=Id,T.DragRotateHandler=kd,T.EdgeInsets=ys,T.FullscreenControl=class extends f.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var t;let s=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=s==null?void 0:s.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)s=s.shadowRoot.fullscreenElement;s===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:f.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){V.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=V.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);V.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new f.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new f.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},T.GeoJSONSource=mo,T.GeolocateControl=class extends f.E{constructor(m){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new f.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new f.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const s=new f.N(t.coords.longitude,t.coords.latitude),c=t.coords.accuracy,u=this._map.getBearing(),p=f.e({bearing:u},this.options.fitBoundsOptions),x=gt.fromLngLat(s,c);this._map.fitBounds(x,p,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const s=new f.N(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Po)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new f.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=V.create("button","maplibregl-ctrl-geolocate",this._container),V.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){f.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=V.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ol({element:this._dotElement}),this._circleElement=V.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ol({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new f.k("trackuserlocationend")),this.fire(new f.k("userlocationlostfocus")))})}},this.options=f.e({},Bd,m)}onAdd(m){return this._map=m,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return f._(this,arguments,void 0,function*(t=!1){if(kn!==void 0&&!t)return kn;if(window.navigator.permissions===void 0)return kn=!!window.navigator.geolocation,kn;try{kn=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{kn=!!window.navigator.geolocation}return kn})}().then(t=>this._finishSetupUI(t)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),V.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ro=0,Po=!1}_isOutOfMapMaxBounds(m){const t=this._map.getMaxBounds(),s=m.coords;return t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const m=this._map.getBounds(),t=m.getSouthEast(),s=m.getNorthEast(),c=t.distanceTo(s),u=Math.ceil(this._accuracy/(c/this._map._container.clientHeight)*2);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}trigger(){if(!this._setup)return f.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new f.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ro--,Po=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new f.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new f.k("trackuserlocationstart")),this.fire(new f.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ro++,Ro>1?(m={maximumAge:6e5,timeout:0},Po=!0):(m=this.options.positionOptions,Po=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},T.Hash=Ml,T.ImageSource=qa,T.KeyboardHandler=jn,T.LngLatBounds=gt,T.LogoControl=Du,T.Map=class extends Rd{constructor(m){f.bf.mark(f.bg.create);const t=Object.assign(Object.assign({},Wp),m);if(t.minZoom!=null&&t.maxZoom!=null&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(t.minPitch!=null&&t.maxPitch!=null&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(t.minPitch!=null&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(t.maxPitch!=null&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new vs(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),{bearingSnap:t.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new we,this._controls=[],this._mapId=f.a4(),this._contextLost=s=>{s.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new f.k("webglcontextlost",{originalEvent:s}))},this._contextRestored=s=>{this._setupPainter(),this.resize(),this._update(),this.fire(new f.k("webglcontextrestored",{originalEvent:s}))},this._onMapScroll=s=>{if(s.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=t.interactive,this._maxTileCacheSize=t.maxTileCacheSize,this._maxTileCacheZoomLevels=t.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=t.preserveDrawingBuffer===!0,this._antialias=t.antialias===!0,this._trackResize=t.trackResize===!0,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles===!0,this._fadeDuration=t.fadeDuration,this._crossSourceCollisions=t.crossSourceCollisions===!0,this._collectResourceTiming=t.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Ru),t.locale),this._clickTolerance=t.clickTolerance,this._overridePixelRatio=t.pixelRatio,this._maxCanvasSize=t.maxCanvasSize,this.transformCameraUpdate=t.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=t.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=ut.addThrottleControl(()=>this.isMoving()),this._requestManager=new bt(t.transformRequest),typeof t.container=="string"){if(this._container=document.getElementById(t.container),!this._container)throw new Error(`Container '${t.container}' not found.`)}else{if(!(t.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(t.maxBounds&&this.setMaxBounds(t.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let s=!1;const c=zo(u=>{this._trackResize&&!this._removed&&(this.resize(u),this.redraw())},50);this._resizeObserver=new ResizeObserver(u=>{s?c(u):s=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Cu(this,t),this._hash=t.hash&&new Ml(typeof t.hash=="string"&&t.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(this.resize(),this.fitBounds(t.bounds,f.e({},t.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=t.localIdeographFontFamily,this._validateStyle=t.validateStyle,t.style&&this.setStyle(t.style,{localIdeographFontFamily:t.localIdeographFontFamily}),t.attributionControl&&this.addControl(new Ts(typeof t.attributionControl=="boolean"?void 0:t.attributionControl)),t.maplibreLogo&&this.addControl(new Du,t.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new f.k(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new f.k(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new f.k("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(m,t){if(t===void 0&&(t=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new f.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=m.onAdd(this);this._controls.push(m);const c=this._controlPositions[t];return t.indexOf("bottom")!==-1?c.insertBefore(s,c.firstChild):c.appendChild(s),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new f.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(m);return t>-1&&this._controls.splice(t,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}calculateCameraOptionsFromTo(m,t,s,c){return c==null&&this.terrain&&(c=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(m,t,s,c)}resize(m){var t;const s=this._containerDimensions(),c=s[0],u=s[1],p=this._getClampedPixelRatio(c,u);if(this._resizeCanvas(c,u,p),this.painter.resize(c,u,p),this.painter.overLimit()){const S=this.painter.context.gl;this._maxCanvasSize=[S.drawingBufferWidth,S.drawingBufferHeight];const A=this._getClampedPixelRatio(c,u);this._resizeCanvas(c,u,A),this.painter.resize(c,u,A)}this.transform.resize(c,u),(t=this._requestedCameraState)===null||t===void 0||t.resize(c,u);const x=!this._moving;return x&&(this.stop(),this.fire(new f.k("movestart",m)).fire(new f.k("move",m))),this.fire(new f.k("resize",m)),x&&this.fire(new f.k("moveend",m)),this}_getClampedPixelRatio(m,t){const{0:s,1:c}=this._maxCanvasSize,u=this.getPixelRatio(),p=m*u,x=t*u;return Math.min(p>s?s/p:1,x>c?c/x:1)*u}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(gt.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}project(m){return this.transform.locationPoint(f.N.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.pointLocation(f.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,t,s){if(m==="mouseenter"||m==="mouseover"){let c=!1;return{layers:t,listener:s,delegates:{mousemove:p=>{const x=t.filter(A=>this.getLayer(A)),S=x.length!==0?this.queryRenderedFeatures(p.point,{layers:x}):[];S.length?c||(c=!0,s.call(this,new Gi(m,this,p.originalEvent,{features:S}))):c=!1},mouseout:()=>{c=!1}}}}if(m==="mouseleave"||m==="mouseout"){let c=!1;return{layers:t,listener:s,delegates:{mousemove:x=>{const S=t.filter(A=>this.getLayer(A));(S.length!==0?this.queryRenderedFeatures(x.point,{layers:S}):[]).length?c=!0:c&&(c=!1,s.call(this,new Gi(m,this,x.originalEvent)))},mouseout:x=>{c&&(c=!1,s.call(this,new Gi(m,this,x.originalEvent)))}}}}{const c=u=>{const p=t.filter(S=>this.getLayer(S)),x=p.length!==0?this.queryRenderedFeatures(u.point,{layers:p}):[];x.length&&(u.features=x,s.call(this,u),delete u.features)};return{layers:t,listener:s,delegates:{[m]:c}}}}_saveDelegatedListener(m,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(t)}_removeDelegatedListener(m,t,s){if(!this._delegatedListeners||!this._delegatedListeners[m])return;const c=this._delegatedListeners[m];for(let u=0;u<c.length;u++){const p=c[u];if(p.listener===s&&p.layers.length===t.length&&p.layers.every(x=>t.includes(x))){for(const x in p.delegates)this.off(x,p.delegates[x]);return void c.splice(u,1)}}}on(m,t,s){if(s===void 0)return super.on(m,t);const c=this._createDelegatedListener(m,typeof t=="string"?[t]:t,s);this._saveDelegatedListener(m,c);for(const u in c.delegates)this.on(u,c.delegates[u]);return this}once(m,t,s){if(s===void 0)return super.once(m,t);const c=typeof t=="string"?[t]:t,u=this._createDelegatedListener(m,c,s);for(const p in u.delegates){const x=u.delegates[p];u.delegates[p]=(...S)=>{this._removeDelegatedListener(m,c,s),x(...S)}}this._saveDelegatedListener(m,u);for(const p in u.delegates)this.once(p,u.delegates[p]);return this}off(m,t,s){return s===void 0?super.off(m,t):(this._removeDelegatedListener(m,typeof t=="string"?[t]:t,s),this)}queryRenderedFeatures(m,t){if(!this.style)return[];let s;const c=m instanceof f.P||Array.isArray(m),u=c?m:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(c?{}:m)||{},u instanceof f.P||typeof u[0]=="number")s=[f.P.convert(u)];else{const p=f.P.convert(u[0]),x=f.P.convert(u[1]);s=[p,new f.P(x.x,p.y),x,new f.P(p.x,x.y),p]}return this.style.queryRenderedFeatures(s,t,this.transform)}querySourceFeatures(m,t){return this.style.querySourceFeatures(m,t)}setStyle(m,t){return(t=f.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(m,t))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const t=this._locale[m];if(t==null)throw new Error(`Missing UI string '${m}'`);return t}_updateStyle(m,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(m,t));const s=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new ul(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,t,s):this.style.loadJSON(m,t,s),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ul(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,t){if(typeof m=="string"){const s=this._requestManager.transformRequest(m,"Style");f.h(s,new AbortController).then(c=>{this._updateDiff(c.data,t)}).catch(c=>{c&&this.fire(new f.j(c))})}else typeof m=="object"&&this._updateDiff(m,t)}_updateDiff(m,t){try{this.style.setState(m,t)&&this._update(!0)}catch(s){f.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(m,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():f.w("There is no style added to the map.")}addSource(m,t){return this._lazyInitEmptyStyle(),this.style.addSource(m,t),this._update(!0)}isSourceLoaded(m){const t=this.style&&this.style.sourceCaches[m];if(t!==void 0)return t.loaded();this.fire(new f.j(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const t=this.style.sourceCaches[m.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&t.reload();for(const s in this.style._layers){const c=this.style._layers[s];c.type==="hillshade"&&c.source===m.source&&f.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ku(this.painter,t,m),this.painter.renderToTexture=new Pd(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=s=>{s.dataType==="style"?this.terrain.sourceCache.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==m.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new f.k("terrain",{terrain:m})),this}getTerrain(){var m,t;return(t=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const t in m){const s=m[t]._tiles;for(const c in s){const u=s[c];if(u.state!=="loaded"&&u.state!=="errored")return!1}}return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,t,s={}){const{pixelRatio:c=1,sdf:u=!1,stretchX:p,stretchY:x,content:S,textFitWidth:A,textFitHeight:z}=s;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||f.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new f.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:D,height:I,data:B}=t,U=t;return this.style.addImage(m,{data:new f.R({width:D,height:I},new Uint8Array(B)),pixelRatio:c,stretchX:p,stretchY:x,content:S,textFitWidth:A,textFitHeight:z,sdf:u,version:0,userImage:U}),U.onAdd&&U.onAdd(this,m),this}}{const{width:D,height:I,data:B}=tt.getImageData(t);this.style.addImage(m,{data:new f.R({width:D,height:I},B),pixelRatio:c,stretchX:p,stretchY:x,content:S,textFitWidth:A,textFitHeight:z,sdf:u,version:0})}}updateImage(m,t){const s=this.style.getImage(m);if(!s)return this.fire(new f.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const c=t instanceof HTMLImageElement||f.b(t)?tt.getImageData(t):t,{width:u,height:p,data:x}=c;if(u===void 0||p===void 0)return this.fire(new f.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(u!==s.data.width||p!==s.data.height)return this.fire(new f.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(t instanceof HTMLImageElement||f.b(t));return s.data.replace(x,S),this.style.updateImage(m,s),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new f.j(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return ut.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,t){return this._lazyInitEmptyStyle(),this.style.addLayer(m,t),this._update(!0)}moveLayer(m,t){return this.style.moveLayer(m,t),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,t,s){return this.style.setLayerZoomRange(m,t,s),this._update(!0)}setFilter(m,t,s={}){return this.style.setFilter(m,t,s),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,t,s,c={}){return this.style.setPaintProperty(m,t,s,c),this._update(!0)}getPaintProperty(m,t){return this.style.getPaintProperty(m,t)}setLayoutProperty(m,t,s,c={}){return this.style.setLayoutProperty(m,t,s,c),this._update(!0)}getLayoutProperty(m,t){return this.style.getLayoutProperty(m,t)}setGlyphs(m,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,t,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,t,s,c=>{c||this._update(!0)}),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,t,s=>{s||this._update(!0)}),this}setLight(m,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(m){return this._lazyInitEmptyStyle(),this.style.setSky(m),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,t){return this.style.setFeatureState(m,t),this._update()}removeFeatureState(m,t){return this.style.removeFeatureState(m,t),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,t=0;return this._container&&(m=this._container.clientWidth||400,t=this._container.clientHeight||300),[m,t]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const t=this._canvasContainer=V.create("div","maplibregl-canvas-container",m);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=V.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),c=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],c);const u=this._controlContainer=V.create("div","maplibregl-control-container",m),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{p[x]=V.create("div",`maplibregl-ctrl-${x} `,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,t,s){this._canvas.width=Math.floor(s*m),this._canvas.height=Math.floor(s*t),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const m={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",c=>{t={requestedAttributes:m},c&&(t.statusMessage=c.statusMessage,t.type=c.type)},{once:!0});const s=this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m);if(!s){const c="Failed to initialize WebGL";throw t?(t.message=c,new Error(JSON.stringify(t))):new Error(c)}this.painter=new El(s,this.transform),pt.testSupport(s)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let s=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const u=this.transform.zoom,p=tt.now();this.style.zoomHistory.update(u,p);const x=new f.z(u,{now:p,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),S=x.crossFadingFactor();S===1&&S===this._crossFadingFactor||(s=!0,this._crossFadingFactor=S),this.style.update(x)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new f.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,f.bf.mark(f.bg.load),this.fire(new f.k("load"))),this.style&&(this.style.hasTransitions()||s)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const c=this._sourcesDirty||this._styleDirty||this._placementDirty;return c||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new f.k("idle")),!this._loaded||this._fullyLoaded||c||(this._fullyLoaded=!0,f.bf.mark(f.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ut.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t!=null&&t.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),V.remove(this._canvasContainer),V.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),f.bf.clearMetrics(),this._removed=!0,this.fire(new f.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,tt.frameAsync(this._frameRequest).then(m=>{f.bf.frame(m),this._frameRequest=null,this._render(m)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return Ld}getCameraTargetElevation(){return this.transform.elevation}},T.MapMouseEvent=Gi,T.MapTouchEvent=kr,T.MapWheelEvent=zd,T.Marker=Ol,T.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const t=this._map.getZoom(),s=t===this._map.getMaxZoom(),c=t===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,s)=>{const c=this._map._getUIString(`NavigationControl.${s}`);t.title=c,t.setAttribute("aria-label",c)},this.options=f.e({},tm,m),this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),V.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),V.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=V.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new em(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){V.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,t){const s=V.create("button",m,this._container);return s.type="button",s.addEventListener("click",t),s}},T.Popup=class extends f.E{constructor(m){super(),this.remove=()=>(this._content&&V.remove(this._content),this._container&&(V.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new f.k("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{var s;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=V.create("div","maplibregl-popup",this._map.getContainer()),this._tip=V.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const S of this.options.className.split(" "))this._container.classList.add(S);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Qe(this._lngLat,this._flatPos,this._map.transform):(s=this._lngLat)===null||s===void 0?void 0:s.wrap(),this._trackPointer&&!t)return;const c=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationPoint(this._lngLat));let u=this.options.anchor;const p=Ul(this.options.offset);if(!u){const S=this._container.offsetWidth,A=this._container.offsetHeight;let z;z=c.y+p.bottom.y<A?["top"]:c.y>this._map.transform.height-A?["bottom"]:[],c.x<S/2?z.push("left"):c.x>this._map.transform.width-S/2&&z.push("right"),u=z.length===0?"bottom":z.join("-")}let x=c.add(p[u]);this.options.subpixelPositioning||(x=x.round()),V.setTransform(this._container,`${Es[u]} translate(${x.x}px,${x.y}px)`),Bl(this._container,u,"popup")},this._onClose=()=>{this.remove()},this.options=f.e(Object.create(ie),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new f.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=f.N.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const t=document.createDocumentFragment(),s=document.createElement("body");let c;for(s.innerHTML=m;c=s.firstChild,c;)t.appendChild(c);return this.setDOMContent(t)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=V.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}_createCloseButton(){this.options.closeButton&&(this._closeButton=V.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Fl);m&&m.focus()}},T.RasterDEMTileSource=oi,T.RasterTileSource=ke,T.ScaleControl=class{constructor(m){this._onMove=()=>{Lo(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Lo(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Ca),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){V.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},T.ScrollZoomHandler=ra,T.Style=ul,T.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=V.create("button","maplibregl-ctrl-terrain",this._container),V.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){V.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},T.TwoFingersTouchPitchHandler=bs,T.TwoFingersTouchRotateHandler=Eu,T.TwoFingersTouchZoomHandler=Tu,T.TwoFingersTouchZoomRotateHandler=zu,T.VectorTileSource=po,T.VideoSource=as,T.addSourceType=(m,t)=>f._(void 0,void 0,void 0,function*(){if(_o(m))throw new Error(`A source type called "${m}" already exists.`);((s,c)=>{go[s]=c})(m,t)}),T.clearPrewarmedResources=function(){const m=Mn;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(Zi),Mn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},T.getMaxParallelImageRequests=function(){return f.a.MAX_PARALLEL_IMAGE_REQUESTS},T.getRTLTextPluginStatus=function(){return Ta().getRTLTextPluginStatus()},T.getVersion=function(){return Lu},T.getWorkerCount=function(){return an.workerCount},T.getWorkerUrl=function(){return f.a.WORKER_URL},T.importScriptInWorkers=function(m){return fo().broadcast("IS",m)},T.prewarm=function(){xr().acquire(Zi)},T.setMaxParallelImageRequests=function(m){f.a.MAX_PARALLEL_IMAGE_REQUESTS=m},T.setRTLTextPlugin=function(m,t){return Ta().setRTLTextPlugin(m,t)},T.setWorkerCount=function(m){an.workerCount=m},T.setWorkerUrl=function(m){f.a.WORKER_URL=m}});var w=o;return w})})(Ew);var Lf=Ew.exports;const vE=w_(Lf),xE=()=>{const i=Zs.useRef(null),a=Zs.useRef(null),[o,d]=Zs.useState([]);Zs.useEffect(()=>{const w=new vE.Map({container:i.current,style:{version:8,sources:{osm:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:'&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors'}},layers:[{id:"osm",type:"raster",source:"osm"}]},center:[143.95,43.65],zoom:6});return a.current=w,w.on("click",T=>{const f=Date.now().toString(),q=[T.lngLat.lng,T.lngLat.lat],ct=new Lf.Popup({offset:25}).setHTML(y(f)),vt=new Lf.Marker({color:"#d00"}).setLngLat(q).setPopup(ct).addTo(w);d(tt=>[...tt,{id:f,lngLat:q,marker:vt}])}),()=>{w.remove()}},[]);const y=w=>`
      <div>
        <button onclick="window.handleEdit('${w}')"></button>
        <button onclick="window.handleDelete('${w}')"></button>
      </div>
    `;return Zs.useEffect(()=>{window.handleEdit=w=>{const T=prompt("");if(T!==null){const f=o.find(q=>q.id===w);f&&f.marker.setPopup(new Lf.Popup({offset:25}).setHTML(`<div>${T}<br>${y(w)}</div>`))}},window.handleDelete=w=>{d(T=>{const f=T.find(q=>q.id===w);return f&&f.marker.remove(),T.filter(q=>q.id!==w)})}},[o]),Eg.jsx("div",{ref:i,id:"map",style:{height:"100vh"}})};yE.createRoot(document.getElementById("root")).render(Eg.jsx(FS.StrictMode,{children:Eg.jsx(xE,{})}));
